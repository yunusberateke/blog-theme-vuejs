{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-ui/src/toolbar/toolbarview.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-ui/src/toolbar/toolbarview.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9nZXQgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9nZXQiOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLWluZGV4LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKCi8qKgogKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyMSwgQ0tTb3VyY2UgLSBGcmVkZXJpY28gS25hYmJlbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3Itb3NzLWxpY2Vuc2UKICovCgovKioKICogQG1vZHVsZSB1aS90b29sYmFyL3Rvb2xiYXJ2aWV3CiAqLwppbXBvcnQgVmlldyBmcm9tICcuLi92aWV3JzsKaW1wb3J0IEZvY3VzVHJhY2tlciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9mb2N1c3RyYWNrZXInOwppbXBvcnQgRm9jdXNDeWNsZXIgZnJvbSAnLi4vZm9jdXNjeWNsZXInOwppbXBvcnQgS2V5c3Ryb2tlSGFuZGxlciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9rZXlzdHJva2VoYW5kbGVyJzsKaW1wb3J0IFRvb2xiYXJTZXBhcmF0b3JWaWV3IGZyb20gJy4vdG9vbGJhcnNlcGFyYXRvcnZpZXcnOwppbXBvcnQgVG9vbGJhckxpbmVCcmVha1ZpZXcgZnJvbSAnLi90b29sYmFybGluZWJyZWFrdmlldyc7CmltcG9ydCBSZXNpemVPYnNlcnZlciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9kb20vcmVzaXplb2JzZXJ2ZXInOwppbXBvcnQgcHJldmVudERlZmF1bHQgZnJvbSAnLi4vYmluZGluZ3MvcHJldmVudGRlZmF1bHQuanMnOwppbXBvcnQgUmVjdCBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9kb20vcmVjdCc7CmltcG9ydCBnbG9iYWwgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvZG9tL2dsb2JhbCc7CmltcG9ydCB7IGNyZWF0ZURyb3Bkb3duLCBhZGRUb29sYmFyVG9Ecm9wZG93biB9IGZyb20gJy4uL2Ryb3Bkb3duL3V0aWxzJzsKaW1wb3J0IHsgbG9nV2FybmluZyB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2NrZWRpdG9yZXJyb3InOwppbXBvcnQgbm9ybWFsaXplVG9vbGJhckNvbmZpZyBmcm9tICcuL25vcm1hbGl6ZXRvb2xiYXJjb25maWcnOwppbXBvcnQgeyBpY29ucyB9IGZyb20gJ2NrZWRpdG9yNS9zcmMvY29yZSc7CmltcG9ydCAnLi4vLi4vdGhlbWUvY29tcG9uZW50cy90b29sYmFyL3Rvb2xiYXIuY3NzJzsKLyoqCiAqIFRoZSB0b29sYmFyIHZpZXcgY2xhc3MuCiAqCiAqIEBleHRlbmRzIG1vZHVsZTp1aS92aWV3flZpZXcKICogQGltcGxlbWVudHMgbW9kdWxlOnVpL2Ryb3Bkb3duL2Ryb3Bkb3ducGFuZWxmb2N1c2FibGV+RHJvcGRvd25QYW5lbEZvY3VzYWJsZQogKi8KCnZhciBUb29sYmFyVmlldyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1ZpZXcpIHsKICBfaW5oZXJpdHMoVG9vbGJhclZpZXcsIF9WaWV3KTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihUb29sYmFyVmlldyk7CgogIC8qKgogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlld30gY2xhc3MuCiAgICoKICAgKiBBbHNvIHNlZSB7QGxpbmsgI3JlbmRlcn0uCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9sb2NhbGV+TG9jYWxlfSBsb2NhbGUgVGhlIGxvY2FsaXphdGlvbiBzZXJ2aWNlcyBpbnN0YW5jZS4KICAgKiBAcGFyYW0ge21vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJPcHRpb25zfSBbb3B0aW9uc10gQ29uZmlndXJhdGlvbiBvcHRpb25zIG9mIHRoZSB0b29sYmFyLgogICAqLwogIGZ1bmN0aW9uIFRvb2xiYXJWaWV3KGxvY2FsZSwgb3B0aW9ucykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUb29sYmFyVmlldyk7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBsb2NhbGUpOwogICAgdmFyIGJpbmQgPSBfdGhpcy5iaW5kVGVtcGxhdGU7CiAgICB2YXIgdCA9IF90aGlzLnQ7CiAgICAvKioKICAgICAqIEEgcmVmZXJlbmNlIHRvIHRoZSBvcHRpb25zIG9iamVjdCBwYXNzZWQgdG8gdGhlIGNvbnN0cnVjdG9yLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhck9wdGlvbnN9CiAgICAgKi8KCiAgICBfdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIC8qKgogICAgICogTGFiZWwgdXNlZCBieSBhc3Npc3RpdmUgdGVjaG5vbG9naWVzIHRvIGRlc2NyaWJlIHRoaXMgdG9vbGJhciBlbGVtZW50LgogICAgICoKICAgICAqIEBkZWZhdWx0ICdFZGl0b3IgdG9vbGJhcicKICAgICAqIEBtZW1iZXIge1N0cmluZ30gI2FyaWFMYWJlbAogICAgICovCgogICAgX3RoaXMuc2V0KCdhcmlhTGFiZWwnLCB0KCdFZGl0b3IgdG9vbGJhcicpKTsKICAgIC8qKgogICAgICogVGhlIG1heGltdW0gd2lkdGggb2YgdGhlIHRvb2xiYXIgZWxlbWVudC4KICAgICAqCiAgICAgKiAqKk5vdGUqKjogV2hlbiBzZXQgdG8gYSBzcGVjaWZpYyB2YWx1ZSAoZS5nLiBgJzIwMHB4J2ApLCB0aGUgdmFsdWUgd2lsbCBhZmZlY3QgdGhlIGJlaGF2aW9yIG9mIHRoZQogICAgICoge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJPcHRpb25zI3Nob3VsZEdyb3VwV2hlbkZ1bGx9CiAgICAgKiBvcHRpb24gYnkgY2hhbmdpbmcgdGhlIG51bWJlciBvZiB7QGxpbmsgI2l0ZW1zfSB0aGF0IHdpbGwgYmUgZGlzcGxheWVkIGluIHRoZSB0b29sYmFyIGF0IGEgdGltZS4KICAgICAqCiAgICAgKiBAb2JzZXJ2YWJsZQogICAgICogQGRlZmF1bHQgJ2F1dG8nCiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9ICNtYXhXaWR0aAogICAgICovCgoKICAgIF90aGlzLnNldCgnbWF4V2lkdGgnLCAnYXV0bycpOwogICAgLyoqCiAgICAgKiBBIGNvbGxlY3Rpb24gb2YgdG9vbGJhciBpdGVtcyAoYnV0dG9ucywgZHJvcGRvd25zLCBldGMuKS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS92aWV3Y29sbGVjdGlvbn5WaWV3Q29sbGVjdGlvbn0KICAgICAqLwoKCiAgICBfdGhpcy5pdGVtcyA9IF90aGlzLmNyZWF0ZUNvbGxlY3Rpb24oKTsKICAgIC8qKgogICAgICogVHJhY2tzIGluZm9ybWF0aW9uIGFib3V0IHRoZSBET00gZm9jdXMgaW4gdGhlIHRvb2xiYXIuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXRpbHMvZm9jdXN0cmFja2VyfkZvY3VzVHJhY2tlcn0KICAgICAqLwoKICAgIF90aGlzLmZvY3VzVHJhY2tlciA9IG5ldyBGb2N1c1RyYWNrZXIoKTsKICAgIC8qKgogICAgICogQW4gaW5zdGFuY2Ugb2YgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMva2V5c3Ryb2tlaGFuZGxlcn5LZXlzdHJva2VIYW5kbGVyfQogICAgICogdG8gaGFuZGxlIGtleWJvYXJkIG5hdmlnYXRpb24gaW4gdGhlIHRvb2xiYXIuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXRpbHMva2V5c3Ryb2tlaGFuZGxlcn5LZXlzdHJva2VIYW5kbGVyfQogICAgICovCgogICAgX3RoaXMua2V5c3Ryb2tlcyA9IG5ldyBLZXlzdHJva2VIYW5kbGVyKCk7CiAgICAvKioKICAgICAqIEFuIGFkZGl0aW9uYWwgQ1NTIGNsYXNzIGFkZGVkIHRvIHRoZSB7QGxpbmsgI2VsZW1lbnR9LgogICAgICoKICAgICAqIEBvYnNlcnZhYmxlCiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9ICNjbGFzcwogICAgICovCgogICAgX3RoaXMuc2V0KCdjbGFzcycpOwogICAgLyoqCiAgICAgKiBXaGVuIHNldCB0cnVlLCBtYWtlcyB0aGUgdG9vbGJhciBsb29rIGNvbXBhY3Qgd2l0aCB7QGxpbmsgI2VsZW1lbnR9LgogICAgICoKICAgICAqIEBvYnNlcnZhYmxlCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICogQG1lbWJlciB7U3RyaW5nfSAjaXNDb21wYWN0CiAgICAgKi8KCgogICAgX3RoaXMuc2V0KCdpc0NvbXBhY3QnLCBmYWxzZSk7CiAgICAvKioKICAgICAqIEEgKGNoaWxkKSB2aWV3IGNvbnRhaW5pbmcge0BsaW5rICNpdGVtcyB0b29sYmFyIGl0ZW1zfS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3fkl0ZW1zVmlld30KICAgICAqLwoKCiAgICBfdGhpcy5pdGVtc1ZpZXcgPSBuZXcgSXRlbXNWaWV3KGxvY2FsZSk7CiAgICAvKioKICAgICAqIEEgdG9w4oCTbGV2ZWwgY29sbGVjdGlvbiBhZ2dyZWdhdGluZyBidWlsZGluZyBibG9ja3Mgb2YgdGhlIHRvb2xiYXIuCiAgICAgKgogICAgICoJ4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAIFRvb2xiYXJWaWV3IOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkAogICAgICoJfCDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAgI2NoaWxkcmVuIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkCB8CiAgICAgKgl8IHwgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAgI2l0ZW1zVmlldyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAgICB8IHwKICAgICAqCXwgfCAgIHwgWyBpdGVtMSBdIFsgaXRlbTIgXSAuLi4gWyBpdGVtTiBdIHwgICB8IHwKICAgICAqCXwgfCAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgC3ilJggICB8IHwKICAgICAqCXwg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYIHwKICAgICAqCeKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmAogICAgICoKICAgICAqIEJ5IGRlZmF1bHQsIGl0IGNvbnRhaW5zIHRoZSB7QGxpbmsgI2l0ZW1zVmlld30gYnV0IGl0IGNhbiBiZSBleHRlbmRlZCB3aXRoIGFkZGl0aW9uYWwKICAgICAqIFVJIGVsZW1lbnRzIHdoZW4gbmVjZXNzYXJ5LgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3ZpZXdjb2xsZWN0aW9uflZpZXdDb2xsZWN0aW9ufQogICAgICovCgogICAgX3RoaXMuY2hpbGRyZW4gPSBfdGhpcy5jcmVhdGVDb2xsZWN0aW9uKCk7CgogICAgX3RoaXMuY2hpbGRyZW4uYWRkKF90aGlzLml0ZW1zVmlldyk7CiAgICAvKioKICAgICAqIEEgY29sbGVjdGlvbiBvZiB7QGxpbmsgI2l0ZW1zfSB0aGF0IHRha2UgcGFydCBpbiB0aGUgZm9jdXMgY3ljbGluZwogICAgICogKGkuZS4gbmF2aWdhdGlvbiB1c2luZyB0aGUga2V5Ym9hcmQpLiBVc3VhbGx5LCBpdCBjb250YWlucyBhIHN1YnNldCBvZiB7QGxpbmsgI2l0ZW1zfSB3aXRoCiAgICAgKiBzb21lIG9wdGlvbmFsIFVJIGVsZW1lbnRzIHRoYXQgYWxzbyBiZWxvbmcgdG8gdGhlIHRvb2xiYXIgYW5kIHNob3VsZCBiZSBmb2N1c2FibGUKICAgICAqIGJ5IHRoZSB1c2VyLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3ZpZXdjb2xsZWN0aW9uflZpZXdDb2xsZWN0aW9ufQogICAgICovCgoKICAgIF90aGlzLmZvY3VzYWJsZXMgPSBfdGhpcy5jcmVhdGVDb2xsZWN0aW9uKCk7CiAgICAvKioKICAgICAqIENvbnRyb2xzIHRoZSBvcmllbnRhdGlvbiBvZiB0b29sYmFyIGl0ZW1zLiBPbmx5IGF2YWlsYWJsZSB3aGVuCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhck9wdGlvbnMjc2hvdWxkR3JvdXBXaGVuRnVsbCBkeW5hbWljIGl0ZW1zIGdyb3VwaW5nfQogICAgICogaXMgKipkaXNhYmxlZCoqLgogICAgICoKICAgICAqIEBvYnNlcnZhYmxlCiAgICAgKiBAbWVtYmVyIHtCb29sZWFufSAjaXNWZXJ0aWNhbAogICAgICovCgogICAgLyoqCiAgICAgKiBIZWxwcyBjeWNsaW5nIG92ZXIge0BsaW5rICNmb2N1c2FibGVzIGZvY3VzYWJsZSBpdGVtc30gaW4gdGhlIHRvb2xiYXIuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dWkvZm9jdXNjeWNsZXJ+Rm9jdXNDeWNsZXJ9CiAgICAgKi8KCiAgICBfdGhpcy5fZm9jdXNDeWNsZXIgPSBuZXcgRm9jdXNDeWNsZXIoewogICAgICBmb2N1c2FibGVzOiBfdGhpcy5mb2N1c2FibGVzLAogICAgICBmb2N1c1RyYWNrZXI6IF90aGlzLmZvY3VzVHJhY2tlciwKICAgICAga2V5c3Ryb2tlSGFuZGxlcjogX3RoaXMua2V5c3Ryb2tlcywKICAgICAgYWN0aW9uczogewogICAgICAgIC8vIE5hdmlnYXRlIHRvb2xiYXIgaXRlbXMgYmFja3dhcmRzIHVzaW5nIHRoZSBhcnJvd1tsZWZ0LHVwXSBrZXlzLgogICAgICAgIGZvY3VzUHJldmlvdXM6IFsnYXJyb3dsZWZ0JywgJ2Fycm93dXAnXSwKICAgICAgICAvLyBOYXZpZ2F0ZSB0b29sYmFyIGl0ZW1zIGZvcndhcmRzIHVzaW5nIHRoZSBhcnJvd1tyaWdodCxkb3duXSBrZXlzLgogICAgICAgIGZvY3VzTmV4dDogWydhcnJvd3JpZ2h0JywgJ2Fycm93ZG93biddCiAgICAgIH0KICAgIH0pOwogICAgdmFyIGNsYXNzZXMgPSBbJ2NrJywgJ2NrLXRvb2xiYXInLCBiaW5kLnRvKCdjbGFzcycpLCBiaW5kLmlmKCdpc0NvbXBhY3QnLCAnY2stdG9vbGJhcl9jb21wYWN0JyldOwoKICAgIGlmIChfdGhpcy5vcHRpb25zLnNob3VsZEdyb3VwV2hlbkZ1bGwgJiYgX3RoaXMub3B0aW9ucy5pc0Zsb2F0aW5nKSB7CiAgICAgIGNsYXNzZXMucHVzaCgnY2stdG9vbGJhcl9mbG9hdGluZycpOwogICAgfQoKICAgIF90aGlzLnNldFRlbXBsYXRlKHsKICAgICAgdGFnOiAnZGl2JywKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBjbGFzc2VzLAogICAgICAgIHJvbGU6ICd0b29sYmFyJywKICAgICAgICAnYXJpYS1sYWJlbCc6IGJpbmQudG8oJ2FyaWFMYWJlbCcpLAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBtYXhXaWR0aDogYmluZC50bygnbWF4V2lkdGgnKQogICAgICAgIH0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IF90aGlzLmNoaWxkcmVuLAogICAgICBvbjogewogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtdWkvaXNzdWVzLzIwNgogICAgICAgIG1vdXNlZG93bjogcHJldmVudERlZmF1bHQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpCiAgICAgIH0KICAgIH0pOwogICAgLyoqCiAgICAgKiBBbiBpbnN0YW5jZSBvZiB0aGUgYWN0aXZlIHRvb2xiYXIgYmVoYXZpb3IgdGhhdCBzaGFwZXMgaXRzIGxvb2sgYW5kIGZ1bmN0aW9uYWxpdHkuCiAgICAgKgogICAgICogU2VlIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyQmVoYXZpb3J9IHRvIGxlYXJuIG1vcmUuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyQmVoYXZpb3J9CiAgICAgKi8KCgogICAgX3RoaXMuX2JlaGF2aW9yID0gX3RoaXMub3B0aW9ucy5zaG91bGRHcm91cFdoZW5GdWxsID8gbmV3IER5bmFtaWNHcm91cGluZyhfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSkgOiBuZXcgU3RhdGljTGF5b3V0KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgIHJldHVybiBfdGhpczsKICB9CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhUb29sYmFyVmlldywgW3sKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKFRvb2xiYXJWaWV3LnByb3RvdHlwZSksICJyZW5kZXIiLCB0aGlzKS5jYWxsKHRoaXMpOyAvLyBDaGlsZHJlbiBhZGRlZCBiZWZvcmUgcmVuZGVyaW5nIHNob3VsZCBiZSBrbm93biB0byB0aGUgI2ZvY3VzVHJhY2tlci4KCgogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5pdGVtcyksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBpdGVtID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICB0aGlzLmZvY3VzVHJhY2tlci5hZGQoaXRlbS5lbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgfQoKICAgICAgdGhpcy5pdGVtcy5vbignYWRkJywgZnVuY3Rpb24gKGV2dCwgaXRlbSkgewogICAgICAgIF90aGlzMi5mb2N1c1RyYWNrZXIuYWRkKGl0ZW0uZWxlbWVudCk7CiAgICAgIH0pOwogICAgICB0aGlzLml0ZW1zLm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoZXZ0LCBpdGVtKSB7CiAgICAgICAgX3RoaXMyLmZvY3VzVHJhY2tlci5yZW1vdmUoaXRlbS5lbGVtZW50KTsKICAgICAgfSk7IC8vIFN0YXJ0IGxpc3RlbmluZyBmb3IgdGhlIGtleXN0cm9rZXMgY29taW5nIGZyb20gI2VsZW1lbnQuCgogICAgICB0aGlzLmtleXN0cm9rZXMubGlzdGVuVG8odGhpcy5lbGVtZW50KTsKCiAgICAgIHRoaXMuX2JlaGF2aW9yLnJlbmRlcih0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICB0aGlzLl9iZWhhdmlvci5kZXN0cm95KCk7CgogICAgICByZXR1cm4gX2dldChfZ2V0UHJvdG90eXBlT2YoVG9vbGJhclZpZXcucHJvdG90eXBlKSwgImRlc3Ryb3kiLCB0aGlzKS5jYWxsKHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBGb2N1c2VzIHRoZSBmaXJzdCBmb2N1c2FibGUgaW4ge0BsaW5rICNmb2N1c2FibGVzfS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb2N1cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXMoKSB7CiAgICAgIHRoaXMuX2ZvY3VzQ3ljbGVyLmZvY3VzRmlyc3QoKTsKICAgIH0KICAgIC8qKgogICAgICogRm9jdXNlcyB0aGUgbGFzdCBmb2N1c2FibGUgaW4ge0BsaW5rICNmb2N1c2FibGVzfS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb2N1c0xhc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzTGFzdCgpIHsKICAgICAgdGhpcy5fZm9jdXNDeWNsZXIuZm9jdXNMYXN0KCk7CiAgICB9CiAgICAvKioKICAgICAqIEEgdXRpbGl0eSB0aGF0IGV4cGFuZHMgdGhlIHBsYWluIHRvb2xiYXIgY29uZmlndXJhdGlvbiBpbnRvCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjaXRlbXN9IHVzaW5nIGEgZ2l2ZW4gY29tcG9uZW50IGZhY3RvcnkuCiAgICAgKgogICAgICogQHBhcmFtIHtBcnJheS48U3RyaW5nPnxPYmplY3R9IGl0ZW1zT3JDb25maWcgVGhlIHRvb2xiYXIgaXRlbXMgb3IgdGhlIGVudGlyZSB0b29sYmFyIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgogICAgICogQHBhcmFtIHttb2R1bGU6dWkvY29tcG9uZW50ZmFjdG9yeX5Db21wb25lbnRGYWN0b3J5fSBmYWN0b3J5IEEgZmFjdG9yeSBwcm9kdWNpbmcgdG9vbGJhciBpdGVtcy4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWxsRnJvbUNvbmZpZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsbEZyb21Db25maWcoaXRlbXNPckNvbmZpZywgZmFjdG9yeSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBjb25maWcgPSBub3JtYWxpemVUb29sYmFyQ29uZmlnKGl0ZW1zT3JDb25maWcpOwogICAgICB2YXIgaXRlbXNUb0NsZWFuID0gY29uZmlnLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAobmFtZSwgaWR4LCBpdGVtcykgewogICAgICAgIGlmIChuYW1lID09PSAnfCcpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gSXRlbXMgbGlzdGVkIGluIGBjb25maWcucmVtb3ZlSXRlbXNgIHNob3VsZCBub3QgYmUgYWRkZWQgdG8gdGhlIHRvb2xiYXIuCgoKICAgICAgICBpZiAoY29uZmlnLnJlbW92ZUl0ZW1zLmluZGV4T2YobmFtZSkgIT09IC0xKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAobmFtZSA9PT0gJy0nKSB7CiAgICAgICAgICAvLyBUaGUgdG9vbGJhciBsaW5lIGJyZWFrcyBtdXN0IG5vdCBiZSByZW5kZXJlZCB3aGVuIHRvb2xiYXIgZ3JvdXBpbmcgaXMgZW5hYmxlZC4KICAgICAgICAgIC8vIChodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy84NTgyKQogICAgICAgICAgaWYgKF90aGlzMy5vcHRpb25zLnNob3VsZEdyb3VwV2hlbkZ1bGwpIHsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRoZSB0b29sYmFyIG11bHRpbGluZSBicmVha3MgKGAtYCBpdGVtcykgb25seSB3b3JrIHdoZW4gdGhlIGF1dG9tYXRpYyBidXR0b24gZ3JvdXBpbmcKICAgICAgICAgICAgICogaXMgZGlzYWJsZWQgaW4gdGhlIHRvb2xiYXIgY29uZmlndXJhdGlvbi4KICAgICAgICAgICAgICogVG8gZG8gdGhpcywgc2V0IHRoZSBgc2hvdWxkTm90R3JvdXBXaGVuRnVsbGAgb3B0aW9uIHRvIGB0cnVlYCBpbiB0aGUgZWRpdG9yIGNvbmZpZ3VyYXRpb246CiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqCQljb25zdCBjb25maWcgPSB7CiAgICAgICAgICAgICAqCQkJdG9vbGJhcjogewogICAgICAgICAgICAgKgkJCQlpdGVtczogWyAuLi4gXSwKICAgICAgICAgICAgICoJCQkJc2hvdWxkTm90R3JvdXBXaGVuRnVsbDogdHJ1ZQogICAgICAgICAgICAgKgkJCX0KICAgICAgICAgICAgICoJCX0KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogTGVhcm4gbW9yZSBhYm91dCB7QGxpbmsgbW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcmNvbmZpZ35FZGl0b3JDb25maWcjdG9vbGJhciB0b29sYmFyIGNvbmZpZ3VyYXRpb259LgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBAZXJyb3IgdG9vbGJhcnZpZXctbGluZS1icmVhay1pZ25vcmVkLXdoZW4tZ3JvdXBpbmctaXRlbXMKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGxvZ1dhcm5pbmcoJ3Rvb2xiYXJ2aWV3LWxpbmUtYnJlYWstaWdub3JlZC13aGVuLWdyb3VwaW5nLWl0ZW1zJywgaXRlbXMpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvLyBGb3IgdGhlIGl0ZW1zIHRoYXQgY2Fubm90IGJlIGluc3RhbnRpYXRlZCB3ZSBhcmUgc2VuZGluZyB3YXJuaW5nIG1lc3NhZ2UuIFdlIGFsc28gZmlsdGVyIHRoZW0gb3V0LgoKCiAgICAgICAgaWYgKCFmYWN0b3J5LmhhcyhuYW1lKSkgewogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGVyZSB3YXMgYSBwcm9ibGVtIHByb2Nlc3NpbmcgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHRvb2xiYXIuIFRoZSBpdGVtIHdpdGggdGhlIGdpdmVuCiAgICAgICAgICAgKiBuYW1lIGRvZXMgbm90IGV4aXN0IHNvIGl0IHdhcyBvbWl0dGVkIHdoZW4gcmVuZGVyaW5nIHRoZSB0b29sYmFyLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgd2FybmluZyB1c3VhbGx5IHNob3dzIHVwIHdoZW4gdGhlIHtAbGluayBtb2R1bGU6Y29yZS9wbHVnaW5+UGx1Z2lufSB3aGljaCBpcyBzdXBwb3NlZAogICAgICAgICAgICogdG8gcHJvdmlkZSBhIHRvb2xiYXIgaXRlbSBoYXMgbm90IGJlZW4gbG9hZGVkIG9yIHRoZXJlIGlzIGEgdHlwbyBpbiB0aGUgY29uZmlndXJhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBNYWtlIHN1cmUgdGhlIHBsdWdpbiByZXNwb25zaWJsZSBmb3IgdGhpcyB0b29sYmFyIGl0ZW0gaXMgbG9hZGVkIGFuZCB0aGUgdG9vbGJhciBjb25maWd1cmF0aW9uCiAgICAgICAgICAgKiBpcyBjb3JyZWN0LCBlLmcuIHtAbGluayBtb2R1bGU6YmFzaWMtc3R5bGVzL2JvbGR+Qm9sZH0gaXMgbG9hZGVkIGZvciB0aGUgYCdib2xkJ2AgdG9vbGJhciBpdGVtLgogICAgICAgICAgICoKICAgICAgICAgICAqIFlvdSBjYW4gdXNlIHRoZSBmb2xsb3dpbmcgc25pcHBldCB0byByZXRyaWV2ZSBhbGwgYXZhaWxhYmxlIHRvb2xiYXIgaXRlbXM6CiAgICAgICAgICAgKgogICAgICAgICAgICoJCUFycmF5LmZyb20oIGVkaXRvci51aS5jb21wb25lbnRGYWN0b3J5Lm5hbWVzKCkgKTsKICAgICAgICAgICAqCiAgICAgICAgICAgKiBAZXJyb3IgdG9vbGJhcnZpZXctaXRlbS11bmF2YWlsYWJsZQogICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudC4KICAgICAgICAgICAqLwogICAgICAgICAgbG9nV2FybmluZygndG9vbGJhcnZpZXctaXRlbS11bmF2YWlsYWJsZScsIHsKICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSk7CgogICAgICB2YXIgaXRlbXNUb0FkZCA9IHRoaXMuX2NsZWFuU2VwYXJhdG9ycyhpdGVtc1RvQ2xlYW4pIC8vIEluc3RhbnRpYXRlIHRvb2xiYXIgaXRlbXMuCiAgICAgIC5tYXAoZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICBpZiAobmFtZSA9PT0gJ3wnKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFRvb2xiYXJTZXBhcmF0b3JWaWV3KCk7CiAgICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnLScpIHsKICAgICAgICAgIHJldHVybiBuZXcgVG9vbGJhckxpbmVCcmVha1ZpZXcoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWN0b3J5LmNyZWF0ZShuYW1lKTsKICAgICAgfSk7CgogICAgICB0aGlzLml0ZW1zLmFkZE1hbnkoaXRlbXNUb0FkZCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBsZWFkaW5nLCB0cmFpbGluZywgYW5kIGR1cGxpY2F0ZWQgc2VwYXJhdG9ycyAoYC1gIGFuZCBgfGApLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge0FycmF5LjxTdHJpbmc+fSBpdGVtcwogICAgICovCgogIH0sIHsKICAgIGtleTogIl9jbGVhblNlcGFyYXRvcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jbGVhblNlcGFyYXRvcnMoaXRlbXMpIHsKICAgICAgdmFyIG5vblNlcGFyYXRvclByZWRpY2F0ZSA9IGZ1bmN0aW9uIG5vblNlcGFyYXRvclByZWRpY2F0ZShpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0gIT09ICctJyAmJiBpdGVtICE9PSAnfCc7CiAgICAgIH07CgogICAgICB2YXIgY291bnQgPSBpdGVtcy5sZW5ndGg7IC8vIEZpbmQgYW4gaW5kZXggb2YgdGhlIGZpcnN0IGl0ZW0gdGhhdCBpcyBub3QgYSBzZXBhcmF0b3IuCgogICAgICB2YXIgZmlyc3RDb21tYW5kSXRlbSA9IGl0ZW1zLmZpbmRJbmRleChub25TZXBhcmF0b3JQcmVkaWNhdGUpOyAvLyBTZWFyY2ggZnJvbSB0aGUgZW5kIG9mIHRoZSBsaXN0LCB0aGVuIGNvbnZlcnQgZm91bmQgaW5kZXggYmFjayB0byB0aGUgb3JpZ2luYWwgZGlyZWN0aW9uLgoKICAgICAgdmFyIGxhc3RDb21tYW5kSXRlbSA9IGNvdW50IC0gaXRlbXMuc2xpY2UoKS5yZXZlcnNlKCkuZmluZEluZGV4KG5vblNlcGFyYXRvclByZWRpY2F0ZSk7CiAgICAgIHJldHVybiBpdGVtcyAvLyBSZXR1cm4gaXRlbXMgd2l0aG91dCB0aGUgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2VwYXJhdG9ycy4KICAgICAgLnNsaWNlKGZpcnN0Q29tbWFuZEl0ZW0sIGxhc3RDb21tYW5kSXRlbSkgLy8gUmVtb3ZlIGR1cGxpY2F0ZWQgc2VwYXJhdG9ycy4KICAgICAgLmZpbHRlcihmdW5jdGlvbiAobmFtZSwgaWR4LCBpdGVtcykgewogICAgICAgIC8vIEZpbHRlciBvbmx5IHNlcGFyYXRvcnMuCiAgICAgICAgaWYgKG5vblNlcGFyYXRvclByZWRpY2F0ZShuYW1lKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgaXNEdXBsaWNhdGVkID0gaWR4ID4gMCAmJiBpdGVtc1tpZHggLSAxXSA9PT0gbmFtZTsKICAgICAgICByZXR1cm4gIWlzRHVwbGljYXRlZDsKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEZpcmVkIHdoZW4gc29tZSB0b29sYmFyIHtAbGluayAjaXRlbXN9IHdlcmUgZ3JvdXBlZCBvciB1bmdyb3VwZWQgYXMgYSByZXN1bHQgb2Ygc29tZSBjaGFuZ2UKICAgICAqIGluIHRoZSB0b29sYmFyIGdlb21ldHJ5LgogICAgICoKICAgICAqICoqTm90ZSoqOiBUaGlzIGV2ZW50IGlzIGFsd2F5cyBmaXJlZCAqKm9uY2UqKiByZWdhcmRsZXNzIG9mIHRoZSBudW1iZXIgb2YgaXRlbXMgdGhhdCB3ZXJlIGJlCiAgICAgKiBncm91cGVkIG9yIHVuZ3JvdXBlZCBhdCBhIHRpbWUuCiAgICAgKgogICAgICogKipOb3RlKio6IFRoaXMgZXZlbnQgaXMgZmlyZWQgb25seSBpZiB0aGUgaXRlbXMgZ3JvdXBpbmcgZnVuY3Rpb25hbGl0eSB3YXMgZW5hYmxlZCBpbgogICAgICogdGhlIGZpcnN0IHBsYWNlIChzZWUge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJPcHRpb25zI3Nob3VsZEdyb3VwV2hlbkZ1bGx9KS4KICAgICAqCiAgICAgKiBAZXZlbnQgZ3JvdXBlZEl0ZW1zVXBkYXRlCiAgICAgKi8KCiAgfV0pOwoKICByZXR1cm4gVG9vbGJhclZpZXc7Cn0oVmlldyk7Ci8qKgogKiBBbiBpbm5lciBibG9jayBvZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3fSBob3N0aW5nIGl0cwogKiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjaXRlbXN9LgogKgogKiBAcHJpdmF0ZQogKiBAZXh0ZW5kcyBtb2R1bGU6dWkvdmlld35WaWV3CiAqLwoKCmV4cG9ydCB7IFRvb2xiYXJWaWV3IGFzIGRlZmF1bHQgfTsKCnZhciBJdGVtc1ZpZXcgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9WaWV3MikgewogIF9pbmhlcml0cyhJdGVtc1ZpZXcsIF9WaWV3Mik7CgogIHZhciBfc3VwZXIyID0gX2NyZWF0ZVN1cGVyKEl0ZW1zVmlldyk7CgogIC8qKgogICAqIEBpbmhlcml0RG9jCiAgICovCiAgZnVuY3Rpb24gSXRlbXNWaWV3KGxvY2FsZSkgewogICAgdmFyIF90aGlzNDsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSXRlbXNWaWV3KTsKCiAgICBfdGhpczQgPSBfc3VwZXIyLmNhbGwodGhpcywgbG9jYWxlKTsKICAgIC8qKgogICAgICogQSBjb2xsZWN0aW9uIG9mIGl0ZW1zIChidXR0b25zLCBkcm9wZG93bnMsIGV0Yy4pLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3ZpZXdjb2xsZWN0aW9uflZpZXdDb2xsZWN0aW9ufQogICAgICovCgogICAgX3RoaXM0LmNoaWxkcmVuID0gX3RoaXM0LmNyZWF0ZUNvbGxlY3Rpb24oKTsKCiAgICBfdGhpczQuc2V0VGVtcGxhdGUoewogICAgICB0YWc6ICdkaXYnLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsnY2snLCAnY2stdG9vbGJhcl9faXRlbXMnXQogICAgICB9LAogICAgICBjaGlsZHJlbjogX3RoaXM0LmNoaWxkcmVuCiAgICB9KTsKCiAgICByZXR1cm4gX3RoaXM0OwogIH0KCiAgcmV0dXJuIEl0ZW1zVmlldzsKfShWaWV3KTsKLyoqCiAqIEEgdG9vbGJhciBiZWhhdmlvciB0aGF0IG1ha2VzIGl0IHN0YXRpYyBhbmQgdW5yZXNwb25zaXZlIHRvIHRoZSBjaGFuZ2VzIG9mIHRoZSBlbnZpcm9ubWVudC4KICogQXQgdGhlIHNhbWUgdGltZSwgaXQgYWxzbyBtYWtlcyBpdCBwb3NzaWJsZSB0byBkaXNwbGF5IGEgdG9vbGJhciB3aXRoIGEgdmVydGljYWwgbGF5b3V0CiAqIHVzaW5nIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjaXNWZXJ0aWNhbH0gcHJvcGVydHkuCiAqCiAqIEBwcml2YXRlCiAqIEBpbXBsZW1lbnRzIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJCZWhhdmlvcgogKi8KCgp2YXIgU3RhdGljTGF5b3V0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+U3RhdGljTGF5b3V0fSB0b29sYmFyCiAgICogYmVoYXZpb3IuCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3fSB2aWV3IEFuIGluc3RhbmNlIG9mIHRoZSB0b29sYmFyIHRoYXQgdGhpcyBiZWhhdmlvcgogICAqIGlzIGFkZGVkIHRvLgogICAqLwogIGZ1bmN0aW9uIFN0YXRpY0xheW91dCh2aWV3KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3RhdGljTGF5b3V0KTsKCiAgICB2YXIgYmluZCA9IHZpZXcuYmluZFRlbXBsYXRlOyAvLyBTdGF0aWMgdG9vbGJhciBjYW4gYmUgdmVydGljYWwgd2hlbiBuZWVkZWQuCgogICAgdmlldy5zZXQoJ2lzVmVydGljYWwnLCBmYWxzZSk7IC8vIDE6MSBwYXNz4oCTdGhyb3VnaCBiaW5kaW5nLCBhbGwgVG9vbGJhclZpZXcjaXRlbXMgYXJlIHZpc2libGUuCgogICAgdmlldy5pdGVtc1ZpZXcuY2hpbGRyZW4uYmluZFRvKHZpZXcuaXRlbXMpLnVzaW5nKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHJldHVybiBpdGVtOwogICAgfSk7IC8vIDE6MSBwYXNz4oCTdGhyb3VnaCBiaW5kaW5nLCBhbGwgVG9vbGJhclZpZXcjaXRlbXMgYXJlIGZvY3VzYWJsZS4KCiAgICB2aWV3LmZvY3VzYWJsZXMuYmluZFRvKHZpZXcuaXRlbXMpLnVzaW5nKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHJldHVybiBpdGVtOwogICAgfSk7CiAgICB2aWV3LmV4dGVuZFRlbXBsYXRlKHsKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbLy8gV2hlbiB2ZXJ0aWNhbCwgdGhlIHRvb2xiYXIgaGFzIGFuIGFkZGl0aW9uYWwgQ1NTIGNsYXNzLgogICAgICAgIGJpbmQuaWYoJ2lzVmVydGljYWwnLCAnY2stdG9vbGJhcl92ZXJ0aWNhbCcpXQogICAgICB9CiAgICB9KTsKICB9CiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhTdGF0aWNMYXlvdXQsIFt7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHt9CiAgICAvKioKICAgICAqIEBpbmhlcml0RG9jCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHt9CiAgfV0pOwoKICByZXR1cm4gU3RhdGljTGF5b3V0Owp9KCk7Ci8qKgogKiBBIHRvb2xiYXIgYmVoYXZpb3IgdGhhdCBtYWtlcyB0aGUgaXRlbXMgcmVzcG9uZCB0byBjaGFuZ2VzIGluIHRoZSBnZW9tZXRyeS4KICoKICogSW4gYSBudXRzaGVsbCwgaXQgZ3JvdXBzIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNpdGVtc30KICogdGhhdCBkbyBub3QgZml0IHZpc3VhbGx5IGludG8gYSBzaW5nbGUgcm93IG9mIHRoZSB0b29sYmFyIChkdWUgdG8gbGltaXRlZCBzcGFjZSkuCiAqIEl0ZW1zIHRoYXQgZG8gbm90IGZpdCBhcmUgYWdncmVnYXRlZCBpbiBhIGRyb3Bkb3duIGRpc3BsYXllZCBhdCB0aGUgZW5kIG9mIHRoZSB0b29sYmFyLgogKgogKgnilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAgVG9vbGJhclZpZXcg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQCiAqCXwg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAICNjaGlsZHJlbiDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAgfAogKgl8IHwgICDilIzilIDilIDilIDilIDilIDilIDilIAgI2l0ZW1zVmlldyDilIDilIDilIDilIDilIDilIDilIDilIDilJAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQIOKUjOKUgOKUgCAjZ3JvdXBlZEl0ZW1zRHJvcGRvd24g4pSA4pSA4pSA4pSQICAgfCB8CiAqCXwgfCAgIHwgICAgICAgI3VuZ3JvdXBlZEl0ZW1zICAgICB8IHwgVG9vbGJhclNlcGFyYXRvclZpZXcgfCB8ICAgICAgICAjZ3JvdXBlZEl0ZW1zICAgICAgIHwgICB8IHwKICoJfCB8ICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSALeKUmCDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgfCB8CiAqCXwgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcLS0tLS0tLS0tLSBvbmx5IHdoZW4gdG9vbGJhciBpdGVtcyBvdmVyZmxvdyAtLS0tLS0tLS8gICAgfCB8CiAqCXwg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYIHwKICoJ4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYCiAqCiAqIEBwcml2YXRlCiAqIEBpbXBsZW1lbnRzIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJCZWhhdmlvcgogKi8KCgp2YXIgRHluYW1pY0dyb3VwaW5nID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAvKioKICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+RHluYW1pY0dyb3VwaW5nfSB0b29sYmFyCiAgICogYmVoYXZpb3IuCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3fSB2aWV3IEFuIGluc3RhbmNlIG9mIHRoZSB0b29sYmFyIHRoYXQgdGhpcyBiZWhhdmlvcgogICAqIGlzIGFkZGVkIHRvLgogICAqLwogIGZ1bmN0aW9uIER5bmFtaWNHcm91cGluZyh2aWV3KSB7CiAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRHluYW1pY0dyb3VwaW5nKTsKCiAgICAvKioKICAgICAqIEEgdG9vbGJhciB2aWV3IHRoaXMgYmVoYXZpb3IgYmVsb25ncyB0by4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS90b29sYmFyflRvb2xiYXJWaWV3fQogICAgICovCiAgICB0aGlzLnZpZXcgPSB2aWV3OwogICAgLyoqCiAgICAgKiBBIGNvbGxlY3Rpb24gb2YgdG9vbGJhciBjaGlsZHJlbi4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS92aWV3Y29sbGVjdGlvbn5WaWV3Q29sbGVjdGlvbn0KICAgICAqLwoKICAgIHRoaXMudmlld0NoaWxkcmVuID0gdmlldy5jaGlsZHJlbjsKICAgIC8qKgogICAgICogQSBjb2xsZWN0aW9uIG9mIGZvY3VzYWJsZSB0b29sYmFyIGVsZW1lbnRzLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3ZpZXdjb2xsZWN0aW9uflZpZXdDb2xsZWN0aW9ufQogICAgICovCgogICAgdGhpcy52aWV3Rm9jdXNhYmxlcyA9IHZpZXcuZm9jdXNhYmxlczsKICAgIC8qKgogICAgICogQSB2aWV3IGNvbnRhaW5pbmcgdG9vbGJhciBpdGVtcy4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3fkl0ZW1zVmlld30KICAgICAqLwoKICAgIHRoaXMudmlld0l0ZW1zVmlldyA9IHZpZXcuaXRlbXNWaWV3OwogICAgLyoqCiAgICAgKiBUb29sYmFyIGZvY3VzIHRyYWNrZXIuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXRpbHMvZm9jdXN0cmFja2VyfkZvY3VzVHJhY2tlcn0KICAgICAqLwoKICAgIHRoaXMudmlld0ZvY3VzVHJhY2tlciA9IHZpZXcuZm9jdXNUcmFja2VyOwogICAgLyoqCiAgICAgKiBUb29sYmFyIGxvY2FsZS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1dGlscy9sb2NhbGV+TG9jYWxlfQogICAgICovCgogICAgdGhpcy52aWV3TG9jYWxlID0gdmlldy5sb2NhbGU7CiAgICAvKioKICAgICAqIFRvb2xiYXIgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge0hUTUxFbGVtZW50fSAjdmlld0VsZW1lbnQKICAgICAqLwoKICAgIC8qKgogICAgICogQSBzdWJzZXQgb2YgdG9vbGJhciB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjaXRlbXN9LgogICAgICogQWdncmVnYXRlcyBpdGVtcyB0aGF0IGZpdCBpbnRvIGEgc2luZ2xlIHJvdyBvZiB0aGUgdG9vbGJhciBhbmQgd2VyZSBub3Qge0BsaW5rICNncm91cGVkSXRlbXMgZ3JvdXBlZH0KICAgICAqIGludG8gYSB7QGxpbmsgI2dyb3VwZWRJdGVtc0Ryb3Bkb3duIGRyb3Bkb3dufS4gSXRlbXMgb2YgdGhpcyBjb2xsZWN0aW9uIGFyZSBkaXNwbGF5ZWQgaW4gdGhlCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjaXRlbXNWaWV3fS4KICAgICAqCiAgICAgKiBXaGVuIG5vbmUgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNpdGVtc30gd2VyZSBncm91cGVkLCBpdAogICAgICogbWF0Y2hlcyB0aGUge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3I2l0ZW1zfSBjb2xsZWN0aW9uIGluIHNpemUgYW5kIG9yZGVyLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3ZpZXdjb2xsZWN0aW9uflZpZXdDb2xsZWN0aW9ufQogICAgICovCgogICAgdGhpcy51bmdyb3VwZWRJdGVtcyA9IHZpZXcuY3JlYXRlQ29sbGVjdGlvbigpOwogICAgLyoqCiAgICAgKiBBIHN1YnNldCBvZiB0b29sYmFyIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNpdGVtc30uCiAgICAgKiBBIGNvbGxlY3Rpb24gb2YgdGhlIHRvb2xiYXIgaXRlbXMgdGhhdCBkbyBub3QgZml0IGludG8gYSBzaW5nbGUgcm93IG9mIHRoZSB0b29sYmFyLgogICAgICogR3JvdXBlZCBpdGVtcyBhcmUgZGlzcGxheWVkIGluIGEgZGVkaWNhdGVkIHtAbGluayAjZ3JvdXBlZEl0ZW1zRHJvcGRvd24gZHJvcGRvd259LgogICAgICoKICAgICAqIFdoZW4gbm9uZSBvZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3I2l0ZW1zfSB3ZXJlIGdyb3VwZWQsCiAgICAgKiB0aGlzIGNvbGxlY3Rpb24gaXMgZW1wdHkuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dWkvdmlld2NvbGxlY3Rpb25+Vmlld0NvbGxlY3Rpb259CiAgICAgKi8KCiAgICB0aGlzLmdyb3VwZWRJdGVtcyA9IHZpZXcuY3JlYXRlQ29sbGVjdGlvbigpOwogICAgLyoqCiAgICAgKiBUaGUgZHJvcGRvd24gdGhhdCBhZ2dyZWdhdGVzIHtAbGluayAjZ3JvdXBlZEl0ZW1zIGdyb3VwZWQgaXRlbXN9IHRoYXQgZG8gbm90IGZpdCBpbnRvIGEgc2luZ2xlCiAgICAgKiByb3cgb2YgdGhlIHRvb2xiYXIuIEl0IGlzIGRpc3BsYXllZCBvbiBkZW1hbmQgYXMgdGhlIGxhc3Qgb2YKICAgICAqIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNjaGlsZHJlbiB0b29sYmFyIGNoaWxkcmVufSBhbmQgb2ZmZXJzIGFub3RoZXIKICAgICAqIChuZXN0ZWQpIHRvb2xiYXIgd2hpY2ggZGlzcGxheXMgaXRlbXMgdGhhdCB3b3VsZCBub3JtYWxseSBvdmVyZmxvdy4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS9kcm9wZG93bi9kcm9wZG93bnZpZXd+RHJvcGRvd25WaWV3fQogICAgICovCgogICAgdGhpcy5ncm91cGVkSXRlbXNEcm9wZG93biA9IHRoaXMuX2NyZWF0ZUdyb3VwZWRJdGVtc0Ryb3Bkb3duKCk7CiAgICAvKioKICAgICAqIEFuIGluc3RhbmNlIG9mIHRoZSByZXNpemUgb2JzZXJ2ZXIgdGhhdCBoZWxwcyBkeW5hbWljYWxseSBkZXRlcm1pbmUgdGhlIGdlb21ldHJ5IG9mIHRoZSB0b29sYmFyCiAgICAgKiBhbmQgbWFuYWdlIGl0ZW1zIHRoYXQgZG8gbm90IGZpdCBpbnRvIGEgc2luZ2xlIHJvdy4KICAgICAqCiAgICAgKiAqKk5vdGU6KiogQ3JlYXRlZCBpbiB7QGxpbmsgI19lbmFibGVHcm91cGluZ09uUmVzaXplfS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTp1dGlscy9kb20vcmVzaXplb2JzZXJ2ZXJ+UmVzaXplT2JzZXJ2ZXJ9CiAgICAgKi8KCiAgICB0aGlzLnJlc2l6ZU9ic2VydmVyID0gbnVsbDsKICAgIC8qKgogICAgICogQSBjYWNoZWQgdmFsdWUgb2YgdGhlIGhvcml6b250YWwgcGFkZGluZyBzdHlsZSB1c2VkIGJ5IHtAbGluayAjX3VwZGF0ZUdyb3VwaW5nfQogICAgICogdG8gbWFuYWdlIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjaXRlbXN9IHRoYXQgZG8gbm90IGZpdCBpbnRvCiAgICAgKiBhIHNpbmdsZSB0b29sYmFyIGxpbmUuIFRoaXMgdmFsdWUgY2FuIGJlIHJldXNlZCBiZXR3ZWVuIHVwZGF0ZXMgYmVjYXVzZSBpdCBpcyB1bmxpa2VseSB0aGF0CiAgICAgKiB0aGUgcGFkZGluZyB3aWxsIGNoYW5nZSBhbmQgcmXigJN1c2luZyBgV2luZG93LmdldENvbXB1dGVkU3R5bGUoKWAgaXMgZXhwZW5zaXZlLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7TnVtYmVyfQogICAgICovCgogICAgdGhpcy5jYWNoZWRQYWRkaW5nID0gbnVsbDsKICAgIC8qKgogICAgICogQSBmbGFnIGluZGljYXRpbmcgdGhhdCBhbiBpdGVtcyBncm91cGluZyB1cGRhdGUgaGFzIGJlZW4gcXVldWVkIChlLmcuIGR1ZSB0byB0aGUgdG9vbGJhciBiZWluZyB2aXNpYmxlKQogICAgICogYW5kIHNob3VsZCBiZSBleGVjdXRlZCBpbW1lZGlhdGVseSB0aGUgbmV4dCB0aW1lIHRoZSB0b29sYmFyIHNob3dzIHVwLgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQG1lbWJlciB7Qm9vbGVhbn0KICAgICAqLwoKICAgIHRoaXMuc2hvdWxkVXBkYXRlR3JvdXBpbmdPbk5leHRSZXNpemUgPSBmYWxzZTsgLy8gT25seSB0aG9zZSBpdGVtcyB0aGF0IHdlcmUgbm90IGdyb3VwZWQgYXJlIHZpc2libGUgdG8gdGhlIHVzZXIuCgogICAgdmlldy5pdGVtc1ZpZXcuY2hpbGRyZW4uYmluZFRvKHRoaXMudW5ncm91cGVkSXRlbXMpLnVzaW5nKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHJldHVybiBpdGVtOwogICAgfSk7IC8vIE1ha2Ugc3VyZSBhbGwgI2l0ZW1zIHZpc2libGUgaW4gdGhlIG1haW4gc3BhY2Ugb2YgdGhlIHRvb2xiYXIgYXJlICJmb2N1c2N5Y2xlYWJsZSIuCgogICAgdGhpcy51bmdyb3VwZWRJdGVtcy5vbignYWRkJywgdGhpcy5fdXBkYXRlRm9jdXNDeWNsZWFibGVJdGVtcy5iaW5kKHRoaXMpKTsKICAgIHRoaXMudW5ncm91cGVkSXRlbXMub24oJ3JlbW92ZScsIHRoaXMuX3VwZGF0ZUZvY3VzQ3ljbGVhYmxlSXRlbXMuYmluZCh0aGlzKSk7IC8vIE1ha2Ugc3VyZSB0aGUgI2dyb3VwZWRJdGVtc0Ryb3Bkb3duIGlzIGFsc28gaW5jbHVkZWQgaW4gY3ljbGluZyB3aGVuIGl0IGFwcGVhcnMuCgogICAgdmlldy5jaGlsZHJlbi5vbignYWRkJywgdGhpcy5fdXBkYXRlRm9jdXNDeWNsZWFibGVJdGVtcy5iaW5kKHRoaXMpKTsKICAgIHZpZXcuY2hpbGRyZW4ub24oJ3JlbW92ZScsIHRoaXMuX3VwZGF0ZUZvY3VzQ3ljbGVhYmxlSXRlbXMuYmluZCh0aGlzKSk7IC8vIFRvb2xiYXJWaWV3I2l0ZW1zIGlzIGR5bmFtaWMuIFdoZW4gYW4gaXRlbSBpcyBhZGRlZCBvciByZW1vdmVkLCBpdCBzaG91bGQgYmUgYXV0b21hdGljYWxseQogICAgLy8gcmVwcmVzZW50ZWQgaW4gZWl0aGVyIGdyb3VwZWQgb3IgdW5ncm91cGVkIGl0ZW1zIGF0IHRoZSByaWdodCBpbmRleC4KICAgIC8vIEluIG90aGVyIHdvcmRzICNpdGVtcyA9PSBjb25jYXQoICN1bmdyb3VwZWRJdGVtcywgI2dyb3VwZWRJdGVtcyApCiAgICAvLyAoaW4gbGVuZ3RoIGFuZCBvcmRlcikuCgogICAgdmlldy5pdGVtcy5vbignY2hhbmdlJywgZnVuY3Rpb24gKGV2dCwgY2hhbmdlRGF0YSkgewogICAgICB2YXIgaW5kZXggPSBjaGFuZ2VEYXRhLmluZGV4OyAvLyBSZW1vdmluZy4KCiAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoY2hhbmdlRGF0YS5yZW1vdmVkKSwKICAgICAgICAgIF9zdGVwMjsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciByZW1vdmVkSXRlbSA9IF9zdGVwMi52YWx1ZTsKCiAgICAgICAgICBpZiAoaW5kZXggPj0gX3RoaXM1LnVuZ3JvdXBlZEl0ZW1zLmxlbmd0aCkgewogICAgICAgICAgICBfdGhpczUuZ3JvdXBlZEl0ZW1zLnJlbW92ZShyZW1vdmVkSXRlbSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczUudW5ncm91cGVkSXRlbXMucmVtb3ZlKHJlbW92ZWRJdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIEFkZGluZy4KCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICB9CgogICAgICBmb3IgKHZhciBjdXJyZW50SW5kZXggPSBpbmRleDsgY3VycmVudEluZGV4IDwgaW5kZXggKyBjaGFuZ2VEYXRhLmFkZGVkLmxlbmd0aDsgY3VycmVudEluZGV4KyspIHsKICAgICAgICB2YXIgYWRkZWRJdGVtID0gY2hhbmdlRGF0YS5hZGRlZFtjdXJyZW50SW5kZXggLSBpbmRleF07CgogICAgICAgIGlmIChjdXJyZW50SW5kZXggPiBfdGhpczUudW5ncm91cGVkSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgICBfdGhpczUuZ3JvdXBlZEl0ZW1zLmFkZChhZGRlZEl0ZW0sIGN1cnJlbnRJbmRleCAtIF90aGlzNS51bmdyb3VwZWRJdGVtcy5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczUudW5ncm91cGVkSXRlbXMuYWRkKGFkZGVkSXRlbSwgY3VycmVudEluZGV4KTsKICAgICAgICB9CiAgICAgIH0gLy8gV2hlbiBuZXcgdW5ncm91cGVkIGl0ZW1zIGpvaW4gaW4gYW5kIGxhbmQgaW4gI3VuZ3JvdXBlZEl0ZW1zLCB0aGVyZSdzIGEgY2hhbmNlIGl0IGNhdXNlcwogICAgICAvLyB0aGUgdG9vbGJhciB0byBvdmVyZmxvdy4KICAgICAgLy8gQ29uc2VxdWVudGx5IGlmIHJlbW92ZWQgZnJvbSBncm91cGVkIG9yIHVuZ3JvdXBlZCBpdGVtcywgdGhlcmUgaXMgYSBjaGFuY2UKICAgICAgLy8gc29tZSBuZXcgc3BhY2UgaXMgYXZhaWxhYmxlIGFuZCB3ZSBjb3VsZCBkbyBzb21lIHVuZ3JvdXBpbmcuCgoKICAgICAgX3RoaXM1Ll91cGRhdGVHcm91cGluZygpOwogICAgfSk7CiAgICB2aWV3LmV4dGVuZFRlbXBsYXRlKHsKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbLy8gVG8gZ3JvdXAgaXRlbXMgZHluYW1pY2FsbHksIHRoZSB0b29sYmFyIG5lZWRzIGEgZGVkaWNhdGVkIENTUyBjbGFzcy4KICAgICAgICAnY2stdG9vbGJhcl9ncm91cGluZyddCiAgICAgIH0KICAgIH0pOwogIH0KICAvKioKICAgKiBFbmFibGVzIGR5bmFtaWMgaXRlbXMgZ3JvdXBpbmcgYmFzZWQgb24gdGhlIGRpbWVuc2lvbnMgb2YgdGhlIHRvb2xiYXIuCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3fSB2aWV3IEFuIGluc3RhbmNlIG9mIHRoZSB0b29sYmFyIHRoYXQgdGhpcyBiZWhhdmlvcgogICAqIGlzIGFkZGVkIHRvLgogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKER5bmFtaWNHcm91cGluZywgW3sKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKHZpZXcpIHsKICAgICAgdGhpcy52aWV3RWxlbWVudCA9IHZpZXcuZWxlbWVudDsKCiAgICAgIHRoaXMuX2VuYWJsZUdyb3VwaW5nT25SZXNpemUoKTsKCiAgICAgIHRoaXMuX2VuYWJsZUdyb3VwaW5nT25NYXhXaWR0aENoYW5nZSh2aWV3KTsKICAgIH0KICAgIC8qKgogICAgICogQ2xlYW5zIHVwIHRoZSBpbnRlcm5hbHMgdXNlZCBieSB0aGlzIGJlaGF2aW9yLgogICAgICovCgogIH0sIHsKICAgIGtleTogImRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIC8vIFRoZSBkcm9wZG93biBtYXkgbm90IGJlIGluIFRvb2xiYXJWaWV3I2NoaWxkcmVuIGF0IHRoZSBtb21lbnQgb2YgdG9vbGJhciBkZXN0cnVjdGlvbgogICAgICAvLyBzbyBsZXQncyBtYWtlIHN1cmUgaXQncyBhY3R1YWxseSBkZXN0cm95ZWQgYWxvbmcgd2l0aCB0aGUgdG9vbGJhci4KICAgICAgdGhpcy5ncm91cGVkSXRlbXNEcm9wZG93bi5kZXN0cm95KCk7CiAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIuZGVzdHJveSgpOwogICAgfQogICAgLyoqCiAgICAgKiBXaGVuIGNhbGxlZCwgaXQgd2lsbCBjaGVjayBpZiBhbnkgb2YgdGhlIHtAbGluayAjdW5ncm91cGVkSXRlbXN9IGRvIG5vdCBmaXQgaW50byBhIHNpbmdsZSByb3cgb2YgdGhlIHRvb2xiYXIsCiAgICAgKiBhbmQgaXQgd2lsbCBtb3ZlIHRoZW0gdG8gdGhlIHtAbGluayAjZ3JvdXBlZEl0ZW1zfSB3aGVuIGl0IGhhcHBlbnMuCiAgICAgKgogICAgICogQXQgdGhlIHNhbWUgdGltZSwgaXQgd2lsbCBhbHNvIGNoZWNrIGlmIHRoZXJlIGlzIGVub3VnaCBzcGFjZSBpbiB0aGUgdG9vbGJhciBmb3IgdGhlIGZpcnN0IG9mIHRoZQogICAgICoge0BsaW5rICNncm91cGVkSXRlbXN9IHRvIGJlIHJldHVybmVkIGJhY2sgdG8ge0BsaW5rICN1bmdyb3VwZWRJdGVtc30gYW5kIHN0aWxsIGZpdCBpbnRvIGEgc2luZ2xlIHJvdwogICAgICogd2l0aG91dCB0aGUgdG9vbGJhciB3cmFwcGluZy4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3VwZGF0ZUdyb3VwaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlR3JvdXBpbmcoKSB7CiAgICAgIC8vIERvIG5vIGdyb3VwaW5n4oCTcmVsYXRlZCBnZW9tZXRyeSBhbmFseXNpcyB3aGVuIHRoZSB0b29sYmFyIGlzIGRldGFjaGVkIGZyb20gdmlzaWJsZSBET00sCiAgICAgIC8vIGZvciBpbnN0YW5jZSBiZWZvcmUgI3JlbmRlcigpLCBvciBhZnRlciByZW5kZXIgYnV0IHdpdGhvdXQgYSBwYXJlbnQgb3IgYSBwYXJlbnQgZGV0YWNoZWQKICAgICAgLy8gZnJvbSBET00uIERPTVJlY3RzIHdvbid0IHdvcmsgYW55d2F5IGFuZCB0aGVyZSB3aWxsIGJlIHRvbnMgb2Ygd2FybmluZyBpbiB0aGUgY29uc29sZSBhbmQKICAgICAgLy8gbm90aGluZyBlbHNlLiBUaGlzIGhhcHBlbnMsIGZvciBpbnN0YW5jZSwgd2hlbiB0aGUgdG9vbGJhciBpcyBkZXRhY2hlZCBmcm9tIERPTSBhbmQKICAgICAgLy8gc29tZSBsb2dpYyBhZGRzIG9yIHJlbW92ZXMgaXRzICNpdGVtcy4KICAgICAgaWYgKCF0aGlzLnZpZXdFbGVtZW50Lm93bmVyRG9jdW1lbnQuYm9keS5jb250YWlucyh0aGlzLnZpZXdFbGVtZW50KSkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBEbyBub3QgdXBkYXRlIGdyb3VwaW5nIHdoZW4gdGhlIGVsZW1lbnQgaXMgaW52aXNpYmxlLiBTdWNoIHRvb2xiYXIgaGFzIERPTVJlY3QgZmlsbGVkIHdpdGggemVyb3MKICAgICAgLy8gYW5kIHRoYXQgd291bGQgY2F1c2UgYWxsIGl0ZW1zIHRvIGJlIGdyb3VwZWQuIEluc3RlYWQsIHF1ZXVlIHRoZSBncm91cGluZyBzbyBpdCBydW5zIG5leHQgdGltZQogICAgICAvLyB0aGUgdG9vbGJhciBpcyB2aXNpYmxlICh0aGUgbmV4dCBSZXNpemVPYnNlcnZlciBjYWxsYmFjayBleGVjdXRpb24pLiBUaGlzIGlzIGhhbmR5IGJlY2F1c2UKICAgICAgLy8gdGhlIGdyb3VwaW5nIGNvdWxkIGJlIGNhdXNlZCBieSBpbmNyZWFzaW5nIHRoZSAjbWF4V2lkdGggd2hlbiB0aGUgdG9vbGJhciB3YXMgaW52aXNpYmxlIGFuZCB0aGUgbmV4dAogICAgICAvLyB0aW1lIGl0IHNob3dzIHVwLCBzb21lIGl0ZW1zIGNvdWxkIGFjdHVhbGx5IGJlIHVuZ3JvdXBlZCAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvNjU3NSkuCgoKICAgICAgaWYgKCF0aGlzLnZpZXdFbGVtZW50Lm9mZnNldFBhcmVudCkgewogICAgICAgIHRoaXMuc2hvdWxkVXBkYXRlR3JvdXBpbmdPbk5leHRSZXNpemUgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBSZW1lbWJlciBob3cgbWFueSBpdGVtcyB3ZXJlIGluaXRpYWxseSBncm91cGVkIHNvIGF0IHRoZSBpdCBpcyBwb3NzaWJsZSB0byBmaWd1cmUgb3V0IGlmIHRoZSBudW1iZXIKICAgICAgLy8gb2YgZ3JvdXBlZCBpdGVtcyBoYXMgY2hhbmdlZC4gSWYgdGhlIG51bWJlciBoYXMgY2hhbmdlZCwgZ2VvbWV0cnkgb2YgdGhlIHRvb2xiYXIgaGFzIGFsc28gY2hhbmdlZC4KCgogICAgICB2YXIgaW5pdGlhbEdyb3VwZWRJdGVtc0NvdW50ID0gdGhpcy5ncm91cGVkSXRlbXMubGVuZ3RoOwogICAgICB2YXIgd2VyZUl0ZW1zR3JvdXBlZDsgLy8gR3JvdXAgI2l0ZW1zIGFzIGxvbmcgYXMgc29tZSB3cmFwIHRvIHRoZSBuZXh0IHJvdy4gVGhpcyB3aWxsIGhhcHBlbiwgZm9yIGluc3RhbmNlLAogICAgICAvLyB3aGVuIHRoZSB0b29sYmFyIGlzIGdldHRpbmcgbmFycm93IGFuZCB0aGVyZSBpcyBub3QgZW5vdWdoIHNwYWNlIHRvIGRpc3BsYXkgYWxsIGl0ZW1zIGluCiAgICAgIC8vIGEgc2luZ2xlIHJvdy4KCiAgICAgIHdoaWxlICh0aGlzLl9hcmVJdGVtc092ZXJmbG93aW5nKSB7CiAgICAgICAgdGhpcy5fZ3JvdXBMYXN0SXRlbSgpOwoKICAgICAgICB3ZXJlSXRlbXNHcm91cGVkID0gdHJ1ZTsKICAgICAgfSAvLyBJZiBub25lIHdlcmUgZ3JvdXBlZCBub3cgYnV0IHRoZXJlIHdlcmUgc29tZSBpdGVtcyBhbHJlYWR5IGdyb3VwZWQgYmVmb3JlLAogICAgICAvLyB0aGVuLCB3aGF0IHRoZSBoZWxsLCBtYXliZSBsZXQncyBzZWUgaWYgc29tZSBvZiB0aGVtIGNhbiBiZSB1bmdyb3VwZWQuIFRoaXMgaGFwcGVucyB3aGVuLAogICAgICAvLyBmb3IgaW5zdGFuY2UsIHRoZSB0b29sYmFyIGlzIHN0cmV0Y2hpbmcgYW5kIHRoZXJlJ3MgbW9yZSBzcGFjZSBpbiBpdCB0aGFuIGJlZm9yZS4KCgogICAgICBpZiAoIXdlcmVJdGVtc0dyb3VwZWQgJiYgdGhpcy5ncm91cGVkSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgLy8gVW5ncm91cCBpdGVtcyBhcyBsb25nIGFzIG5vbmUgYXJlIG92ZXJmbG93aW5nIG9yIHRoZXJlIGFyZSBub25lIHRvIHVuZ3JvdXAgbGVmdC4KICAgICAgICB3aGlsZSAodGhpcy5ncm91cGVkSXRlbXMubGVuZ3RoICYmICF0aGlzLl9hcmVJdGVtc092ZXJmbG93aW5nKSB7CiAgICAgICAgICB0aGlzLl91bmdyb3VwRmlyc3RJdGVtKCk7CiAgICAgICAgfSAvLyBJZiB0aGUgdW5ncm91cGluZyBlbmRlZCB1cCB3aXRoIHNvbWUgaXRlbSB3cmFwcGluZyB0byB0aGUgbmV4dCByb3csCiAgICAgICAgLy8gcHV0IGl0IGJhY2sgdG8gdGhlIGdyb3VwIHRvb2xiYXIgKCJ1bmRvIHRoZSBsYXN0IHVuZ3JvdXAiKS4gV2UgZG9uJ3Qga25vdyB3aGV0aGVyCiAgICAgICAgLy8gYW4gaXRlbSB3aWxsIHdyYXAgb3Igbm90IHVudGlsIHdlIHVuZ3JvdXAgaXQgKHRoYXQncyBhIERPTS9DU1MgdGhpbmcpIHNvIHRoaXMKICAgICAgICAvLyBjbGVhbuKAk3VwIGlzIHZpdGFsIGZvciB0aGUgYWxnb3JpdGhtLgoKCiAgICAgICAgaWYgKHRoaXMuX2FyZUl0ZW1zT3ZlcmZsb3dpbmcpIHsKICAgICAgICAgIHRoaXMuX2dyb3VwTGFzdEl0ZW0oKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmdyb3VwZWRJdGVtcy5sZW5ndGggIT09IGluaXRpYWxHcm91cGVkSXRlbXNDb3VudCkgewogICAgICAgIHRoaXMudmlldy5maXJlKCdncm91cGVkSXRlbXNVcGRhdGUnKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGB0cnVlYCB3aGVuIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNlbGVtZW50fSBjaGlsZHJlbiB2aXN1YWxseSBvdmVyZmxvdywKICAgICAqIGZvciBpbnN0YW5jZSBpZiB0aGUgdG9vbGJhciBpcyBuYXJyb3dlciB0aGFuIGl0cyBtZW1iZXJzLiBSZXR1cm5zIGBmYWxzZWAgb3RoZXJ3aXNlLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAdHlwZSB7Qm9vbGVhbn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfYXJlSXRlbXNPdmVyZmxvd2luZyIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgLy8gQW4gZW1wdHkgdG9vbGJhciBjYW5ub3Qgb3ZlcmZsb3cuCiAgICAgIGlmICghdGhpcy51bmdyb3VwZWRJdGVtcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciBlbGVtZW50ID0gdGhpcy52aWV3RWxlbWVudDsKICAgICAgdmFyIHVpTGFuZ3VhZ2VEaXJlY3Rpb24gPSB0aGlzLnZpZXdMb2NhbGUudWlMYW5ndWFnZURpcmVjdGlvbjsKICAgICAgdmFyIGxhc3RDaGlsZFJlY3QgPSBuZXcgUmVjdChlbGVtZW50Lmxhc3RDaGlsZCk7CiAgICAgIHZhciB0b29sYmFyUmVjdCA9IG5ldyBSZWN0KGVsZW1lbnQpOwoKICAgICAgaWYgKCF0aGlzLmNhY2hlZFBhZGRpbmcpIHsKICAgICAgICB2YXIgY29tcHV0ZWRTdHlsZSA9IGdsb2JhbC53aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KTsKICAgICAgICB2YXIgcGFkZGluZ1Byb3BlcnR5ID0gdWlMYW5ndWFnZURpcmVjdGlvbiA9PT0gJ2x0cicgPyAncGFkZGluZ1JpZ2h0JyA6ICdwYWRkaW5nTGVmdCc7IC8vIHBhcnNlSW50KCkgaXMgZXNzZW50aWFsIGJlY2F1c2Ugb2YgcXVpcmt5IGZsb2F0aW5nIHBvaW50IG51bWJlcnMgbG9naWMgYW5kIERPTS4KICAgICAgICAvLyBJZiB0aGUgcGFkZGluZyB0dXJuZWQgb3V0IHRvbyBiaWcgYmVjYXVzZSBvZiB0aGF0LCB0aGUgZ3JvdXBlZCBpdGVtcyBkcm9wZG93biB3b3VsZAogICAgICAgIC8vIGFsd2F5cyBsb29rIChmcm9tIHRoZSBSZWN0IHBlcnNwZWN0aXZlKSBsaWtlIGl0IG92ZXJmbG93cyAod2hpbGUgaXQncyBub3QpLgoKICAgICAgICB0aGlzLmNhY2hlZFBhZGRpbmcgPSBOdW1iZXIucGFyc2VJbnQoY29tcHV0ZWRTdHlsZVtwYWRkaW5nUHJvcGVydHldKTsKICAgICAgfQoKICAgICAgaWYgKHVpTGFuZ3VhZ2VEaXJlY3Rpb24gPT09ICdsdHInKSB7CiAgICAgICAgcmV0dXJuIGxhc3RDaGlsZFJlY3QucmlnaHQgPiB0b29sYmFyUmVjdC5yaWdodCAtIHRoaXMuY2FjaGVkUGFkZGluZzsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbGFzdENoaWxkUmVjdC5sZWZ0IDwgdG9vbGJhclJlY3QubGVmdCArIHRoaXMuY2FjaGVkUGFkZGluZzsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBFbmFibGVzIHRoZSBmdW5jdGlvbmFsaXR5IHRoYXQgcHJldmVudHMge0BsaW5rICN1bmdyb3VwZWRJdGVtc30gZnJvbSBvdmVyZmxvd2luZyAod3JhcHBpbmcgdG8gdGhlIG5leHQgcm93KQogICAgICogdXBvbiByZXNpemUgd2hlbiB0aGVyZSBpcyBsaXR0bGUgc3BhY2UgYXZhaWxhYmxlLiBJbnN0ZWFkLCB0aGUgdG9vbGJhciBpdGVtcyBhcmUgbW92ZWQgdG8gdGhlCiAgICAgKiB7QGxpbmsgI2dyb3VwZWRJdGVtc30gY29sbGVjdGlvbiBhbmQgZGlzcGxheWVkIGluIGEgZHJvcGRvd24gYXQgdGhlIGVuZCBvZiB0aGUgcm93ICh3aGljaCBoYXMgaXRzIG93biBuZXN0ZWQgdG9vbGJhcikuCiAgICAgKgogICAgICogV2hlbiBjYWxsZWQsIHRoZSB0b29sYmFyIHdpbGwgYXV0b21hdGljYWxseSBhbmFseXplIHRoZSBsb2NhdGlvbiBvZiBpdHMge0BsaW5rICN1bmdyb3VwZWRJdGVtc30gYW5kICJncm91cCIKICAgICAqIHRoZW0gaW4gdGhlIGRyb3Bkb3duIGlmIG5lY2Vzc2FyeS4gSXQgd2lsbCBhbHNvIG9ic2VydmUgdGhlIGJyb3dzZXIgd2luZG93IGZvciBzaXplIGNoYW5nZXMgaW4KICAgICAqIHRoZSBmdXR1cmUgYW5kIHJlc3BvbmQgdG8gdGhlbSBieSBncm91cGluZyBtb3JlIGl0ZW1zIG9yIHJldmVydGluZyBhbHJlYWR5IGdyb3VwZWQgYmFjaywgZGVwZW5kaW5nCiAgICAgKiBvbiB0aGUgdmlzdWFsIHNwYWNlIGF2YWlsYWJsZS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9lbmFibGVHcm91cGluZ09uUmVzaXplIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5hYmxlR3JvdXBpbmdPblJlc2l6ZSgpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB2YXIgcHJldmlvdXNXaWR0aDsgLy8gVE9ETzogQ29uc2lkZXIgZGVib3VuY2UuCgogICAgICB0aGlzLnJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKHRoaXMudmlld0VsZW1lbnQsIGZ1bmN0aW9uIChlbnRyeSkgewogICAgICAgIGlmICghcHJldmlvdXNXaWR0aCB8fCBwcmV2aW91c1dpZHRoICE9PSBlbnRyeS5jb250ZW50UmVjdC53aWR0aCB8fCBfdGhpczYuc2hvdWxkVXBkYXRlR3JvdXBpbmdPbk5leHRSZXNpemUpIHsKICAgICAgICAgIF90aGlzNi5zaG91bGRVcGRhdGVHcm91cGluZ09uTmV4dFJlc2l6ZSA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzNi5fdXBkYXRlR3JvdXBpbmcoKTsKCiAgICAgICAgICBwcmV2aW91c1dpZHRoID0gZW50cnkuY29udGVudFJlY3Qud2lkdGg7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHRoaXMuX3VwZGF0ZUdyb3VwaW5nKCk7CiAgICB9CiAgICAvKioKICAgICAqIEVuYWJsZXMgdGhlIGdyb3VwaW5nIGZ1bmN0aW9uYWxpdHksIGp1c3QgbGlrZSB7QGxpbmsgI19lbmFibGVHcm91cGluZ09uUmVzaXplfSBidXQgdGhlIGRpZmZlcmVuY2UgaXMgdGhhdAogICAgICogaXQgbGlzdGVucyB0byB0aGUgY2hhbmdlcyBvZiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjbWF4V2lkdGh9IGluc3RlYWQuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfZW5hYmxlR3JvdXBpbmdPbk1heFdpZHRoQ2hhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5hYmxlR3JvdXBpbmdPbk1heFdpZHRoQ2hhbmdlKHZpZXcpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2aWV3Lm9uKCdjaGFuZ2U6bWF4V2lkdGgnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM3Ll91cGRhdGVHcm91cGluZygpOwogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogV2hlbiBjYWxsZWQsIGl0IHdpbGwgcmVtb3ZlIHRoZSBsYXN0IGl0ZW0gZnJvbSB7QGxpbmsgI3VuZ3JvdXBlZEl0ZW1zfSBhbmQgbW92ZSBpdCBiYWNrCiAgICAgKiB0byB0aGUge0BsaW5rICNncm91cGVkSXRlbXN9IGNvbGxlY3Rpb24uCiAgICAgKgogICAgICogVGhlIG9wcG9zaXRlIG9mIHtAbGluayAjX3VuZ3JvdXBGaXJzdEl0ZW19LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2dyb3VwTGFzdEl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9ncm91cExhc3RJdGVtKCkgewogICAgICBpZiAoIXRoaXMuZ3JvdXBlZEl0ZW1zLmxlbmd0aCkgewogICAgICAgIHRoaXMudmlld0NoaWxkcmVuLmFkZChuZXcgVG9vbGJhclNlcGFyYXRvclZpZXcoKSk7CiAgICAgICAgdGhpcy52aWV3Q2hpbGRyZW4uYWRkKHRoaXMuZ3JvdXBlZEl0ZW1zRHJvcGRvd24pOwogICAgICAgIHRoaXMudmlld0ZvY3VzVHJhY2tlci5hZGQodGhpcy5ncm91cGVkSXRlbXNEcm9wZG93bi5lbGVtZW50KTsKICAgICAgfQoKICAgICAgdGhpcy5ncm91cGVkSXRlbXMuYWRkKHRoaXMudW5ncm91cGVkSXRlbXMucmVtb3ZlKHRoaXMudW5ncm91cGVkSXRlbXMubGFzdCksIDApOwogICAgfQogICAgLyoqCiAgICAgKiBNb3ZlcyB0aGUgdmVyeSBmaXJzdCBpdGVtIGJlbG9uZ2luZyB0byB7QGxpbmsgI2dyb3VwZWRJdGVtc30gYmFjawogICAgICogdG8gdGhlIHtAbGluayAjdW5ncm91cGVkSXRlbXN9IGNvbGxlY3Rpb24uCiAgICAgKgogICAgICogVGhlIG9wcG9zaXRlIG9mIHtAbGluayAjX2dyb3VwTGFzdEl0ZW19LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3VuZ3JvdXBGaXJzdEl0ZW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF91bmdyb3VwRmlyc3RJdGVtKCkgewogICAgICB0aGlzLnVuZ3JvdXBlZEl0ZW1zLmFkZCh0aGlzLmdyb3VwZWRJdGVtcy5yZW1vdmUodGhpcy5ncm91cGVkSXRlbXMuZmlyc3QpKTsKCiAgICAgIGlmICghdGhpcy5ncm91cGVkSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy52aWV3Q2hpbGRyZW4ucmVtb3ZlKHRoaXMuZ3JvdXBlZEl0ZW1zRHJvcGRvd24pOwogICAgICAgIHRoaXMudmlld0NoaWxkcmVuLnJlbW92ZSh0aGlzLnZpZXdDaGlsZHJlbi5sYXN0KTsKICAgICAgICB0aGlzLnZpZXdGb2N1c1RyYWNrZXIucmVtb3ZlKHRoaXMuZ3JvdXBlZEl0ZW1zRHJvcGRvd24uZWxlbWVudCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUge0BsaW5rICNncm91cGVkSXRlbXNEcm9wZG93bn0gdGhhdCBob3N0cyB0aGUgbWVtYmVycyBvZiB0aGUge0BsaW5rICNncm91cGVkSXRlbXN9CiAgICAgKiBjb2xsZWN0aW9uIHdoZW4gdGhlcmUgaXMgbm90IGVub3VnaCBzcGFjZSBpbiB0aGUgdG9vbGJhciB0byBkaXNwbGF5IGFsbCBpdGVtcyBpbiBhIHNpbmdsZSByb3cuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEByZXR1cm5zIHttb2R1bGU6dWkvZHJvcGRvd24vZHJvcGRvd252aWV3fkRyb3Bkb3duVmlld30KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY3JlYXRlR3JvdXBlZEl0ZW1zRHJvcGRvd24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVHcm91cGVkSXRlbXNEcm9wZG93bigpIHsKICAgICAgdmFyIGxvY2FsZSA9IHRoaXMudmlld0xvY2FsZTsKICAgICAgdmFyIHQgPSBsb2NhbGUudDsKICAgICAgdmFyIGRyb3Bkb3duID0gY3JlYXRlRHJvcGRvd24obG9jYWxlKTsKICAgICAgZHJvcGRvd24uY2xhc3MgPSAnY2stdG9vbGJhcl9fZ3JvdXBlZC1kcm9wZG93bic7IC8vIE1ha2Ugc3VyZSB0aGUgZHJvcGRvd24gbmV2ZXIgc3RpY2tzIG91dCB0byB0aGUgbGVmdC9yaWdodC4gSXQgc2hvdWxkIGJlIHVuZGVyIHRoZSBtYWluIHRvb2xiYXIuCiAgICAgIC8vIChodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy81NjA4KQoKICAgICAgZHJvcGRvd24ucGFuZWxQb3NpdGlvbiA9IGxvY2FsZS51aUxhbmd1YWdlRGlyZWN0aW9uID09PSAnbHRyJyA/ICdzdycgOiAnc2UnOwogICAgICBhZGRUb29sYmFyVG9Ecm9wZG93bihkcm9wZG93biwgW10pOwogICAgICBkcm9wZG93bi5idXR0b25WaWV3LnNldCh7CiAgICAgICAgbGFiZWw6IHQoJ1Nob3cgbW9yZSBpdGVtcycpLAogICAgICAgIHRvb2x0aXA6IHRydWUsCiAgICAgICAgdG9vbHRpcFBvc2l0aW9uOiBsb2NhbGUudWlMYW5ndWFnZURpcmVjdGlvbiA9PT0gJ3J0bCcgPyAnc2UnIDogJ3N3JywKICAgICAgICBpY29uOiBpY29ucy50aHJlZVZlcnRpY2FsRG90cwogICAgICB9KTsgLy8gMToxIHBhc3PigJN0aHJvdWdoIGJpbmRpbmcuCgogICAgICBkcm9wZG93bi50b29sYmFyVmlldy5pdGVtcy5iaW5kVG8odGhpcy5ncm91cGVkSXRlbXMpLnVzaW5nKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgIH0pOwogICAgICByZXR1cm4gZHJvcGRvd247CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNmb2N1c2FibGVzIGZvY3Vz4oCTY3ljbGVhYmxlIGl0ZW1zfQogICAgICogY29sbGVjdGlvbiBzbyBpdCByZXByZXNlbnRzIHRoZSB1cOKAk3Rv4oCTZGF0ZSBzdGF0ZSBvZiB0aGUgVUkgZnJvbSB0aGUgcGVyc3BlY3RpdmUgb2YgdGhlIHVzZXIuCiAgICAgKgogICAgICogRm9yIGluc3RhbmNlLCB0aGUge0BsaW5rICNncm91cGVkSXRlbXNEcm9wZG93bn0gY2FuIHNob3cgdXAgYW5kIGhpZGUgYnV0IHdoZW4gaXQgaXMgdmlzaWJsZSwKICAgICAqIGl0IG11c3QgYmUgc3ViamVjdCB0byBmb2N1cyBjeWNsaW5nIGluIHRoZSB0b29sYmFyLgogICAgICoKICAgICAqIFNlZSB0aGUge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3I2ZvY3VzYWJsZXMgY29sbGVjdGlvbn0gZG9jdW1lbnRhdGlvbgogICAgICogdG8gbGVhcm4gbW9yZSBhYm91dCB0aGUgcHVycG9zZSBvZiB0aGlzIG1ldGhvZC4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl91cGRhdGVGb2N1c0N5Y2xlYWJsZUl0ZW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlRm9jdXNDeWNsZWFibGVJdGVtcygpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB0aGlzLnZpZXdGb2N1c2FibGVzLmNsZWFyKCk7CiAgICAgIHRoaXMudW5ncm91cGVkSXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgX3RoaXM4LnZpZXdGb2N1c2FibGVzLmFkZChpdGVtKTsKICAgICAgfSk7CgogICAgICBpZiAodGhpcy5ncm91cGVkSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy52aWV3Rm9jdXNhYmxlcy5hZGQodGhpcy5ncm91cGVkSXRlbXNEcm9wZG93bik7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBEeW5hbWljR3JvdXBpbmc7Cn0oKTsKLyoqCiAqIE9wdGlvbnMgcGFzc2VkIHRvIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjY29uc3RydWN0b3J9IG9mIHRoZSB0b29sYmFyLgogKgogKiBAaW50ZXJmYWNlIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJPcHRpb25zCiAqLwoKLyoqCiAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIHRvb2xiYXIgd2lsbCBhdXRvbWF0aWNhbGx5IGdyb3VwIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNpdGVtc30gdGhhdAogKiB3b3VsZCBub3JtYWxseSB3cmFwIHRvIHRoZSBuZXh0IGxpbmUgd2hlbiB0aGVyZSBpcyBub3QgZW5vdWdoIHNwYWNlIHRvIGRpc3BsYXkgdGhlbSBpbiBhIHNpbmdsZSByb3csIGZvcgogKiBpbnN0YW5jZSwgaWYgdGhlIHBhcmVudCBjb250YWluZXIgb2YgdGhlIHRvb2xiYXIgaXMgbmFycm93LiBGb3IgdG9vbGJhcnMgaW4gYWJzb2x1dGVseSBwb3NpdGlvbmVkIGNvbnRhaW5lcnMKICogd2l0aG91dCB3aWR0aCByZXN0cmljdGlvbnMgYWxzbyB0aGUge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJPcHRpb25zI2lzRmxvYXRpbmd9IG9wdGlvbiBpcyByZXF1aXJlZCB0byBiZSBgdHJ1ZWAuCiAqCiAqIFNlZSBhbHNvOiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjbWF4V2lkdGh9LgogKgogKiBAbWVtYmVyIHtCb29sZWFufSBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyT3B0aW9ucyNzaG91bGRHcm91cFdoZW5GdWxsCiAqLwoKLyoqCiAqIFRoaXMgb3B0aW9uIHNob3VsZCBiZSBlbmFibGVkIGZvciB0b29sYmFycyBpbiBhYnNvbHV0ZWx5IHBvc2l0aW9uZWQgY29udGFpbmVycyB3aXRob3V0IHdpZHRoIHJlc3RyaWN0aW9ucwogKiB0byBlbmFibGUgYXV0b21hdGljIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNpdGVtc30gZ3JvdXBpbmcuCiAqIFdoZW4gdGhpcyBvcHRpb24gaXMgc2V0IHRvIGB0cnVlYCwgdGhlIGl0ZW1zIHdpbGwgc3RvcCB3cmFwcGluZyB0byB0aGUgbmV4dCBsaW5lCiAqIGFuZCB0b2dldGhlciB3aXRoIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyT3B0aW9ucyNzaG91bGRHcm91cFdoZW5GdWxsfSwKICogdGhpcyB3aWxsIGFsbG93IGdyb3VwaW5nIHRoZW0gd2hlbiB0aGVyZSBpcyBub3QgZW5vdWdoIHNwYWNlIGluIGEgc2luZ2xlIHJvdy4KICoKICogQG1lbWJlciB7Qm9vbGVhbn0gbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhck9wdGlvbnMjaXNGbG9hdGluZwogKi8KCi8qKgogKiBBIGNsYXNzIGludGVyZmFjZSBkZWZpbmluZyB0aGUgYmVoYXZpb3Igb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlld30uCiAqCiAqIFRvb2xiYXIgYmVoYXZpb3JzIGV4dGVuZCBpdHMgbG9vayBhbmQgZnVuY3Rpb25hbGl0eSBhbmQgaGF2ZSBhbiBpbXBhY3Qgb24gdGhlCiAqIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNlbGVtZW50fSB0ZW1wbGF0ZSBvcgogKiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjcmVuZGVyIHJlbmRlcmluZ30uIFRoZXkgY2FuIGJlIGVuYWJsZWQKICogY29uZGl0aW9uYWxseSwgZS5nLiBkZXBlbmRpbmcgb24gdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHRvb2xiYXIuCiAqCiAqIEBwcml2YXRlCiAqIEBpbnRlcmZhY2UgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhckJlaGF2aW9yCiAqLwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgdG9vbGJhciBiZWhhdmlvciBpbnN0YW5jZS4KICoKICogVGhlIGluc3RhbmNlIGlzIGNyZWF0ZWQgaW4gdGhlIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNjb25zdHJ1Y3Rvcn0gb2YgdGhlIHRvb2xiYXIuCiAqIFRoaXMgaXMgdGhlIHJpZ2h0IHBsYWNlIHRvIGV4dGVuZCB0aGUge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3I3RlbXBsYXRlfSBvZgogKiB0aGUgdG9vbGJhciwgZGVmaW5lIGV4dHJhIHRvb2xiYXIgcHJvcGVydGllcywgZXRjLgogKgogKiBAbWV0aG9kICNjb25zdHJ1Y3RvcgogKiBAcGFyYW0ge21vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3fSB2aWV3IEFuIGluc3RhbmNlIG9mIHRoZSB0b29sYmFyIHRoYXQgdGhpcyBiZWhhdmlvciBpcyBhZGRlZCB0by4KICovCgovKioKICogQSBtZXRob2QgY2FsbGVkIGFmdGVyIHRoZSB0b29sYmFyIGhhcyBiZWVuIHtAbGluayBtb2R1bGU6dWkvdG9vbGJhci90b29sYmFydmlld35Ub29sYmFyVmlldyNyZW5kZXIgcmVuZGVyZWR9LgogKiBJdCBjYW4gYmUgdXNlZCB0bywgZm9yIGV4YW1wbGUsIGN1c3RvbWl6ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIHRvb2xiYXIgd2hlbiBpdHMge0BsaW5rIG1vZHVsZTp1aS90b29sYmFyL3Rvb2xiYXJ2aWV3flRvb2xiYXJWaWV3I2VsZW1lbnR9CiAqIGlzIGF2YWlsYWJsZS4KICoKICogQHJlYWRvbmx5CiAqIEBtZW1iZXIge0Z1bmN0aW9ufSAjcmVuZGVyCiAqIEBwYXJhbSB7bW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXd9IHZpZXcgQW4gaW5zdGFuY2Ugb2YgdGhlIHRvb2xiYXIgYmVpbmcgcmVuZGVyZWQuCiAqLwoKLyoqCiAqIEEgbWV0aG9kIGNhbGxlZCBhZnRlciB0aGUgdG9vbGJhciBoYXMgYmVlbiB7QGxpbmsgbW9kdWxlOnVpL3Rvb2xiYXIvdG9vbGJhcnZpZXd+VG9vbGJhclZpZXcjZGVzdHJveSBkZXN0cm95ZWR9LgogKiBJdCBhbGxvd3MgY2xlYW5pbmcgdXAgYWZ0ZXIgdGhlIHRvb2xiYXIgYmVoYXZpb3IsIGZvciBpbnN0YW5jZSwgdGhpcyBpcyB0aGUgcmlnaHQgcGxhY2UgdG8gZGV0YWNoCiAqIGV2ZW50IGxpc3RlbmVycywgZnJlZSB1cCByZWZlcmVuY2VzLCBldGMuCiAqCiAqIEByZWFkb25seQogKiBAbWVtYmVyIHtGdW5jdGlvbn0gI2Rlc3Ryb3kKICov"},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-ui/src/toolbar/toolbarview.js"],"names":["View","FocusTracker","FocusCycler","KeystrokeHandler","ToolbarSeparatorView","ToolbarLineBreakView","ResizeObserver","preventDefault","Rect","global","createDropdown","addToolbarToDropdown","logWarning","normalizeToolbarConfig","icons","ToolbarView","locale","options","bind","bindTemplate","t","set","items","createCollection","focusTracker","keystrokes","itemsView","ItemsView","children","add","focusables","_focusCycler","keystrokeHandler","actions","focusPrevious","focusNext","classes","to","if","shouldGroupWhenFull","isFloating","push","setTemplate","tag","attributes","class","role","style","maxWidth","on","mousedown","_behavior","DynamicGrouping","StaticLayout","item","element","evt","remove","listenTo","render","destroy","focusFirst","focusLast","itemsOrConfig","factory","config","itemsToClean","filter","name","idx","removeItems","indexOf","has","itemsToAdd","_cleanSeparators","map","create","addMany","nonSeparatorPredicate","count","length","firstCommandItem","findIndex","lastCommandItem","slice","reverse","isDuplicated","view","bindTo","using","extendTemplate","viewChildren","viewFocusables","viewItemsView","viewFocusTracker","viewLocale","ungroupedItems","groupedItems","groupedItemsDropdown","_createGroupedItemsDropdown","resizeObserver","cachedPadding","shouldUpdateGroupingOnNextResize","_updateFocusCycleableItems","changeData","index","removed","removedItem","currentIndex","added","addedItem","_updateGrouping","viewElement","_enableGroupingOnResize","_enableGroupingOnMaxWidthChange","ownerDocument","body","contains","offsetParent","initialGroupedItemsCount","wereItemsGrouped","_areItemsOverflowing","_groupLastItem","_ungroupFirstItem","fire","uiLanguageDirection","lastChildRect","lastChild","toolbarRect","computedStyle","window","getComputedStyle","paddingProperty","Number","parseInt","right","left","previousWidth","entry","contentRect","width","last","first","dropdown","panelPosition","buttonView","label","tooltip","tooltipPosition","icon","threeVerticalDots","toolbarView","clear"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module ui/toolbar/toolbarview\n */\n\nimport View from '../view';\nimport FocusTracker from '@ckeditor/ckeditor5-utils/src/focustracker';\nimport FocusCycler from '../focuscycler';\nimport KeystrokeHandler from '@ckeditor/ckeditor5-utils/src/keystrokehandler';\nimport ToolbarSeparatorView from './toolbarseparatorview';\nimport ToolbarLineBreakView from './toolbarlinebreakview';\nimport ResizeObserver from '@ckeditor/ckeditor5-utils/src/dom/resizeobserver';\nimport preventDefault from '../bindings/preventdefault.js';\nimport Rect from '@ckeditor/ckeditor5-utils/src/dom/rect';\nimport global from '@ckeditor/ckeditor5-utils/src/dom/global';\nimport { createDropdown, addToolbarToDropdown } from '../dropdown/utils';\nimport { logWarning } from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport normalizeToolbarConfig from './normalizetoolbarconfig';\nimport { icons } from 'ckeditor5/src/core';\n\nimport '../../theme/components/toolbar/toolbar.css';\n\n/**\n * The toolbar view class.\n *\n * @extends module:ui/view~View\n * @implements module:ui/dropdown/dropdownpanelfocusable~DropdownPanelFocusable\n */\nexport default class ToolbarView extends View {\n\t/**\n\t * Creates an instance of the {@link module:ui/toolbar/toolbarview~ToolbarView} class.\n\t *\n\t * Also see {@link #render}.\n\t *\n\t * @param {module:utils/locale~Locale} locale The localization services instance.\n\t * @param {module:ui/toolbar/toolbarview~ToolbarOptions} [options] Configuration options of the toolbar.\n\t */\n\tconstructor( locale, options ) {\n\t\tsuper( locale );\n\n\t\tconst bind = this.bindTemplate;\n\t\tconst t = this.t;\n\n\t\t/**\n\t\t * A reference to the options object passed to the constructor.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ToolbarOptions}\n\t\t */\n\t\tthis.options = options || {};\n\n\t\t/**\n\t\t * Label used by assistive technologies to describe this toolbar element.\n\t\t *\n\t\t * @default 'Editor toolbar'\n\t\t * @member {String} #ariaLabel\n\t\t */\n\t\tthis.set( 'ariaLabel', t( 'Editor toolbar' ) );\n\n\t\t/**\n\t\t * The maximum width of the toolbar element.\n\t\t *\n\t\t * **Note**: When set to a specific value (e.g. `'200px'`), the value will affect the behavior of the\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull}\n\t\t * option by changing the number of {@link #items} that will be displayed in the toolbar at a time.\n\t\t *\n\t\t * @observable\n\t\t * @default 'auto'\n\t\t * @member {String} #maxWidth\n\t\t */\n\t\tthis.set( 'maxWidth', 'auto' );\n\n\t\t/**\n\t\t * A collection of toolbar items (buttons, dropdowns, etc.).\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.items = this.createCollection();\n\n\t\t/**\n\t\t * Tracks information about the DOM focus in the toolbar.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/focustracker~FocusTracker}\n\t\t */\n\t\tthis.focusTracker = new FocusTracker();\n\n\t\t/**\n\t\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}\n\t\t * to handle keyboard navigation in the toolbar.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/keystrokehandler~KeystrokeHandler}\n\t\t */\n\t\tthis.keystrokes = new KeystrokeHandler();\n\n\t\t/**\n\t\t * An additional CSS class added to the {@link #element}.\n\t\t *\n\t\t * @observable\n\t\t * @member {String} #class\n\t\t */\n\t\tthis.set( 'class' );\n\n\t\t/**\n\t\t * When set true, makes the toolbar look compact with {@link #element}.\n\t\t *\n\t\t * @observable\n\t\t * @default false\n\t\t * @member {String} #isCompact\n\t\t */\n\t\tthis.set( 'isCompact', false );\n\n\t\t/**\n\t\t * A (child) view containing {@link #items toolbar items}.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ItemsView}\n\t\t */\n\t\tthis.itemsView = new ItemsView( locale );\n\n\t\t/**\n\t\t * A toplevel collection aggregating building blocks of the toolbar.\n\t\t *\n\t\t *\t ToolbarView \n\t\t *\t|  #children  |\n\t\t *\t| |    #itemsView    | |\n\t\t *\t| |   | [ item1 ] [ item2 ] ... [ itemN ] |   | |\n\t\t *\t| |   -   | |\n\t\t *\t|  |\n\t\t *\t\n\t\t *\n\t\t * By default, it contains the {@link #itemsView} but it can be extended with additional\n\t\t * UI elements when necessary.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.children = this.createCollection();\n\t\tthis.children.add( this.itemsView );\n\n\t\t/**\n\t\t * A collection of {@link #items} that take part in the focus cycling\n\t\t * (i.e. navigation using the keyboard). Usually, it contains a subset of {@link #items} with\n\t\t * some optional UI elements that also belong to the toolbar and should be focusable\n\t\t * by the user.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.focusables = this.createCollection();\n\n\t\t/**\n\t\t * Controls the orientation of toolbar items. Only available when\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull dynamic items grouping}\n\t\t * is **disabled**.\n\t\t *\n\t\t * @observable\n\t\t * @member {Boolean} #isVertical\n\t\t */\n\n\t\t/**\n\t\t * Helps cycling over {@link #focusables focusable items} in the toolbar.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {module:ui/focuscycler~FocusCycler}\n\t\t */\n\t\tthis._focusCycler = new FocusCycler( {\n\t\t\tfocusables: this.focusables,\n\t\t\tfocusTracker: this.focusTracker,\n\t\t\tkeystrokeHandler: this.keystrokes,\n\t\t\tactions: {\n\t\t\t\t// Navigate toolbar items backwards using the arrow[left,up] keys.\n\t\t\t\tfocusPrevious: [ 'arrowleft', 'arrowup' ],\n\n\t\t\t\t// Navigate toolbar items forwards using the arrow[right,down] keys.\n\t\t\t\tfocusNext: [ 'arrowright', 'arrowdown' ]\n\t\t\t}\n\t\t} );\n\n\t\tconst classes = [\n\t\t\t'ck',\n\t\t\t'ck-toolbar',\n\t\t\tbind.to( 'class' ),\n\t\t\tbind.if( 'isCompact', 'ck-toolbar_compact' )\n\t\t];\n\n\t\tif ( this.options.shouldGroupWhenFull && this.options.isFloating ) {\n\t\t\tclasses.push( 'ck-toolbar_floating' );\n\t\t}\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'div',\n\t\t\tattributes: {\n\t\t\t\tclass: classes,\n\t\t\t\trole: 'toolbar',\n\t\t\t\t'aria-label': bind.to( 'ariaLabel' ),\n\t\t\t\tstyle: {\n\t\t\t\t\tmaxWidth: bind.to( 'maxWidth' )\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tchildren: this.children,\n\n\t\t\ton: {\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-ui/issues/206\n\t\t\t\tmousedown: preventDefault( this )\n\t\t\t}\n\t\t} );\n\n\t\t/**\n\t\t * An instance of the active toolbar behavior that shapes its look and functionality.\n\t\t *\n\t\t * See {@link module:ui/toolbar/toolbarview~ToolbarBehavior} to learn more.\n\t\t *\n\t\t * @protected\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ToolbarBehavior}\n\t\t */\n\t\tthis._behavior = this.options.shouldGroupWhenFull ? new DynamicGrouping( this ) : new StaticLayout( this );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trender() {\n\t\tsuper.render();\n\n\t\t// Children added before rendering should be known to the #focusTracker.\n\t\tfor ( const item of this.items ) {\n\t\t\tthis.focusTracker.add( item.element );\n\t\t}\n\n\t\tthis.items.on( 'add', ( evt, item ) => {\n\t\t\tthis.focusTracker.add( item.element );\n\t\t} );\n\n\t\tthis.items.on( 'remove', ( evt, item ) => {\n\t\t\tthis.focusTracker.remove( item.element );\n\t\t} );\n\n\t\t// Start listening for the keystrokes coming from #element.\n\t\tthis.keystrokes.listenTo( this.element );\n\n\t\tthis._behavior.render( this );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {\n\t\tthis._behavior.destroy();\n\n\t\treturn super.destroy();\n\t}\n\n\t/**\n\t * Focuses the first focusable in {@link #focusables}.\n\t */\n\tfocus() {\n\t\tthis._focusCycler.focusFirst();\n\t}\n\n\t/**\n\t * Focuses the last focusable in {@link #focusables}.\n\t */\n\tfocusLast() {\n\t\tthis._focusCycler.focusLast();\n\t}\n\n\t/**\n\t * A utility that expands the plain toolbar configuration into\n\t * {@link module:ui/toolbar/toolbarview~ToolbarView#items} using a given component factory.\n\t *\n\t * @param {Array.<String>|Object} itemsOrConfig The toolbar items or the entire toolbar configuration object.\n\t * @param {module:ui/componentfactory~ComponentFactory} factory A factory producing toolbar items.\n\t */\n\tfillFromConfig( itemsOrConfig, factory ) {\n\t\tconst config = normalizeToolbarConfig( itemsOrConfig );\n\n\t\tconst itemsToClean = config.items\n\t\t\t.filter( ( name, idx, items ) => {\n\t\t\t\tif ( name === '|' ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Items listed in `config.removeItems` should not be added to the toolbar.\n\t\t\t\tif ( config.removeItems.indexOf( name ) !== -1 ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif ( name === '-' ) {\n\t\t\t\t\t// The toolbar line breaks must not be rendered when toolbar grouping is enabled.\n\t\t\t\t\t// (https://github.com/ckeditor/ckeditor5/issues/8582)\n\t\t\t\t\tif ( this.options.shouldGroupWhenFull ) {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * The toolbar multiline breaks (`-` items) only work when the automatic button grouping\n\t\t\t\t\t\t * is disabled in the toolbar configuration.\n\t\t\t\t\t\t * To do this, set the `shouldNotGroupWhenFull` option to `true` in the editor configuration:\n\t\t\t\t\t\t *\n\t\t\t\t\t\t *\t\tconst config = {\n\t\t\t\t\t\t *\t\t\ttoolbar: {\n\t\t\t\t\t\t *\t\t\t\titems: [ ... ],\n\t\t\t\t\t\t *\t\t\t\tshouldNotGroupWhenFull: true\n\t\t\t\t\t\t *\t\t\t}\n\t\t\t\t\t\t *\t\t}\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * Learn more about {@link module:core/editor/editorconfig~EditorConfig#toolbar toolbar configuration}.\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * @error toolbarview-line-break-ignored-when-grouping-items\n\t\t\t\t\t\t */\n\t\t\t\t\t\tlogWarning( 'toolbarview-line-break-ignored-when-grouping-items', items );\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// For the items that cannot be instantiated we are sending warning message. We also filter them out.\n\t\t\t\tif ( !factory.has( name ) ) {\n\t\t\t\t\t/**\n\t\t\t\t\t * There was a problem processing the configuration of the toolbar. The item with the given\n\t\t\t\t\t * name does not exist so it was omitted when rendering the toolbar.\n\t\t\t\t\t *\n\t\t\t\t\t * This warning usually shows up when the {@link module:core/plugin~Plugin} which is supposed\n\t\t\t\t\t * to provide a toolbar item has not been loaded or there is a typo in the configuration.\n\t\t\t\t\t *\n\t\t\t\t\t * Make sure the plugin responsible for this toolbar item is loaded and the toolbar configuration\n\t\t\t\t\t * is correct, e.g. {@link module:basic-styles/bold~Bold} is loaded for the `'bold'` toolbar item.\n\t\t\t\t\t *\n\t\t\t\t\t * You can use the following snippet to retrieve all available toolbar items:\n\t\t\t\t\t *\n\t\t\t\t\t *\t\tArray.from( editor.ui.componentFactory.names() );\n\t\t\t\t\t *\n\t\t\t\t\t * @error toolbarview-item-unavailable\n\t\t\t\t\t * @param {String} name The name of the component.\n\t\t\t\t\t */\n\t\t\t\t\tlogWarning( 'toolbarview-item-unavailable', { name } );\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t} );\n\n\t\tconst itemsToAdd = this._cleanSeparators( itemsToClean )\n\t\t\t// Instantiate toolbar items.\n\t\t\t.map( name => {\n\t\t\t\tif ( name === '|' ) {\n\t\t\t\t\treturn new ToolbarSeparatorView();\n\t\t\t\t} else if ( name === '-' ) {\n\t\t\t\t\treturn new ToolbarLineBreakView();\n\t\t\t\t}\n\n\t\t\t\treturn factory.create( name );\n\t\t\t} );\n\n\t\tthis.items.addMany( itemsToAdd );\n\t}\n\n\t/**\n\t * Remove leading, trailing, and duplicated separators (`-` and `|`).\n\t *\n\t * @private\n\t * @param {Array.<String>} items\n\t */\n\t_cleanSeparators( items ) {\n\t\tconst nonSeparatorPredicate = item => ( item !== '-' && item !== '|' );\n\t\tconst count = items.length;\n\n\t\t// Find an index of the first item that is not a separator.\n\t\tconst firstCommandItem = items.findIndex( nonSeparatorPredicate );\n\n\t\t// Search from the end of the list, then convert found index back to the original direction.\n\t\tconst lastCommandItem = count - items\n\t\t\t.slice()\n\t\t\t.reverse()\n\t\t\t.findIndex( nonSeparatorPredicate );\n\n\t\treturn items\n\t\t\t// Return items without the leading and trailing separators.\n\t\t\t.slice( firstCommandItem, lastCommandItem )\n\t\t\t// Remove duplicated separators.\n\t\t\t.filter( ( name, idx, items ) => {\n\t\t\t\t// Filter only separators.\n\t\t\t\tif ( nonSeparatorPredicate( name ) ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tconst isDuplicated = idx > 0 && items[ idx - 1 ] === name;\n\n\t\t\t\treturn !isDuplicated;\n\t\t\t} );\n\t}\n\n\t/**\n\t * Fired when some toolbar {@link #items} were grouped or ungrouped as a result of some change\n\t * in the toolbar geometry.\n\t *\n\t * **Note**: This event is always fired **once** regardless of the number of items that were be\n\t * grouped or ungrouped at a time.\n\t *\n\t * **Note**: This event is fired only if the items grouping functionality was enabled in\n\t * the first place (see {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull}).\n\t *\n\t * @event groupedItemsUpdate\n\t */\n}\n\n/**\n * An inner block of the {@link module:ui/toolbar/toolbarview~ToolbarView} hosting its\n * {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n *\n * @private\n * @extends module:ui/view~View\n */\nclass ItemsView extends View {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( locale ) {\n\t\tsuper( locale );\n\n\t\t/**\n\t\t * A collection of items (buttons, dropdowns, etc.).\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.children = this.createCollection();\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'div',\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck',\n\t\t\t\t\t'ck-toolbar__items'\n\t\t\t\t]\n\t\t\t},\n\t\t\tchildren: this.children\n\t\t} );\n\t}\n}\n\n/**\n * A toolbar behavior that makes it static and unresponsive to the changes of the environment.\n * At the same time, it also makes it possible to display a toolbar with a vertical layout\n * using the {@link module:ui/toolbar/toolbarview~ToolbarView#isVertical} property.\n *\n * @private\n * @implements module:ui/toolbar/toolbarview~ToolbarBehavior\n */\nclass StaticLayout {\n\t/**\n\t * Creates an instance of the {@link module:ui/toolbar/toolbarview~StaticLayout} toolbar\n\t * behavior.\n\t *\n\t * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n\t * is added to.\n\t */\n\tconstructor( view ) {\n\t\tconst bind = view.bindTemplate;\n\n\t\t// Static toolbar can be vertical when needed.\n\t\tview.set( 'isVertical', false );\n\n\t\t// 1:1 passthrough binding, all ToolbarView#items are visible.\n\t\tview.itemsView.children.bindTo( view.items ).using( item => item );\n\n\t\t// 1:1 passthrough binding, all ToolbarView#items are focusable.\n\t\tview.focusables.bindTo( view.items ).using( item => item );\n\n\t\tview.extendTemplate( {\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t// When vertical, the toolbar has an additional CSS class.\n\t\t\t\t\tbind.if( 'isVertical', 'ck-toolbar_vertical' )\n\t\t\t\t]\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trender() {}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {}\n}\n\n/**\n * A toolbar behavior that makes the items respond to changes in the geometry.\n *\n * In a nutshell, it groups {@link module:ui/toolbar/toolbarview~ToolbarView#items}\n * that do not fit visually into a single row of the toolbar (due to limited space).\n * Items that do not fit are aggregated in a dropdown displayed at the end of the toolbar.\n *\n *\t ToolbarView \n *\t|  #children  |\n *\t| |    #itemsView    #groupedItemsDropdown    | |\n *\t| |   |       #ungroupedItems     | | ToolbarSeparatorView | |        #groupedItems       |   | |\n *\t| |   -     | |\n *\t| |                                  \\---------- only when toolbar items overflow --------/    | |\n *\t|  |\n *\t\n *\n * @private\n * @implements module:ui/toolbar/toolbarview~ToolbarBehavior\n */\nclass DynamicGrouping {\n\t/**\n\t * Creates an instance of the {@link module:ui/toolbar/toolbarview~DynamicGrouping} toolbar\n\t * behavior.\n\t *\n\t * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n\t * is added to.\n\t */\n\tconstructor( view ) {\n\t\t/**\n\t\t * A toolbar view this behavior belongs to.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar~ToolbarView}\n\t\t */\n\t\tthis.view = view;\n\n\t\t/**\n\t\t * A collection of toolbar children.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.viewChildren = view.children;\n\n\t\t/**\n\t\t * A collection of focusable toolbar elements.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.viewFocusables = view.focusables;\n\n\t\t/**\n\t\t * A view containing toolbar items.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/toolbar/toolbarview~ItemsView}\n\t\t */\n\t\tthis.viewItemsView = view.itemsView;\n\n\t\t/**\n\t\t * Toolbar focus tracker.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/focustracker~FocusTracker}\n\t\t */\n\t\tthis.viewFocusTracker = view.focusTracker;\n\n\t\t/**\n\t\t * Toolbar locale.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/locale~Locale}\n\t\t */\n\t\tthis.viewLocale = view.locale;\n\n\t\t/**\n\t\t * Toolbar element.\n\t\t *\n\t\t * @readonly\n\t\t * @member {HTMLElement} #viewElement\n\t\t */\n\n\t\t/**\n\t\t * A subset of toolbar {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n\t\t * Aggregates items that fit into a single row of the toolbar and were not {@link #groupedItems grouped}\n\t\t * into a {@link #groupedItemsDropdown dropdown}. Items of this collection are displayed in the\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarView#itemsView}.\n\t\t *\n\t\t * When none of the {@link module:ui/toolbar/toolbarview~ToolbarView#items} were grouped, it\n\t\t * matches the {@link module:ui/toolbar/toolbarview~ToolbarView#items} collection in size and order.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.ungroupedItems = view.createCollection();\n\n\t\t/**\n\t\t * A subset of toolbar {@link module:ui/toolbar/toolbarview~ToolbarView#items}.\n\t\t * A collection of the toolbar items that do not fit into a single row of the toolbar.\n\t\t * Grouped items are displayed in a dedicated {@link #groupedItemsDropdown dropdown}.\n\t\t *\n\t\t * When none of the {@link module:ui/toolbar/toolbarview~ToolbarView#items} were grouped,\n\t\t * this collection is empty.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/viewcollection~ViewCollection}\n\t\t */\n\t\tthis.groupedItems = view.createCollection();\n\n\t\t/**\n\t\t * The dropdown that aggregates {@link #groupedItems grouped items} that do not fit into a single\n\t\t * row of the toolbar. It is displayed on demand as the last of\n\t\t * {@link module:ui/toolbar/toolbarview~ToolbarView#children toolbar children} and offers another\n\t\t * (nested) toolbar which displays items that would normally overflow.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:ui/dropdown/dropdownview~DropdownView}\n\t\t */\n\t\tthis.groupedItemsDropdown = this._createGroupedItemsDropdown();\n\n\t\t/**\n\t\t * An instance of the resize observer that helps dynamically determine the geometry of the toolbar\n\t\t * and manage items that do not fit into a single row.\n\t\t *\n\t\t * **Note:** Created in {@link #_enableGroupingOnResize}.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:utils/dom/resizeobserver~ResizeObserver}\n\t\t */\n\t\tthis.resizeObserver = null;\n\n\t\t/**\n\t\t * A cached value of the horizontal padding style used by {@link #_updateGrouping}\n\t\t * to manage the {@link module:ui/toolbar/toolbarview~ToolbarView#items} that do not fit into\n\t\t * a single toolbar line. This value can be reused between updates because it is unlikely that\n\t\t * the padding will change and reusing `Window.getComputedStyle()` is expensive.\n\t\t *\n\t\t * @readonly\n\t\t * @member {Number}\n\t\t */\n\t\tthis.cachedPadding = null;\n\n\t\t/**\n\t\t * A flag indicating that an items grouping update has been queued (e.g. due to the toolbar being visible)\n\t\t * and should be executed immediately the next time the toolbar shows up.\n\t\t *\n\t\t * @readonly\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis.shouldUpdateGroupingOnNextResize = false;\n\n\t\t// Only those items that were not grouped are visible to the user.\n\t\tview.itemsView.children.bindTo( this.ungroupedItems ).using( item => item );\n\n\t\t// Make sure all #items visible in the main space of the toolbar are \"focuscycleable\".\n\t\tthis.ungroupedItems.on( 'add', this._updateFocusCycleableItems.bind( this ) );\n\t\tthis.ungroupedItems.on( 'remove', this._updateFocusCycleableItems.bind( this ) );\n\n\t\t// Make sure the #groupedItemsDropdown is also included in cycling when it appears.\n\t\tview.children.on( 'add', this._updateFocusCycleableItems.bind( this ) );\n\t\tview.children.on( 'remove', this._updateFocusCycleableItems.bind( this ) );\n\n\t\t// ToolbarView#items is dynamic. When an item is added or removed, it should be automatically\n\t\t// represented in either grouped or ungrouped items at the right index.\n\t\t// In other words #items == concat( #ungroupedItems, #groupedItems )\n\t\t// (in length and order).\n\t\tview.items.on( 'change', ( evt, changeData ) => {\n\t\t\tconst index = changeData.index;\n\n\t\t\t// Removing.\n\t\t\tfor ( const removedItem of changeData.removed ) {\n\t\t\t\tif ( index >= this.ungroupedItems.length ) {\n\t\t\t\t\tthis.groupedItems.remove( removedItem );\n\t\t\t\t} else {\n\t\t\t\t\tthis.ungroupedItems.remove( removedItem );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Adding.\n\t\t\tfor ( let currentIndex = index; currentIndex < index + changeData.added.length; currentIndex++ ) {\n\t\t\t\tconst addedItem = changeData.added[ currentIndex - index ];\n\n\t\t\t\tif ( currentIndex > this.ungroupedItems.length ) {\n\t\t\t\t\tthis.groupedItems.add( addedItem, currentIndex - this.ungroupedItems.length );\n\t\t\t\t} else {\n\t\t\t\t\tthis.ungroupedItems.add( addedItem, currentIndex );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// When new ungrouped items join in and land in #ungroupedItems, there's a chance it causes\n\t\t\t// the toolbar to overflow.\n\t\t\t// Consequently if removed from grouped or ungrouped items, there is a chance\n\t\t\t// some new space is available and we could do some ungrouping.\n\t\t\tthis._updateGrouping();\n\t\t} );\n\n\t\tview.extendTemplate( {\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t// To group items dynamically, the toolbar needs a dedicated CSS class.\n\t\t\t\t\t'ck-toolbar_grouping'\n\t\t\t\t]\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Enables dynamic items grouping based on the dimensions of the toolbar.\n\t *\n\t * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior\n\t * is added to.\n\t */\n\trender( view ) {\n\t\tthis.viewElement = view.element;\n\n\t\tthis._enableGroupingOnResize();\n\t\tthis._enableGroupingOnMaxWidthChange( view );\n\t}\n\n\t/**\n\t * Cleans up the internals used by this behavior.\n\t */\n\tdestroy() {\n\t\t// The dropdown may not be in ToolbarView#children at the moment of toolbar destruction\n\t\t// so let's make sure it's actually destroyed along with the toolbar.\n\t\tthis.groupedItemsDropdown.destroy();\n\n\t\tthis.resizeObserver.destroy();\n\t}\n\n\t/**\n\t * When called, it will check if any of the {@link #ungroupedItems} do not fit into a single row of the toolbar,\n\t * and it will move them to the {@link #groupedItems} when it happens.\n\t *\n\t * At the same time, it will also check if there is enough space in the toolbar for the first of the\n\t * {@link #groupedItems} to be returned back to {@link #ungroupedItems} and still fit into a single row\n\t * without the toolbar wrapping.\n\t *\n\t * @protected\n\t */\n\t_updateGrouping() {\n\t\t// Do no groupingrelated geometry analysis when the toolbar is detached from visible DOM,\n\t\t// for instance before #render(), or after render but without a parent or a parent detached\n\t\t// from DOM. DOMRects won't work anyway and there will be tons of warning in the console and\n\t\t// nothing else. This happens, for instance, when the toolbar is detached from DOM and\n\t\t// some logic adds or removes its #items.\n\t\tif ( !this.viewElement.ownerDocument.body.contains( this.viewElement ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Do not update grouping when the element is invisible. Such toolbar has DOMRect filled with zeros\n\t\t// and that would cause all items to be grouped. Instead, queue the grouping so it runs next time\n\t\t// the toolbar is visible (the next ResizeObserver callback execution). This is handy because\n\t\t// the grouping could be caused by increasing the #maxWidth when the toolbar was invisible and the next\n\t\t// time it shows up, some items could actually be ungrouped (https://github.com/ckeditor/ckeditor5/issues/6575).\n\t\tif ( !this.viewElement.offsetParent ) {\n\t\t\tthis.shouldUpdateGroupingOnNextResize = true;\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Remember how many items were initially grouped so at the it is possible to figure out if the number\n\t\t// of grouped items has changed. If the number has changed, geometry of the toolbar has also changed.\n\t\tconst initialGroupedItemsCount = this.groupedItems.length;\n\t\tlet wereItemsGrouped;\n\n\t\t// Group #items as long as some wrap to the next row. This will happen, for instance,\n\t\t// when the toolbar is getting narrow and there is not enough space to display all items in\n\t\t// a single row.\n\t\twhile ( this._areItemsOverflowing ) {\n\t\t\tthis._groupLastItem();\n\n\t\t\twereItemsGrouped = true;\n\t\t}\n\n\t\t// If none were grouped now but there were some items already grouped before,\n\t\t// then, what the hell, maybe let's see if some of them can be ungrouped. This happens when,\n\t\t// for instance, the toolbar is stretching and there's more space in it than before.\n\t\tif ( !wereItemsGrouped && this.groupedItems.length ) {\n\t\t\t// Ungroup items as long as none are overflowing or there are none to ungroup left.\n\t\t\twhile ( this.groupedItems.length && !this._areItemsOverflowing ) {\n\t\t\t\tthis._ungroupFirstItem();\n\t\t\t}\n\n\t\t\t// If the ungrouping ended up with some item wrapping to the next row,\n\t\t\t// put it back to the group toolbar (\"undo the last ungroup\"). We don't know whether\n\t\t\t// an item will wrap or not until we ungroup it (that's a DOM/CSS thing) so this\n\t\t\t// cleanup is vital for the algorithm.\n\t\t\tif ( this._areItemsOverflowing ) {\n\t\t\t\tthis._groupLastItem();\n\t\t\t}\n\t\t}\n\n\t\tif ( this.groupedItems.length !== initialGroupedItemsCount ) {\n\t\t\tthis.view.fire( 'groupedItemsUpdate' );\n\t\t}\n\t}\n\n\t/**\n\t * Returns `true` when {@link module:ui/toolbar/toolbarview~ToolbarView#element} children visually overflow,\n\t * for instance if the toolbar is narrower than its members. Returns `false` otherwise.\n\t *\n\t * @private\n\t * @type {Boolean}\n\t */\n\tget _areItemsOverflowing() {\n\t\t// An empty toolbar cannot overflow.\n\t\tif ( !this.ungroupedItems.length ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst element = this.viewElement;\n\t\tconst uiLanguageDirection = this.viewLocale.uiLanguageDirection;\n\t\tconst lastChildRect = new Rect( element.lastChild );\n\t\tconst toolbarRect = new Rect( element );\n\n\t\tif ( !this.cachedPadding ) {\n\t\t\tconst computedStyle = global.window.getComputedStyle( element );\n\t\t\tconst paddingProperty = uiLanguageDirection === 'ltr' ? 'paddingRight' : 'paddingLeft';\n\n\t\t\t// parseInt() is essential because of quirky floating point numbers logic and DOM.\n\t\t\t// If the padding turned out too big because of that, the grouped items dropdown would\n\t\t\t// always look (from the Rect perspective) like it overflows (while it's not).\n\t\t\tthis.cachedPadding = Number.parseInt( computedStyle[ paddingProperty ] );\n\t\t}\n\n\t\tif ( uiLanguageDirection === 'ltr' ) {\n\t\t\treturn lastChildRect.right > toolbarRect.right - this.cachedPadding;\n\t\t} else {\n\t\t\treturn lastChildRect.left < toolbarRect.left + this.cachedPadding;\n\t\t}\n\t}\n\n\t/**\n\t * Enables the functionality that prevents {@link #ungroupedItems} from overflowing (wrapping to the next row)\n\t * upon resize when there is little space available. Instead, the toolbar items are moved to the\n\t * {@link #groupedItems} collection and displayed in a dropdown at the end of the row (which has its own nested toolbar).\n\t *\n\t * When called, the toolbar will automatically analyze the location of its {@link #ungroupedItems} and \"group\"\n\t * them in the dropdown if necessary. It will also observe the browser window for size changes in\n\t * the future and respond to them by grouping more items or reverting already grouped back, depending\n\t * on the visual space available.\n\t *\n\t * @private\n\t */\n\t_enableGroupingOnResize() {\n\t\tlet previousWidth;\n\n\t\t// TODO: Consider debounce.\n\t\tthis.resizeObserver = new ResizeObserver( this.viewElement, entry => {\n\t\t\tif ( !previousWidth || previousWidth !== entry.contentRect.width || this.shouldUpdateGroupingOnNextResize ) {\n\t\t\t\tthis.shouldUpdateGroupingOnNextResize = false;\n\n\t\t\t\tthis._updateGrouping();\n\n\t\t\t\tpreviousWidth = entry.contentRect.width;\n\t\t\t}\n\t\t} );\n\n\t\tthis._updateGrouping();\n\t}\n\n\t/**\n\t * Enables the grouping functionality, just like {@link #_enableGroupingOnResize} but the difference is that\n\t * it listens to the changes of {@link module:ui/toolbar/toolbarview~ToolbarView#maxWidth} instead.\n\t *\n\t * @private\n\t */\n\t_enableGroupingOnMaxWidthChange( view ) {\n\t\tview.on( 'change:maxWidth', () => {\n\t\t\tthis._updateGrouping();\n\t\t} );\n\t}\n\n\t/**\n\t * When called, it will remove the last item from {@link #ungroupedItems} and move it back\n\t * to the {@link #groupedItems} collection.\n\t *\n\t * The opposite of {@link #_ungroupFirstItem}.\n\t *\n\t * @private\n\t */\n\t_groupLastItem() {\n\t\tif ( !this.groupedItems.length ) {\n\t\t\tthis.viewChildren.add( new ToolbarSeparatorView() );\n\t\t\tthis.viewChildren.add( this.groupedItemsDropdown );\n\t\t\tthis.viewFocusTracker.add( this.groupedItemsDropdown.element );\n\t\t}\n\n\t\tthis.groupedItems.add( this.ungroupedItems.remove( this.ungroupedItems.last ), 0 );\n\t}\n\n\t/**\n\t * Moves the very first item belonging to {@link #groupedItems} back\n\t * to the {@link #ungroupedItems} collection.\n\t *\n\t * The opposite of {@link #_groupLastItem}.\n\t *\n\t * @private\n\t */\n\t_ungroupFirstItem() {\n\t\tthis.ungroupedItems.add( this.groupedItems.remove( this.groupedItems.first ) );\n\n\t\tif ( !this.groupedItems.length ) {\n\t\t\tthis.viewChildren.remove( this.groupedItemsDropdown );\n\t\t\tthis.viewChildren.remove( this.viewChildren.last );\n\t\t\tthis.viewFocusTracker.remove( this.groupedItemsDropdown.element );\n\t\t}\n\t}\n\n\t/**\n\t * Creates the {@link #groupedItemsDropdown} that hosts the members of the {@link #groupedItems}\n\t * collection when there is not enough space in the toolbar to display all items in a single row.\n\t *\n\t * @private\n\t * @returns {module:ui/dropdown/dropdownview~DropdownView}\n\t */\n\t_createGroupedItemsDropdown() {\n\t\tconst locale = this.viewLocale;\n\t\tconst t = locale.t;\n\t\tconst dropdown = createDropdown( locale );\n\n\t\tdropdown.class = 'ck-toolbar__grouped-dropdown';\n\n\t\t// Make sure the dropdown never sticks out to the left/right. It should be under the main toolbar.\n\t\t// (https://github.com/ckeditor/ckeditor5/issues/5608)\n\t\tdropdown.panelPosition = locale.uiLanguageDirection === 'ltr' ? 'sw' : 'se';\n\n\t\taddToolbarToDropdown( dropdown, [] );\n\n\t\tdropdown.buttonView.set( {\n\t\t\tlabel: t( 'Show more items' ),\n\t\t\ttooltip: true,\n\t\t\ttooltipPosition: locale.uiLanguageDirection === 'rtl' ? 'se' : 'sw',\n\t\t\ticon: icons.threeVerticalDots\n\t\t} );\n\n\t\t// 1:1 passthrough binding.\n\t\tdropdown.toolbarView.items.bindTo( this.groupedItems ).using( item => item );\n\n\t\treturn dropdown;\n\t}\n\n\t/**\n\t * Updates the {@link module:ui/toolbar/toolbarview~ToolbarView#focusables focuscycleable items}\n\t * collection so it represents the uptodate state of the UI from the perspective of the user.\n\t *\n\t * For instance, the {@link #groupedItemsDropdown} can show up and hide but when it is visible,\n\t * it must be subject to focus cycling in the toolbar.\n\t *\n\t * See the {@link module:ui/toolbar/toolbarview~ToolbarView#focusables collection} documentation\n\t * to learn more about the purpose of this method.\n\t *\n\t * @private\n\t */\n\t_updateFocusCycleableItems() {\n\t\tthis.viewFocusables.clear();\n\n\t\tthis.ungroupedItems.map( item => {\n\t\t\tthis.viewFocusables.add( item );\n\t\t} );\n\n\t\tif ( this.groupedItems.length ) {\n\t\t\tthis.viewFocusables.add( this.groupedItemsDropdown );\n\t\t}\n\t}\n}\n\n/**\n * Options passed to the {@link module:ui/toolbar/toolbarview~ToolbarView#constructor} of the toolbar.\n *\n * @interface module:ui/toolbar/toolbarview~ToolbarOptions\n */\n\n/**\n * When set to `true`, the toolbar will automatically group {@link module:ui/toolbar/toolbarview~ToolbarView#items} that\n * would normally wrap to the next line when there is not enough space to display them in a single row, for\n * instance, if the parent container of the toolbar is narrow. For toolbars in absolutely positioned containers\n * without width restrictions also the {@link module:ui/toolbar/toolbarview~ToolbarOptions#isFloating} option is required to be `true`.\n *\n * See also: {@link module:ui/toolbar/toolbarview~ToolbarView#maxWidth}.\n *\n * @member {Boolean} module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull\n */\n\n/**\n * This option should be enabled for toolbars in absolutely positioned containers without width restrictions\n * to enable automatic {@link module:ui/toolbar/toolbarview~ToolbarView#items} grouping.\n * When this option is set to `true`, the items will stop wrapping to the next line\n * and together with {@link module:ui/toolbar/toolbarview~ToolbarOptions#shouldGroupWhenFull},\n * this will allow grouping them when there is not enough space in a single row.\n *\n * @member {Boolean} module:ui/toolbar/toolbarview~ToolbarOptions#isFloating\n */\n\n/**\n * A class interface defining the behavior of the {@link module:ui/toolbar/toolbarview~ToolbarView}.\n *\n * Toolbar behaviors extend its look and functionality and have an impact on the\n * {@link module:ui/toolbar/toolbarview~ToolbarView#element} template or\n * {@link module:ui/toolbar/toolbarview~ToolbarView#render rendering}. They can be enabled\n * conditionally, e.g. depending on the configuration of the toolbar.\n *\n * @private\n * @interface module:ui/toolbar/toolbarview~ToolbarBehavior\n */\n\n/**\n * Creates a new toolbar behavior instance.\n *\n * The instance is created in the {@link module:ui/toolbar/toolbarview~ToolbarView#constructor} of the toolbar.\n * This is the right place to extend the {@link module:ui/toolbar/toolbarview~ToolbarView#template} of\n * the toolbar, define extra toolbar properties, etc.\n *\n * @method #constructor\n * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar that this behavior is added to.\n */\n\n/**\n * A method called after the toolbar has been {@link module:ui/toolbar/toolbarview~ToolbarView#render rendered}.\n * It can be used to, for example, customize the behavior of the toolbar when its {@link module:ui/toolbar/toolbarview~ToolbarView#element}\n * is available.\n *\n * @readonly\n * @member {Function} #render\n * @param {module:ui/toolbar/toolbarview~ToolbarView} view An instance of the toolbar being rendered.\n */\n\n/**\n * A method called after the toolbar has been {@link module:ui/toolbar/toolbarview~ToolbarView#destroy destroyed}.\n * It allows cleaning up after the toolbar behavior, for instance, this is the right place to detach\n * event listeners, free up references, etc.\n *\n * @readonly\n * @member {Function} #destroy\n */\n"]}]}