{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-link/src/linkui.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-link/src/linkui.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvaG9tZS9la2ViZXJhdC9ZYW5kZXguRGlzay9Qcm9qZWxlcmltL0JlbmltUHJvamVsZXJpbS93ZWJzaXRlbS93ZWJzaXRlbS13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvaG9tZS9la2ViZXJhdC9ZYW5kZXguRGlzay9Qcm9qZWxlcmltL0JlbmltUHJvamVsZXJpbS93ZWJzaXRlbS93ZWJzaXRlbS13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9nZXQgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9nZXQiOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZnJvbS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CgovKioKICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjEsIENLU291cmNlIC0gRnJlZGVyaWNvIEtuYWJiZW4uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLW9zcy1saWNlbnNlCiAqLwoKLyoqCiAqIEBtb2R1bGUgbGluay9saW5rdWkKICovCmltcG9ydCB7IFBsdWdpbiB9IGZyb20gJ2NrZWRpdG9yNS9zcmMvY29yZSc7CmltcG9ydCB7IENsaWNrT2JzZXJ2ZXIgfSBmcm9tICdja2VkaXRvcjUvc3JjL2VuZ2luZSc7CmltcG9ydCB7IEJ1dHRvblZpZXcsIENvbnRleHR1YWxCYWxsb29uLCBjbGlja091dHNpZGVIYW5kbGVyIH0gZnJvbSAnY2tlZGl0b3I1L3NyYy91aSc7CmltcG9ydCBMaW5rRm9ybVZpZXcgZnJvbSAnLi91aS9saW5rZm9ybXZpZXcnOwppbXBvcnQgTGlua0FjdGlvbnNWaWV3IGZyb20gJy4vdWkvbGlua2FjdGlvbnN2aWV3JzsKaW1wb3J0IHsgYWRkTGlua1Byb3RvY29sSWZBcHBsaWNhYmxlLCBpc0xpbmtFbGVtZW50LCBMSU5LX0tFWVNUUk9LRSB9IGZyb20gJy4vdXRpbHMnOwppbXBvcnQgbGlua0ljb24gZnJvbSAnLi4vdGhlbWUvaWNvbnMvbGluay5zdmcnOwp2YXIgVklTVUFMX1NFTEVDVElPTl9NQVJLRVJfTkFNRSA9ICdsaW5rLXVpJzsKLyoqCiAqIFRoZSBsaW5rIFVJIHBsdWdpbi4gSXQgaW50cm9kdWNlcyB0aGUgYCdsaW5rJ2AgYW5kIGAndW5saW5rJ2AgYnV0dG9ucyBhbmQgc3VwcG9ydCBmb3IgdGhlIDxrYmQ+Q3RybCtLPC9rYmQ+IGtleXN0cm9rZS4KICoKICogSXQgdXNlcyB0aGUKICoge0BsaW5rIG1vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29ufkNvbnRleHR1YWxCYWxsb29uIGNvbnRleHR1YWwgYmFsbG9vbiBwbHVnaW59LgogKgogKiBAZXh0ZW5kcyBtb2R1bGU6Y29yZS9wbHVnaW5+UGx1Z2luCiAqLwoKdmFyIExpbmtVSSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BsdWdpbikgewogIF9pbmhlcml0cyhMaW5rVUksIF9QbHVnaW4pOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKExpbmtVSSk7CgogIGZ1bmN0aW9uIExpbmtVSSgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMaW5rVUkpOwoKICAgIHJldHVybiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIF9jcmVhdGVDbGFzcyhMaW5rVUksIFt7CiAgICBrZXk6ICJpbml0IiwKICAgIHZhbHVlOgogICAgLyoqCiAgICAgKiBAaW5oZXJpdERvYwogICAgICovCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICB2YXIgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICAgIGVkaXRvci5lZGl0aW5nLnZpZXcuYWRkT2JzZXJ2ZXIoQ2xpY2tPYnNlcnZlcik7CiAgICAgIC8qKgogICAgICAgKiBUaGUgYWN0aW9ucyB2aWV3IGRpc3BsYXllZCBpbnNpZGUgb2YgdGhlIGJhbGxvb24uCiAgICAgICAqCiAgICAgICAqIEBtZW1iZXIge21vZHVsZTpsaW5rL3VpL2xpbmthY3Rpb25zdmlld35MaW5rQWN0aW9uc1ZpZXd9CiAgICAgICAqLwoKICAgICAgdGhpcy5hY3Rpb25zVmlldyA9IHRoaXMuX2NyZWF0ZUFjdGlvbnNWaWV3KCk7CiAgICAgIC8qKgogICAgICAgKiBUaGUgZm9ybSB2aWV3IGRpc3BsYXllZCBpbnNpZGUgdGhlIGJhbGxvb24uCiAgICAgICAqCiAgICAgICAqIEBtZW1iZXIge21vZHVsZTpsaW5rL3VpL2xpbmtmb3Jtdmlld35MaW5rRm9ybVZpZXd9CiAgICAgICAqLwoKICAgICAgdGhpcy5mb3JtVmlldyA9IHRoaXMuX2NyZWF0ZUZvcm1WaWV3KCk7CiAgICAgIC8qKgogICAgICAgKiBUaGUgY29udGV4dHVhbCBiYWxsb29uIHBsdWdpbiBpbnN0YW5jZS4KICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICogQG1lbWJlciB7bW9kdWxlOnVpL3BhbmVsL2JhbGxvb24vY29udGV4dHVhbGJhbGxvb25+Q29udGV4dHVhbEJhbGxvb259CiAgICAgICAqLwoKICAgICAgdGhpcy5fYmFsbG9vbiA9IGVkaXRvci5wbHVnaW5zLmdldChDb250ZXh0dWFsQmFsbG9vbik7IC8vIENyZWF0ZSB0b29sYmFyIGJ1dHRvbnMuCgogICAgICB0aGlzLl9jcmVhdGVUb29sYmFyTGlua0J1dHRvbigpOyAvLyBBdHRhY2ggbGlmZWN5Y2xlIGFjdGlvbnMgdG8gdGhlIHRoZSBiYWxsb29uLgoKCiAgICAgIHRoaXMuX2VuYWJsZVVzZXJCYWxsb29uSW50ZXJhY3Rpb25zKCk7IC8vIFJlbmRlcnMgYSBmYWtlIHZpc3VhbCBzZWxlY3Rpb24gbWFya2VyIG9uIGFuIGV4cGFuZGVkIHNlbGVjdGlvbi4KCgogICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2VkaXRpbmdEb3duY2FzdCcpLm1hcmtlclRvSGlnaGxpZ2h0KHsKICAgICAgICBtb2RlbDogVklTVUFMX1NFTEVDVElPTl9NQVJLRVJfTkFNRSwKICAgICAgICB2aWV3OiB7CiAgICAgICAgICBjbGFzc2VzOiBbJ2NrLWZha2UtbGluay1zZWxlY3Rpb24nXQogICAgICAgIH0KICAgICAgfSk7IC8vIFJlbmRlcnMgYSBmYWtlIHZpc3VhbCBzZWxlY3Rpb24gbWFya2VyIG9uIGEgY29sbGFwc2VkIHNlbGVjdGlvbi4KCiAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcignZWRpdGluZ0Rvd25jYXN0JykubWFya2VyVG9FbGVtZW50KHsKICAgICAgICBtb2RlbDogVklTVUFMX1NFTEVDVElPTl9NQVJLRVJfTkFNRSwKICAgICAgICB2aWV3OiB7CiAgICAgICAgICBuYW1lOiAnc3BhbicsCiAgICAgICAgICBjbGFzc2VzOiBbJ2NrLWZha2UtbGluay1zZWxlY3Rpb24nLCAnY2stZmFrZS1saW5rLXNlbGVjdGlvbl9jb2xsYXBzZWQnXQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEBpbmhlcml0RG9jCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoTGlua1VJLnByb3RvdHlwZSksICJkZXN0cm95IiwgdGhpcykuY2FsbCh0aGlzKTsgLy8gRGVzdHJveSBjcmVhdGVkIFVJIGNvbXBvbmVudHMgYXMgdGhleSBhcmUgbm90IGF1dG9tYXRpY2FsbHkgZGVzdHJveWVkIChzZWUgY2tlZGl0b3I1IzEzNDEpLgoKCiAgICAgIHRoaXMuZm9ybVZpZXcuZGVzdHJveSgpOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSB7QGxpbmsgbW9kdWxlOmxpbmsvdWkvbGlua2FjdGlvbnN2aWV3fkxpbmtBY3Rpb25zVmlld30gaW5zdGFuY2UuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEByZXR1cm5zIHttb2R1bGU6bGluay91aS9saW5rYWN0aW9uc3ZpZXd+TGlua0FjdGlvbnNWaWV3fSBUaGUgbGluayBhY3Rpb25zIHZpZXcgaW5zdGFuY2UuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2NyZWF0ZUFjdGlvbnNWaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlQWN0aW9uc1ZpZXcoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICAgIHZhciBhY3Rpb25zVmlldyA9IG5ldyBMaW5rQWN0aW9uc1ZpZXcoZWRpdG9yLmxvY2FsZSk7CiAgICAgIHZhciBsaW5rQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpbmsnKTsKICAgICAgdmFyIHVubGlua0NvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCd1bmxpbmsnKTsKICAgICAgYWN0aW9uc1ZpZXcuYmluZCgnaHJlZicpLnRvKGxpbmtDb21tYW5kLCAndmFsdWUnKTsKICAgICAgYWN0aW9uc1ZpZXcuZWRpdEJ1dHRvblZpZXcuYmluZCgnaXNFbmFibGVkJykudG8obGlua0NvbW1hbmQpOwogICAgICBhY3Rpb25zVmlldy51bmxpbmtCdXR0b25WaWV3LmJpbmQoJ2lzRW5hYmxlZCcpLnRvKHVubGlua0NvbW1hbmQpOyAvLyBFeGVjdXRlIHVubGluayBjb21tYW5kIGFmdGVyIGNsaWNraW5nIG9uIHRoZSAiRWRpdCIgYnV0dG9uLgoKICAgICAgdGhpcy5saXN0ZW5UbyhhY3Rpb25zVmlldywgJ2VkaXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuX2FkZEZvcm1WaWV3KCk7CiAgICAgIH0pOyAvLyBFeGVjdXRlIHVubGluayBjb21tYW5kIGFmdGVyIGNsaWNraW5nIG9uIHRoZSAiVW5saW5rIiBidXR0b24uCgogICAgICB0aGlzLmxpc3RlblRvKGFjdGlvbnNWaWV3LCAndW5saW5rJywgZnVuY3Rpb24gKCkgewogICAgICAgIGVkaXRvci5leGVjdXRlKCd1bmxpbmsnKTsKCiAgICAgICAgX3RoaXMuX2hpZGVVSSgpOwogICAgICB9KTsgLy8gQ2xvc2UgdGhlIHBhbmVsIG9uIGVzYyBrZXkgcHJlc3Mgd2hlbiB0aGUgKiphY3Rpb25zIGhhdmUgZm9jdXMqKi4KCiAgICAgIGFjdGlvbnNWaWV3LmtleXN0cm9rZXMuc2V0KCdFc2MnLCBmdW5jdGlvbiAoZGF0YSwgY2FuY2VsKSB7CiAgICAgICAgX3RoaXMuX2hpZGVVSSgpOwoKICAgICAgICBjYW5jZWwoKTsKICAgICAgfSk7IC8vIE9wZW4gdGhlIGZvcm0gdmlldyBvbiBDdHJsK0sgd2hlbiB0aGUgKiphY3Rpb25zIGhhdmUgZm9jdXMqKi4uCgogICAgICBhY3Rpb25zVmlldy5rZXlzdHJva2VzLnNldChMSU5LX0tFWVNUUk9LRSwgZnVuY3Rpb24gKGRhdGEsIGNhbmNlbCkgewogICAgICAgIF90aGlzLl9hZGRGb3JtVmlldygpOwoKICAgICAgICBjYW5jZWwoKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhY3Rpb25zVmlldzsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUge0BsaW5rIG1vZHVsZTpsaW5rL3VpL2xpbmtmb3Jtdmlld35MaW5rRm9ybVZpZXd9IGluc3RhbmNlLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmxpbmsvdWkvbGlua2Zvcm12aWV3fkxpbmtGb3JtVmlld30gVGhlIGxpbmsgZm9ybSB2aWV3IGluc3RhbmNlLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9jcmVhdGVGb3JtVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUZvcm1WaWV3KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBlZGl0b3IgPSB0aGlzLmVkaXRvcjsKICAgICAgdmFyIGxpbmtDb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldCgnbGluaycpOwogICAgICB2YXIgZGVmYXVsdFByb3RvY29sID0gZWRpdG9yLmNvbmZpZy5nZXQoJ2xpbmsuZGVmYXVsdFByb3RvY29sJyk7CiAgICAgIHZhciBmb3JtVmlldyA9IG5ldyBMaW5rRm9ybVZpZXcoZWRpdG9yLmxvY2FsZSwgbGlua0NvbW1hbmQpOwogICAgICBmb3JtVmlldy51cmxJbnB1dFZpZXcuZmllbGRWaWV3LmJpbmQoJ3ZhbHVlJykudG8obGlua0NvbW1hbmQsICd2YWx1ZScpOyAvLyBGb3JtIGVsZW1lbnRzIHNob3VsZCBiZSByZWFkLW9ubHkgd2hlbiBjb3JyZXNwb25kaW5nIGNvbW1hbmRzIGFyZSBkaXNhYmxlZC4KCiAgICAgIGZvcm1WaWV3LnVybElucHV0Vmlldy5iaW5kKCdpc1JlYWRPbmx5JykudG8obGlua0NvbW1hbmQsICdpc0VuYWJsZWQnLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICByZXR1cm4gIXZhbHVlOwogICAgICB9KTsKICAgICAgZm9ybVZpZXcuc2F2ZUJ1dHRvblZpZXcuYmluZCgnaXNFbmFibGVkJykudG8obGlua0NvbW1hbmQpOyAvLyBFeGVjdXRlIGxpbmsgY29tbWFuZCBhZnRlciBjbGlja2luZyB0aGUgIlNhdmUiIGJ1dHRvbi4KCiAgICAgIHRoaXMubGlzdGVuVG8oZm9ybVZpZXcsICdzdWJtaXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHZhbHVlID0gZm9ybVZpZXcudXJsSW5wdXRWaWV3LmZpZWxkVmlldy5lbGVtZW50LnZhbHVlOwogICAgICAgIHZhciBwYXJzZWRVcmwgPSBhZGRMaW5rUHJvdG9jb2xJZkFwcGxpY2FibGUodmFsdWUsIGRlZmF1bHRQcm90b2NvbCk7CiAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ2xpbmsnLCBwYXJzZWRVcmwsIGZvcm1WaWV3LmdldERlY29yYXRvclN3aXRjaGVzU3RhdGUoKSk7CgogICAgICAgIF90aGlzMi5fY2xvc2VGb3JtVmlldygpOwogICAgICB9KTsgLy8gSGlkZSB0aGUgcGFuZWwgYWZ0ZXIgY2xpY2tpbmcgdGhlICJDYW5jZWwiIGJ1dHRvbi4KCiAgICAgIHRoaXMubGlzdGVuVG8oZm9ybVZpZXcsICdjYW5jZWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLl9jbG9zZUZvcm1WaWV3KCk7CiAgICAgIH0pOyAvLyBDbG9zZSB0aGUgcGFuZWwgb24gZXNjIGtleSBwcmVzcyB3aGVuIHRoZSAqKmZvcm0gaGFzIGZvY3VzKiouCgogICAgICBmb3JtVmlldy5rZXlzdHJva2VzLnNldCgnRXNjJywgZnVuY3Rpb24gKGRhdGEsIGNhbmNlbCkgewogICAgICAgIF90aGlzMi5fY2xvc2VGb3JtVmlldygpOwoKICAgICAgICBjYW5jZWwoKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBmb3JtVmlldzsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlcyBhIHRvb2xiYXIgTGluayBidXR0b24uIENsaWNraW5nIHRoaXMgYnV0dG9uIHdpbGwgc2hvdwogICAgICogYSB7QGxpbmsgI19iYWxsb29ufSBhdHRhY2hlZCB0byB0aGUgc2VsZWN0aW9uLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2NyZWF0ZVRvb2xiYXJMaW5rQnV0dG9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlVG9vbGJhckxpbmtCdXR0b24oKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgICB2YXIgbGlua0NvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCdsaW5rJyk7CiAgICAgIHZhciB0ID0gZWRpdG9yLnQ7IC8vIEhhbmRsZSB0aGUgYEN0cmwrS2Aga2V5c3Ryb2tlIGFuZCBzaG93IHRoZSBwYW5lbC4KCiAgICAgIGVkaXRvci5rZXlzdHJva2VzLnNldChMSU5LX0tFWVNUUk9LRSwgZnVuY3Rpb24gKGtleUV2dERhdGEsIGNhbmNlbCkgewogICAgICAgIC8vIFByZXZlbnQgZm9jdXNpbmcgdGhlIHNlYXJjaCBiYXIgaW4gRkYsIENocm9tZSBhbmQgRWRnZS4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzQ4MTEuCiAgICAgICAgY2FuY2VsKCk7CgogICAgICAgIGlmIChsaW5rQ29tbWFuZC5pc0VuYWJsZWQpIHsKICAgICAgICAgIF90aGlzMy5fc2hvd1VJKHRydWUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGVkaXRvci51aS5jb21wb25lbnRGYWN0b3J5LmFkZCgnbGluaycsIGZ1bmN0aW9uIChsb2NhbGUpIHsKICAgICAgICB2YXIgYnV0dG9uID0gbmV3IEJ1dHRvblZpZXcobG9jYWxlKTsKICAgICAgICBidXR0b24uaXNFbmFibGVkID0gdHJ1ZTsKICAgICAgICBidXR0b24ubGFiZWwgPSB0KCdMaW5rJyk7CiAgICAgICAgYnV0dG9uLmljb24gPSBsaW5rSWNvbjsKICAgICAgICBidXR0b24ua2V5c3Ryb2tlID0gTElOS19LRVlTVFJPS0U7CiAgICAgICAgYnV0dG9uLnRvb2x0aXAgPSB0cnVlOwogICAgICAgIGJ1dHRvbi5pc1RvZ2dsZWFibGUgPSB0cnVlOyAvLyBCaW5kIGJ1dHRvbiB0byB0aGUgY29tbWFuZC4KCiAgICAgICAgYnV0dG9uLmJpbmQoJ2lzRW5hYmxlZCcpLnRvKGxpbmtDb21tYW5kLCAnaXNFbmFibGVkJyk7CiAgICAgICAgYnV0dG9uLmJpbmQoJ2lzT24nKS50byhsaW5rQ29tbWFuZCwgJ3ZhbHVlJywgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gISF2YWx1ZTsKICAgICAgICB9KTsgLy8gU2hvdyB0aGUgcGFuZWwgb24gYnV0dG9uIGNsaWNrLgoKICAgICAgICBfdGhpczMubGlzdGVuVG8oYnV0dG9uLCAnZXhlY3V0ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczMuX3Nob3dVSSh0cnVlKTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGJ1dHRvbjsKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEF0dGFjaGVzIGFjdGlvbnMgdGhhdCBjb250cm9sIHdoZXRoZXIgdGhlIGJhbGxvb24gcGFuZWwgY29udGFpbmluZyB0aGUKICAgICAqIHtAbGluayAjZm9ybVZpZXd9IGlzIHZpc2libGUgb3Igbm90LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2VuYWJsZVVzZXJCYWxsb29uSW50ZXJhY3Rpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5hYmxlVXNlckJhbGxvb25JbnRlcmFjdGlvbnMoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIHZpZXdEb2N1bWVudCA9IHRoaXMuZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudDsgLy8gSGFuZGxlIGNsaWNrIG9uIHZpZXcgZG9jdW1lbnQgYW5kIHNob3cgcGFuZWwgd2hlbiBzZWxlY3Rpb24gaXMgcGxhY2VkIGluc2lkZSB0aGUgbGluayBlbGVtZW50LgogICAgICAvLyBLZWVwIHBhbmVsIG9wZW4gdW50aWwgc2VsZWN0aW9uIHdpbGwgYmUgaW5zaWRlIHRoZSBzYW1lIGxpbmsgZWxlbWVudC4KCiAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHBhcmVudExpbmsgPSBfdGhpczQuX2dldFNlbGVjdGVkTGlua0VsZW1lbnQoKTsKCiAgICAgICAgaWYgKHBhcmVudExpbmspIHsKICAgICAgICAgIC8vIFRoZW4gc2hvdyBwYW5lbCBidXQga2VlcCBmb2N1cyBpbnNpZGUgZWRpdG9yIGVkaXRhYmxlLgogICAgICAgICAgX3RoaXM0Ll9zaG93VUkoKTsKICAgICAgICB9CiAgICAgIH0pOyAvLyBGb2N1cyB0aGUgZm9ybSBpZiB0aGUgYmFsbG9vbiBpcyB2aXNpYmxlIGFuZCB0aGUgVGFiIGtleSBoYXMgYmVlbiBwcmVzc2VkLgoKICAgICAgdGhpcy5lZGl0b3Iua2V5c3Ryb2tlcy5zZXQoJ1RhYicsIGZ1bmN0aW9uIChkYXRhLCBjYW5jZWwpIHsKICAgICAgICBpZiAoX3RoaXM0Ll9hcmVBY3Rpb25zVmlzaWJsZSAmJiAhX3RoaXM0LmFjdGlvbnNWaWV3LmZvY3VzVHJhY2tlci5pc0ZvY3VzZWQpIHsKICAgICAgICAgIF90aGlzNC5hY3Rpb25zVmlldy5mb2N1cygpOwoKICAgICAgICAgIGNhbmNlbCgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIC8vIFVzZSB0aGUgaGlnaCBwcmlvcml0eSBiZWNhdXNlIHRoZSBsaW5rIFVJIG5hdmlnYXRpb24gaXMgbW9yZSBpbXBvcnRhbnQKICAgICAgICAvLyB0aGFuIG90aGVyIGZlYXR1cmUncyBhY3Rpb25zLCBlLmcuIGxpc3QgaW5kZW50YXRpb24uCiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1saW5rL2lzc3Vlcy8xNDYKICAgICAgICBwcmlvcml0eTogJ2hpZ2gnCiAgICAgIH0pOyAvLyBDbG9zZSB0aGUgcGFuZWwgb24gdGhlIEVzYyBrZXkgcHJlc3Mgd2hlbiB0aGUgZWRpdGFibGUgaGFzIGZvY3VzIGFuZCB0aGUgYmFsbG9vbiBpcyB2aXNpYmxlLgoKICAgICAgdGhpcy5lZGl0b3Iua2V5c3Ryb2tlcy5zZXQoJ0VzYycsIGZ1bmN0aW9uIChkYXRhLCBjYW5jZWwpIHsKICAgICAgICBpZiAoX3RoaXM0Ll9pc1VJVmlzaWJsZSkgewogICAgICAgICAgX3RoaXM0Ll9oaWRlVUkoKTsKCiAgICAgICAgICBjYW5jZWwoKTsKICAgICAgICB9CiAgICAgIH0pOyAvLyBDbG9zZSBvbiBjbGljayBvdXRzaWRlIG9mIGJhbGxvb24gcGFuZWwgZWxlbWVudC4KCiAgICAgIGNsaWNrT3V0c2lkZUhhbmRsZXIoewogICAgICAgIGVtaXR0ZXI6IHRoaXMuZm9ybVZpZXcsCiAgICAgICAgYWN0aXZhdG9yOiBmdW5jdGlvbiBhY3RpdmF0b3IoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM0Ll9pc1VJSW5QYW5lbDsKICAgICAgICB9LAogICAgICAgIGNvbnRleHRFbGVtZW50czogW3RoaXMuX2JhbGxvb24udmlldy5lbGVtZW50XSwKICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gY2FsbGJhY2soKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXM0Ll9oaWRlVUkoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgI2FjdGlvbnNWaWV3fSB0byB0aGUge0BsaW5rICNfYmFsbG9vbn0uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICovCgogIH0sIHsKICAgIGtleTogIl9hZGRBY3Rpb25zVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZEFjdGlvbnNWaWV3KCkgewogICAgICBpZiAodGhpcy5fYXJlQWN0aW9uc0luUGFuZWwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX2JhbGxvb24uYWRkKHsKICAgICAgICB2aWV3OiB0aGlzLmFjdGlvbnNWaWV3LAogICAgICAgIHBvc2l0aW9uOiB0aGlzLl9nZXRCYWxsb29uUG9zaXRpb25EYXRhKCkKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayAjZm9ybVZpZXd9IHRvIHRoZSB7QGxpbmsgI19iYWxsb29ufS4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2FkZEZvcm1WaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkRm9ybVZpZXcoKSB7CiAgICAgIGlmICh0aGlzLl9pc0Zvcm1JblBhbmVsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICAgIHZhciBsaW5rQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpbmsnKTsKICAgICAgdGhpcy5mb3JtVmlldy5kaXNhYmxlQ3NzVHJhbnNpdGlvbnMoKTsKCiAgICAgIHRoaXMuX2JhbGxvb24uYWRkKHsKICAgICAgICB2aWV3OiB0aGlzLmZvcm1WaWV3LAogICAgICAgIHBvc2l0aW9uOiB0aGlzLl9nZXRCYWxsb29uUG9zaXRpb25EYXRhKCkKICAgICAgfSk7IC8vIFNlbGVjdCBpbnB1dCB3aGVuIGZvcm0gdmlldyBpcyBjdXJyZW50bHkgdmlzaWJsZS4KCgogICAgICBpZiAodGhpcy5fYmFsbG9vbi52aXNpYmxlVmlldyA9PT0gdGhpcy5mb3JtVmlldykgewogICAgICAgIHRoaXMuZm9ybVZpZXcudXJsSW5wdXRWaWV3LmZpZWxkVmlldy5zZWxlY3QoKTsKICAgICAgfQoKICAgICAgdGhpcy5mb3JtVmlldy5lbmFibGVDc3NUcmFuc2l0aW9ucygpOyAvLyBNYWtlIHN1cmUgdGhhdCBlYWNoIHRpbWUgdGhlIHBhbmVsIHNob3dzIHVwLCB0aGUgVVJMIGZpZWxkIHJlbWFpbnMgaW4gc3luYyB3aXRoIHRoZSB2YWx1ZSBvZgogICAgICAvLyB0aGUgY29tbWFuZC4gSWYgdGhlIHVzZXIgdHlwZWQgaW4gdGhlIGlucHV0LCB0aGVuIGNhbmNlbGVkIHRoZSBiYWxsb29uIChgdXJsSW5wdXRWaWV3LmZpZWxkVmlldyN2YWx1ZWAgc3RheXMKICAgICAgLy8gdW5hbHRlcmVkKSBhbmQgcmUtb3BlbmVkIGl0IHdpdGhvdXQgY2hhbmdpbmcgdGhlIHZhbHVlIG9mIHRoZSBsaW5rIGNvbW1hbmQgKGUuZy4gYmVjYXVzZSB0aGV5CiAgICAgIC8vIGNsaWNrZWQgdGhlIHNhbWUgbGluayksIHRoZXkgd291bGQgc2VlIHRoZSBvbGQgdmFsdWUgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIHZhbHVlIG9mIHRoZSBjb21tYW5kLgogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWxpbmsvaXNzdWVzLzc4CiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtbGluay9pc3N1ZXMvMTIzCgogICAgICB0aGlzLmZvcm1WaWV3LnVybElucHV0Vmlldy5maWVsZFZpZXcuZWxlbWVudC52YWx1ZSA9IGxpbmtDb21tYW5kLnZhbHVlIHx8ICcnOwogICAgfQogICAgLyoqCiAgICAgKiBDbG9zZXMgdGhlIGZvcm0gdmlldy4gRGVjaWRlcyB3aGV0aGVyIHRoZSBiYWxsb29uIHNob3VsZCBiZSBoaWRkZW4gY29tcGxldGVseSBvciBpZiB0aGUgYWN0aW9uIHZpZXcgc2hvdWxkIGJlIHNob3duLiBUaGlzIGlzCiAgICAgKiBkZWNpZGVkIHVwb24gdGhlIGxpbmsgY29tbWFuZCB2YWx1ZSAod2hpY2ggaGFzIGEgdmFsdWUgaWYgdGhlIGRvY3VtZW50IHNlbGVjdGlvbiBpcyBpbiB0aGUgbGluaykuCiAgICAgKgogICAgICogQWRkaXRpb25hbGx5LCBpZiBhbnkge0BsaW5rIG1vZHVsZTpsaW5rL2xpbmt+TGlua0NvbmZpZyNkZWNvcmF0b3JzfSBhcmUgZGVmaW5lZCBpbiB0aGUgZWRpdG9yIGNvbmZpZ3VyYXRpb24sIHRoZSBzdGF0ZSBvZgogICAgICogc3dpdGNoIGJ1dHRvbnMgcmVzcG9uc2libGUgZm9yIG1hbnVhbCBkZWNvcmF0b3IgaGFuZGxpbmcgaXMgcmVzdG9yZWQuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY2xvc2VGb3JtVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2Nsb3NlRm9ybVZpZXcoKSB7CiAgICAgIHZhciBsaW5rQ29tbWFuZCA9IHRoaXMuZWRpdG9yLmNvbW1hbmRzLmdldCgnbGluaycpOyAvLyBSZXN0b3JlIG1hbnVhbCBkZWNvcmF0b3Igc3RhdGVzIHRvIHJlcHJlc2VudCB0aGUgY3VycmVudCBtb2RlbCBzdGF0ZS4gVGhpcyBjYXNlIGlzIGltcG9ydGFudCB0byByZXNldCB0aGUgc3dpdGNoIGJ1dHRvbnMKICAgICAgLy8gd2hlbiB0aGUgdXNlciBjYW5jZWxzIHRoZSBlZGl0aW5nIGZvcm0uCgogICAgICBsaW5rQ29tbWFuZC5yZXN0b3JlTWFudWFsRGVjb3JhdG9yU3RhdGVzKCk7CgogICAgICBpZiAobGlua0NvbW1hbmQudmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3JlbW92ZUZvcm1WaWV3KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5faGlkZVVJKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyB0aGUge0BsaW5rICNmb3JtVmlld30gZnJvbSB0aGUge0BsaW5rICNfYmFsbG9vbn0uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZW1vdmVGb3JtVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbW92ZUZvcm1WaWV3KCkgewogICAgICBpZiAodGhpcy5faXNGb3JtSW5QYW5lbCkgewogICAgICAgIC8vIEJsdXIgdGhlIGlucHV0IGVsZW1lbnQgYmVmb3JlIHJlbW92aW5nIGl0IGZyb20gRE9NIHRvIHByZXZlbnQgaXNzdWVzIGluIHNvbWUgYnJvd3NlcnMuCiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzE1MDEuCiAgICAgICAgdGhpcy5mb3JtVmlldy5zYXZlQnV0dG9uVmlldy5mb2N1cygpOwoKICAgICAgICB0aGlzLl9iYWxsb29uLnJlbW92ZSh0aGlzLmZvcm1WaWV3KTsgLy8gQmVjYXVzZSB0aGUgZm9ybSBoYXMgYW4gaW5wdXQgd2hpY2ggaGFzIGZvY3VzLCB0aGUgZm9jdXMgbXVzdCBiZSBicm91Z2h0IGJhY2sKICAgICAgICAvLyB0byB0aGUgZWRpdG9yLiBPdGhlcndpc2UsIGl0IHdvdWxkIGJlIGxvc3QuCgoKICAgICAgICB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXcuZm9jdXMoKTsKCiAgICAgICAgdGhpcy5faGlkZUZha2VWaXN1YWxTZWxlY3Rpb24oKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTaG93cyB0aGUgY29ycmVjdCBVSSB0eXBlLiBJdCBpcyBlaXRoZXIge0BsaW5rICNmb3JtVmlld30gb3Ige0BsaW5rICNhY3Rpb25zVmlld30uCiAgICAgKgogICAgICogQHBhcmFtIHtCb29sZWFufSBmb3JjZVZpc2libGUKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3Nob3dVSSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Nob3dVSSgpIHsKICAgICAgdmFyIGZvcmNlVmlzaWJsZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CgogICAgICAvLyBXaGVuIHRoZXJlJ3Mgbm8gbGluayB1bmRlciB0aGUgc2VsZWN0aW9uLCBnbyBzdHJhaWdodCB0byB0aGUgZWRpdGluZyBVSS4KICAgICAgaWYgKCF0aGlzLl9nZXRTZWxlY3RlZExpbmtFbGVtZW50KCkpIHsKICAgICAgICAvLyBTaG93IHZpc3VhbCBzZWxlY3Rpb24gb24gYSB0ZXh0IHdpdGhvdXQgYSBsaW5rIHdoZW4gdGhlIGNvbnRleHR1YWwgYmFsbG9vbiBpcyBkaXNwbGF5ZWQuCiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzQ3MjEuCiAgICAgICAgdGhpcy5fc2hvd0Zha2VWaXN1YWxTZWxlY3Rpb24oKTsKCiAgICAgICAgdGhpcy5fYWRkQWN0aW9uc1ZpZXcoKTsgLy8gQmUgc3VyZSBwYW5lbCB3aXRoIGxpbmsgaXMgdmlzaWJsZS4KCgogICAgICAgIGlmIChmb3JjZVZpc2libGUpIHsKICAgICAgICAgIHRoaXMuX2JhbGxvb24uc2hvd1N0YWNrKCdtYWluJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9hZGRGb3JtVmlldygpOwogICAgICB9IC8vIElmIHRoZXJlJ3MgYSBsaW5rIHVuZGVyIHRoZSBzZWxlY3Rpb24uLi4KICAgICAgZWxzZSB7CiAgICAgICAgICAvLyBHbyB0byB0aGUgZWRpdGluZyBVSSBpZiBhY3Rpb25zIGFyZSBhbHJlYWR5IHZpc2libGUuCiAgICAgICAgICBpZiAodGhpcy5fYXJlQWN0aW9uc1Zpc2libGUpIHsKICAgICAgICAgICAgdGhpcy5fYWRkRm9ybVZpZXcoKTsKICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlIGRpc3BsYXkganVzdCB0aGUgYWN0aW9ucyBVSS4KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHRoaXMuX2FkZEFjdGlvbnNWaWV3KCk7CiAgICAgICAgICAgIH0gLy8gQmUgc3VyZSBwYW5lbCB3aXRoIGxpbmsgaXMgdmlzaWJsZS4KCgogICAgICAgICAgaWYgKGZvcmNlVmlzaWJsZSkgewogICAgICAgICAgICB0aGlzLl9iYWxsb29uLnNob3dTdGFjaygnbWFpbicpOwogICAgICAgICAgfQogICAgICAgIH0gLy8gQmVnaW4gcmVzcG9uZGluZyB0byB1aSN1cGRhdGUgb25jZSB0aGUgVUkgaXMgYWRkZWQuCgoKICAgICAgdGhpcy5fc3RhcnRVcGRhdGluZ1VJKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgdGhlIHtAbGluayAjZm9ybVZpZXd9IGZyb20gdGhlIHtAbGluayAjX2JhbGxvb259LgogICAgICoKICAgICAqIFNlZSB7QGxpbmsgI19hZGRGb3JtVmlld30sIHtAbGluayAjX2FkZEFjdGlvbnNWaWV3fS4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2hpZGVVSSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hpZGVVSSgpIHsKICAgICAgaWYgKCF0aGlzLl9pc1VJSW5QYW5lbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoZWRpdG9yLnVpLCAndXBkYXRlJyk7CiAgICAgIHRoaXMuc3RvcExpc3RlbmluZyh0aGlzLl9iYWxsb29uLCAnY2hhbmdlOnZpc2libGVWaWV3Jyk7IC8vIE1ha2Ugc3VyZSB0aGUgZm9jdXMgYWx3YXlzIGdldHMgYmFjayB0byB0aGUgZWRpdGFibGUgX2JlZm9yZV8gcmVtb3ZpbmcgdGhlIGZvY3VzZWQgZm9ybSB2aWV3LgogICAgICAvLyBEb2luZyBvdGhlcndpc2UgY2F1c2VzIGlzc3VlcyBpbiBzb21lIGJyb3dzZXJzLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1saW5rL2lzc3Vlcy8xOTMuCgogICAgICBlZGl0b3IuZWRpdGluZy52aWV3LmZvY3VzKCk7IC8vIFJlbW92ZSBmb3JtIGZpcnN0IGJlY2F1c2UgaXQncyBvbiB0b3Agb2YgdGhlIHN0YWNrLgoKICAgICAgdGhpcy5fcmVtb3ZlRm9ybVZpZXcoKTsgLy8gVGhlbiByZW1vdmUgdGhlIGFjdGlvbnMgdmlldyBiZWNhdXNlIGl0J3MgYmVuZWF0aCB0aGUgZm9ybS4KCgogICAgICB0aGlzLl9iYWxsb29uLnJlbW92ZSh0aGlzLmFjdGlvbnNWaWV3KTsKCiAgICAgIHRoaXMuX2hpZGVGYWtlVmlzdWFsU2VsZWN0aW9uKCk7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2VzIHRoZSBVSSByZWFjdCB0byB0aGUge0BsaW5rIG1vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J1aX5FZGl0b3JVSSNldmVudDp1cGRhdGV9IGV2ZW50IHRvCiAgICAgKiByZXBvc2l0aW9uIGl0c2VsZiB3aGVuIHRoZSBlZGl0b3IgVUkgc2hvdWxkIGJlIHJlZnJlc2hlZC4KICAgICAqCiAgICAgKiBTZWU6IHtAbGluayAjX2hpZGVVSX0gdG8gbGVhcm4gd2hlbiB0aGUgVUkgc3RvcHMgcmVhY3RpbmcgdG8gdGhlIGB1cGRhdGVgIGV2ZW50LgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfc3RhcnRVcGRhdGluZ1VJIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc3RhcnRVcGRhdGluZ1VJKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBlZGl0b3IgPSB0aGlzLmVkaXRvcjsKICAgICAgdmFyIHZpZXdEb2N1bWVudCA9IGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQ7CgogICAgICB2YXIgcHJldlNlbGVjdGVkTGluayA9IHRoaXMuX2dldFNlbGVjdGVkTGlua0VsZW1lbnQoKTsKCiAgICAgIHZhciBwcmV2U2VsZWN0aW9uUGFyZW50ID0gZ2V0U2VsZWN0aW9uUGFyZW50KCk7CgogICAgICB2YXIgdXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlKCkgewogICAgICAgIHZhciBzZWxlY3RlZExpbmsgPSBfdGhpczUuX2dldFNlbGVjdGVkTGlua0VsZW1lbnQoKTsKCiAgICAgICAgdmFyIHNlbGVjdGlvblBhcmVudCA9IGdldFNlbGVjdGlvblBhcmVudCgpOyAvLyBIaWRlIHRoZSBwYW5lbCBpZjoKICAgICAgICAvLwogICAgICAgIC8vICogdGhlIHNlbGVjdGlvbiB3ZW50IG91dCBvZiB0aGUgRVhJU1RJTkcgbGluayBlbGVtZW50LiBFLmcuIHVzZXIgbW92ZWQgdGhlIGNhcmV0IG91dAogICAgICAgIC8vICAgb2YgdGhlIGxpbmssCiAgICAgICAgLy8gKiB0aGUgc2VsZWN0aW9uIHdlbnQgdG8gYSBkaWZmZXJlbnQgcGFyZW50IHdoZW4gY3JlYXRpbmcgYSBORVcgbGluay4gRS5nLiBzb21lb25lCiAgICAgICAgLy8gICBlbHNlIG1vZGlmaWVkIHRoZSBkb2N1bWVudC4KICAgICAgICAvLyAqIHRoZSBzZWxlY3Rpb24gaGFzIGV4cGFuZGVkIChlLmcuIGRpc3BsYXlpbmcgbGluayBhY3Rpb25zIHRoZW4gcHJlc3NpbmcgU0hJRlQrUmlnaHQgYXJyb3cpLgogICAgICAgIC8vCiAgICAgICAgLy8gTm90ZTogI19nZXRTZWxlY3RlZExpbmtFbGVtZW50IHdpbGwgcmV0dXJuIGEgbGluayBmb3IgYSBub24tY29sbGFwc2VkIHNlbGVjdGlvbiBvbmx5CiAgICAgICAgLy8gd2hlbiBmdWxseSBzZWxlY3RlZC4KCiAgICAgICAgaWYgKHByZXZTZWxlY3RlZExpbmsgJiYgIXNlbGVjdGVkTGluayB8fCAhcHJldlNlbGVjdGVkTGluayAmJiBzZWxlY3Rpb25QYXJlbnQgIT09IHByZXZTZWxlY3Rpb25QYXJlbnQpIHsKICAgICAgICAgIF90aGlzNS5faGlkZVVJKCk7CiAgICAgICAgfSAvLyBVcGRhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBwYW5lbCB3aGVuOgogICAgICAgIC8vICAqIGxpbmsgcGFuZWwgaXMgaW4gdGhlIHZpc2libGUgc3RhY2sKICAgICAgICAvLyAgKiB0aGUgc2VsZWN0aW9uIHJlbWFpbnMgaW4gdGhlIG9yaWdpbmFsIGxpbmsgZWxlbWVudCwKICAgICAgICAvLyAgKiB0aGVyZSB3YXMgbm8gbGluayBlbGVtZW50IGluIHRoZSBmaXJzdCBwbGFjZSwgaS5lLiBjcmVhdGluZyBhIG5ldyBsaW5rCiAgICAgICAgZWxzZSBpZiAoX3RoaXM1Ll9pc1VJVmlzaWJsZSkgewogICAgICAgICAgICAvLyBJZiBzdGlsbCBpbiBhIGxpbmsgZWxlbWVudCwgc2ltcGx5IHVwZGF0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIGJhbGxvb24uCiAgICAgICAgICAgIC8vIElmIHRoZXJlIHdhcyBubyBsaW5rIChlLmcuIGluc2VydGluZyBvbmUpLCB0aGUgYmFsbG9vbiBtdXN0IGJlIG1vdmVkCiAgICAgICAgICAgIC8vIHRvIHRoZSBuZXcgcG9zaXRpb24gaW4gdGhlIGVkaXRpbmcgdmlldyAoYSBuZXcgbmF0aXZlIERPTSByYW5nZSkuCiAgICAgICAgICAgIF90aGlzNS5fYmFsbG9vbi51cGRhdGVQb3NpdGlvbihfdGhpczUuX2dldEJhbGxvb25Qb3NpdGlvbkRhdGEoKSk7CiAgICAgICAgICB9CgogICAgICAgIHByZXZTZWxlY3RlZExpbmsgPSBzZWxlY3RlZExpbms7CiAgICAgICAgcHJldlNlbGVjdGlvblBhcmVudCA9IHNlbGVjdGlvblBhcmVudDsKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGdldFNlbGVjdGlvblBhcmVudCgpIHsKICAgICAgICByZXR1cm4gdmlld0RvY3VtZW50LnNlbGVjdGlvbi5mb2N1cy5nZXRBbmNlc3RvcnMoKS5yZXZlcnNlKCkuZmluZChmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgcmV0dXJuIG5vZGUuaXMoJ2VsZW1lbnQnKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5saXN0ZW5UbyhlZGl0b3IudWksICd1cGRhdGUnLCB1cGRhdGUpOwogICAgICB0aGlzLmxpc3RlblRvKHRoaXMuX2JhbGxvb24sICdjaGFuZ2U6dmlzaWJsZVZpZXcnLCB1cGRhdGUpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGB0cnVlYCB3aGVuIHtAbGluayAjZm9ybVZpZXd9IGlzIGluIHRoZSB7QGxpbmsgI19iYWxsb29ufS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9pc0Zvcm1JblBhbmVsIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fYmFsbG9vbi5oYXNWaWV3KHRoaXMuZm9ybVZpZXcpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGB0cnVlYCB3aGVuIHtAbGluayAjYWN0aW9uc1ZpZXd9IGlzIGluIHRoZSB7QGxpbmsgI19iYWxsb29ufS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9hcmVBY3Rpb25zSW5QYW5lbCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2JhbGxvb24uaGFzVmlldyh0aGlzLmFjdGlvbnNWaWV3KTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBgdHJ1ZWAgd2hlbiB7QGxpbmsgI2FjdGlvbnNWaWV3fSBpcyBpbiB0aGUge0BsaW5rICNfYmFsbG9vbn0gYW5kIGl0IGlzCiAgICAgKiBjdXJyZW50bHkgdmlzaWJsZS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9hcmVBY3Rpb25zVmlzaWJsZSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2JhbGxvb24udmlzaWJsZVZpZXcgPT09IHRoaXMuYWN0aW9uc1ZpZXc7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYHRydWVgIHdoZW4ge0BsaW5rICNhY3Rpb25zVmlld30gb3Ige0BsaW5rICNmb3JtVmlld30gaXMgaW4gdGhlIHtAbGluayAjX2JhbGxvb259LgogICAgICoKICAgICAqIEByZWFkb25seQogICAgICogQHByb3RlY3RlZAogICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2lzVUlJblBhbmVsIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5faXNGb3JtSW5QYW5lbCB8fCB0aGlzLl9hcmVBY3Rpb25zSW5QYW5lbDsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBgdHJ1ZWAgd2hlbiB7QGxpbmsgI2FjdGlvbnNWaWV3fSBvciB7QGxpbmsgI2Zvcm1WaWV3fSBpcyBpbiB0aGUge0BsaW5rICNfYmFsbG9vbn0gYW5kIGl0IGlzCiAgICAgKiBjdXJyZW50bHkgdmlzaWJsZS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9pc1VJVmlzaWJsZSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgdmFyIHZpc2libGVWaWV3ID0gdGhpcy5fYmFsbG9vbi52aXNpYmxlVmlldzsKICAgICAgcmV0dXJuIHZpc2libGVWaWV3ID09IHRoaXMuZm9ybVZpZXcgfHwgdGhpcy5fYXJlQWN0aW9uc1Zpc2libGU7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgcG9zaXRpb25pbmcgb3B0aW9ucyBmb3IgdGhlIHtAbGluayAjX2JhbGxvb259LiBUaGV5IGNvbnRyb2wgdGhlIHdheSB0aGUgYmFsbG9vbiBpcyBhdHRhY2hlZAogICAgICogdG8gdGhlIHRhcmdldCBlbGVtZW50IG9yIHNlbGVjdGlvbi4KICAgICAqCiAgICAgKiBJZiB0aGUgc2VsZWN0aW9uIGlzIGNvbGxhcHNlZCBhbmQgaW5zaWRlIGEgbGluayBlbGVtZW50LCB0aGUgcGFuZWwgd2lsbCBiZSBhdHRhY2hlZCB0byB0aGUKICAgICAqIGVudGlyZSBsaW5rIGVsZW1lbnQuIE90aGVyd2lzZSwgaXQgd2lsbCBiZSBhdHRhY2hlZCB0byB0aGUgc2VsZWN0aW9uLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOnV0aWxzL2RvbS9wb3NpdGlvbn5PcHRpb25zfQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9nZXRCYWxsb29uUG9zaXRpb25EYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0QmFsbG9vblBvc2l0aW9uRGF0YSgpIHsKICAgICAgdmFyIHZpZXcgPSB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXc7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsOwogICAgICB2YXIgdmlld0RvY3VtZW50ID0gdmlldy5kb2N1bWVudDsKICAgICAgdmFyIHRhcmdldCA9IG51bGw7CgogICAgICBpZiAobW9kZWwubWFya2Vycy5oYXMoVklTVUFMX1NFTEVDVElPTl9NQVJLRVJfTkFNRSkpIHsKICAgICAgICAvLyBUaGVyZSBhcmUgY2FzZXMgd2hlbiB3ZSBoaWdobGlnaHQgc2VsZWN0aW9uIHVzaW5nIGEgbWFya2VyICgjNzcwNSwgIzQ3MjEpLgogICAgICAgIHZhciBtYXJrZXJWaWV3RWxlbWVudHMgPSBBcnJheS5mcm9tKHRoaXMuZWRpdG9yLmVkaXRpbmcubWFwcGVyLm1hcmtlck5hbWVUb0VsZW1lbnRzKFZJU1VBTF9TRUxFQ1RJT05fTUFSS0VSX05BTUUpKTsKICAgICAgICB2YXIgbmV3UmFuZ2UgPSB2aWV3LmNyZWF0ZVJhbmdlKHZpZXcuY3JlYXRlUG9zaXRpb25CZWZvcmUobWFya2VyVmlld0VsZW1lbnRzWzBdKSwgdmlldy5jcmVhdGVQb3NpdGlvbkFmdGVyKG1hcmtlclZpZXdFbGVtZW50c1ttYXJrZXJWaWV3RWxlbWVudHMubGVuZ3RoIC0gMV0pKTsKICAgICAgICB0YXJnZXQgPSB2aWV3LmRvbUNvbnZlcnRlci52aWV3UmFuZ2VUb0RvbShuZXdSYW5nZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRhcmdldExpbmsgPSB0aGlzLl9nZXRTZWxlY3RlZExpbmtFbGVtZW50KCk7CgogICAgICAgIHZhciByYW5nZSA9IHZpZXdEb2N1bWVudC5zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpOwogICAgICAgIHRhcmdldCA9IHRhcmdldExpbmsgPyAvLyBXaGVuIHNlbGVjdGlvbiBpcyBpbnNpZGUgbGluayBlbGVtZW50LCB0aGVuIGF0dGFjaCBwYW5lbCB0byB0aGlzIGVsZW1lbnQuCiAgICAgICAgdmlldy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKHRhcmdldExpbmspIDogLy8gT3RoZXJ3aXNlIGF0dGFjaCBwYW5lbCB0byB0aGUgc2VsZWN0aW9uLgogICAgICAgIHZpZXcuZG9tQ29udmVydGVyLnZpZXdSYW5nZVRvRG9tKHJhbmdlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICB0YXJnZXQ6IHRhcmdldAogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBsaW5rIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fSB1bmRlcgogICAgICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQgZWRpdGluZyB2aWV3J3N9IHNlbGVjdGlvbiBvciBgbnVsbGAKICAgICAqIGlmIHRoZXJlIGlzIG5vbmUuCiAgICAgKgogICAgICogKipOb3RlKio6IEZvciBhIG5vbuKAk2NvbGxhcHNlZCBzZWxlY3Rpb24sIHRoZSBsaW5rIGVsZW1lbnQgaXMgb25seSByZXR1cm5lZCB3aGVuICoqZnVsbHkqKgogICAgICogc2VsZWN0ZWQgYW5kIHRoZSAqKm9ubHkqKiBlbGVtZW50IHdpdGhpbiB0aGUgc2VsZWN0aW9uIGJvdW5kYXJpZXMuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fG51bGx9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2dldFNlbGVjdGVkTGlua0VsZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRTZWxlY3RlZExpbmtFbGVtZW50KCkgewogICAgICB2YXIgdmlldyA9IHRoaXMuZWRpdG9yLmVkaXRpbmcudmlldzsKICAgICAgdmFyIHNlbGVjdGlvbiA9IHZpZXcuZG9jdW1lbnQuc2VsZWN0aW9uOwoKICAgICAgaWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCkgewogICAgICAgIHJldHVybiBmaW5kTGlua0VsZW1lbnRBbmNlc3RvcihzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUaGUgcmFuZ2UgZm9yIGZ1bGx5IHNlbGVjdGVkIGxpbmsgaXMgdXN1YWxseSBhbmNob3JlZCBpbiBhZGphY2VudCB0ZXh0IG5vZGVzLgogICAgICAgIC8vIFRyaW0gaXQgdG8gZ2V0IGNsb3NlciB0byB0aGUgYWN0dWFsIGxpbmsgZWxlbWVudC4KICAgICAgICB2YXIgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpLmdldFRyaW1tZWQoKTsKICAgICAgICB2YXIgc3RhcnRMaW5rID0gZmluZExpbmtFbGVtZW50QW5jZXN0b3IocmFuZ2Uuc3RhcnQpOwogICAgICAgIHZhciBlbmRMaW5rID0gZmluZExpbmtFbGVtZW50QW5jZXN0b3IocmFuZ2UuZW5kKTsKCiAgICAgICAgaWYgKCFzdGFydExpbmsgfHwgc3RhcnRMaW5rICE9IGVuZExpbmspIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gLy8gQ2hlY2sgaWYgdGhlIGxpbmsgZWxlbWVudCBpcyBmdWxseSBzZWxlY3RlZC4KCgogICAgICAgIGlmICh2aWV3LmNyZWF0ZVJhbmdlSW4oc3RhcnRMaW5rKS5nZXRUcmltbWVkKCkuaXNFcXVhbChyYW5nZSkpIHsKICAgICAgICAgIHJldHVybiBzdGFydExpbms7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNwbGF5cyBhIGZha2UgdmlzdWFsIHNlbGVjdGlvbiB3aGVuIHRoZSBjb250ZXh0dWFsIGJhbGxvb24gaXMgZGlzcGxheWVkLgogICAgICoKICAgICAqIFRoaXMgYWRkcyBhICdsaW5rLXVpJyBtYXJrZXIgaW50byB0aGUgZG9jdW1lbnQgdGhhdCBpcyByZW5kZXJlZCBhcyBhIGhpZ2hsaWdodCBvbiBzZWxlY3RlZCB0ZXh0IGZyYWdtZW50LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3Nob3dGYWtlVmlzdWFsU2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc2hvd0Zha2VWaXN1YWxTZWxlY3Rpb24oKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsOwogICAgICBtb2RlbC5jaGFuZ2UoZnVuY3Rpb24gKHdyaXRlcikgewogICAgICAgIHZhciByYW5nZSA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCk7CgogICAgICAgIGlmIChtb2RlbC5tYXJrZXJzLmhhcyhWSVNVQUxfU0VMRUNUSU9OX01BUktFUl9OQU1FKSkgewogICAgICAgICAgd3JpdGVyLnVwZGF0ZU1hcmtlcihWSVNVQUxfU0VMRUNUSU9OX01BUktFUl9OQU1FLCB7CiAgICAgICAgICAgIHJhbmdlOiByYW5nZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChyYW5nZS5zdGFydC5pc0F0RW5kKSB7CiAgICAgICAgICAgIHZhciBzdGFydFBvc2l0aW9uID0gcmFuZ2Uuc3RhcnQuZ2V0TGFzdE1hdGNoaW5nUG9zaXRpb24oZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICAgICAgICB2YXIgaXRlbSA9IF9yZWYuaXRlbTsKICAgICAgICAgICAgICByZXR1cm4gIW1vZGVsLnNjaGVtYS5pc0NvbnRlbnQoaXRlbSk7CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBib3VuZGFyaWVzOiByYW5nZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgd3JpdGVyLmFkZE1hcmtlcihWSVNVQUxfU0VMRUNUSU9OX01BUktFUl9OQU1FLCB7CiAgICAgICAgICAgICAgdXNpbmdPcGVyYXRpb246IGZhbHNlLAogICAgICAgICAgICAgIGFmZmVjdHNEYXRhOiBmYWxzZSwKICAgICAgICAgICAgICByYW5nZTogd3JpdGVyLmNyZWF0ZVJhbmdlKHN0YXJ0UG9zaXRpb24sIHJhbmdlLmVuZCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3cml0ZXIuYWRkTWFya2VyKFZJU1VBTF9TRUxFQ1RJT05fTUFSS0VSX05BTUUsIHsKICAgICAgICAgICAgICB1c2luZ09wZXJhdGlvbjogZmFsc2UsCiAgICAgICAgICAgICAgYWZmZWN0c0RhdGE6IGZhbHNlLAogICAgICAgICAgICAgIHJhbmdlOiByYW5nZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBIaWRlcyB0aGUgZmFrZSB2aXN1YWwgc2VsZWN0aW9uIGNyZWF0ZWQgaW4ge0BsaW5rICNfc2hvd0Zha2VWaXN1YWxTZWxlY3Rpb259LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2hpZGVGYWtlVmlzdWFsU2VsZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGlkZUZha2VWaXN1YWxTZWxlY3Rpb24oKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsOwoKICAgICAgaWYgKG1vZGVsLm1hcmtlcnMuaGFzKFZJU1VBTF9TRUxFQ1RJT05fTUFSS0VSX05BTUUpKSB7CiAgICAgICAgbW9kZWwuY2hhbmdlKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICAgIHdyaXRlci5yZW1vdmVNYXJrZXIoVklTVUFMX1NFTEVDVElPTl9NQVJLRVJfTkFNRSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9XSwgW3sKICAgIGtleTogInJlcXVpcmVzIiwKICAgIGdldDoKICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gW0NvbnRleHR1YWxCYWxsb29uXTsKICAgIH0KICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwbHVnaW5OYW1lIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gJ0xpbmtVSSc7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTGlua1VJOwp9KFBsdWdpbik7IC8vIFJldHVybnMgYSBsaW5rIGVsZW1lbnQgaWYgdGhlcmUncyBvbmUgYW1vbmcgdGhlIGFuY2VzdG9ycyBvZiB0aGUgcHJvdmlkZWQgYFBvc2l0aW9uYC4KLy8KLy8gQHByaXZhdGUKLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb259IFZpZXcgcG9zaXRpb24gdG8gYW5hbHl6ZS4KLy8gQHJldHVybnMge21vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR8bnVsbH0gTGluayBlbGVtZW50IGF0IHRoZSBwb3NpdGlvbiBvciBudWxsLgoKCmV4cG9ydCB7IExpbmtVSSBhcyBkZWZhdWx0IH07CgpmdW5jdGlvbiBmaW5kTGlua0VsZW1lbnRBbmNlc3Rvcihwb3NpdGlvbikgewogIHJldHVybiBwb3NpdGlvbi5nZXRBbmNlc3RvcnMoKS5maW5kKGZ1bmN0aW9uIChhbmNlc3RvcikgewogICAgcmV0dXJuIGlzTGlua0VsZW1lbnQoYW5jZXN0b3IpOwogIH0pOwp9"},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-link/src/linkui.js"],"names":["Plugin","ClickObserver","ButtonView","ContextualBalloon","clickOutsideHandler","LinkFormView","LinkActionsView","addLinkProtocolIfApplicable","isLinkElement","LINK_KEYSTROKE","linkIcon","VISUAL_SELECTION_MARKER_NAME","LinkUI","editor","editing","view","addObserver","actionsView","_createActionsView","formView","_createFormView","_balloon","plugins","get","_createToolbarLinkButton","_enableUserBalloonInteractions","conversion","for","markerToHighlight","model","classes","markerToElement","name","destroy","locale","linkCommand","commands","unlinkCommand","bind","to","editButtonView","unlinkButtonView","listenTo","_addFormView","execute","_hideUI","keystrokes","set","data","cancel","defaultProtocol","config","urlInputView","fieldView","value","saveButtonView","element","parsedUrl","getDecoratorSwitchesState","_closeFormView","t","keyEvtData","isEnabled","_showUI","ui","componentFactory","add","button","label","icon","keystroke","tooltip","isToggleable","viewDocument","document","parentLink","_getSelectedLinkElement","_areActionsVisible","focusTracker","isFocused","focus","priority","_isUIVisible","emitter","activator","_isUIInPanel","contextElements","callback","_areActionsInPanel","position","_getBalloonPositionData","_isFormInPanel","disableCssTransitions","visibleView","select","enableCssTransitions","restoreManualDecoratorStates","undefined","_removeFormView","remove","_hideFakeVisualSelection","forceVisible","_showFakeVisualSelection","_addActionsView","showStack","_startUpdatingUI","stopListening","prevSelectedLink","prevSelectionParent","getSelectionParent","update","selectedLink","selectionParent","updatePosition","selection","getAncestors","reverse","find","node","is","hasView","target","markers","has","markerViewElements","Array","from","mapper","markerNameToElements","newRange","createRange","createPositionBefore","createPositionAfter","length","domConverter","viewRangeToDom","targetLink","range","getFirstRange","mapViewToDom","isCollapsed","findLinkElementAncestor","getFirstPosition","getTrimmed","startLink","start","endLink","end","createRangeIn","isEqual","change","writer","updateMarker","isAtEnd","startPosition","getLastMatchingPosition","item","schema","isContent","boundaries","addMarker","usingOperation","affectsData","removeMarker","ancestor"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module link/linkui\n */\n\nimport { Plugin } from 'ckeditor5/src/core';\nimport { ClickObserver } from 'ckeditor5/src/engine';\nimport { ButtonView, ContextualBalloon, clickOutsideHandler } from 'ckeditor5/src/ui';\n\nimport LinkFormView from './ui/linkformview';\nimport LinkActionsView from './ui/linkactionsview';\nimport { addLinkProtocolIfApplicable, isLinkElement, LINK_KEYSTROKE } from './utils';\n\nimport linkIcon from '../theme/icons/link.svg';\n\nconst VISUAL_SELECTION_MARKER_NAME = 'link-ui';\n\n/**\n * The link UI plugin. It introduces the `'link'` and `'unlink'` buttons and support for the <kbd>Ctrl+K</kbd> keystroke.\n *\n * It uses the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon plugin}.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class LinkUI extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\treturn [ ContextualBalloon ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'LinkUI';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\tconst editor = this.editor;\n\n\t\teditor.editing.view.addObserver( ClickObserver );\n\n\t\t/**\n\t\t * The actions view displayed inside of the balloon.\n\t\t *\n\t\t * @member {module:link/ui/linkactionsview~LinkActionsView}\n\t\t */\n\t\tthis.actionsView = this._createActionsView();\n\n\t\t/**\n\t\t * The form view displayed inside the balloon.\n\t\t *\n\t\t * @member {module:link/ui/linkformview~LinkFormView}\n\t\t */\n\t\tthis.formView = this._createFormView();\n\n\t\t/**\n\t\t * The contextual balloon plugin instance.\n\t\t *\n\t\t * @private\n\t\t * @member {module:ui/panel/balloon/contextualballoon~ContextualBalloon}\n\t\t */\n\t\tthis._balloon = editor.plugins.get( ContextualBalloon );\n\n\t\t// Create toolbar buttons.\n\t\tthis._createToolbarLinkButton();\n\n\t\t// Attach lifecycle actions to the the balloon.\n\t\tthis._enableUserBalloonInteractions();\n\n\t\t// Renders a fake visual selection marker on an expanded selection.\n\t\teditor.conversion.for( 'editingDowncast' ).markerToHighlight( {\n\t\t\tmodel: VISUAL_SELECTION_MARKER_NAME,\n\t\t\tview: {\n\t\t\t\tclasses: [ 'ck-fake-link-selection' ]\n\t\t\t}\n\t\t} );\n\n\t\t// Renders a fake visual selection marker on a collapsed selection.\n\t\teditor.conversion.for( 'editingDowncast' ).markerToElement( {\n\t\t\tmodel: VISUAL_SELECTION_MARKER_NAME,\n\t\t\tview: {\n\t\t\t\tname: 'span',\n\t\t\t\tclasses: [ 'ck-fake-link-selection', 'ck-fake-link-selection_collapsed' ]\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {\n\t\tsuper.destroy();\n\n\t\t// Destroy created UI components as they are not automatically destroyed (see ckeditor5#1341).\n\t\tthis.formView.destroy();\n\t}\n\n\t/**\n\t * Creates the {@link module:link/ui/linkactionsview~LinkActionsView} instance.\n\t *\n\t * @private\n\t * @returns {module:link/ui/linkactionsview~LinkActionsView} The link actions view instance.\n\t */\n\t_createActionsView() {\n\t\tconst editor = this.editor;\n\t\tconst actionsView = new LinkActionsView( editor.locale );\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\t\tconst unlinkCommand = editor.commands.get( 'unlink' );\n\n\t\tactionsView.bind( 'href' ).to( linkCommand, 'value' );\n\t\tactionsView.editButtonView.bind( 'isEnabled' ).to( linkCommand );\n\t\tactionsView.unlinkButtonView.bind( 'isEnabled' ).to( unlinkCommand );\n\n\t\t// Execute unlink command after clicking on the \"Edit\" button.\n\t\tthis.listenTo( actionsView, 'edit', () => {\n\t\t\tthis._addFormView();\n\t\t} );\n\n\t\t// Execute unlink command after clicking on the \"Unlink\" button.\n\t\tthis.listenTo( actionsView, 'unlink', () => {\n\t\t\teditor.execute( 'unlink' );\n\t\t\tthis._hideUI();\n\t\t} );\n\n\t\t// Close the panel on esc key press when the **actions have focus**.\n\t\tactionsView.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tthis._hideUI();\n\t\t\tcancel();\n\t\t} );\n\n\t\t// Open the form view on Ctrl+K when the **actions have focus**..\n\t\tactionsView.keystrokes.set( LINK_KEYSTROKE, ( data, cancel ) => {\n\t\t\tthis._addFormView();\n\t\t\tcancel();\n\t\t} );\n\n\t\treturn actionsView;\n\t}\n\n\t/**\n\t * Creates the {@link module:link/ui/linkformview~LinkFormView} instance.\n\t *\n\t * @private\n\t * @returns {module:link/ui/linkformview~LinkFormView} The link form view instance.\n\t */\n\t_createFormView() {\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\t\tconst defaultProtocol = editor.config.get( 'link.defaultProtocol' );\n\n\t\tconst formView = new LinkFormView( editor.locale, linkCommand );\n\n\t\tformView.urlInputView.fieldView.bind( 'value' ).to( linkCommand, 'value' );\n\n\t\t// Form elements should be read-only when corresponding commands are disabled.\n\t\tformView.urlInputView.bind( 'isReadOnly' ).to( linkCommand, 'isEnabled', value => !value );\n\t\tformView.saveButtonView.bind( 'isEnabled' ).to( linkCommand );\n\n\t\t// Execute link command after clicking the \"Save\" button.\n\t\tthis.listenTo( formView, 'submit', () => {\n\t\t\tconst { value } = formView.urlInputView.fieldView.element;\n\t\t\tconst parsedUrl = addLinkProtocolIfApplicable( value, defaultProtocol );\n\t\t\teditor.execute( 'link', parsedUrl, formView.getDecoratorSwitchesState() );\n\t\t\tthis._closeFormView();\n\t\t} );\n\n\t\t// Hide the panel after clicking the \"Cancel\" button.\n\t\tthis.listenTo( formView, 'cancel', () => {\n\t\t\tthis._closeFormView();\n\t\t} );\n\n\t\t// Close the panel on esc key press when the **form has focus**.\n\t\tformView.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tthis._closeFormView();\n\t\t\tcancel();\n\t\t} );\n\n\t\treturn formView;\n\t}\n\n\t/**\n\t * Creates a toolbar Link button. Clicking this button will show\n\t * a {@link #_balloon} attached to the selection.\n\t *\n\t * @private\n\t */\n\t_createToolbarLinkButton() {\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\t\tconst t = editor.t;\n\n\t\t// Handle the `Ctrl+K` keystroke and show the panel.\n\t\teditor.keystrokes.set( LINK_KEYSTROKE, ( keyEvtData, cancel ) => {\n\t\t\t// Prevent focusing the search bar in FF, Chrome and Edge. See https://github.com/ckeditor/ckeditor5/issues/4811.\n\t\t\tcancel();\n\n\t\t\tif ( linkCommand.isEnabled ) {\n\t\t\t\tthis._showUI( true );\n\t\t\t}\n\t\t} );\n\n\t\teditor.ui.componentFactory.add( 'link', locale => {\n\t\t\tconst button = new ButtonView( locale );\n\n\t\t\tbutton.isEnabled = true;\n\t\t\tbutton.label = t( 'Link' );\n\t\t\tbutton.icon = linkIcon;\n\t\t\tbutton.keystroke = LINK_KEYSTROKE;\n\t\t\tbutton.tooltip = true;\n\t\t\tbutton.isToggleable = true;\n\n\t\t\t// Bind button to the command.\n\t\t\tbutton.bind( 'isEnabled' ).to( linkCommand, 'isEnabled' );\n\t\t\tbutton.bind( 'isOn' ).to( linkCommand, 'value', value => !!value );\n\n\t\t\t// Show the panel on button click.\n\t\t\tthis.listenTo( button, 'execute', () => this._showUI( true ) );\n\n\t\t\treturn button;\n\t\t} );\n\t}\n\n\t/**\n\t * Attaches actions that control whether the balloon panel containing the\n\t * {@link #formView} is visible or not.\n\t *\n\t * @private\n\t */\n\t_enableUserBalloonInteractions() {\n\t\tconst viewDocument = this.editor.editing.view.document;\n\n\t\t// Handle click on view document and show panel when selection is placed inside the link element.\n\t\t// Keep panel open until selection will be inside the same link element.\n\t\tthis.listenTo( viewDocument, 'click', () => {\n\t\t\tconst parentLink = this._getSelectedLinkElement();\n\n\t\t\tif ( parentLink ) {\n\t\t\t\t// Then show panel but keep focus inside editor editable.\n\t\t\t\tthis._showUI();\n\t\t\t}\n\t\t} );\n\n\t\t// Focus the form if the balloon is visible and the Tab key has been pressed.\n\t\tthis.editor.keystrokes.set( 'Tab', ( data, cancel ) => {\n\t\t\tif ( this._areActionsVisible && !this.actionsView.focusTracker.isFocused ) {\n\t\t\t\tthis.actionsView.focus();\n\t\t\t\tcancel();\n\t\t\t}\n\t\t}, {\n\t\t\t// Use the high priority because the link UI navigation is more important\n\t\t\t// than other feature's actions, e.g. list indentation.\n\t\t\t// https://github.com/ckeditor/ckeditor5-link/issues/146\n\t\t\tpriority: 'high'\n\t\t} );\n\n\t\t// Close the panel on the Esc key press when the editable has focus and the balloon is visible.\n\t\tthis.editor.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tif ( this._isUIVisible ) {\n\t\t\t\tthis._hideUI();\n\t\t\t\tcancel();\n\t\t\t}\n\t\t} );\n\n\t\t// Close on click outside of balloon panel element.\n\t\tclickOutsideHandler( {\n\t\t\temitter: this.formView,\n\t\t\tactivator: () => this._isUIInPanel,\n\t\t\tcontextElements: [ this._balloon.view.element ],\n\t\t\tcallback: () => this._hideUI()\n\t\t} );\n\t}\n\n\t/**\n\t * Adds the {@link #actionsView} to the {@link #_balloon}.\n\t *\n\t * @protected\n\t */\n\t_addActionsView() {\n\t\tif ( this._areActionsInPanel ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._balloon.add( {\n\t\t\tview: this.actionsView,\n\t\t\tposition: this._getBalloonPositionData()\n\t\t} );\n\t}\n\n\t/**\n\t * Adds the {@link #formView} to the {@link #_balloon}.\n\t *\n\t * @protected\n\t */\n\t_addFormView() {\n\t\tif ( this._isFormInPanel ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\n\t\tthis.formView.disableCssTransitions();\n\n\t\tthis._balloon.add( {\n\t\t\tview: this.formView,\n\t\t\tposition: this._getBalloonPositionData()\n\t\t} );\n\n\t\t// Select input when form view is currently visible.\n\t\tif ( this._balloon.visibleView === this.formView ) {\n\t\t\tthis.formView.urlInputView.fieldView.select();\n\t\t}\n\n\t\tthis.formView.enableCssTransitions();\n\n\t\t// Make sure that each time the panel shows up, the URL field remains in sync with the value of\n\t\t// the command. If the user typed in the input, then canceled the balloon (`urlInputView.fieldView#value` stays\n\t\t// unaltered) and re-opened it without changing the value of the link command (e.g. because they\n\t\t// clicked the same link), they would see the old value instead of the actual value of the command.\n\t\t// https://github.com/ckeditor/ckeditor5-link/issues/78\n\t\t// https://github.com/ckeditor/ckeditor5-link/issues/123\n\t\tthis.formView.urlInputView.fieldView.element.value = linkCommand.value || '';\n\t}\n\n\t/**\n\t * Closes the form view. Decides whether the balloon should be hidden completely or if the action view should be shown. This is\n\t * decided upon the link command value (which has a value if the document selection is in the link).\n\t *\n\t * Additionally, if any {@link module:link/link~LinkConfig#decorators} are defined in the editor configuration, the state of\n\t * switch buttons responsible for manual decorator handling is restored.\n\t *\n\t * @private\n\t */\n\t_closeFormView() {\n\t\tconst linkCommand = this.editor.commands.get( 'link' );\n\n\t\t// Restore manual decorator states to represent the current model state. This case is important to reset the switch buttons\n\t\t// when the user cancels the editing form.\n\t\tlinkCommand.restoreManualDecoratorStates();\n\n\t\tif ( linkCommand.value !== undefined ) {\n\t\t\tthis._removeFormView();\n\t\t} else {\n\t\t\tthis._hideUI();\n\t\t}\n\t}\n\n\t/**\n\t * Removes the {@link #formView} from the {@link #_balloon}.\n\t *\n\t * @protected\n\t */\n\t_removeFormView() {\n\t\tif ( this._isFormInPanel ) {\n\t\t\t// Blur the input element before removing it from DOM to prevent issues in some browsers.\n\t\t\t// See https://github.com/ckeditor/ckeditor5/issues/1501.\n\t\t\tthis.formView.saveButtonView.focus();\n\n\t\t\tthis._balloon.remove( this.formView );\n\n\t\t\t// Because the form has an input which has focus, the focus must be brought back\n\t\t\t// to the editor. Otherwise, it would be lost.\n\t\t\tthis.editor.editing.view.focus();\n\n\t\t\tthis._hideFakeVisualSelection();\n\t\t}\n\t}\n\n\t/**\n\t * Shows the correct UI type. It is either {@link #formView} or {@link #actionsView}.\n\t *\n\t * @param {Boolean} forceVisible\n\t * @private\n\t */\n\t_showUI( forceVisible = false ) {\n\t\t// When there's no link under the selection, go straight to the editing UI.\n\t\tif ( !this._getSelectedLinkElement() ) {\n\t\t\t// Show visual selection on a text without a link when the contextual balloon is displayed.\n\t\t\t// See https://github.com/ckeditor/ckeditor5/issues/4721.\n\t\t\tthis._showFakeVisualSelection();\n\n\t\t\tthis._addActionsView();\n\n\t\t\t// Be sure panel with link is visible.\n\t\t\tif ( forceVisible ) {\n\t\t\t\tthis._balloon.showStack( 'main' );\n\t\t\t}\n\n\t\t\tthis._addFormView();\n\t\t}\n\t\t// If there's a link under the selection...\n\t\telse {\n\t\t\t// Go to the editing UI if actions are already visible.\n\t\t\tif ( this._areActionsVisible ) {\n\t\t\t\tthis._addFormView();\n\t\t\t}\n\t\t\t// Otherwise display just the actions UI.\n\t\t\telse {\n\t\t\t\tthis._addActionsView();\n\t\t\t}\n\n\t\t\t// Be sure panel with link is visible.\n\t\t\tif ( forceVisible ) {\n\t\t\t\tthis._balloon.showStack( 'main' );\n\t\t\t}\n\t\t}\n\n\t\t// Begin responding to ui#update once the UI is added.\n\t\tthis._startUpdatingUI();\n\t}\n\n\t/**\n\t * Removes the {@link #formView} from the {@link #_balloon}.\n\t *\n\t * See {@link #_addFormView}, {@link #_addActionsView}.\n\t *\n\t * @protected\n\t */\n\t_hideUI() {\n\t\tif ( !this._isUIInPanel ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.editor;\n\n\t\tthis.stopListening( editor.ui, 'update' );\n\t\tthis.stopListening( this._balloon, 'change:visibleView' );\n\n\t\t// Make sure the focus always gets back to the editable _before_ removing the focused form view.\n\t\t// Doing otherwise causes issues in some browsers. See https://github.com/ckeditor/ckeditor5-link/issues/193.\n\t\teditor.editing.view.focus();\n\n\t\t// Remove form first because it's on top of the stack.\n\t\tthis._removeFormView();\n\n\t\t// Then remove the actions view because it's beneath the form.\n\t\tthis._balloon.remove( this.actionsView );\n\n\t\tthis._hideFakeVisualSelection();\n\t}\n\n\t/**\n\t * Makes the UI react to the {@link module:core/editor/editorui~EditorUI#event:update} event to\n\t * reposition itself when the editor UI should be refreshed.\n\t *\n\t * See: {@link #_hideUI} to learn when the UI stops reacting to the `update` event.\n\t *\n\t * @protected\n\t */\n\t_startUpdatingUI() {\n\t\tconst editor = this.editor;\n\t\tconst viewDocument = editor.editing.view.document;\n\n\t\tlet prevSelectedLink = this._getSelectedLinkElement();\n\t\tlet prevSelectionParent = getSelectionParent();\n\n\t\tconst update = () => {\n\t\t\tconst selectedLink = this._getSelectedLinkElement();\n\t\t\tconst selectionParent = getSelectionParent();\n\n\t\t\t// Hide the panel if:\n\t\t\t//\n\t\t\t// * the selection went out of the EXISTING link element. E.g. user moved the caret out\n\t\t\t//   of the link,\n\t\t\t// * the selection went to a different parent when creating a NEW link. E.g. someone\n\t\t\t//   else modified the document.\n\t\t\t// * the selection has expanded (e.g. displaying link actions then pressing SHIFT+Right arrow).\n\t\t\t//\n\t\t\t// Note: #_getSelectedLinkElement will return a link for a non-collapsed selection only\n\t\t\t// when fully selected.\n\t\t\tif ( ( prevSelectedLink && !selectedLink ) ||\n\t\t\t\t( !prevSelectedLink && selectionParent !== prevSelectionParent ) ) {\n\t\t\t\tthis._hideUI();\n\t\t\t}\n\t\t\t// Update the position of the panel when:\n\t\t\t//  * link panel is in the visible stack\n\t\t\t//  * the selection remains in the original link element,\n\t\t\t//  * there was no link element in the first place, i.e. creating a new link\n\t\t\telse if ( this._isUIVisible ) {\n\t\t\t\t// If still in a link element, simply update the position of the balloon.\n\t\t\t\t// If there was no link (e.g. inserting one), the balloon must be moved\n\t\t\t\t// to the new position in the editing view (a new native DOM range).\n\t\t\t\tthis._balloon.updatePosition( this._getBalloonPositionData() );\n\t\t\t}\n\n\t\t\tprevSelectedLink = selectedLink;\n\t\t\tprevSelectionParent = selectionParent;\n\t\t};\n\n\t\tfunction getSelectionParent() {\n\t\t\treturn viewDocument.selection.focus.getAncestors()\n\t\t\t\t.reverse()\n\t\t\t\t.find( node => node.is( 'element' ) );\n\t\t}\n\n\t\tthis.listenTo( editor.ui, 'update', update );\n\t\tthis.listenTo( this._balloon, 'change:visibleView', update );\n\t}\n\n\t/**\n\t * Returns `true` when {@link #formView} is in the {@link #_balloon}.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _isFormInPanel() {\n\t\treturn this._balloon.hasView( this.formView );\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} is in the {@link #_balloon}.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _areActionsInPanel() {\n\t\treturn this._balloon.hasView( this.actionsView );\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} is in the {@link #_balloon} and it is\n\t * currently visible.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _areActionsVisible() {\n\t\treturn this._balloon.visibleView === this.actionsView;\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} or {@link #formView} is in the {@link #_balloon}.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _isUIInPanel() {\n\t\treturn this._isFormInPanel || this._areActionsInPanel;\n\t}\n\n\t/**\n\t * Returns `true` when {@link #actionsView} or {@link #formView} is in the {@link #_balloon} and it is\n\t * currently visible.\n\t *\n\t * @readonly\n\t * @protected\n\t * @type {Boolean}\n\t */\n\tget _isUIVisible() {\n\t\tconst visibleView = this._balloon.visibleView;\n\n\t\treturn visibleView == this.formView || this._areActionsVisible;\n\t}\n\n\t/**\n\t * Returns positioning options for the {@link #_balloon}. They control the way the balloon is attached\n\t * to the target element or selection.\n\t *\n\t * If the selection is collapsed and inside a link element, the panel will be attached to the\n\t * entire link element. Otherwise, it will be attached to the selection.\n\t *\n\t * @private\n\t * @returns {module:utils/dom/position~Options}\n\t */\n\t_getBalloonPositionData() {\n\t\tconst view = this.editor.editing.view;\n\t\tconst model = this.editor.model;\n\t\tconst viewDocument = view.document;\n\t\tlet target = null;\n\n\t\tif ( model.markers.has( VISUAL_SELECTION_MARKER_NAME ) ) {\n\t\t\t// There are cases when we highlight selection using a marker (#7705, #4721).\n\t\t\tconst markerViewElements = Array.from( this.editor.editing.mapper.markerNameToElements( VISUAL_SELECTION_MARKER_NAME ) );\n\t\t\tconst newRange = view.createRange(\n\t\t\t\tview.createPositionBefore( markerViewElements[ 0 ] ),\n\t\t\t\tview.createPositionAfter( markerViewElements[ markerViewElements.length - 1 ] )\n\t\t\t);\n\n\t\t\ttarget = view.domConverter.viewRangeToDom( newRange );\n\t\t} else {\n\t\t\tconst targetLink = this._getSelectedLinkElement();\n\t\t\tconst range = viewDocument.selection.getFirstRange();\n\n\t\t\ttarget = targetLink ?\n\t\t\t\t// When selection is inside link element, then attach panel to this element.\n\t\t\t\tview.domConverter.mapViewToDom( targetLink ) :\n\t\t\t\t// Otherwise attach panel to the selection.\n\t\t\t\tview.domConverter.viewRangeToDom( range );\n\t\t}\n\n\t\treturn { target };\n\t}\n\n\t/**\n\t * Returns the link {@link module:engine/view/attributeelement~AttributeElement} under\n\t * the {@link module:engine/view/document~Document editing view's} selection or `null`\n\t * if there is none.\n\t *\n\t * **Note**: For a non–collapsed selection, the link element is only returned when **fully**\n\t * selected and the **only** element within the selection boundaries.\n\t *\n\t * @private\n\t * @returns {module:engine/view/attributeelement~AttributeElement|null}\n\t */\n\t_getSelectedLinkElement() {\n\t\tconst view = this.editor.editing.view;\n\t\tconst selection = view.document.selection;\n\n\t\tif ( selection.isCollapsed ) {\n\t\t\treturn findLinkElementAncestor( selection.getFirstPosition() );\n\t\t} else {\n\t\t\t// The range for fully selected link is usually anchored in adjacent text nodes.\n\t\t\t// Trim it to get closer to the actual link element.\n\t\t\tconst range = selection.getFirstRange().getTrimmed();\n\t\t\tconst startLink = findLinkElementAncestor( range.start );\n\t\t\tconst endLink = findLinkElementAncestor( range.end );\n\n\t\t\tif ( !startLink || startLink != endLink ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check if the link element is fully selected.\n\t\t\tif ( view.createRangeIn( startLink ).getTrimmed().isEqual( range ) ) {\n\t\t\t\treturn startLink;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Displays a fake visual selection when the contextual balloon is displayed.\n\t *\n\t * This adds a 'link-ui' marker into the document that is rendered as a highlight on selected text fragment.\n\t *\n\t * @private\n\t */\n\t_showFakeVisualSelection() {\n\t\tconst model = this.editor.model;\n\n\t\tmodel.change( writer => {\n\t\t\tconst range = model.document.selection.getFirstRange();\n\n\t\t\tif ( model.markers.has( VISUAL_SELECTION_MARKER_NAME ) ) {\n\t\t\t\twriter.updateMarker( VISUAL_SELECTION_MARKER_NAME, { range } );\n\t\t\t} else {\n\t\t\t\tif ( range.start.isAtEnd ) {\n\t\t\t\t\tconst startPosition = range.start.getLastMatchingPosition(\n\t\t\t\t\t\t( { item } ) => !model.schema.isContent( item ),\n\t\t\t\t\t\t{ boundaries: range }\n\t\t\t\t\t);\n\n\t\t\t\t\twriter.addMarker( VISUAL_SELECTION_MARKER_NAME, {\n\t\t\t\t\t\tusingOperation: false,\n\t\t\t\t\t\taffectsData: false,\n\t\t\t\t\t\trange: writer.createRange( startPosition, range.end )\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\twriter.addMarker( VISUAL_SELECTION_MARKER_NAME, {\n\t\t\t\t\t\tusingOperation: false,\n\t\t\t\t\t\taffectsData: false,\n\t\t\t\t\t\trange\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Hides the fake visual selection created in {@link #_showFakeVisualSelection}.\n\t *\n\t * @private\n\t */\n\t_hideFakeVisualSelection() {\n\t\tconst model = this.editor.model;\n\n\t\tif ( model.markers.has( VISUAL_SELECTION_MARKER_NAME ) ) {\n\t\t\tmodel.change( writer => {\n\t\t\t\twriter.removeMarker( VISUAL_SELECTION_MARKER_NAME );\n\t\t\t} );\n\t\t}\n\t}\n}\n\n// Returns a link element if there's one among the ancestors of the provided `Position`.\n//\n// @private\n// @param {module:engine/view/position~Position} View position to analyze.\n// @returns {module:engine/view/attributeelement~AttributeElement|null} Link element at the position or null.\nfunction findLinkElementAncestor( position ) {\n\treturn position.getAncestors().find( ancestor => isLinkElement( ancestor ) );\n}\n"]}]}