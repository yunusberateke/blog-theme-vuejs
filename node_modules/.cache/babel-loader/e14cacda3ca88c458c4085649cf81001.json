{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-ui/src/template.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-ui/src/template.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvaG9tZS9la2ViZXJhdC9ZYW5kZXguRGlzay9Qcm9qZWxlcmltL0JlbmltUHJvamVsZXJpbS93ZWJzaXRlbS93ZWJzaXRlbS13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9nZXQgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9nZXQiOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgX3NsaWNlZFRvQXJyYXkgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5IjsKaW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CgovKioKICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjEsIENLU291cmNlIC0gRnJlZGVyaWNvIEtuYWJiZW4uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLW9zcy1saWNlbnNlCiAqLwoKLyoqCiAqIEBtb2R1bGUgdWkvdGVtcGxhdGUKICovCgovKiBnbG9iYWwgZG9jdW1lbnQgKi8KaW1wb3J0IENLRWRpdG9yRXJyb3IgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvY2tlZGl0b3JlcnJvcic7CmltcG9ydCBtaXggZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvbWl4JzsKaW1wb3J0IEVtaXR0ZXJNaXhpbiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9lbWl0dGVybWl4aW4nOwppbXBvcnQgVmlldyBmcm9tICcuL3ZpZXcnOwppbXBvcnQgVmlld0NvbGxlY3Rpb24gZnJvbSAnLi92aWV3Y29sbGVjdGlvbic7CmltcG9ydCBpc05vZGUgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvZG9tL2lzbm9kZSc7CmltcG9ydCB7IGlzT2JqZWN0LCBjbG9uZURlZXBXaXRoIH0gZnJvbSAnbG9kYXNoLWVzJzsKaW1wb3J0IHRvQXJyYXkgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMvdG9hcnJheSc7CnZhciB4aHRtbE5zID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnOwovKioKICogQSBiYXNpYyBUZW1wbGF0ZSBjbGFzcy4gSXQgcmVuZGVycyBhIERPTSBIVE1MIGVsZW1lbnQgb3IgdGV4dCBmcm9tIGEKICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb24gZGVmaW5pdGlvbn0gYW5kIHN1cHBvcnRzIGVsZW1lbnQgYXR0cmlidXRlcywgY2hpbGRyZW4sCiAqIGJpbmRpbmdzIHRvIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGUgb2JzZXJ2YWJsZXN9IGFuZCBET00gZXZlbnQgcHJvcGFnYXRpb24uCiAqCiAqIEEgc2ltcGxlIHRlbXBsYXRlIGNhbiBsb29rIGxpa2UgdGhpczoKICoKICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCWNsYXNzOiAnZm9vJywKICoJCQkJc3R5bGU6IHsKICoJCQkJCWJhY2tncm91bmRDb2xvcjogJ3llbGxvdycKICoJCQkJfQogKgkJCX0sCiAqCQkJb246IHsKICoJCQkJY2xpY2s6IGJpbmQudG8oICdjbGlja2VkJyApCiAqCQkJfSwKICoJCQljaGlsZHJlbjogWwogKgkJCQknQSBwYXJhZ3JhcGguJwogKgkJCV0KICoJCX0gKS5yZW5kZXIoKTsKICoKICogYW5kIGl0IHdpbGwgcmVuZGVyIHRoZSBmb2xsb3dpbmcgSFRNTCBlbGVtZW50OgogKgogKgkJPHAgY2xhc3M9ImZvbyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6IHllbGxvdzsiPkEgcGFyYWdyYXBoLjwvcD4KICoKICogQWRkaXRpb25hbGx5LCB0aGUgYG9ic2VydmFibGVgIHdpbGwgYWx3YXlzIGZpcmUgYGNsaWNrZWRgIHVwb24gY2xpY2tpbmcgYDxwPmAgaW4gdGhlIERPTS4KICoKICogU2VlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSB0byBrbm93IG1vcmUgYWJvdXQgdGVtcGxhdGVzIGFuZCBjb21wbGV4CiAqIHRlbXBsYXRlIGRlZmluaXRpb25zLgogKgoqIEBtaXhlcyBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJNaXhpbgogKi8KCnZhciBUZW1wbGF0ZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUge0BsaW5rIH5UZW1wbGF0ZX0gY2xhc3MuCiAgICoKICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IGRlZiBUaGUgZGVmaW5pdGlvbiBvZiB0aGUgdGVtcGxhdGUuCiAgICovCiAgZnVuY3Rpb24gVGVtcGxhdGUoZGVmKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVGVtcGxhdGUpOwoKICAgIE9iamVjdC5hc3NpZ24odGhpcywgbm9ybWFsaXplKGNsb25lKGRlZikpKTsKICAgIC8qKgogICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhpcyBwYXJ0aWN1bGFyIFRlbXBsYXRlIGluc3RhbmNlIGhhcyBiZWVuCiAgICAgKiB7QGxpbmsgI3JlbmRlciByZW5kZXJlZH0uCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHtCb29sZWFufQogICAgICovCgogICAgdGhpcy5faXNSZW5kZXJlZCA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBUaGUgdGFnIChgdGFnTmFtZWApIG9mIHRoaXMgdGVtcGxhdGUsIGUuZy4gYGRpdmAuIEl0IGFsc28gaW5kaWNhdGVzIHRoYXQgdGhlIHRlbXBsYXRlCiAgICAgKiByZW5kZXJzIHRvIGFuIEhUTUwgZWxlbWVudC4KICAgICAqCiAgICAgKiBAbWVtYmVyIHtTdHJpbmd9ICN0YWcKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHRleHQgb2YgdGhlIHRlbXBsYXRlLiBJdCBhbHNvIGluZGljYXRlcyB0aGF0IHRoZSB0ZW1wbGF0ZSByZW5kZXJzIHRvIGEgRE9NIHRleHQgbm9kZS4KICAgICAqCiAgICAgKiBAbWVtYmVyIHtBcnJheS48U3RyaW5nfG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hPn0gI3RleHQKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGF0dHJpYnV0ZXMgb2YgdGhlIHRlbXBsYXRlLCBlLmcuIGB7IGlkOiBbICdjay1pZCcgXSB9YCwgY29ycmVzcG9uZGluZyB3aXRoCiAgICAgKiB0aGUgYXR0cmlidXRlcyBvZiBhbiBIVE1MIGVsZW1lbnQuCiAgICAgKgogICAgICogKipOb3RlKio6IFRoaXMgcHJvcGVydHkgb25seSBtYWtlcyBzZW5zZSB3aGVuIHtAbGluayAjdGFnfSBpcyBkZWZpbmVkLgogICAgICoKICAgICAqIEBtZW1iZXIge09iamVjdH0gI2F0dHJpYnV0ZXMKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGNoaWxkcmVuIG9mIHRoZSB0ZW1wbGF0ZS4gVGhleSBjYW4gYmUgZWl0aGVyOgogICAgICogKiBpbmRlcGVuZGVudCBpbnN0YW5jZXMgb2Yge0BsaW5rIH5UZW1wbGF0ZX0gKHN1YuKAk3RlbXBsYXRlcyksCiAgICAgKiAqIG5hdGl2ZSBET00gTm9kZXMuCiAgICAgKgogICAgICogKipOb3RlKio6IFRoaXMgcHJvcGVydHkgb25seSBtYWtlcyBzZW5zZSB3aGVuIHtAbGluayAjdGFnfSBpcyBkZWZpbmVkLgogICAgICoKICAgICAqIEBtZW1iZXIge0FycmF5Ljxtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGV8Tm9kZT59ICNjaGlsZHJlbgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgRE9NIGV2ZW50IGxpc3RlbmVycyBvZiB0aGUgdGVtcGxhdGUuCiAgICAgKgogICAgICogQG1lbWJlciB7T2JqZWN0fSAjZXZlbnRMaXN0ZW5lcnMKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGRhdGEgdXNlZCBieSB0aGUge0BsaW5rICNyZXZlcnR9IG1ldGhvZCB0byByZXN0b3JlIGEgbm9kZSB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCiAgICAgKgogICAgICogU2VlOiB7QGxpbmsgI2FwcGx5fS4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBtZW1iZXIge21vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhfQogICAgICovCgogICAgdGhpcy5fcmV2ZXJ0RGF0YSA9IG51bGw7CiAgfQogIC8qKgogICAqIFJlbmRlcnMgYSBET00gTm9kZSAoYW4gSFRNTCBlbGVtZW50IG9yIHRleHQpIG91dCBvZiB0aGUgdGVtcGxhdGUuCiAgICoKICAgKgkJY29uc3QgZG9tTm9kZSA9IG5ldyBUZW1wbGF0ZSggeyAuLi4gfSApLnJlbmRlcigpOwogICAqCiAgICogU2VlOiB7QGxpbmsgI2FwcGx5fS4KICAgKgogICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxUZXh0fQogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKFRlbXBsYXRlLCBbewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBub2RlID0gdGhpcy5fcmVuZGVyTm9kZSh7CiAgICAgICAgaW50b0ZyYWdtZW50OiB0cnVlCiAgICAgIH0pOwoKICAgICAgdGhpcy5faXNSZW5kZXJlZCA9IHRydWU7CiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBsaWVzIHRoZSB0ZW1wbGF0ZSB0byBhbiBleGlzdGluZyBET00gTm9kZSwgZWl0aGVyIEhUTUwgZWxlbWVudCBvciB0ZXh0LgogICAgICoKICAgICAqICoqTm90ZToqKiBObyBuZXcgRE9NIG5vZGVzIHdpbGwgYmUgY3JlYXRlZC4gQXBwbHlpbmcgZXh0ZW5kczoKICAgICAqCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbiBhdHRyaWJ1dGVzfSwKICAgICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9uIGV2ZW50IGxpc3RlbmVyc30sIGFuZAogICAgICogYHRleHRDb250ZW50YCBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbiBjaGlsZHJlbn0gb25seS4KICAgICAqCiAgICAgKiAqKk5vdGU6KiogRXhpc3RpbmcgYGNsYXNzYCBhbmQgYHN0eWxlYCBhdHRyaWJ1dGVzIGFyZSBleHRlbmRlZCB3aGVuIGEgdGVtcGxhdGUKICAgICAqIGlzIGFwcGxpZWQgdG8gYW4gSFRNTCBlbGVtZW50LCB3aGlsZSBvdGhlciBhdHRyaWJ1dGVzIGFuZCBgdGV4dENvbnRlbnRgIGFyZSBvdmVycmlkZGVuLgogICAgICoKICAgICAqICoqTm90ZToqKiBUaGUgcHJvY2VzcyBvZiBhcHBseWluZyBhIHRlbXBsYXRlIGNhbiBiZSBlYXNpbHkgcmV2ZXJ0ZWQgdXNpbmcgdGhlCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI3JldmVydH0gbWV0aG9kLgogICAgICoKICAgICAqCQljb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKICAgICAqCQljb25zdCBvYnNlcnZhYmxlID0gbmV3IE1vZGVsKCB7IGRpdkNsYXNzOiAnbXktZGl2JyB9ICk7CiAgICAgKgkJY29uc3QgZW1pdHRlciA9IE9iamVjdC5jcmVhdGUoIEVtaXR0ZXJNaXhpbiApOwogICAgICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAgICAgKgogICAgICoJCW5ldyBUZW1wbGF0ZSggewogICAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICAgKgkJCQlpZDogJ2ZpcnN0LWRpdicsCiAgICAgKgkJCQljbGFzczogYmluZC50byggJ2RpdkNsYXNzJyApCiAgICAgKgkJCX0sCiAgICAgKgkJCW9uOiB7CiAgICAgKgkJCQljbGljazogYmluZCggJ2VsZW1lbnRDbGlja2VkJyApIC8vIFdpbGwgYmUgZmlyZWQgYnkgdGhlIG9ic2VydmFibGUuCiAgICAgKgkJCX0sCiAgICAgKgkJCWNoaWxkcmVuOiBbCiAgICAgKgkJCQknRGl2IHRleHQuJwogICAgICoJCQldCiAgICAgKgkJfSApLmFwcGx5KCBlbGVtZW50ICk7CiAgICAgKgogICAgICoJCWNvbnNvbGUubG9nKCBlbGVtZW50Lm91dGVySFRNTCApOyAvLyAtPiAnPGRpdiBpZD0iZmlyc3QtZGl2IiBjbGFzcz0ibXktZGl2Ij48L2Rpdj4nCiAgICAgKgogICAgICogQHNlZSBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjcmVuZGVyCiAgICAgKiBAc2VlIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNyZXZlcnQKICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBSb290IG5vZGUgZm9yIHRoZSB0ZW1wbGF0ZSB0byBhcHBseS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhcHBseSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYXBwbHkobm9kZSkgewogICAgICB0aGlzLl9yZXZlcnREYXRhID0gZ2V0RW1wdHlSZXZlcnREYXRhKCk7CgogICAgICB0aGlzLl9yZW5kZXJOb2RlKHsKICAgICAgICBub2RlOiBub2RlLAogICAgICAgIGlzQXBwbHlpbmc6IHRydWUsCiAgICAgICAgcmV2ZXJ0RGF0YTogdGhpcy5fcmV2ZXJ0RGF0YQogICAgICB9KTsKCiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgLyoqCiAgICAgKiBSZXZlcnRzIGEgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhcHBseSBhcHBsaWVkfSB0byBhIERPTSBub2RlLgogICAgICoKICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZSBUaGUgcm9vdCBub2RlIGZvciB0aGUgdGVtcGxhdGUgdG8gcmV2ZXJ0LiBJbiBtb3N0IG9mIHRoZSBjYXNlcywgaXQgaXMgdGhlCiAgICAgKiBzYW1lIG5vZGUgdXNlZCBieSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2FwcGx5fS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZXZlcnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJldmVydChub2RlKSB7CiAgICAgIGlmICghdGhpcy5fcmV2ZXJ0RGF0YSkgewogICAgICAgIC8qKgogICAgICAgICAqIEF0dGVtcHRpbmcgdG8gcmV2ZXJ0IGEgdGVtcGxhdGUgd2hpY2ggaGFzIG5vdCBiZWVuIGFwcGxpZWQgeWV0LgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIHVpLXRlbXBsYXRlLXJldmVydC1ub3QtYXBwbGllZAogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd1aS10ZW1wbGF0ZS1yZXZlcnQtbm90LWFwcGxpZWQnLCBbdGhpcywgbm9kZV0pOwogICAgICB9CgogICAgICB0aGlzLl9yZXZlcnRUZW1wbGF0ZUZyb21Ob2RlKG5vZGUsIHRoaXMuX3JldmVydERhdGEpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGl0ZXJhdG9yIHdoaWNoIHRyYXZlcnNlcyB0aGUgdGVtcGxhdGUgaW4gc2VhcmNoIG9mIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fQogICAgICogaW5zdGFuY2VzIGFuZCByZXR1cm5zIHRoZW0gb25lIGJ5IG9uZS4KICAgICAqCiAgICAgKgkJY29uc3Qgdmlld0ZvbyA9IG5ldyBWaWV3KCk7CiAgICAgKgkJY29uc3Qgdmlld0JhciA9IG5ldyBWaWV3KCk7CiAgICAgKgkJY29uc3Qgdmlld0JheiA9IG5ldyBWaWV3KCk7CiAgICAgKgkJY29uc3QgdGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUoIHsKICAgICAqCQkJdGFnOiAnZGl2JywKICAgICAqCQkJY2hpbGRyZW46IFsKICAgICAqCQkJCXZpZXdGb28sCiAgICAgKgkJCQl7CiAgICAgKgkJCQkJdGFnOiAnZGl2JywKICAgICAqCQkJCQljaGlsZHJlbjogWwogICAgICoJCQkJCQl2aWV3QmFyCiAgICAgKgkJCQkJXQogICAgICoJCQkJfSwKICAgICAqCQkJCXZpZXdCYXoKICAgICAqCQkJXQogICAgICoJCX0gKTsKICAgICAqCiAgICAgKgkJLy8gTG9nczogdmlld0Zvbywgdmlld0Jhciwgdmlld0JhegogICAgICoJCWZvciAoIGNvbnN0IHZpZXcgb2YgdGVtcGxhdGUuZ2V0Vmlld3MoKSApIHsKICAgICAqCQkJY29uc29sZS5sb2coIHZpZXcgKTsKICAgICAqCQl9CiAgICAgKgogICAgICogQHJldHVybnMge0l0ZXJhYmxlLjxtb2R1bGU6dWkvdmlld35WaWV3Pn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3cyIsCiAgICB2YWx1ZToKICAgIC8qI19fUFVSRV9fKi8KICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIGdldFZpZXdzKCkgewogICAgICB2YXIgX21hcmtlZCwgc2VhcmNoOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIGdldFZpZXdzJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBzZWFyY2ggPSBmdW5jdGlvbiBfc2VhcmNoKGRlZikgewogICAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvciwgX3N0ZXAsIGNoaWxkOwoKICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBzZWFyY2gkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRlZi5jaGlsZHJlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMzsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZGVmLmNoaWxkcmVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDI7CgogICAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IucygpOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVmlldyhjaGlsZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQ7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNUZW1wbGF0ZShjaGlsZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5kZWxlZ2F0ZVlpZWxkKHNlYXJjaChjaGlsZCksICJ0MCIsIDEzKTsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTc7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnQxID0gX2NvbnRleHRbImNhdGNoIl0oMik7CgogICAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IuZShfY29udGV4dC50MSk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDIwOwoKICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMjApOwoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgX21hcmtlZCwgbnVsbCwgW1syLCAxNywgMjAsIDIzXV0pOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIF9tYXJrZWQgPSAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoc2VhcmNoKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmRlbGVnYXRlWWllbGQoc2VhcmNoKHRoaXMpLCAidDAiLCAzKTsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIGdldFZpZXdzLCB0aGlzKTsKICAgIH0pCiAgICAvKioKICAgICAqIEFuIGVudHJ5IHBvaW50IHRvIHRoZSBpbnRlcmZhY2Ugd2hpY2ggYmluZHMgRE9NIG5vZGVzIHRvCiAgICAgKiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlIG9ic2VydmFibGVzfS4KICAgICAqIFRoZXJlIGFyZSB0d28gdHlwZXMgb2YgYmluZGluZ3M6CiAgICAgKgogICAgICogKiBIVE1MIGVsZW1lbnQgYXR0cmlidXRlcyBvciB0ZXh0IGB0ZXh0Q29udGVudGAgc3luY2hyb25pemVkIHdpdGggYXR0cmlidXRlcyBvZiBhbgogICAgICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0uIExlYXJuIG1vcmUgYWJvdXQge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG99CiAgICAgKiBhbmQge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jaWZ9LgogICAgICoKICAgICAqCQljb25zdCBiaW5kID0gVGVtcGxhdGUuYmluZCggb2JzZXJ2YWJsZSwgZW1pdHRlciApOwogICAgICoKICAgICAqCQluZXcgVGVtcGxhdGUoIHsKICAgICAqCQkJYXR0cmlidXRlczogewogICAgICoJCQkJLy8gQmluZHMgdGhlIGVsZW1lbnQgImNsYXNzIiBhdHRyaWJ1dGUgdG8gb2JzZXJ2YWJsZSNjbGFzc0F0dHJpYnV0ZS4KICAgICAqCQkJCWNsYXNzOiBiaW5kLnRvKCAnY2xhc3NBdHRyaWJ1dGUnICkKICAgICAqCQkJfQogICAgICoJCX0gKS5yZW5kZXIoKTsKICAgICAqCiAgICAgKiAqIERPTSBldmVudHMgZmlyZWQgb24gSFRNTCBlbGVtZW50IHByb3BhZ2F0ZWQgdGhyb3VnaAogICAgICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0uIExlYXJuIG1vcmUgYWJvdXQge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG99LgogICAgICoKICAgICAqCQljb25zdCBiaW5kID0gVGVtcGxhdGUuYmluZCggb2JzZXJ2YWJsZSwgZW1pdHRlciApOwogICAgICoKICAgICAqCQluZXcgVGVtcGxhdGUoIHsKICAgICAqCQkJb246IHsKICAgICAqCQkJCS8vIFdpbGwgYmUgZmlyZWQgYnkgdGhlIG9ic2VydmFibGUuCiAgICAgKgkJCQljbGljazogYmluZCggJ2VsZW1lbnRDbGlja2VkJyApCiAgICAgKgkJCX0KICAgICAqCQl9ICkucmVuZGVyKCk7CiAgICAgKgogICAgICogQWxzbyBzZWUge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXcjYmluZFRlbXBsYXRlfS4KICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gb2JzZXJ2YWJsZSBBbiBvYnNlcnZhYmxlIHdoaWNoIHByb3ZpZGVzIGJvdW5kYWJsZSBhdHRyaWJ1dGVzLgogICAgICogQHBhcmFtIHttb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJ9IGVtaXR0ZXIgQW4gZW1pdHRlciB0aGF0IGxpc3RlbnMgdG8gb2JzZXJ2YWJsZSBhdHRyaWJ1dGUKICAgICAqIGNoYW5nZXMgb3IgRE9NIEV2ZW50cyAoZGVwZW5kaW5nIG9uIHRoZSBraW5kIG9mIHRoZSBiaW5kaW5nKS4gVXN1YWxseSwgYSB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+Vmlld30gaW5zdGFuY2UuCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyTm9kZSIsCiAgICB2YWx1ZToKICAgIC8qKgogICAgICogUmVuZGVycyBhIERPTSBOb2RlIChlaXRoZXIgYW4gSFRNTCBlbGVtZW50IG9yIHRleHQpIG91dCBvZiB0aGUgdGVtcGxhdGUuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqLwogICAgZnVuY3Rpb24gX3JlbmRlck5vZGUoZGF0YSkgewogICAgICB2YXIgaXNJbnZhbGlkOwoKICAgICAgaWYgKGRhdGEubm9kZSkgewogICAgICAgIC8vIFdoZW4gYXBwbHlpbmcsIGEgZGVmaW5pdGlvbiBjYW5ub3QgaGF2ZSAidGFnIiBhbmQgInRleHQiIGF0IHRoZSBzYW1lIHRpbWUuCiAgICAgICAgaXNJbnZhbGlkID0gdGhpcy50YWcgJiYgdGhpcy50ZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFdoZW4gcmVuZGVyaW5nLCBhIGRlZmluaXRpb24gbXVzdCBoYXZlIGVpdGhlciAidGFnIiBvciAidGV4dCI6IFhPUiggdGhpcy50YWcsIHRoaXMudGV4dCApLgogICAgICAgIGlzSW52YWxpZCA9IHRoaXMudGFnID8gdGhpcy50ZXh0IDogIXRoaXMudGV4dDsKICAgICAgfQoKICAgICAgaWYgKGlzSW52YWxpZCkgewogICAgICAgIC8qKgogICAgICAgICAqIE5vZGUgZGVmaW5pdGlvbiBjYW5ub3QgaGF2ZSB0aGUgInRhZyIgYW5kICJ0ZXh0IiBwcm9wZXJ0aWVzIGF0IHRoZSBzYW1lIHRpbWUuCiAgICAgICAgICogTm9kZSBkZWZpbml0aW9uIG11c3QgaGF2ZSBlaXRoZXIgInRhZyIgb3IgInRleHQiIHdoZW4gcmVuZGVyaW5nIGEgbmV3IE5vZGUuCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgdWktdGVtcGxhdGUtd3Jvbmctc3ludGF4CiAgICAgICAgICovCiAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3VpLXRlbXBsYXRlLXdyb25nLXN5bnRheCcsIHRoaXMpOwogICAgICB9CgogICAgICBpZiAodGhpcy50ZXh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlclRleHQoZGF0YSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckVsZW1lbnQoZGF0YSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVuZGVycyBhbiBIVE1MIGVsZW1lbnQgb3V0IG9mIHRoZSB0ZW1wbGF0ZS4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhfSBkYXRhIFJlbmRlcmluZyBkYXRhLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZW5kZXJFbGVtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyRWxlbWVudChkYXRhKSB7CiAgICAgIHZhciBub2RlID0gZGF0YS5ub2RlOwoKICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgbm9kZSA9IGRhdGEubm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyh0aGlzLm5zIHx8IHhodG1sTnMsIHRoaXMudGFnKTsKICAgICAgfQoKICAgICAgdGhpcy5fcmVuZGVyQXR0cmlidXRlcyhkYXRhKTsKCiAgICAgIHRoaXMuX3JlbmRlckVsZW1lbnRDaGlsZHJlbihkYXRhKTsKCiAgICAgIHRoaXMuX3NldFVwTGlzdGVuZXJzKGRhdGEpOwoKICAgICAgcmV0dXJuIG5vZGU7CiAgICB9CiAgICAvKioKICAgICAqIFJlbmRlcnMgYSB0ZXh0IG5vZGUgb3V0IG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjdGV4dH0uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlclRleHQoZGF0YSkgewogICAgICB2YXIgbm9kZSA9IGRhdGEubm9kZTsgLy8gU2F2ZSB0aGUgb3JpZ2luYWwgdGV4dENvbnRlbnQgdG8gcmV2ZXJ0IGl0IGluICNyZXZlcnQoKS4KCiAgICAgIGlmIChub2RlKSB7CiAgICAgICAgZGF0YS5yZXZlcnREYXRhLnRleHQgPSBub2RlLnRleHRDb250ZW50OwogICAgICB9IGVsc2UgewogICAgICAgIG5vZGUgPSBkYXRhLm5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7CiAgICAgIH0gLy8gQ2hlY2sgaWYgdGhpcyBUZXh0IE5vZGUgaXMgYm91bmQgdG8gT2JzZXJ2YWJsZS4gQ2FzZXM6CiAgICAgIC8vCiAgICAgIC8vCQl0ZXh0OiBbIFRlbXBsYXRlLmJpbmQoIC4uLiApLnRvKCAuLi4gKSBdCiAgICAgIC8vCiAgICAgIC8vCQl0ZXh0OiBbCiAgICAgIC8vCQkJJ2ZvbycsCiAgICAgIC8vCQkJVGVtcGxhdGUuYmluZCggLi4uICkudG8oIC4uLiApLAogICAgICAvLwkJCS4uLgogICAgICAvLwkJXQogICAgICAvLwoKCiAgICAgIGlmIChoYXNUZW1wbGF0ZUJpbmRpbmcodGhpcy50ZXh0KSkgewogICAgICAgIHRoaXMuX2JpbmRUb09ic2VydmFibGUoewogICAgICAgICAgc2NoZW1hOiB0aGlzLnRleHQsCiAgICAgICAgICB1cGRhdGVyOiBnZXRUZXh0VXBkYXRlcihub2RlKSwKICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICB9KTsKICAgICAgfSAvLyBTaW1wbHkgc2V0IHRleHQuIENhc2VzOgogICAgICAvLwogICAgICAvLwkJdGV4dDogWyAnYWxsJywgJ2FyZScsICdzdGF0aWMnIF0KICAgICAgLy8KICAgICAgLy8JCXRleHQ6IFsgJ2ZvbycgXQogICAgICAvLwogICAgICBlbHNlIHsKICAgICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSB0aGlzLnRleHQuam9pbignJyk7CiAgICAgICAgfQoKICAgICAgcmV0dXJuIG5vZGU7CiAgICB9CiAgICAvKioKICAgICAqIFJlbmRlcnMgSFRNTCBlbGVtZW50IGF0dHJpYnV0ZXMgb3V0IG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjYXR0cmlidXRlc30uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyQXR0cmlidXRlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlckF0dHJpYnV0ZXMoZGF0YSkgewogICAgICB2YXIgYXR0ck5hbWUsIGF0dHJWYWx1ZSwgZG9tQXR0clZhbHVlLCBhdHRyTnM7CgogICAgICBpZiAoIXRoaXMuYXR0cmlidXRlcykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIG5vZGUgPSBkYXRhLm5vZGU7CiAgICAgIHZhciByZXZlcnREYXRhID0gZGF0YS5yZXZlcnREYXRhOwoKICAgICAgZm9yIChhdHRyTmFtZSBpbiB0aGlzLmF0dHJpYnV0ZXMpIHsKICAgICAgICAvLyBDdXJyZW50IGF0dHJpYnV0ZSB2YWx1ZSBpbiBET00uCiAgICAgICAgZG9tQXR0clZhbHVlID0gbm9kZS5nZXRBdHRyaWJ1dGUoYXR0ck5hbWUpOyAvLyBUaGUgdmFsdWUgdG8gYmUgc2V0LgoKICAgICAgICBhdHRyVmFsdWUgPSB0aGlzLmF0dHJpYnV0ZXNbYXR0ck5hbWVdOyAvLyBTYXZlIHJldmVydCBkYXRhLgoKICAgICAgICBpZiAocmV2ZXJ0RGF0YSkgewogICAgICAgICAgcmV2ZXJ0RGF0YS5hdHRyaWJ1dGVzW2F0dHJOYW1lXSA9IGRvbUF0dHJWYWx1ZTsKICAgICAgICB9IC8vIERldGVjdCBjdXN0b20gbmFtZXNwYWNlOgogICAgICAgIC8vCiAgICAgICAgLy8JCWNsYXNzOiB7CiAgICAgICAgLy8JCQluczogJ2FiYycsCiAgICAgICAgLy8JCQl2YWx1ZTogVGVtcGxhdGUuYmluZCggLi4uICkudG8oIC4uLiApCiAgICAgICAgLy8JCX0KICAgICAgICAvLwoKCiAgICAgICAgYXR0ck5zID0gaXNPYmplY3QoYXR0clZhbHVlWzBdKSAmJiBhdHRyVmFsdWVbMF0ubnMgPyBhdHRyVmFsdWVbMF0ubnMgOiBudWxsOyAvLyBBY3RpdmF0ZSBiaW5kaW5nIGlmIG9uZSBpcyBmb3VuZC4gQ2FzZXM6CiAgICAgICAgLy8KICAgICAgICAvLwkJY2xhc3M6IFsKICAgICAgICAvLwkJCVRlbXBsYXRlLmJpbmQoIC4uLiApLnRvKCAuLi4gKQogICAgICAgIC8vCQldCiAgICAgICAgLy8KICAgICAgICAvLwkJY2xhc3M6IFsKICAgICAgICAvLwkJCSdiYXInLAogICAgICAgIC8vCQkJVGVtcGxhdGUuYmluZCggLi4uICkudG8oIC4uLiApLAogICAgICAgIC8vCQkJJ2JheicKICAgICAgICAvLwkJXQogICAgICAgIC8vCiAgICAgICAgLy8JCWNsYXNzOiB7CiAgICAgICAgLy8JCQluczogJ2FiYycsCiAgICAgICAgLy8JCQl2YWx1ZTogVGVtcGxhdGUuYmluZCggLi4uICkudG8oIC4uLiApCiAgICAgICAgLy8JCX0KICAgICAgICAvLwoKICAgICAgICBpZiAoaGFzVGVtcGxhdGVCaW5kaW5nKGF0dHJWYWx1ZSkpIHsKICAgICAgICAgIC8vIE5vcm1hbGl6ZSBhdHRyaWJ1dGVzIHdpdGggYWRkaXRpb25hbCBkYXRhIGxpa2UgbmFtZXNwYWNlOgogICAgICAgICAgLy8KICAgICAgICAgIC8vCQljbGFzczogewogICAgICAgICAgLy8JCQluczogJ2FiYycsCiAgICAgICAgICAvLwkJCXZhbHVlOiBbIC4uLiBdCiAgICAgICAgICAvLwkJfQogICAgICAgICAgLy8KICAgICAgICAgIHZhciB2YWx1ZVRvQmluZCA9IGF0dHJOcyA/IGF0dHJWYWx1ZVswXS52YWx1ZSA6IGF0dHJWYWx1ZTsgLy8gRXh0ZW5kIHRoZSBvcmlnaW5hbCB2YWx1ZSBvZiBhdHRyaWJ1dGVzIGxpa2UgInN0eWxlIiBhbmQgImNsYXNzIiwKICAgICAgICAgIC8vIGRvbid0IG92ZXJyaWRlIHRoZW0uCgogICAgICAgICAgaWYgKHJldmVydERhdGEgJiYgc2hvdWxkRXh0ZW5kKGF0dHJOYW1lKSkgewogICAgICAgICAgICB2YWx1ZVRvQmluZC51bnNoaWZ0KGRvbUF0dHJWYWx1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fYmluZFRvT2JzZXJ2YWJsZSh7CiAgICAgICAgICAgIHNjaGVtYTogdmFsdWVUb0JpbmQsCiAgICAgICAgICAgIHVwZGF0ZXI6IGdldEF0dHJpYnV0ZVVwZGF0ZXIobm9kZSwgYXR0ck5hbWUsIGF0dHJOcyksCiAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gU3R5bGUgYXR0cmlidXRlIGNvdWxkIGJlIGFuIE9iamVjdCBzbyBpdCBuZWVkcyB0byBiZSBwYXJzZWQgaW4gYSBzcGVjaWZpYyB3YXkuCiAgICAgICAgLy8KICAgICAgICAvLwkJc3R5bGU6IHsKICAgICAgICAvLwkJCXdpZHRoOiAnMTAwcHgnLAogICAgICAgIC8vCQkJaGVpZ2h0OiBUZW1wbGF0ZS5iaW5kKCAuLi4gKS50byggLi4uICkKICAgICAgICAvLwkJfQogICAgICAgIC8vCiAgICAgICAgZWxzZSBpZiAoYXR0ck5hbWUgPT0gJ3N0eWxlJyAmJiB0eXBlb2YgYXR0clZhbHVlWzBdICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICB0aGlzLl9yZW5kZXJTdHlsZUF0dHJpYnV0ZShhdHRyVmFsdWVbMF0sIGRhdGEpOwogICAgICAgICAgfSAvLyBPdGhlcndpc2Ugc2ltcGx5IHNldCB0aGUgc3RhdGljIGF0dHJpYnV0ZToKICAgICAgICAgIC8vCiAgICAgICAgICAvLwkJY2xhc3M6IFsgJ2ZvbycgXQogICAgICAgICAgLy8KICAgICAgICAgIC8vCQljbGFzczogWyAnYWxsJywgJ2FyZScsICdzdGF0aWMnIF0KICAgICAgICAgIC8vCiAgICAgICAgICAvLwkJY2xhc3M6IFsKICAgICAgICAgIC8vCQkJewogICAgICAgICAgLy8JCQkJbnM6ICdhYmMnLAogICAgICAgICAgLy8JCQkJdmFsdWU6IFsgJ2ZvbycgXQogICAgICAgICAgLy8JCQl9CiAgICAgICAgICAvLwkJXQogICAgICAgICAgLy8KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIC8vIEV4dGVuZCB0aGUgb3JpZ2luYWwgdmFsdWUgb2YgYXR0cmlidXRlcyBsaWtlICJzdHlsZSIgYW5kICJjbGFzcyIsCiAgICAgICAgICAgICAgLy8gZG9uJ3Qgb3ZlcnJpZGUgdGhlbS4KICAgICAgICAgICAgICBpZiAocmV2ZXJ0RGF0YSAmJiBkb21BdHRyVmFsdWUgJiYgc2hvdWxkRXh0ZW5kKGF0dHJOYW1lKSkgewogICAgICAgICAgICAgICAgYXR0clZhbHVlLnVuc2hpZnQoZG9tQXR0clZhbHVlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGF0dHJWYWx1ZSA9IGF0dHJWYWx1ZSAvLyBSZXRyaWV2ZSAidmFsdWVzIiBmcm9tOgogICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgLy8JCWNsYXNzOiBbCiAgICAgICAgICAgICAgLy8JCQl7CiAgICAgICAgICAgICAgLy8JCQkJbnM6ICdhYmMnLAogICAgICAgICAgICAgIC8vCQkJCXZhbHVlOiBbIC4uLiBdCiAgICAgICAgICAgICAgLy8JCQl9CiAgICAgICAgICAgICAgLy8JCV0KICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbCA/IHZhbC52YWx1ZSB8fCB2YWwgOiB2YWw7CiAgICAgICAgICAgICAgfSkgLy8gRmxhdHRlbiB0aGUgYXJyYXkuCiAgICAgICAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAocHJldiwgbmV4dCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHByZXYuY29uY2F0KG5leHQpOwogICAgICAgICAgICAgIH0sIFtdKSAvLyBDb252ZXJ0IGludG8gc3RyaW5nLgogICAgICAgICAgICAgIC5yZWR1Y2UoYXJyYXlWYWx1ZVJlZHVjZXIsICcnKTsKCiAgICAgICAgICAgICAgaWYgKCFpc0ZhbHN5KGF0dHJWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlTlMoYXR0ck5zLCBhdHRyTmFtZSwgYXR0clZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW5kZXJzIHRoZSBgc3R5bGVgIGF0dHJpYnV0ZSBvZiBhbiBIVE1MIGVsZW1lbnQgYmFzZWQgb24KICAgICAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjYXR0cmlidXRlc30uCiAgICAgKgogICAgICogQSBzdHlsZSBhdHRyaWJ1dGUgaXMgYW4ge09iamVjdH0gd2l0aCBzdGF0aWMgdmFsdWVzOgogICAgICoKICAgICAqCQlhdHRyaWJ1dGVzOiB7CiAgICAgKgkJCXN0eWxlOiB7CiAgICAgKgkJCQljb2xvcjogJ3JlZCcKICAgICAqCQkJfQogICAgICoJCX0KICAgICAqCiAgICAgKiBvciB2YWx1ZXMgYm91bmQgdG8ge0BsaW5rIG1vZHVsZTp1aS9tb2RlbH5Nb2RlbH0gcHJvcGVydGllczoKICAgICAqCiAgICAgKgkJYXR0cmlidXRlczogewogICAgICoJCQlzdHlsZTogewogICAgICoJCQkJY29sb3I6IGJpbmQudG8oIC4uLiApCiAgICAgKgkJCX0KICAgICAqCQl9CiAgICAgKgogICAgICogTm90ZTogVGhlIGBzdHlsZWAgYXR0cmlidXRlIGlzIHJlbmRlcmVkIHdpdGhvdXQgc2V0dGluZyB0aGUgbmFtZXNwYWNlLiBJdCBkb2VzIG5vdCBzZWVtIHRvIGJlCiAgICAgKiBuZWVkZWQuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdHlsZXMgU3R5bGVzIGxvY2F0ZWQgaW4gYGF0dHJpYnV0ZXMuc3R5bGVgIG9mIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufS4KICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGF9IGRhdGEgUmVuZGVyaW5nIGRhdGEuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3JlbmRlclN0eWxlQXR0cmlidXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyU3R5bGVBdHRyaWJ1dGUoc3R5bGVzLCBkYXRhKSB7CiAgICAgIHZhciBub2RlID0gZGF0YS5ub2RlOwoKICAgICAgZm9yICh2YXIgc3R5bGVOYW1lIGluIHN0eWxlcykgewogICAgICAgIHZhciBzdHlsZVZhbHVlID0gc3R5bGVzW3N0eWxlTmFtZV07IC8vIENhc2VzOgogICAgICAgIC8vCiAgICAgICAgLy8JCXN0eWxlOiB7CiAgICAgICAgLy8JCQljb2xvcjogYmluZC50byggJ2F0dHJpYnV0ZScgKQogICAgICAgIC8vCQl9CiAgICAgICAgLy8KCiAgICAgICAgaWYgKGhhc1RlbXBsYXRlQmluZGluZyhzdHlsZVZhbHVlKSkgewogICAgICAgICAgdGhpcy5fYmluZFRvT2JzZXJ2YWJsZSh7CiAgICAgICAgICAgIHNjaGVtYTogW3N0eWxlVmFsdWVdLAogICAgICAgICAgICB1cGRhdGVyOiBnZXRTdHlsZVVwZGF0ZXIobm9kZSwgc3R5bGVOYW1lKSwKICAgICAgICAgICAgZGF0YTogZGF0YQogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyBDYXNlczoKICAgICAgICAvLwogICAgICAgIC8vCQlzdHlsZTogewogICAgICAgIC8vCQkJY29sb3I6ICdyZWQnCiAgICAgICAgLy8JCX0KICAgICAgICAvLwogICAgICAgIGVsc2UgewogICAgICAgICAgICBub2RlLnN0eWxlW3N0eWxlTmFtZV0gPSBzdHlsZVZhbHVlOwogICAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZWx5IHJlbmRlcnMgSFRNTCBlbGVtZW50J3MgY2hpbGRyZW4gZnJvbSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2NoaWxkcmVufS4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhfSBkYXRhIFJlbmRlcmluZyBkYXRhLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZW5kZXJFbGVtZW50Q2hpbGRyZW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJFbGVtZW50Q2hpbGRyZW4oZGF0YSkgewogICAgICB2YXIgbm9kZSA9IGRhdGEubm9kZTsKICAgICAgdmFyIGNvbnRhaW5lciA9IGRhdGEuaW50b0ZyYWdtZW50ID8gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpIDogbm9kZTsKICAgICAgdmFyIGlzQXBwbHlpbmcgPSBkYXRhLmlzQXBwbHlpbmc7CiAgICAgIHZhciBjaGlsZEluZGV4ID0gMDsKCiAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5jaGlsZHJlbiksCiAgICAgICAgICBfc3RlcDI7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgY2hpbGQgPSBfc3RlcDIudmFsdWU7CgogICAgICAgICAgaWYgKGlzVmlld0NvbGxlY3Rpb24oY2hpbGQpKSB7CiAgICAgICAgICAgIGlmICghaXNBcHBseWluZykgewogICAgICAgICAgICAgIGNoaWxkLnNldFBhcmVudChub2RlKTsgLy8gTm90ZTogVmlld0NvbGxlY3Rpb24gcmVuZGVycyBpdHMgY2hpbGRyZW4uCgogICAgICAgICAgICAgIHZhciBfaXRlcmF0b3IzID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoY2hpbGQpLAogICAgICAgICAgICAgICAgICBfc3RlcDM7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjMucygpOyAhKF9zdGVwMyA9IF9pdGVyYXRvcjMubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgICB2YXIgdmlldyA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHZpZXcuZWxlbWVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IzLmUoZXJyKTsKICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGlzVmlldyhjaGlsZCkpIHsKICAgICAgICAgICAgaWYgKCFpc0FwcGx5aW5nKSB7CiAgICAgICAgICAgICAgaWYgKCFjaGlsZC5pc1JlbmRlcmVkKSB7CiAgICAgICAgICAgICAgICBjaGlsZC5yZW5kZXIoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjaGlsZC5lbGVtZW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChpc05vZGUoY2hpbGQpKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjaGlsZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaXNBcHBseWluZykgewogICAgICAgICAgICAgIHZhciByZXZlcnREYXRhID0gZGF0YS5yZXZlcnREYXRhOwogICAgICAgICAgICAgIHZhciBjaGlsZFJldmVydERhdGEgPSBnZXRFbXB0eVJldmVydERhdGEoKTsKICAgICAgICAgICAgICByZXZlcnREYXRhLmNoaWxkcmVuLnB1c2goY2hpbGRSZXZlcnREYXRhKTsKCiAgICAgICAgICAgICAgY2hpbGQuX3JlbmRlck5vZGUoewogICAgICAgICAgICAgICAgbm9kZTogY29udGFpbmVyLmNoaWxkTm9kZXNbY2hpbGRJbmRleCsrXSwKICAgICAgICAgICAgICAgIGlzQXBwbHlpbmc6IHRydWUsCiAgICAgICAgICAgICAgICByZXZlcnREYXRhOiBjaGlsZFJldmVydERhdGEKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2hpbGQucmVuZGVyKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IyLmYoKTsKICAgICAgfQoKICAgICAgaWYgKGRhdGEuaW50b0ZyYWdtZW50KSB7CiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChjb250YWluZXIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFjdGl2YXRlcyBgb25gIGV2ZW50IGxpc3RlbmVycyBmcm9tIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0KICAgICAqIG9uIGFuIEhUTUwgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhfSBkYXRhIFJlbmRlcmluZyBkYXRhLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXRVcExpc3RlbmVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldFVwTGlzdGVuZXJzKGRhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5ldmVudExpc3RlbmVycykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3Aoa2V5KSB7CiAgICAgICAgdmFyIHJldmVydEJpbmRpbmdzID0gX3RoaXMuZXZlbnRMaXN0ZW5lcnNba2V5XS5tYXAoZnVuY3Rpb24gKHNjaGVtYUl0ZW0pIHsKICAgICAgICAgIHZhciBfa2V5JHNwbGl0ID0ga2V5LnNwbGl0KCdAJyksCiAgICAgICAgICAgICAgX2tleSRzcGxpdDIgPSBfc2xpY2VkVG9BcnJheShfa2V5JHNwbGl0LCAyKSwKICAgICAgICAgICAgICBkb21FdnROYW1lID0gX2tleSRzcGxpdDJbMF0sCiAgICAgICAgICAgICAgZG9tU2VsZWN0b3IgPSBfa2V5JHNwbGl0MlsxXTsKCiAgICAgICAgICByZXR1cm4gc2NoZW1hSXRlbS5hY3RpdmF0ZURvbUV2ZW50TGlzdGVuZXIoZG9tRXZ0TmFtZSwgZG9tU2VsZWN0b3IsIGRhdGEpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoZGF0YS5yZXZlcnREYXRhKSB7CiAgICAgICAgICBkYXRhLnJldmVydERhdGEuYmluZGluZ3MucHVzaChyZXZlcnRCaW5kaW5ncyk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuZXZlbnRMaXN0ZW5lcnMpIHsKICAgICAgICBfbG9vcChrZXkpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvciBhIGdpdmVuIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gY29udGFpbmluZyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30KICAgICAqIGFjdGl2YXRlcyB0aGUgYmluZGluZyBhbmQgc2V0cyBpdHMgaW5pdGlhbCB2YWx1ZS4KICAgICAqCiAgICAgKiBOb3RlOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IGNhbiBiZSBmb3IgSFRNTCBlbGVtZW50IGF0dHJpYnV0ZXMgb3IKICAgICAqIHRleHQgbm9kZSBgdGV4dENvbnRlbnRgLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEJpbmRpbmcgb3B0aW9ucy4KICAgICAqIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IG9wdGlvbnMuc2NoZW1hCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcHRpb25zLnVwZGF0ZXIgQSBmdW5jdGlvbiB3aGljaCB1cGRhdGVzIHRoZSBET00gKGxpa2UgYXR0cmlidXRlIG9yIHRleHQpLgogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gb3B0aW9ucy5kYXRhIFJlbmRlcmluZyBkYXRhLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9iaW5kVG9PYnNlcnZhYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfYmluZFRvT2JzZXJ2YWJsZShfcmVmKSB7CiAgICAgIHZhciBzY2hlbWEgPSBfcmVmLnNjaGVtYSwKICAgICAgICAgIHVwZGF0ZXIgPSBfcmVmLnVwZGF0ZXIsCiAgICAgICAgICBkYXRhID0gX3JlZi5kYXRhOwogICAgICB2YXIgcmV2ZXJ0RGF0YSA9IGRhdGEucmV2ZXJ0RGF0YTsgLy8gU2V0IGluaXRpYWwgdmFsdWVzLgoKICAgICAgc3luY1ZhbHVlU2NoZW1hVmFsdWUoc2NoZW1hLCB1cGRhdGVyLCBkYXRhKTsKICAgICAgdmFyIHJldmVydEJpbmRpbmdzID0gc2NoZW1hIC8vIEZpbHRlciAiZmFsc3kiIChmYWxzZSwgdW5kZWZpbmVkLCBudWxsLCAnJykgdmFsdWUgc2NoZW1hIGNvbXBvbmVudHMgb3V0LgogICAgICAuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuICFpc0ZhbHN5KGl0ZW0pOwogICAgICB9KSAvLyBGaWx0ZXIgaW5hY3RpdmUgYmluZGluZ3MgZnJvbSBzY2hlbWEsIGxpa2Ugc3RhdGljIHN0cmluZ3MgKCdmb28nKSwgbnVtYmVycyAoNDIpLCBldGMuCiAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5vYnNlcnZhYmxlOwogICAgICB9KSAvLyBPbmNlIG9ubHkgdGhlIGFjdHVhbCBiaW5kaW5nIGFyZSBsZWZ0LCBsZXQgdGhlIGVtaXR0ZXIgbGlzdGVuIHRvIG9ic2VydmFibGUgY2hhbmdlOmF0dHJpYnV0ZSBldmVudC4KICAgICAgLy8gVE9ETzogUmVkdWNlIHRoZSBudW1iZXIgb2YgbGlzdGVuZXJzIGF0dGFjaGVkIGFzIG1hbnkgYmluZGluZ3MgbWF5IGxpc3RlbgogICAgICAvLyB0byB0aGUgc2FtZSBvYnNlcnZhYmxlIGF0dHJpYnV0ZS4KICAgICAgLm1hcChmdW5jdGlvbiAodGVtcGxhdGVCaW5kaW5nKSB7CiAgICAgICAgcmV0dXJuIHRlbXBsYXRlQmluZGluZy5hY3RpdmF0ZUF0dHJpYnV0ZUxpc3RlbmVyKHNjaGVtYSwgdXBkYXRlciwgZGF0YSk7CiAgICAgIH0pOwoKICAgICAgaWYgKHJldmVydERhdGEpIHsKICAgICAgICByZXZlcnREYXRhLmJpbmRpbmdzLnB1c2gocmV2ZXJ0QmluZGluZ3MpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldmVydHMge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhI3JldmVydERhdGEgdGVtcGxhdGUgZGF0YX0gZnJvbSBhIG5vZGUgdG8KICAgICAqIHJldHVybiBpdCB0byB0aGUgb3JpZ2luYWwgc3RhdGUuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHBhcmFtIHtIVE1MRWxlbWVudHxUZXh0fSBub2RlIEEgbm9kZSB0byBiZSByZXZlcnRlZC4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXZlcnREYXRhIEFuIG9iamVjdCB0aGF0IHN0b3JlcyBpbmZvcm1hdGlvbiBhYm91dCB3aGF0IGNoYW5nZXMgaGF2ZSBiZWVuIG1hZGUgYnkKICAgICAqIHtAbGluayAjYXBwbHl9IHRvIHRoZSBub2RlLiBTZWUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJEYXRhI3JldmVydERhdGF9IGZvciBtb3JlIGluZm9ybWF0aW9uLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZXZlcnRUZW1wbGF0ZUZyb21Ob2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmV2ZXJ0VGVtcGxhdGVGcm9tTm9kZShub2RlLCByZXZlcnREYXRhKSB7CiAgICAgIHZhciBfaXRlcmF0b3I0ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocmV2ZXJ0RGF0YS5iaW5kaW5ncyksCiAgICAgICAgICBfc3RlcDQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNC5zKCk7ICEoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgYmluZGluZyA9IF9zdGVwNC52YWx1ZTsKCiAgICAgICAgICAvLyBFYWNoIGJpbmRpbmcgbWF5IGNvbnNpc3Qgb2Ygc2V2ZXJhbCBvYnNlcnZhYmxlK29ic2VydmFibGUjYXR0cmlidXRlLgogICAgICAgICAgLy8gbGlrZSB0aGUgZm9sbG93aW5nIGhhcyAyOgogICAgICAgICAgLy8KICAgICAgICAgIC8vCQljbGFzczogWwogICAgICAgICAgLy8JCQkneCcsCiAgICAgICAgICAvLwkJCWJpbmQudG8oICdmb28nICksCiAgICAgICAgICAvLwkJCSd5JywKICAgICAgICAgIC8vCQkJYmluZC50byggJ2JhcicgKQogICAgICAgICAgLy8JCV0KICAgICAgICAgIC8vCiAgICAgICAgICB2YXIgX2l0ZXJhdG9yNSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGJpbmRpbmcpLAogICAgICAgICAgICAgIF9zdGVwNTsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykgewogICAgICAgICAgICAgIHZhciByZXZlcnRCaW5kaW5nID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgICAgIHJldmVydEJpbmRpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjUuZShlcnIpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2l0ZXJhdG9yNS5mKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I0LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I0LmYoKTsKICAgICAgfQoKICAgICAgaWYgKHJldmVydERhdGEudGV4dCkgewogICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSByZXZlcnREYXRhLnRleHQ7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKHZhciBhdHRyTmFtZSBpbiByZXZlcnREYXRhLmF0dHJpYnV0ZXMpIHsKICAgICAgICB2YXIgYXR0clZhbHVlID0gcmV2ZXJ0RGF0YS5hdHRyaWJ1dGVzW2F0dHJOYW1lXTsgLy8gV2hlbiB0aGUgYXR0cmlidXRlIGhhcyAqKm5vdCoqIGJlZW4gc2V0IGJlZm9yZSAjYXBwbHkoKS4KCiAgICAgICAgaWYgKGF0dHJWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoYXR0ck5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZShhdHRyTmFtZSwgYXR0clZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmV2ZXJ0RGF0YS5jaGlsZHJlbi5sZW5ndGg7ICsraSkgewogICAgICAgIHRoaXMuX3JldmVydFRlbXBsYXRlRnJvbU5vZGUobm9kZS5jaGlsZE5vZGVzW2ldLCByZXZlcnREYXRhLmNoaWxkcmVuW2ldKTsKICAgICAgfQogICAgfQogIH1dLCBbewogICAga2V5OiAiYmluZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYmluZChvYnNlcnZhYmxlLCBlbWl0dGVyKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdG86IGZ1bmN0aW9uIHRvKGV2ZW50TmFtZU9yRnVuY3Rpb25PckF0dHJpYnV0ZSwgY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybiBuZXcgVGVtcGxhdGVUb0JpbmRpbmcoewogICAgICAgICAgICBldmVudE5hbWVPckZ1bmN0aW9uOiBldmVudE5hbWVPckZ1bmN0aW9uT3JBdHRyaWJ1dGUsCiAgICAgICAgICAgIGF0dHJpYnV0ZTogZXZlbnROYW1lT3JGdW5jdGlvbk9yQXR0cmlidXRlLAogICAgICAgICAgICBvYnNlcnZhYmxlOiBvYnNlcnZhYmxlLAogICAgICAgICAgICBlbWl0dGVyOiBlbWl0dGVyLAogICAgICAgICAgICBjYWxsYmFjazogY2FsbGJhY2sKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgaWY6IGZ1bmN0aW9uIF9pZihhdHRyaWJ1dGUsIHZhbHVlSWZUcnVlLCBjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIG5ldyBUZW1wbGF0ZUlmQmluZGluZyh7CiAgICAgICAgICAgIG9ic2VydmFibGU6IG9ic2VydmFibGUsCiAgICAgICAgICAgIGVtaXR0ZXI6IGVtaXR0ZXIsCiAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlLAogICAgICAgICAgICB2YWx1ZUlmVHJ1ZTogdmFsdWVJZlRydWUsCiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjawogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmRzIGFuIGV4aXN0aW5nIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGV9IGluc3RhbmNlIHdpdGggc29tZSBhZGRpdGlvbmFsIGNvbnRlbnQKICAgICAqIGZyb20gYW5vdGhlciB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCiAgICAgKgogICAgICoJCWNvbnN0IGJpbmQgPSBUZW1wbGF0ZS5iaW5kKCBvYnNlcnZhYmxlLCBlbWl0dGVyICk7CiAgICAgKgogICAgICoJCWNvbnN0IHRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKCB7CiAgICAgKgkJCXRhZzogJ3AnLAogICAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICAgKgkJCQljbGFzczogJ2EnLAogICAgICoJCQkJZGF0YS14OiBiaW5kLnRvKCAnZm9vJyApCiAgICAgKgkJCX0sCiAgICAgKgkJCWNoaWxkcmVuOiBbCiAgICAgKgkJCQl7CiAgICAgKgkJCQkJdGFnOiAnc3BhbicsCiAgICAgKgkJCQkJYXR0cmlidXRlczogewogICAgICoJCQkJCQljbGFzczogJ2InCiAgICAgKgkJCQkJfSwKICAgICAqCQkJCQljaGlsZHJlbjogWwogICAgICoJCQkJCQknU3BhbicKICAgICAqCQkJCQldCiAgICAgKgkJCQl9CiAgICAgKgkJCV0KICAgICAqCQkgfSApOwogICAgICoKICAgICAqCQkvLyBJbnN0YW5jZS1sZXZlbCBleHRlbnNpb24uCiAgICAgKgkJVGVtcGxhdGUuZXh0ZW5kKCB0ZW1wbGF0ZSwgewogICAgICoJCQlhdHRyaWJ1dGVzOiB7CiAgICAgKgkJCQljbGFzczogJ2InLAogICAgICoJCQkJZGF0YS14OiBiaW5kLnRvKCAnYmFyJyApCiAgICAgKgkJCX0sCiAgICAgKgkJCWNoaWxkcmVuOiBbCiAgICAgKgkJCQl7CiAgICAgKgkJCQkJYXR0cmlidXRlczogewogICAgICoJCQkJCQljbGFzczogJ2MnCiAgICAgKgkJCQkJfQogICAgICoJCQkJfQogICAgICoJCQldCiAgICAgKgkJfSApOwogICAgICoKICAgICAqCQkvLyBDaGlsZCBleHRlbnNpb24uCiAgICAgKgkJVGVtcGxhdGUuZXh0ZW5kKCB0ZW1wbGF0ZS5jaGlsZHJlblsgMCBdLCB7CiAgICAgKgkJCWF0dHJpYnV0ZXM6IHsKICAgICAqCQkJCWNsYXNzOiAnZCcKICAgICAqCQkJfQogICAgICoJCX0gKTsKICAgICAqCiAgICAgKiB0aGUgYG91dGVySFRNTGAgb2YgYHRlbXBsYXRlLnJlbmRlcigpYCBpczoKICAgICAqCiAgICAgKgkJPHAgY2xhc3M9ImEgYiIgZGF0YS14PSJ7IG9ic2VydmFibGUuZm9vIH0geyBvYnNlcnZhYmxlLmJhciB9Ij4KICAgICAqCQkJPHNwYW4gY2xhc3M9ImIgYyBkIj5TcGFuPC9zcGFuPgogICAgICoJCTwvcD4KICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gdGVtcGxhdGUgQW4gZXhpc3RpbmcgdGVtcGxhdGUgaW5zdGFuY2UgdG8gYmUgZXh0ZW5kZWQuCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IGRlZiBBZGRpdGlvbmFsIGRlZmluaXRpb24gdG8gYmUgYXBwbGllZCB0byBhIHRlbXBsYXRlLgogICAgICovCgogIH0sIHsKICAgIGtleTogImV4dGVuZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXh0ZW5kKHRlbXBsYXRlLCBkZWYpIHsKICAgICAgaWYgKHRlbXBsYXRlLl9pc1JlbmRlcmVkKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogRXh0ZW5kaW5nIGEgdGVtcGxhdGUgYWZ0ZXIgcmVuZGVyaW5nIG1heSBub3Qgd29yayBhcyBleHBlY3RlZC4gVG8gbWFrZSBzdXJlCiAgICAgICAgICogdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUuZXh0ZW5kIGV4dGVuZGluZ30gd29ya3MgZm9yIGFuIGVsZW1lbnQsCiAgICAgICAgICogbWFrZSBzdXJlIGl0IGhhcHBlbnMgYmVmb3JlIHtAbGluayAjcmVuZGVyfSBpcyBjYWxsZWQuCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgdGVtcGxhdGUtZXh0ZW5kLXJlbmRlcgogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd0ZW1wbGF0ZS1leHRlbmQtcmVuZGVyJywgW3RoaXMsIHRlbXBsYXRlXSk7CiAgICAgIH0KCiAgICAgIGV4dGVuZFRlbXBsYXRlKHRlbXBsYXRlLCBub3JtYWxpemUoY2xvbmUoZGVmKSkpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFRlbXBsYXRlOwp9KCk7CgpleHBvcnQgeyBUZW1wbGF0ZSBhcyBkZWZhdWx0IH07Cm1peChUZW1wbGF0ZSwgRW1pdHRlck1peGluKTsKLyoqCiAqIERlc2NyaWJlcyBhIGJpbmRpbmcgY3JlYXRlZCBieSB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZS5iaW5kfSBpbnRlcmZhY2UuCiAqCiAqIEBwcm90ZWN0ZWQKICovCgpleHBvcnQgdmFyIFRlbXBsYXRlQmluZGluZyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9IGNsYXNzLgogICAqCiAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYgVGhlIGRlZmluaXRpb24gb2YgdGhlIGJpbmRpbmcuCiAgICovCiAgZnVuY3Rpb24gVGVtcGxhdGVCaW5kaW5nKGRlZikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRlbXBsYXRlQmluZGluZyk7CgogICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkZWYpOwogICAgLyoqCiAgICAgKiBBbiBvYnNlcnZhYmxlIGluc3RhbmNlIG9mIHRoZSBiaW5kaW5nLiBJdCBlaXRoZXI6CiAgICAgKgogICAgICogKiBwcm92aWRlcyB0aGUgYXR0cmlidXRlIHdpdGggdGhlIHZhbHVlLAogICAgICogKiBvciBwYXNzZXMgdGhlIGV2ZW50IHdoZW4gYSBjb3JyZXNwb25kaW5nIERPTSBldmVudCBpcyBmaXJlZC4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbn0gbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuIHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJ9IHVzZWQgYnkgdGhlIGJpbmRpbmcgdG86CiAgICAgKgogICAgICogKiBsaXN0ZW4gdG8gdGhlIGF0dHJpYnV0ZSBjaGFuZ2UgaW4gdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI29ic2VydmFibGV9LAogICAgICogKiBvciBsaXN0ZW4gdG8gdGhlIGV2ZW50IGluIHRoZSBET00uCiAgICAgKgogICAgICogQG1lbWJlciB7bW9kdWxlOnV0aWxzL2VtaXR0ZXJtaXhpbn5FbWl0dGVyTWl4aW59IG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjZW1pdHRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjb2JzZXJ2YWJsZSBvYnNlcnZlZCBhdHRyaWJ1dGV9LgogICAgICoKICAgICAqIEBtZW1iZXIge1N0cmluZ30gbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGUKICAgICAqLwoKICAgIC8qKgogICAgICogQSBjdXN0b20gZnVuY3Rpb24gdG8gcHJvY2VzcyB0aGUgdmFsdWUgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2F0dHJpYnV0ZX0uCiAgICAgKgogICAgICogQG1lbWJlciB7RnVuY3Rpb259IFttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2NhbGxiYWNrXQogICAgICovCiAgfQogIC8qKgogICAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBiaW5kaW5nLiBJdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2F0dHJpYnV0ZX0gaW4KICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlfS4gVGhlIHZhbHVlIG1heSBiZSBwcm9jZXNzZWQgYnkgdGhlCiAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjY2FsbGJhY2t9LCBpZiBzdWNoIGhhcyBiZWVuIHBhc3NlZCB0byB0aGUgYmluZGluZy4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gW25vZGVdIEEgbmF0aXZlIERPTSBub2RlLCBwYXNzZWQgdG8gdGhlIGN1c3RvbSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNjYWxsYmFja30uCiAgICogQHJldHVybnMgeyp9IFRoZSB2YWx1ZSBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGV9IGluCiAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjb2JzZXJ2YWJsZX0uCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoVGVtcGxhdGVCaW5kaW5nLCBbewogICAga2V5OiAiZ2V0VmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKG5vZGUpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5vYnNlcnZhYmxlW3RoaXMuYXR0cmlidXRlXTsKICAgICAgcmV0dXJuIHRoaXMuY2FsbGJhY2sgPyB0aGlzLmNhbGxiYWNrKHZhbHVlLCBub2RlKSA6IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBBY3RpdmF0ZXMgdGhlIGxpc3RlbmVyIHdoaWNoIHdhaXRzIGZvciBjaGFuZ2VzIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNhdHRyaWJ1dGV9IGluCiAgICAgKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZyNvYnNlcnZhYmxlfSwgdGhlbiB1cGRhdGVzIHRoZSBET00gd2l0aCB0aGUgYWdncmVnYXRlZAogICAgICogdmFsdWUgb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfS4KICAgICAqCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBzY2hlbWEgQSBmdWxsIHNjaGVtYSB0byBnZW5lcmF0ZSBhbiBhdHRyaWJ1dGUgb3IgdGV4dCBpbiB0aGUgRE9NLgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gdXBkYXRlciBBIERPTSB1cGRhdGVyIGZ1bmN0aW9uIHVzZWQgdG8gdXBkYXRlIHRoZSBuYXRpdmUgRE9NIGF0dHJpYnV0ZSBvciB0ZXh0LgogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byBzZXZlciB0aGUgbGlzdGVuZXIgYmluZGluZy4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhY3RpdmF0ZUF0dHJpYnV0ZUxpc3RlbmVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhY3RpdmF0ZUF0dHJpYnV0ZUxpc3RlbmVyKHNjaGVtYSwgdXBkYXRlciwgZGF0YSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKCkgewogICAgICAgIHJldHVybiBzeW5jVmFsdWVTY2hlbWFWYWx1ZShzY2hlbWEsIHVwZGF0ZXIsIGRhdGEpOwogICAgICB9OwoKICAgICAgdGhpcy5lbWl0dGVyLmxpc3RlblRvKHRoaXMub2JzZXJ2YWJsZSwgJ2NoYW5nZTonICsgdGhpcy5hdHRyaWJ1dGUsIGNhbGxiYWNrKTsgLy8gQWxsb3dzIHJldmVydCBvZiB0aGUgbGlzdGVuZXIuCgogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5lbWl0dGVyLnN0b3BMaXN0ZW5pbmcoX3RoaXMyLm9ic2VydmFibGUsICdjaGFuZ2U6JyArIF90aGlzMi5hdHRyaWJ1dGUsIGNhbGxiYWNrKTsKICAgICAgfTsKICAgIH0KICB9XSk7CgogIHJldHVybiBUZW1wbGF0ZUJpbmRpbmc7Cn0oKTsKLyoqCiAqIERlc2NyaWJlcyBlaXRoZXI6CiAqCiAqICogYSBiaW5kaW5nIHRvIGFuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9LAogKiAqIG9yIGEgbmF0aXZlIERPTSBldmVudCBiaW5kaW5nLgogKgogKiBJdCBpcyBjcmVhdGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiN0b30gbWV0aG9kLgogKgogKiBAcHJvdGVjdGVkCiAqLwoKZXhwb3J0IHZhciBUZW1wbGF0ZVRvQmluZGluZyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1RlbXBsYXRlQmluZGluZykgewogIF9pbmhlcml0cyhUZW1wbGF0ZVRvQmluZGluZywgX1RlbXBsYXRlQmluZGluZyk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoVGVtcGxhdGVUb0JpbmRpbmcpOwoKICBmdW5jdGlvbiBUZW1wbGF0ZVRvQmluZGluZygpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUZW1wbGF0ZVRvQmluZGluZyk7CgogICAgcmV0dXJuIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFRlbXBsYXRlVG9CaW5kaW5nLCBbewogICAga2V5OiAiYWN0aXZhdGVEb21FdmVudExpc3RlbmVyIiwKICAgIHZhbHVlOgogICAgLyoqCiAgICAgKiBBY3RpdmF0ZXMgdGhlIGxpc3RlbmVyIGZvciB0aGUgbmF0aXZlIERPTSBldmVudCwgd2hpY2ggd2hlbiBmaXJlZCwgaXMgcHJvcGFnYXRlZCBieQogICAgICogdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nI2VtaXR0ZXJ9LgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkb21FdnROYW1lIFRoZSBuYW1lIG9mIHRoZSBuYXRpdmUgRE9NIGV2ZW50LgogICAgICogQHBhcmFtIHtTdHJpbmd9IGRvbVNlbGVjdG9yIFRoZSBzZWxlY3RvciBpbiB0aGUgRE9NIHRvIGZpbHRlciBkZWxlZ2F0ZWQgZXZlbnRzLgogICAgICogQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+UmVuZGVyRGF0YX0gZGF0YSBSZW5kZXJpbmcgZGF0YS4KICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byBzZXZlciB0aGUgbGlzdGVuZXIgYmluZGluZy4KICAgICAqLwogICAgZnVuY3Rpb24gYWN0aXZhdGVEb21FdmVudExpc3RlbmVyKGRvbUV2dE5hbWUsIGRvbVNlbGVjdG9yLCBkYXRhKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24gY2FsbGJhY2soZXZ0LCBkb21FdnQpIHsKICAgICAgICBpZiAoIWRvbVNlbGVjdG9yIHx8IGRvbUV2dC50YXJnZXQubWF0Y2hlcyhkb21TZWxlY3RvcikpIHsKICAgICAgICAgIGlmICh0eXBlb2YgX3RoaXMzLmV2ZW50TmFtZU9yRnVuY3Rpb24gPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBfdGhpczMuZXZlbnROYW1lT3JGdW5jdGlvbihkb21FdnQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMzLm9ic2VydmFibGUuZmlyZShfdGhpczMuZXZlbnROYW1lT3JGdW5jdGlvbiwgZG9tRXZ0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICB0aGlzLmVtaXR0ZXIubGlzdGVuVG8oZGF0YS5ub2RlLCBkb21FdnROYW1lLCBjYWxsYmFjayk7IC8vIEFsbG93cyByZXZlcnQgb2YgdGhlIGxpc3RlbmVyLgoKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczMuZW1pdHRlci5zdG9wTGlzdGVuaW5nKGRhdGEubm9kZSwgZG9tRXZ0TmFtZSwgY2FsbGJhY2spOwogICAgICB9OwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFRlbXBsYXRlVG9CaW5kaW5nOwp9KFRlbXBsYXRlQmluZGluZyk7Ci8qKgogKiBEZXNjcmliZXMgYSBiaW5kaW5nIHRvIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbn0gY3JlYXRlZCBieSB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jaWZ9CiAqIG1ldGhvZC4KICoKICogQHByb3RlY3RlZAogKi8KCmV4cG9ydCB2YXIgVGVtcGxhdGVJZkJpbmRpbmcgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9UZW1wbGF0ZUJpbmRpbmcyKSB7CiAgX2luaGVyaXRzKFRlbXBsYXRlSWZCaW5kaW5nLCBfVGVtcGxhdGVCaW5kaW5nMik7CgogIHZhciBfc3VwZXIyID0gX2NyZWF0ZVN1cGVyKFRlbXBsYXRlSWZCaW5kaW5nKTsKCiAgZnVuY3Rpb24gVGVtcGxhdGVJZkJpbmRpbmcoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVGVtcGxhdGVJZkJpbmRpbmcpOwoKICAgIHJldHVybiBfc3VwZXIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoVGVtcGxhdGVJZkJpbmRpbmcsIFt7CiAgICBrZXk6ICJnZXRWYWx1ZSIsCiAgICB2YWx1ZToKICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VmFsdWUobm9kZSkgewogICAgICB2YXIgdmFsdWUgPSBfZ2V0KF9nZXRQcm90b3R5cGVPZihUZW1wbGF0ZUlmQmluZGluZy5wcm90b3R5cGUpLCAiZ2V0VmFsdWUiLCB0aGlzKS5jYWxsKHRoaXMsIG5vZGUpOwoKICAgICAgcmV0dXJuIGlzRmFsc3kodmFsdWUpID8gZmFsc2UgOiB0aGlzLnZhbHVlSWZUcnVlIHx8IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRoZSB2YWx1ZSBvZiB0aGUgRE9NIGF0dHJpYnV0ZSBvciB0ZXh0IHRvIGJlIHNldCBpZiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjYXR0cmlidXRlfSBpbgogICAgICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmcjb2JzZXJ2YWJsZX0gaXMgYHRydWVgLgogICAgICoKICAgICAqIEBtZW1iZXIge1N0cmluZ30gW21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUlmQmluZGluZyN2YWx1ZUlmVHJ1ZV0KICAgICAqLwoKICB9XSk7CgogIHJldHVybiBUZW1wbGF0ZUlmQmluZGluZzsKfShUZW1wbGF0ZUJpbmRpbmcpOyAvLyBDaGVja3Mgd2hldGhlciBnaXZlbiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IGNvbnRhaW5zIGEKLy8ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9LgovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBzY2hlbWEKLy8gQHJldHVybnMge0Jvb2xlYW59CgpmdW5jdGlvbiBoYXNUZW1wbGF0ZUJpbmRpbmcoc2NoZW1hKSB7CiAgaWYgKCFzY2hlbWEpIHsKICAgIHJldHVybiBmYWxzZTsKICB9IC8vIE5vcm1hbGl6ZSBhdHRyaWJ1dGVzIHdpdGggYWRkaXRpb25hbCBkYXRhIGxpa2UgbmFtZXNwYWNlOgogIC8vCiAgLy8JCWNsYXNzOiB7CiAgLy8JCQluczogJ2FiYycsCiAgLy8JCQl2YWx1ZTogWyAuLi4gXQogIC8vCQl9CiAgLy8KCgogIGlmIChzY2hlbWEudmFsdWUpIHsKICAgIHNjaGVtYSA9IHNjaGVtYS52YWx1ZTsKICB9CgogIGlmIChBcnJheS5pc0FycmF5KHNjaGVtYSkpIHsKICAgIHJldHVybiBzY2hlbWEuc29tZShoYXNUZW1wbGF0ZUJpbmRpbmcpOwogIH0gZWxzZSBpZiAoc2NoZW1hIGluc3RhbmNlb2YgVGVtcGxhdGVCaW5kaW5nKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIHJldHVybiBmYWxzZTsKfSAvLyBBc3NlbWJsZXMgdGhlIHZhbHVlIHVzaW5nIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0gYW5kIHN0b3JlcyBpdCBpbiBhIGZvcm0gb2YKLy8gYW4gQXJyYXkuIEVhY2ggZW50cnkgb2YgdGhlIEFycmF5IGNvcnJlc3BvbmRzIHRvIG9uZSBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9Ci8vIGl0ZW1zLgovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBzY2hlbWEKLy8gQHBhcmFtIHtOb2RlfSBub2RlIERPTSBOb2RlIHVwZGF0ZWQgd2hlbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlTWl4aW59IGNoYW5nZXMuCi8vIEByZXR1cm5zIHtBcnJheX0KCgpmdW5jdGlvbiBnZXRWYWx1ZVNjaGVtYVZhbHVlKHNjaGVtYSwgbm9kZSkgewogIHJldHVybiBzY2hlbWEubWFwKGZ1bmN0aW9uIChzY2hlbWFJdGVtKSB7CiAgICAvLyBQcm9jZXNzIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSBiaW5kaW5ncy4KICAgIGlmIChzY2hlbWFJdGVtIGluc3RhbmNlb2YgVGVtcGxhdGVCaW5kaW5nKSB7CiAgICAgIHJldHVybiBzY2hlbWFJdGVtLmdldFZhbHVlKG5vZGUpOwogICAgfSAvLyBBbGwgc3RhdGljIHZhbHVlcyBsaWtlIHN0cmluZ3MsIG51bWJlcnMsIGFuZCAiZmFsc3kiIHZhbHVlcyAoZmFsc2UsIG51bGwsIHVuZGVmaW5lZCwgJycsIGV0Yy4pIGp1c3QgcGFzcy4KCgogICAgcmV0dXJuIHNjaGVtYUl0ZW07CiAgfSk7Cn0gLy8gQSBmdW5jdGlvbiBleGVjdXRlZCBlYWNoIHRpbWUgdGhlIGJvdW5kIE9ic2VydmFibGUgYXR0cmlidXRlIGNoYW5nZXMsIHdoaWNoIHVwZGF0ZXMgdGhlIERPTSB3aXRoIGEgdmFsdWUKLy8gY29uc3RydWN0ZWQgZnJvbSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9LgovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBzY2hlbWEKLy8gQHBhcmFtIHtGdW5jdGlvbn0gdXBkYXRlciBBIGZ1bmN0aW9uIHdoaWNoIHVwZGF0ZXMgdGhlIERPTSAobGlrZSBhdHRyaWJ1dGUgb3IgdGV4dCkuCi8vIEBwYXJhbSB7Tm9kZX0gbm9kZSBET00gTm9kZSB1cGRhdGVkIHdoZW4ge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZU1peGlufSBjaGFuZ2VzLgoKCmZ1bmN0aW9uIHN5bmNWYWx1ZVNjaGVtYVZhbHVlKHNjaGVtYSwgdXBkYXRlciwgX3JlZjIpIHsKICB2YXIgbm9kZSA9IF9yZWYyLm5vZGU7CiAgdmFyIHZhbHVlID0gZ2V0VmFsdWVTY2hlbWFWYWx1ZShzY2hlbWEsIG5vZGUpOyAvLyBDaGVjayBpZiBzY2hlbWEgaXMgYSBzaW5nbGUgVGVtcGxhdGUuYmluZC5pZiwgbGlrZToKICAvLwogIC8vCQljbGFzczogVGVtcGxhdGUuYmluZC5pZiggJ2ZvbycgKQogIC8vCgogIGlmIChzY2hlbWEubGVuZ3RoID09IDEgJiYgc2NoZW1hWzBdIGluc3RhbmNlb2YgVGVtcGxhdGVJZkJpbmRpbmcpIHsKICAgIHZhbHVlID0gdmFsdWVbMF07CiAgfSBlbHNlIHsKICAgIHZhbHVlID0gdmFsdWUucmVkdWNlKGFycmF5VmFsdWVSZWR1Y2VyLCAnJyk7CiAgfQoKICBpZiAoaXNGYWxzeSh2YWx1ZSkpIHsKICAgIHVwZGF0ZXIucmVtb3ZlKCk7CiAgfSBlbHNlIHsKICAgIHVwZGF0ZXIuc2V0KHZhbHVlKTsKICB9Cn0gLy8gUmV0dXJucyBhbiBvYmplY3QgY29uc2lzdGluZyBvZiBgc2V0YCBhbmQgYHJlbW92ZWAgZnVuY3Rpb25zLCB3aGljaAovLyBjYW4gYmUgdXNlZCBpbiB0aGUgY29udGV4dCBvZiBET00gTm9kZSB0byBzZXQgb3IgcmVzZXQgYHRleHRDb250ZW50YC4KLy8gQHNlZSBtb2R1bGU6dWkvdmlld35WaWV3I19iaW5kVG9PYnNlcnZhYmxlCi8vCi8vIEBwYXJhbSB7Tm9kZX0gbm9kZSBET00gTm9kZSB0byBiZSBtb2RpZmllZC4KLy8gQHJldHVybnMge09iamVjdH0KCgpmdW5jdGlvbiBnZXRUZXh0VXBkYXRlcihub2RlKSB7CiAgcmV0dXJuIHsKICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CiAgICAgIG5vZGUudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgIH0sCiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZSgpIHsKICAgICAgbm9kZS50ZXh0Q29udGVudCA9ICcnOwogICAgfQogIH07Cn0gLy8gUmV0dXJucyBhbiBvYmplY3QgY29uc2lzdGluZyBvZiBgc2V0YCBhbmQgYHJlbW92ZWAgZnVuY3Rpb25zLCB3aGljaAovLyBjYW4gYmUgdXNlZCBpbiB0aGUgY29udGV4dCBvZiBET00gTm9kZSB0byBzZXQgb3IgcmVzZXQgYW4gYXR0cmlidXRlLgovLyBAc2VlIG1vZHVsZTp1aS92aWV3flZpZXcjX2JpbmRUb09ic2VydmFibGUKLy8KLy8gQHBhcmFtIHtOb2RlfSBub2RlIERPTSBOb2RlIHRvIGJlIG1vZGlmaWVkLgovLyBAcGFyYW0ge1N0cmluZ30gYXR0ck5hbWUgTmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIGJlIG1vZGlmaWVkLgovLyBAcGFyYW0ge1N0cmluZ30gW25zPW51bGxdIE5hbWVzcGFjZSB0byB1c2UuCi8vIEByZXR1cm5zIHtPYmplY3R9CgoKZnVuY3Rpb24gZ2V0QXR0cmlidXRlVXBkYXRlcihlbCwgYXR0ck5hbWUsIG5zKSB7CiAgcmV0dXJuIHsKICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZU5TKG5zLCBhdHRyTmFtZSwgdmFsdWUpOwogICAgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICBlbC5yZW1vdmVBdHRyaWJ1dGVOUyhucywgYXR0ck5hbWUpOwogICAgfQogIH07Cn0gLy8gUmV0dXJucyBhbiBvYmplY3QgY29uc2lzdGluZyBvZiBgc2V0YCBhbmQgYHJlbW92ZWAgZnVuY3Rpb25zLCB3aGljaAovLyBjYW4gYmUgdXNlZCBpbiB0aGUgY29udGV4dCBvZiBDU1NTdHlsZURlY2xhcmF0aW9uIHRvIHNldCBvciByZW1vdmUgYSBzdHlsZS4KLy8gQHNlZSBtb2R1bGU6dWkvdmlld35WaWV3I19iaW5kVG9PYnNlcnZhYmxlCi8vCi8vIEBwYXJhbSB7Tm9kZX0gbm9kZSBET00gTm9kZSB0byBiZSBtb2RpZmllZC4KLy8gQHBhcmFtIHtTdHJpbmd9IHN0eWxlTmFtZSBOYW1lIG9mIHRoZSBzdHlsZSB0byBiZSBtb2RpZmllZC4KLy8gQHJldHVybnMge09iamVjdH0KCgpmdW5jdGlvbiBnZXRTdHlsZVVwZGF0ZXIoZWwsIHN0eWxlTmFtZSkgewogIHJldHVybiB7CiAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewogICAgICBlbC5zdHlsZVtzdHlsZU5hbWVdID0gdmFsdWU7CiAgICB9LAogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7CiAgICAgIGVsLnN0eWxlW3N0eWxlTmFtZV0gPSBudWxsOwogICAgfQogIH07Cn0gLy8gQ2xvbmVzIGRlZmluaXRpb24gb2YgdGhlIHRlbXBsYXRlLgovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IGRlZgovLyBAcmV0dXJucyB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0KCgpmdW5jdGlvbiBjbG9uZShkZWYpIHsKICB2YXIgY2xvbmUgPSBjbG9uZURlZXBXaXRoKGRlZiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAvLyBEb24ndCBjbG9uZSB0aGUgYFRlbXBsYXRlLmJpbmRgKiBiaW5kaW5ncyBiZWNhdXNlIG9mIHRoZSByZWZlcmVuY2VzIHRvIE9ic2VydmFibGUKICAgIC8vIGFuZCBEb21FbWl0dGVyTWl4aW4gaW5zdGFuY2VzIGluc2lkZSwgd2hpY2ggd291bGQgYWxzbyBiZSB0cmF2ZXJzZWQgYW5kIGNsb25lZCBieSBncmVlZHkKICAgIC8vIGNsb25lRGVlcFdpdGggYWxnb3JpdGhtLiBUaGVyZSdzIG5vIHBvaW50IGluIGNsb25pbmcgT2JzZXJ2YWJsZS9Eb21FbWl0dGVyTWl4aW5zCiAgICAvLyBhbG9uZyB3aXRoIHRoZSBkZWZpbml0aW9uLgogICAgLy8KICAgIC8vIERvbid0IGNsb25lIFRlbXBsYXRlIGluc3RhbmNlcyBpZiBwcm92aWRlZCBhcyBhIGNoaWxkLiBUaGV5J3JlIHNpbXBseSAjcmVuZGVyKCllZAogICAgLy8gYW5kIG5vdGhpbmcgc2hvdWxkIGludGVyZmVyZS4KICAgIC8vCiAgICAvLyBBbHNvIGRvbid0IGNsb25lIFZpZXcgaW5zdGFuY2VzIGlmIHByb3ZpZGVkIGFzIGEgY2hpbGQgb2YgdGhlIFRlbXBsYXRlLiBUaGUgdGVtcGxhdGUKICAgIC8vIGluc3RhbmNlIHdpbGwgYmUgZXh0cmFjdGVkIGZyb20gdGhlIFZpZXcgZHVyaW5nIHRoZSBub3JtYWxpemF0aW9uIGFuZCB0aGVyZSdzIG5vIG5lZWQKICAgIC8vIHRvIGNsb25lIGl0LgogICAgaWYgKHZhbHVlICYmICh2YWx1ZSBpbnN0YW5jZW9mIFRlbXBsYXRlQmluZGluZyB8fCBpc1RlbXBsYXRlKHZhbHVlKSB8fCBpc1ZpZXcodmFsdWUpIHx8IGlzVmlld0NvbGxlY3Rpb24odmFsdWUpKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgfSk7CiAgcmV0dXJuIGNsb25lOwp9IC8vIE5vcm1hbGl6ZXMgZ2l2ZW4ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259LgovLwovLyBTZWU6Ci8vICAqIHtAbGluayBub3JtYWxpemVBdHRyaWJ1dGVzfQovLyAgKiB7QGxpbmsgbm9ybWFsaXplTGlzdGVuZXJzfQovLyAgKiB7QGxpbmsgbm9ybWFsaXplUGxhaW5UZXh0RGVmaW5pdGlvbn0KLy8gICoge0BsaW5rIG5vcm1hbGl6ZVRleHREZWZpbml0aW9ufQovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IGRlZgovLyBAcmV0dXJucyB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gTm9ybWFsaXplZCBkZWZpbml0aW9uLgoKCmZ1bmN0aW9uIG5vcm1hbGl6ZShkZWYpIHsKICBpZiAodHlwZW9mIGRlZiA9PSAnc3RyaW5nJykgewogICAgZGVmID0gbm9ybWFsaXplUGxhaW5UZXh0RGVmaW5pdGlvbihkZWYpOwogIH0gZWxzZSBpZiAoZGVmLnRleHQpIHsKICAgIG5vcm1hbGl6ZVRleHREZWZpbml0aW9uKGRlZik7CiAgfQoKICBpZiAoZGVmLm9uKSB7CiAgICBkZWYuZXZlbnRMaXN0ZW5lcnMgPSBub3JtYWxpemVMaXN0ZW5lcnMoZGVmLm9uKTsgLy8gVGVtcGxhdGUgbWl4ZXMgRW1pdHRlck1peGluLCBzbyBkZWxldGUgI29uIHRvIGF2b2lkIGNvbGxpc2lvbi4KCiAgICBkZWxldGUgZGVmLm9uOwogIH0KCiAgaWYgKCFkZWYudGV4dCkgewogICAgaWYgKGRlZi5hdHRyaWJ1dGVzKSB7CiAgICAgIG5vcm1hbGl6ZUF0dHJpYnV0ZXMoZGVmLmF0dHJpYnV0ZXMpOwogICAgfQoKICAgIHZhciBjaGlsZHJlbiA9IFtdOwoKICAgIGlmIChkZWYuY2hpbGRyZW4pIHsKICAgICAgaWYgKGlzVmlld0NvbGxlY3Rpb24oZGVmLmNoaWxkcmVuKSkgewogICAgICAgIGNoaWxkcmVuLnB1c2goZGVmLmNoaWxkcmVuKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgX2l0ZXJhdG9yNiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGRlZi5jaGlsZHJlbiksCiAgICAgICAgICAgIF9zdGVwNjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBjaGlsZCA9IF9zdGVwNi52YWx1ZTsKCiAgICAgICAgICAgIGlmIChpc1RlbXBsYXRlKGNoaWxkKSB8fCBpc1ZpZXcoY2hpbGQpIHx8IGlzTm9kZShjaGlsZCkpIHsKICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKG5ldyBUZW1wbGF0ZShjaGlsZCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfaXRlcmF0b3I2LmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yNi5mKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZGVmLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgfQoKICByZXR1cm4gZGVmOwp9IC8vIE5vcm1hbGl6ZXMgImF0dHJpYnV0ZXMiIHNlY3Rpb24gb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259LgovLwovLwkJYXR0cmlidXRlczogewovLwkJCWE6ICdiYXInLAovLwkJCWI6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSwKLy8JCQljOiB7Ci8vCQkJCXZhbHVlOiAnYmFyJwovLwkJCX0KLy8JCX0KLy8KLy8gYmVjb21lcwovLwovLwkJYXR0cmlidXRlczogewovLwkJCWE6IFsgJ2JhcicgXSwKLy8JCQliOiBbIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSBdLAovLwkJCWM6IHsKLy8JCQkJdmFsdWU6IFsgJ2JhcicgXQovLwkJCX0KLy8JCX0KLy8KLy8gQHBhcmFtIHtPYmplY3R9IGF0dHJpYnV0ZXMKCgpmdW5jdGlvbiBub3JtYWxpemVBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMpIHsKICBmb3IgKHZhciBhIGluIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChhdHRyaWJ1dGVzW2FdLnZhbHVlKSB7CiAgICAgIGF0dHJpYnV0ZXNbYV0udmFsdWUgPSB0b0FycmF5KGF0dHJpYnV0ZXNbYV0udmFsdWUpOwogICAgfQoKICAgIGFycmF5aWZ5KGF0dHJpYnV0ZXMsIGEpOwogIH0KfSAvLyBOb3JtYWxpemVzICJvbiIgc2VjdGlvbiBvZiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCi8vCi8vCQlvbjogewovLwkJCWE6ICdiYXInLAovLwkJCWI6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSwKLy8JCQljOiBbIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSwgKCkgPT4geyAuLi4gfSBdCi8vCQl9Ci8vCi8vIGJlY29tZXMKLy8KLy8JCW9uOiB7Ci8vCQkJYTogWyAnYmFyJyBdLAovLwkJCWI6IFsge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9IF0sCi8vCQkJYzogWyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30sICgpID0+IHsgLi4uIH0gXQovLwkJfQovLwovLyBAcGFyYW0ge09iamVjdH0gbGlzdGVuZXJzCi8vIEByZXR1cm5zIHtPYmplY3R9IE9iamVjdCBjb250YWluaW5nIG5vcm1hbGl6ZWQgbGlzdGVuZXJzLgoKCmZ1bmN0aW9uIG5vcm1hbGl6ZUxpc3RlbmVycyhsaXN0ZW5lcnMpIHsKICBmb3IgKHZhciBsIGluIGxpc3RlbmVycykgewogICAgYXJyYXlpZnkobGlzdGVuZXJzLCBsKTsKICB9CgogIHJldHVybiBsaXN0ZW5lcnM7Cn0gLy8gTm9ybWFsaXplcyAic3RyaW5nIiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCi8vCi8vCQkiZm9vIgovLwovLyBiZWNvbWVzCi8vCi8vCQl7IHRleHQ6IFsgJ2ZvbycgXSB9LAovLwovLyBAcGFyYW0ge1N0cmluZ30gZGVmCi8vIEByZXR1cm5zIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBOb3JtYWxpemVkIHRlbXBsYXRlIGRlZmluaXRpb24uCgoKZnVuY3Rpb24gbm9ybWFsaXplUGxhaW5UZXh0RGVmaW5pdGlvbihkZWYpIHsKICByZXR1cm4gewogICAgdGV4dDogW2RlZl0KICB9Owp9IC8vIE5vcm1hbGl6ZXMgdGV4dCB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0uCi8vCi8vCQljaGlsZHJlbjogWwovLwkJCXsgdGV4dDogJ2RlZicgfSwKLy8JCQl7IHRleHQ6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVCaW5kaW5nfSB9Ci8vCQldCi8vCi8vIGJlY29tZXMKLy8KLy8JCWNoaWxkcmVuOiBbCi8vCQkJeyB0ZXh0OiBbICdkZWYnIF0gfSwKLy8JCQl7IHRleHQ6IFsge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9IF0gfQovLwkJXQovLwovLyBAcGFyYW0ge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259IGRlZgoKCmZ1bmN0aW9uIG5vcm1hbGl6ZVRleHREZWZpbml0aW9uKGRlZikgewogIGRlZi50ZXh0ID0gdG9BcnJheShkZWYudGV4dCk7Cn0gLy8gV3JhcHMgYW4gZW50cnkgaW4gT2JqZWN0IGluIGFuIEFycmF5LCBpZiBub3QgYWxyZWFkeSBvbmUuCi8vCi8vCQl7Ci8vCQkJeDogJ3knLAovLwkJCWE6IFsgJ2InIF0KLy8JCX0KLy8KLy8gYmVjb21lcwovLwovLwkJewovLwkJCXg6IFsgJ3knIF0sCi8vCQkJYTogWyAnYicgXQovLwkJfQovLwovLyBAcGFyYW0ge09iamVjdH0gb2JqCi8vIEBwYXJhbSB7U3RyaW5nfSBrZXkKCgpmdW5jdGlvbiBhcnJheWlmeShvYmosIGtleSkgewogIG9ialtrZXldID0gdG9BcnJheShvYmpba2V5XSk7Cn0gLy8gQSBoZWxwZXIgd2hpY2ggY29uY2F0ZW5hdGVzIHRoZSB2YWx1ZSBhdm9pZGluZyB1bndhbnRlZAovLyBsZWFkaW5nIHdoaXRlIHNwYWNlcy4KLy8KLy8gQHBhcmFtIHtTdHJpbmd9IHByZXYKLy8gQHBhcmFtIHtTdHJpbmd9IGN1cgovLyBAcmV0dXJucyB7U3RyaW5nfQoKCmZ1bmN0aW9uIGFycmF5VmFsdWVSZWR1Y2VyKHByZXYsIGN1cikgewogIGlmIChpc0ZhbHN5KGN1cikpIHsKICAgIHJldHVybiBwcmV2OwogIH0gZWxzZSBpZiAoaXNGYWxzeShwcmV2KSkgewogICAgcmV0dXJuIGN1cjsKICB9IGVsc2UgewogICAgcmV0dXJuICIiLmNvbmNhdChwcmV2LCAiICIpLmNvbmNhdChjdXIpOwogIH0KfSAvLyBFeHRlbmRzIG9uZSBvYmplY3QgZGVmaW5lZCBpbiB0aGUgZm9sbG93aW5nIGZvcm1hdDoKLy8KLy8JCXsKLy8JCQlrZXkxOiBbQXJyYXkxXSwKLy8JCQlrZXkyOiBbQXJyYXkyXSwKLy8JCQkuLi4KLy8JCQlrZXlOOiBbQXJyYXlOXQovLwkJfQovLwovLyB3aXRoIGFub3RoZXIgb2JqZWN0IG9mIHRoZSBzYW1lIGRhdGEgZm9ybWF0LgovLwovLyBAcGFyYW0ge09iamVjdH0gb2JqIEJhc2Ugb2JqZWN0LgovLyBAcGFyYW0ge09iamVjdH0gZXh0IE9iamVjdCBleHRlbmRpbmcgYmFzZS4KLy8gQHJldHVybnMge1N0cmluZ30KCgpmdW5jdGlvbiBleHRlbmRPYmplY3RWYWx1ZUFycmF5KG9iaiwgZXh0KSB7CiAgZm9yICh2YXIgYSBpbiBleHQpIHsKICAgIGlmIChvYmpbYV0pIHsKICAgICAgdmFyIF9vYmokYTsKCiAgICAgIChfb2JqJGEgPSBvYmpbYV0pLnB1c2guYXBwbHkoX29iaiRhLCBfdG9Db25zdW1hYmxlQXJyYXkoZXh0W2FdKSk7CiAgICB9IGVsc2UgewogICAgICBvYmpbYV0gPSBleHRbYV07CiAgICB9CiAgfQp9IC8vIEEgaGVscGVyIGZvciB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2V4dGVuZH0uIFJlY3Vyc2l2ZWx5IGV4dGVuZHMge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0gaW5zdGFuY2UKLy8gd2l0aCBjb250ZW50IGZyb20ge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZURlZmluaXRpb259LiBTZWUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNleHRlbmR9IHRvIGxlYXJuIG1vcmUuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlfSBkZWYgQSB0ZW1wbGF0ZSBpbnN0YW5jZSB0byBiZSBleHRlbmRlZC4KLy8gQHBhcmFtIHttb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVEZWZpbml0aW9ufSBkZWYgQSBkZWZpbml0aW9uIHdoaWNoIGlzIHRvIGV4dGVuZCB0aGUgdGVtcGxhdGUgaW5zdGFuY2UuCi8vIEBwYXJhbSB7T2JqZWN0fSBFcnJvciBjb250ZXh0LgoKCmZ1bmN0aW9uIGV4dGVuZFRlbXBsYXRlKHRlbXBsYXRlLCBkZWYpIHsKICBpZiAoZGVmLmF0dHJpYnV0ZXMpIHsKICAgIGlmICghdGVtcGxhdGUuYXR0cmlidXRlcykgewogICAgICB0ZW1wbGF0ZS5hdHRyaWJ1dGVzID0ge307CiAgICB9CgogICAgZXh0ZW5kT2JqZWN0VmFsdWVBcnJheSh0ZW1wbGF0ZS5hdHRyaWJ1dGVzLCBkZWYuYXR0cmlidXRlcyk7CiAgfQoKICBpZiAoZGVmLmV2ZW50TGlzdGVuZXJzKSB7CiAgICBpZiAoIXRlbXBsYXRlLmV2ZW50TGlzdGVuZXJzKSB7CiAgICAgIHRlbXBsYXRlLmV2ZW50TGlzdGVuZXJzID0ge307CiAgICB9CgogICAgZXh0ZW5kT2JqZWN0VmFsdWVBcnJheSh0ZW1wbGF0ZS5ldmVudExpc3RlbmVycywgZGVmLmV2ZW50TGlzdGVuZXJzKTsKICB9CgogIGlmIChkZWYudGV4dCkgewogICAgdmFyIF90ZW1wbGF0ZSR0ZXh0OwoKICAgIChfdGVtcGxhdGUkdGV4dCA9IHRlbXBsYXRlLnRleHQpLnB1c2guYXBwbHkoX3RlbXBsYXRlJHRleHQsIF90b0NvbnN1bWFibGVBcnJheShkZWYudGV4dCkpOwogIH0KCiAgaWYgKGRlZi5jaGlsZHJlbiAmJiBkZWYuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICBpZiAodGVtcGxhdGUuY2hpbGRyZW4ubGVuZ3RoICE9IGRlZi5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgLyoqCiAgICAgICAqIFRoZSBudW1iZXIgb2YgY2hpbGRyZW4gaW4gZXh0ZW5kZWQgZGVmaW5pdGlvbiBkb2VzIG5vdCBtYXRjaC4KICAgICAgICoKICAgICAgICogQGVycm9yIHVpLXRlbXBsYXRlLWV4dGVuZC1jaGlsZHJlbi1taXNtYXRjaAogICAgICAgKi8KICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3VpLXRlbXBsYXRlLWV4dGVuZC1jaGlsZHJlbi1taXNtYXRjaCcsIHRlbXBsYXRlKTsKICAgIH0KCiAgICB2YXIgY2hpbGRJbmRleCA9IDA7CgogICAgdmFyIF9pdGVyYXRvcjcgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihkZWYuY2hpbGRyZW4pLAogICAgICAgIF9zdGVwNzsKCiAgICB0cnkgewogICAgICBmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykgewogICAgICAgIHZhciBjaGlsZERlZiA9IF9zdGVwNy52YWx1ZTsKICAgICAgICBleHRlbmRUZW1wbGF0ZSh0ZW1wbGF0ZS5jaGlsZHJlbltjaGlsZEluZGV4KytdLCBjaGlsZERlZik7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycikgewogICAgICBfaXRlcmF0b3I3LmUoZXJyKTsKICAgIH0gZmluYWxseSB7CiAgICAgIF9pdGVyYXRvcjcuZigpOwogICAgfQogIH0KfSAvLyBDaGVja3MgaWYgdmFsdWUgaXMgImZhbHN5Ii4KLy8gTm90ZTogMCAoTnVtYmVyKSBpcyBub3QgImZhbHN5IiBpbiB0aGlzIGNvbnRleHQuCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7Kn0gdmFsdWUgVmFsdWUgdG8gYmUgY2hlY2tlZC4KCgpmdW5jdGlvbiBpc0ZhbHN5KHZhbHVlKSB7CiAgcmV0dXJuICF2YWx1ZSAmJiB2YWx1ZSAhPT0gMDsKfSAvLyBDaGVja3MgaWYgdGhlIGl0ZW0gaXMgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXd9Ci8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7Kn0gdmFsdWUgVmFsdWUgdG8gYmUgY2hlY2tlZC4KCgpmdW5jdGlvbiBpc1ZpZXcoaXRlbSkgewogIHJldHVybiBpdGVtIGluc3RhbmNlb2YgVmlldzsKfSAvLyBDaGVja3MgaWYgdGhlIGl0ZW0gaXMgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZX0KLy8KLy8gQHByaXZhdGUKLy8gQHBhcmFtIHsqfSB2YWx1ZSBWYWx1ZSB0byBiZSBjaGVja2VkLgoKCmZ1bmN0aW9uIGlzVGVtcGxhdGUoaXRlbSkgewogIHJldHVybiBpdGVtIGluc3RhbmNlb2YgVGVtcGxhdGU7Cn0gLy8gQ2hlY2tzIGlmIHRoZSBpdGVtIGlzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6dWkvdmlld2NvbGxlY3Rpb25+Vmlld0NvbGxlY3Rpb259Ci8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7Kn0gdmFsdWUgVmFsdWUgdG8gYmUgY2hlY2tlZC4KCgpmdW5jdGlvbiBpc1ZpZXdDb2xsZWN0aW9uKGl0ZW0pIHsKICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIFZpZXdDb2xsZWN0aW9uOwp9IC8vIENyZWF0ZXMgYW4gZW1wdHkgc2tlbGV0b24gZm9yIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjcmV2ZXJ0fQovLyBkYXRhLgovLwovLyBAcHJpdmF0ZQoKCmZ1bmN0aW9uIGdldEVtcHR5UmV2ZXJ0RGF0YSgpIHsKICByZXR1cm4gewogICAgY2hpbGRyZW46IFtdLAogICAgYmluZGluZ3M6IFtdLAogICAgYXR0cmlidXRlczoge30KICB9Owp9IC8vIENoZWNrcyB3aGV0aGVyIGFuIGF0dHJpYnV0ZSBzaG91bGQgYmUgZXh0ZW5kZWQgd2hlbgovLyB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2FwcGx5fSBpcyBjYWxsZWQuCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7U3RyaW5nfSBhdHRyTmFtZSBBdHRyaWJ1dGUgbmFtZSB0byBjaGVjay4KCgpmdW5jdGlvbiBzaG91bGRFeHRlbmQoYXR0ck5hbWUpIHsKICByZXR1cm4gYXR0ck5hbWUgPT0gJ2NsYXNzJyB8fCBhdHRyTmFtZSA9PSAnc3R5bGUnOwp9Ci8qKgogKiBBIGRlZmluaXRpb24gb2YgdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGV9LiBJdCBkZXNjcmliZXMgd2hhdCBraW5kIG9mCiAqIG5vZGUgYSB0ZW1wbGF0ZSB3aWxsIHJlbmRlciAoSFRNTCBlbGVtZW50IG9yIHRleHQpLCBhdHRyaWJ1dGVzIG9mIGFuIGVsZW1lbnQsIERPTSBldmVudAogKiBsaXN0ZW5lcnMgYW5kIGNoaWxkcmVuLgogKgogKiBBbHNvIHNlZToKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9IHRvIGxlYXJuIGFib3V0IEhUTUwgZWxlbWVudCBhdHRyaWJ1dGVzLAogKiAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVMaXN0ZW5lclNjaGVtYX0gdG8gbGVhcm4gYWJvdXQgRE9NIGV2ZW50IGxpc3RlbmVycy4KICoKICogQSBzYW1wbGUgZGVmaW5pdGlvbiBvbiBhbiBIVE1MIGVsZW1lbnQgY2FuIGxvb2sgbGlrZSB0aGlzOgogKgogKgkJbmV3IFRlbXBsYXRlKCB7CiAqCQkJdGFnOiAncCcsCiAqCQkJY2hpbGRyZW46IFsKICoJCQkJewogKgkJCQkJdGFnOiAnc3BhbicsCiAqCQkJCQlhdHRyaWJ1dGVzOiB7IC4uLiB9LAogKgkJCQkJY2hpbGRyZW46IFsgLi4uIF0sCiAqCQkJCX0sCiAqCQkJCXsKICoJCQkJCXRleHQ6ICdzdGF0aWPigJN0ZXh0JwogKgkJCQl9LAogKgkJCQknYWxzby1zdGF0aWPigJN0ZXh0JywKICoJCQldLAogKgkJCWF0dHJpYnV0ZXM6IHsKICoJCQkJY2xhc3M6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0sCiAqCQkJCWlkOiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWF9LAogKgkJCQlzdHlsZToge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfQogKgogKgkJCQkvLyAuLi4KICoJCQl9LAogKgkJCW9uOiB7CiAqCQkJCSdjbGljayc6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVMaXN0ZW5lclNjaGVtYX0KICoKICoJCQkJLy8gRG9jdW1lbnQucXVlcnlTZWxlY3RvciBmb3JtYXQgaXMgYWxzbyBhY2NlcHRlZC4KICoJCQkJJ2tleXVwQGEuc29tZS1jbGFzcyc6IHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVMaXN0ZW5lclNjaGVtYX0KICoKICoJCQkJLy8gLi4uCiAqCQkJfQogKgkJfSApOwogKgogKiBBIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fSwgYW5vdGhlciB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlfSBvciBhIG5hdGl2ZSBET00gbm9kZQogKiBjYW4gYWxzbyBiZWNvbWUgYSBjaGlsZCBvZiBhIHRlbXBsYXRlLiBXaGVuIGEgdmlldyBpcyBwYXNzZWQsIGl0cyB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+VmlldyNlbGVtZW50fSBpcyB1c2VkOgogKgogKgkJY29uc3QgdmlldyA9IG5ldyBTb21lVmlldygpOwogKgkJY29uc3QgY2hpbGRUZW1wbGF0ZSA9IG5ldyBUZW1wbGF0ZSggeyAuLi4gfSApOwogKgkJY29uc3QgY2hpbGROb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2InICk7CiAqCiAqCQluZXcgVGVtcGxhdGUoIHsKICoJCQl0YWc6ICdwJywKICoKICoJCQljaGlsZHJlbjogWwogKgkJCQkvLyB2aWV3I2VsZW1lbnQgd2lsbCBiZSBhZGRlZCBhcyBhIGNoaWxkIG9mIHRoaXMgPHA+LgogKgkJCQl2aWV3LAogKgogKiAJCQkJLy8gVGhlIG91dHB1dCBvZiBjaGlsZFRlbXBsYXRlLnJlbmRlcigpIHdpbGwgYmUgYWRkZWQgaGVyZS4KICoJCQkJY2hpbGRUZW1wbGF0ZSwKICoKICoJCQkJLy8gTmF0aXZlIERPTSBub2RlcyBhcmUgaW5jbHVkZWQgZGlyZWN0bHkgaW4gdGhlIHJlbmRlcmVkIG91dHB1dC4KICoJCQkJY2hpbGROb2RlCiAqCQkJXQogKgkJfSApOwogKgogKiBBbiBlbnRpcmUge0BsaW5rIG1vZHVsZTp1aS92aWV3Y29sbGVjdGlvbn5WaWV3Q29sbGVjdGlvbn0gY2FuIGJlIHVzZWQgYXMgYSBjaGlsZCBpbiB0aGUgZGVmaW5pdGlvbjoKICoKICoJCWNvbnN0IGNvbGxlY3Rpb24gPSBuZXcgVmlld0NvbGxlY3Rpb24oKTsKICoJCWNvbGxlY3Rpb24uYWRkKCBzb21lVmlldyApOwogKgogKgkJbmV3IFRlbXBsYXRlKCB7CiAqCQkJdGFnOiAncCcsCiAqCiAqCQkJY2hpbGRyZW46IGNvbGxlY3Rpb24KICoJCX0gKTsKICoKICogQHR5cGVkZWYgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbgogKiBAdHlwZSBPYmplY3QKICoKICogQHByb3BlcnR5IHtTdHJpbmd9IHRhZyBTZWUgdGhlIHRlbXBsYXRlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjdGFnfSBwcm9wZXJ0eS4KICoKICogQHByb3BlcnR5IHtBcnJheS48bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbj59IFtjaGlsZHJlbl0KICogU2VlIHRoZSB0ZW1wbGF0ZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2NoaWxkcmVufSBwcm9wZXJ0eS4KICoKICogQHByb3BlcnR5IHtPYmplY3QuPFN0cmluZywgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlVmFsdWVTY2hlbWE+fSBbYXR0cmlidXRlc10KICogU2VlIHRoZSB0ZW1wbGF0ZSB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2F0dHJpYnV0ZXN9IHByb3BlcnR5LgogKgogKiBAcHJvcGVydHkge1N0cmluZ3xtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYXxBcnJheS48U3RyaW5nfG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hPn0gW3RleHRdCiAqIFNlZSB0aGUgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSN0ZXh0fSBwcm9wZXJ0eS4KICoKICogQHByb3BlcnR5IHtPYmplY3QuPFN0cmluZywgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlTGlzdGVuZXJTY2hlbWE+fSBbb25dCiAqIFNlZSB0aGUgdGVtcGxhdGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNldmVudExpc3RlbmVyc30gcHJvcGVydHkuCiAqLwoKLyoqCiAqIERlc2NyaWJlcyBhIHZhbHVlIG9mIGFuIEhUTUwgZWxlbWVudCBhdHRyaWJ1dGUgb3IgYHRleHRDb250ZW50YC4gSXQgYWxsb3dzIGNvbWJpbmluZyBtdWx0aXBsZQogKiBkYXRhIHNvdXJjZXMgbGlrZSBzdGF0aWMgdmFsdWVzIGFuZCB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBhdHRyaWJ1dGVzLgogKgogKiBBbHNvIHNlZToKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gdG8gbGVhcm4gd2hlcmUgdG8gdXNlIGl0LAogKiAqIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUuYmluZH0gdG8gbGVhcm4gaG93IHRvIGNvbmZpZ3VyZQogKiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBhdHRyaWJ1dGUgYmluZGluZ3MsCiAqICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNyZW5kZXJ9IHRvIGxlYXJuIGhvdyB0byByZW5kZXIgYSB0ZW1wbGF0ZSwKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiN0byBgdG8oKWB9IGFuZCB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiNpZiBgaWYoKWB9CiAqIG1ldGhvZHMgdG8gbGVhcm4gbW9yZSBhYm91dCBiaW5kaW5ncy4KICoKICogQXR0cmlidXRlIHZhbHVlcyBjYW4gYmUgZGVzY3JpYmVkIGluIG1hbnkgZGlmZmVyZW50IHdheXM6CiAqCiAqCQkvLyBCaW5kIGhlbHBlciB3aWxsIGNyZWF0ZSBiaW5kaW5ncyB0byBhdHRyaWJ1dGVzIG9mIHRoZSBvYnNlcnZhYmxlLgogKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgkJCWF0dHJpYnV0ZXM6IHsKICoJCQkJLy8gQSBwbGFpbiBzdHJpbmcgc2NoZW1hLgogKgkJCQknY2xhc3MnOiAnc3RhdGljLXRleHQnLAogKgogKgkJCQkvLyBBbiBvYmplY3Qgc2NoZW1hLCBiaW5kcyB0byB0aGUgImZvbyIgYXR0cmlidXRlIG9mIHRoZQogKgkJCQkvLyBvYnNlcnZhYmxlIGFuZCBmb2xsb3dzIGl0cyB2YWx1ZS4KICoJCQkJJ2NsYXNzJzogYmluZC50byggJ2ZvbycgKSwKICoKICoJCQkJLy8gQW4gYXJyYXkgc2NoZW1hLCBjb21iaW5lcyB0aGUgYWJvdmUuCiAqCQkJCSdjbGFzcyc6IFsKICoJCQkJCSdzdGF0aWMtdGV4dCcsCiAqCQkJCQliaW5kLnRvKCAnYmFyJywgKCkgPT4geyAuLi4gfSApLAogKgogKiAJCQkJCS8vIEJpbmRpbmdzIGNhbiBhbHNvIGJlIGNvbmRpdGlvbmFsLgogKgkJCQkJYmluZC5pZiggJ2JheicsICdjbGFzcy13aGVuLWJhei1pcy10cnVlJyApCiAqCQkJCV0sCiAqCiAqCQkJCS8vIEFuIGFycmF5IHNjaGVtYSwgd2l0aCBhIGN1c3RvbSBuYW1lc3BhY2UsIGUuZy4gdXNlZnVsIGZvciBjcmVhdGluZyBTVkdzLgogKgkJCQknY2xhc3MnOiB7CiAqCQkJCQluczogJ2h0dHA6Ly9ucy51cmwnLAogKgkJCQkJdmFsdWU6IFsKICoJCQkJCQliaW5kLmlmKCAnYmF6JywgJ3ZhbHVlLXdoZW4tdHJ1ZScgKSwKICoJCQkJCQknc3RhdGljLXRleHQnCiAqCQkJCQldCiAqCQkJCX0sCiAqCiAqCQkJCS8vIEFuIG9iamVjdCBzY2hlbWEsIHNwZWNpZmljIGZvciBzdHlsZXMuCiAqCQkJCXN0eWxlOiB7CiAqCQkJCQljb2xvcjogJ3JlZCcsCiAqCQkJCQliYWNrZ3JvdW5kQ29sb3I6IGJpbmQudG8oICdxdXgnLCAoKSA9PiB7IC4uLiB9ICkKICoJCQkJfQogKgkJCX0KICoJCX0gKTsKICoKICogVGV4dCBub2RlcyBjYW4gYWxzbyBoYXZlIGNvbXBsZXggdmFsdWVzOgogKgogKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICoKICoJCS8vIFdpbGwgcmVuZGVyIGEgImZvbyIgdGV4dCBub2RlLgogKgkJbmV3IFRlbXBsYXRlKCB7CiAqCQkJdGV4dDogJ2ZvbycKICoJCX0gKTsKICoKICoJCS8vIFdpbGwgcmVuZGVyIGEgInN0YXRpYyB0ZXh0OiB7b2JzZXJ2YWJsZS5mb299IiB0ZXh0IG5vZGUuCiAqCQkvLyBUaGUgdGV4dCBvZiB0aGUgbm9kZSB3aWxsIGJlIHVwZGF0ZWQgYXMgdGhlICJmb28iIGF0dHJpYnV0ZSBjaGFuZ2VzLgogKgkJbmV3IFRlbXBsYXRlKCB7CiAqCQkJdGV4dDogWwogKgkJCQknc3RhdGljIHRleHQ6ICcsCiAqCQkJCWJpbmQudG8oICdmb28nLCAoKSA9PiB7IC4uLiB9ICkKICoJCQldCiAqCQl9ICk7CiAqCiAqIEB0eXBlZGVmIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hCiAqIEB0eXBlIHtPYmplY3R8U3RyaW5nfEFycmF5fQogKi8KCi8qKgogKiBEZXNjcmliZXMgYW4gZXZlbnQgbGlzdGVuZXIgYXR0YWNoZWQgdG8gYW4gSFRNTCBlbGVtZW50LiBTdWNoIGxpc3RlbmVyIGNhbiBwcm9wYWdhdGUgRE9NIGV2ZW50cwogKiB0aHJvdWdoIGFuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9IGluc3RhbmNlLCBleGVjdXRlIGN1c3RvbSBjYWxsYmFja3MKICogb3IgYm90aCwgaWYgbmVjZXNzYXJ5LgogKgogKiBBbHNvIHNlZToKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlRGVmaW5pdGlvbn0gdG8gbGVhcm4gbW9yZSBhYm91dCB0ZW1wbGF0ZSBkZWZpbml0aW9ucywKICogKiB7QGxpbmsgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbiN0byBgdG8oKWB9IG1ldGhvZCB0byBsZWFybiBtb3JlIGFib3V0IGJpbmRpbmdzLgogKgogKiBDaGVjayBvdXQgZGlmZmVyZW50IHdheXMgb2YgYXR0YWNoaW5nIGV2ZW50IGxpc3RlbmVycyBiZWxvdzoKICoKICoJCS8vIEJpbmQgaGVscGVyIHdpbGwgcHJvcGFnYXRlIGV2ZW50cyB0aHJvdWdoIHRoZSBvYnNlcnZhYmxlLgogKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgkJCW9uOiB7CiAqCQkJCS8vIEFuIG9iamVjdCBzY2hlbWEuIFRoZSBvYnNlcnZhYmxlIHdpbGwgZmlyZSB0aGUgImNsaWNrZWQiIGV2ZW50IHVwb24gRE9NICJjbGljayIuCiAqCQkJCWNsaWNrOiBiaW5kLnRvKCAnY2xpY2tlZCcgKQogKgogKgkJCQkvLyBBbiBvYmplY3Qgc2NoZW1hLiBJdCB3aWxsIHdvcmsgZm9yICJjbGljayIgZXZlbnQgb24gImEuZm9vIiBjaGlsZHJlbiBvbmx5LgogKgkJCQknY2xpY2tAYS5mb28nOiBiaW5kLnRvKCAnY2xpY2tlZCcgKQogKgogKgkJCQkvLyBBbiBhcnJheSBzY2hlbWEsIG1ha2VzIHRoZSBvYnNlcnZhYmxlIHByb3BhZ2F0ZSBtdWx0aXBsZSBldmVudHMuCiAqCQkJCWNsaWNrOiBbCiAqCQkJCQliaW5kLnRvKCAnY2xpY2tlZCcgKSwKICoJCQkJCWJpbmQudG8oICdleGVjdXRlZCcgKQogKgkJCQldLAogKgogKgkJCQkvLyBBbiBhcnJheSBzY2hlbWEgd2l0aCBhIGN1c3RvbSBjYWxsYmFjay4KICoJCQkJJ2NsaWNrQGEuZm9vJzogewogKgkJCQkJYmluZC50byggJ2NsaWNrZWQnICksCiAqCQkJCQliaW5kLnRvKCBldnQgPT4gewogKgkJCQkJCWNvbnNvbGUubG9nKCBgJHsgZXZ0LnRhcmdldCB9IGhhcyBiZWVuIGNsaWNrZWQhYCApOwogKgkJCQkJfSB9CiAqCQkJCX0KICoJCQl9CiAqCQl9ICk7CiAqCiAqIEB0eXBlZGVmIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUxpc3RlbmVyU2NoZW1hCiAqIEB0eXBlIHtPYmplY3R8U3RyaW5nfEFycmF5fQogKi8KCi8qKgogKiBUaGUgcmV0dXJuIHZhbHVlIG9mIHtAbGluayB+VGVtcGxhdGUuYmluZCBgVGVtcGxhdGUuYmluZCgpYH0uIEl0IHByb3ZpZGVzIGB0bygpYCBhbmQgYGlmKClgCiAqIG1ldGhvZHMgdG8gY3JlYXRlIHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlIG9ic2VydmFibGV9IGF0dHJpYnV0ZSBhbmQgZXZlbnQgYmluZGluZ3MuCiAqCiAqIEBpbnRlcmZhY2UgbW9kdWxlOnVpL3RlbXBsYXRlfkJpbmRDaGFpbgogKi8KCi8qKgogKiBCaW5kcyBhbiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlIG9ic2VydmFibGV9IHRvIGVpdGhlcjoKICoKICogKiBhbiBIVE1MIGVsZW1lbnQgYXR0cmlidXRlIG9yIGEgdGV4dCBub2RlIGB0ZXh0Q29udGVudGAsIHNvIGl0IHJlbWFpbnMgaW4gc3luYyB3aXRoIHRoZSBvYnNlcnZhYmxlCiAqIGF0dHJpYnV0ZSBhcyBpdCBjaGFuZ2VzLAogKiAqIG9yIGFuIEhUTUwgZWxlbWVudCBET00gZXZlbnQsIHNvIHRoZSBET00gZXZlbnRzIGFyZSBwcm9wYWdhdGVkIHRocm91Z2ggYW4gb2JzZXJ2YWJsZS4KICoKICogU29tZSBjb21tb24gdXNlIGNhc2VzIG9mIGB0bygpYCBiaW5kaW5ncyBhcmUgcHJlc2VudGVkIGJlbG93OgogKgogKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ3AnLAogKgkJCWF0dHJpYnV0ZXM6IHsKICoJCQkJLy8gY2xhc3M9Ii4uLiIgYXR0cmlidXRlIGdldHMgYm91bmQgdG8gYG9ic2VydmFibGUjYWAKICoJCQkJY2xhc3M6IGJpbmQudG8oICdhJyApCiAqCQkJfSwKICoJCQljaGlsZHJlbjogWwogKgkJCQkvLyA8cD4uLi48L3A+IGdldHMgYm91bmQgdG8gb2JzZXJ2YWJsZSNiOyBhbHdheXMgYHRvVXBwZXJDYXNlKClgLgogKgkJCQl7CiAqCQkJCQl0ZXh0OiBiaW5kLnRvKCAnYicsICggdmFsdWUsIG5vZGUgKSA9PiB2YWx1ZS50b1VwcGVyQ2FzZSgpICkKICoJCQkJfQogKgkJCV0sCiAqCQkJb246IHsKICoJCQkJY2xpY2s6IFsKICoJCQkJCS8vIEFuIG9ic2VydmFibGUgd2lsbCBmaXJlICJjbGlja2VkIiB1cG9uICJjbGljayIgaW4gdGhlIERPTS4KICoJCQkJCWJpbmQudG8oICdjbGlja2VkJyApLAogKgogKgkJCQkJLy8gQSBjdXN0b20gY2FsbGJhY2sgd2lsbCBiZSBleGVjdXRlZCB1cG9uICJjbGljayIgaW4gdGhlIERPTS4KICoJCQkJCWJpbmQudG8oICgpID0+IHsKICoJCQkJCQkuLi4KICoJCQkJCX0gKQogKgkJCQldCiAqCQkJfQogKgkJfSApLnJlbmRlcigpOwogKgogKiBMZWFybiBtb3JlIGFib3V0IHVzaW5nIGB0bygpYCBpbiB0aGUge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZVZhbHVlU2NoZW1hfSBhbmQKICoge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUxpc3RlbmVyU2NoZW1hfS4KICoKICogQG1ldGhvZCAjdG8KICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IGV2ZW50TmFtZU9yRnVuY3Rpb25PckF0dHJpYnV0ZSBBbiBhdHRyaWJ1dGUgbmFtZSBvZgogKiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlfSBvciBhIERPTSBldmVudCBuYW1lIG9yIGFuIGV2ZW50IGNhbGxiYWNrLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdIEFsbG93cyBmb3IgcHJvY2Vzc2luZyBvZiB0aGUgdmFsdWUuIEFjY2VwdHMgYE5vZGVgIGFuZCBgdmFsdWVgIGFzIGFyZ3VtZW50cy4KICogQHJldHVybnMge21vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZUJpbmRpbmd9CiAqLwoKLyoqCiAqIEJpbmRzIGFuIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGUgb2JzZXJ2YWJsZX0gdG8gYW4gSFRNTCBlbGVtZW50IGF0dHJpYnV0ZSBvciBhIHRleHQKICogbm9kZSBgdGV4dENvbnRlbnRgIHNvIGl0IHJlbWFpbnMgaW4gc3luYyB3aXRoIHRoZSBvYnNlcnZhYmxlIGF0dHJpYnV0ZSBhcyBpdCBjaGFuZ2VzLgogKgogKiBVbmxpa2Uge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5CaW5kQ2hhaW4jdG99LCBpdCBjb250cm9scyB0aGUgcHJlc2VuY2Ugb2YgdGhlIGF0dHJpYnV0ZSBvciBgdGV4dENvbnRlbnRgCiAqIGRlcGVuZGluZyBvbiB0aGUgImZhbHNlbmVzcyIgb2YgYW4ge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gYXR0cmlidXRlLgogKgogKgkJY29uc3QgYmluZCA9IFRlbXBsYXRlLmJpbmQoIG9ic2VydmFibGUsIGVtaXR0ZXIgKTsKICoKICoJCW5ldyBUZW1wbGF0ZSggewogKgkJCXRhZzogJ2lucHV0JywKICoJCQlhdHRyaWJ1dGVzOiB7CiAqCQkJCS8vIDxpbnB1dCBjaGVja2VkPiB3aGVuIGBvYnNlcnZhYmxlI2FgIGlzIG5vdCB1bmRlZmluZWQvbnVsbC9mYWxzZS8nJwogKgkJCQkvLyA8aW5wdXQ+IHdoZW4gYG9ic2VydmFibGUjYWAgaXMgdW5kZWZpbmVkL251bGwvZmFsc2UKICoJCQkJY2hlY2tlZDogYmluZC5pZiggJ2EnICkKICoJCQl9LAogKgkJCWNoaWxkcmVuOiBbCiAqCQkJCXsKICoJCQkJCS8vIDxpbnB1dD4iYi1pcy1ub3Qtc2V0IjwvaW5wdXQ+IHdoZW4gYG9ic2VydmFibGUjYmAgaXMgdW5kZWZpbmVkL251bGwvZmFsc2UvJycKICoJCQkJCS8vIDxpbnB1dD48L2lucHV0PiB3aGVuIGBvYnNlcnZhYmxlI2JgIGlzIG5vdCAiZmFsc3kiCiAqCQkJCQl0ZXh0OiBiaW5kLmlmKCAnYicsICdiLWlzLW5vdC1zZXQnLCAoIHZhbHVlLCBub2RlICkgPT4gIXZhbHVlICkKICoJCQkJfQogKgkJCV0KICoJCX0gKS5yZW5kZXIoKTsKICoKICogTGVhcm4gbW9yZSBhYm91dCB1c2luZyBgaWYoKWAgaW4gdGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGVWYWx1ZVNjaGVtYX0uCiAqCiAqIEBtZXRob2QgI2lmCiAqIEBwYXJhbSB7U3RyaW5nfSBhdHRyaWJ1dGUgQW4gYXR0cmlidXRlIG5hbWUgb2Yge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gdXNlZCBpbiB0aGUgYmluZGluZy4KICogQHBhcmFtIHtTdHJpbmd9IFt2YWx1ZUlmVHJ1ZV0gVmFsdWUgc2V0IHdoZW4gdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGV9IGF0dHJpYnV0ZSBpcyBub3QKICogdW5kZWZpbmVkL251bGwvZmFsc2UvJycgKGVtcHR5IHN0cmluZykuCiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gQWxsb3dzIGZvciBwcm9jZXNzaW5nIG9mIHRoZSB2YWx1ZS4gQWNjZXB0cyBgTm9kZWAgYW5kIGB2YWx1ZWAgYXMgYXJndW1lbnRzLgogKiBAcmV0dXJucyB7bW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlQmluZGluZ30KICovCgovKioKICogVGhlIHtAbGluayBtb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjX3JlbmRlck5vZGV9IGNvbmZpZ3VyYXRpb24uCiAqCiAqIEBwcml2YXRlCiAqIEBpbnRlcmZhY2UgbW9kdWxlOnVpL3RlbXBsYXRlflJlbmRlckRhdGEKICovCgovKioKICogVGVsbHMge0BsaW5rIG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNfcmVuZGVyTm9kZX0gdG8gcmVuZGVyCiAqIGNoaWxkcmVuIGludG8gYERvY3VtZW50RnJhZ21lbnRgIGZpcnN0IGFuZCB0aGVuIGFwcGVuZCB0aGUgZnJhZ21lbnQKICogdG8gdGhlIHBhcmVudCBlbGVtZW50LiBJdCBpcyBhIHNwZWVkIG9wdGltaXphdGlvbi4KICoKICogQG1lbWJlciB7Qm9vbGVhbn0gI2ludG9GcmFnbWVudAogKi8KCi8qKgogKiBBIG5vZGUgd2hpY2ggaXMgYmVpbmcgcmVuZGVyZWQuCiAqCiAqIEBtZW1iZXIge0hUTUxFbGVtZW50fFRleHR9ICNub2RlCiAqLwoKLyoqCiAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSB7QG1vZHVsZTp1aS90ZW1wbGF0ZX5SZW5kZXJOb2RlT3B0aW9ucyNub2RlfSBoYXMKICogYmVlbiBwcm92aWRlZCBieSB7QG1vZHVsZTp1aS90ZW1wbGF0ZX5UZW1wbGF0ZSNhcHBseX0uCiAqCiAqIEBtZW1iZXIge0Jvb2xlYW59ICNpc0FwcGx5aW5nCiAqLwoKLyoqCiAqIEFuIG9iamVjdCBzdG9yaW5nIHRoZSBkYXRhIHRoYXQgaGVscHMge0Btb2R1bGU6dWkvdGVtcGxhdGV+VGVtcGxhdGUjcmV2ZXJ0fQogKiBicmluZ2luZyBiYWNrIGFuIGVsZW1lbnQgdG8gaXRzIGluaXRpYWwgc3RhdGUsIGkuZS4gYmVmb3JlCiAqIHtAbW9kdWxlOnVpL3RlbXBsYXRlflRlbXBsYXRlI2FwcGx5fSB3YXMgY2FsbGVkLgogKgogKiBAbWVtYmVyIHtPYmplY3R9ICNyZXZlcnREYXRhCiAqLw=="},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-ui/src/template.js"],"names":["CKEditorError","mix","EmitterMixin","View","ViewCollection","isNode","isObject","cloneDeepWith","toArray","xhtmlNs","Template","def","Object","assign","normalize","clone","_isRendered","_revertData","node","_renderNode","intoFragment","getEmptyRevertData","isApplying","revertData","_revertTemplateFromNode","search","children","child","isView","isTemplate","data","isInvalid","tag","text","_renderText","_renderElement","document","createElementNS","ns","_renderAttributes","_renderElementChildren","_setUpListeners","textContent","createTextNode","hasTemplateBinding","_bindToObservable","schema","updater","getTextUpdater","join","attrName","attrValue","domAttrValue","attrNs","attributes","getAttribute","valueToBind","value","shouldExtend","unshift","getAttributeUpdater","_renderStyleAttribute","map","val","reduce","prev","next","concat","arrayValueReducer","isFalsy","setAttributeNS","styles","styleName","styleValue","getStyleUpdater","style","container","createDocumentFragment","childIndex","isViewCollection","setParent","view","appendChild","element","isRendered","render","childRevertData","push","childNodes","eventListeners","key","revertBindings","schemaItem","split","domEvtName","domSelector","activateDomEventListener","bindings","syncValueSchemaValue","filter","item","observable","templateBinding","activateAttributeListener","binding","revertBinding","removeAttribute","setAttribute","i","length","emitter","to","eventNameOrFunctionOrAttribute","callback","TemplateToBinding","eventNameOrFunction","attribute","if","valueIfTrue","TemplateIfBinding","template","extendTemplate","TemplateBinding","listenTo","stopListening","evt","domEvt","target","matches","fire","Array","isArray","some","getValueSchemaValue","getValue","remove","set","el","removeAttributeNS","normalizePlainTextDefinition","normalizeTextDefinition","on","normalizeListeners","normalizeAttributes","a","arrayify","listeners","l","obj","cur","extendObjectValueArray","ext","childDef"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AAEA,OAAOA,aAAP,MAA0B,6CAA1B;AACA,OAAOC,GAAP,MAAgB,mCAAhB;AACA,OAAOC,YAAP,MAAyB,4CAAzB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,MAAP,MAAmB,0CAAnB;AACA,SAASC,QAAT,EAAmBC,aAAnB,QAAwC,WAAxC;AACA,OAAOC,OAAP,MAAoB,uCAApB;AAEA,IAAMC,OAAO,GAAG,8BAAhB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IACqBC,Q;AACpB;AACD;AACA;AACA;AACA;AACC,oBAAaC,GAAb,EAAmB;AAAA;;AAClBC,IAAAA,MAAM,CAACC,MAAP,CAAe,IAAf,EAAqBC,SAAS,CAAEC,KAAK,CAAEJ,GAAF,CAAP,CAA9B;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,SAAKK,WAAL,GAAmB,KAAnB;AAEA;AACF;AACA;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,SAAKC,WAAL,GAAmB,IAAnB;AACA;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;WACC,kBAAS;AACR,UAAMC,IAAI,GAAG,KAAKC,WAAL,CAAkB;AAC9BC,QAAAA,YAAY,EAAE;AADgB,OAAlB,CAAb;;AAIA,WAAKJ,WAAL,GAAmB,IAAnB;AAEA,aAAOE,IAAP;AACA;AAED;AACD;AACA;AACA;AACA;AACA;AA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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module ui/template\n */\n\n/* global document */\n\nimport CKEditorError from '@ckeditor/ckeditor5-utils/src/ckeditorerror';\nimport mix from '@ckeditor/ckeditor5-utils/src/mix';\nimport EmitterMixin from '@ckeditor/ckeditor5-utils/src/emittermixin';\nimport View from './view';\nimport ViewCollection from './viewcollection';\nimport isNode from '@ckeditor/ckeditor5-utils/src/dom/isnode';\nimport { isObject, cloneDeepWith } from 'lodash-es';\nimport toArray from '@ckeditor/ckeditor5-utils/src/toarray';\n\nconst xhtmlNs = 'http://www.w3.org/1999/xhtml';\n\n/**\n * A basic Template class. It renders a DOM HTML element or text from a\n * {@link module:ui/template~TemplateDefinition definition} and supports element attributes, children,\n * bindings to {@link module:utils/observablemixin~Observable observables} and DOM event propagation.\n *\n * A simple template can look like this:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\tclass: 'foo',\n *\t\t\t\tstyle: {\n *\t\t\t\t\tbackgroundColor: 'yellow'\n *\t\t\t\t}\n *\t\t\t},\n *\t\t\ton: {\n *\t\t\t\tclick: bind.to( 'clicked' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t'A paragraph.'\n *\t\t\t]\n *\t\t} ).render();\n *\n * and it will render the following HTML element:\n *\n *\t\t<p class=\"foo\" style=\"background-color: yellow;\">A paragraph.</p>\n *\n * Additionally, the `observable` will always fire `clicked` upon clicking `<p>` in the DOM.\n *\n * See {@link module:ui/template~TemplateDefinition} to know more about templates and complex\n * template definitions.\n *\n* @mixes module:utils/emittermixin~EmitterMixin\n */\nexport default class Template {\n\t/**\n\t * Creates an instance of the {@link ~Template} class.\n\t *\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the template.\n\t */\n\tconstructor( def ) {\n\t\tObject.assign( this, normalize( clone( def ) ) );\n\n\t\t/**\n\t\t * Indicates whether this particular Template instance has been\n\t\t * {@link #render rendered}.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {Boolean}\n\t\t */\n\t\tthis._isRendered = false;\n\n\t\t/**\n\t\t * The tag (`tagName`) of this template, e.g. `div`. It also indicates that the template\n\t\t * renders to an HTML element.\n\t\t *\n\t\t * @member {String} #tag\n\t\t */\n\n\t\t/**\n\t\t * The text of the template. It also indicates that the template renders to a DOM text node.\n\t\t *\n\t\t * @member {Array.<String|module:ui/template~TemplateValueSchema>} #text\n\t\t */\n\n\t\t/**\n\t\t * The attributes of the template, e.g. `{ id: [ 'ck-id' ] }`, corresponding with\n\t\t * the attributes of an HTML element.\n\t\t *\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\n\t\t *\n\t\t * @member {Object} #attributes\n\t\t */\n\n\t\t/**\n\t\t * The children of the template. They can be either:\n\t\t * * independent instances of {@link ~Template} (sub–templates),\n\t\t * * native DOM Nodes.\n\t\t *\n\t\t * **Note**: This property only makes sense when {@link #tag} is defined.\n\t\t *\n\t\t * @member {Array.<module:ui/template~Template|Node>} #children\n\t\t */\n\n\t\t/**\n\t\t * The DOM event listeners of the template.\n\t\t *\n\t\t * @member {Object} #eventListeners\n\t\t */\n\n\t\t/**\n\t\t * The data used by the {@link #revert} method to restore a node to its original state.\n\t\t *\n\t\t * See: {@link #apply}.\n\t\t *\n\t\t * @readonly\n\t\t * @protected\n\t\t * @member {module:ui/template~RenderData}\n\t\t */\n\t\tthis._revertData = null;\n\t}\n\n\t/**\n\t * Renders a DOM Node (an HTML element or text) out of the template.\n\t *\n\t *\t\tconst domNode = new Template( { ... } ).render();\n\t *\n\t * See: {@link #apply}.\n\t *\n\t * @returns {HTMLElement|Text}\n\t */\n\trender() {\n\t\tconst node = this._renderNode( {\n\t\t\tintoFragment: true\n\t\t} );\n\n\t\tthis._isRendered = true;\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Applies the template to an existing DOM Node, either HTML element or text.\n\t *\n\t * **Note:** No new DOM nodes will be created. Applying extends:\n\t *\n\t * {@link module:ui/template~TemplateDefinition attributes},\n\t * {@link module:ui/template~TemplateDefinition event listeners}, and\n\t * `textContent` of {@link module:ui/template~TemplateDefinition children} only.\n\t *\n\t * **Note:** Existing `class` and `style` attributes are extended when a template\n\t * is applied to an HTML element, while other attributes and `textContent` are overridden.\n\t *\n\t * **Note:** The process of applying a template can be easily reverted using the\n\t * {@link module:ui/template~Template#revert} method.\n\t *\n\t *\t\tconst element = document.createElement( 'div' );\n\t *\t\tconst observable = new Model( { divClass: 'my-div' } );\n\t *\t\tconst emitter = Object.create( EmitterMixin );\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tid: 'first-div',\n\t *\t\t\t\tclass: bind.to( 'divClass' )\n\t *\t\t\t},\n\t *\t\t\ton: {\n\t *\t\t\t\tclick: bind( 'elementClicked' ) // Will be fired by the observable.\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t'Div text.'\n\t *\t\t\t]\n\t *\t\t} ).apply( element );\n\t *\n\t *\t\tconsole.log( element.outerHTML ); // -> '<div id=\"first-div\" class=\"my-div\"></div>'\n\t *\n\t * @see module:ui/template~Template#render\n\t * @see module:ui/template~Template#revert\n\t * @param {Node} node Root node for the template to apply.\n\t */\n\tapply( node ) {\n\t\tthis._revertData = getEmptyRevertData();\n\n\t\tthis._renderNode( {\n\t\t\tnode,\n\t\t\tisApplying: true,\n\t\t\trevertData: this._revertData\n\t\t} );\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Reverts a template {@link module:ui/template~Template#apply applied} to a DOM node.\n\t *\n\t * @param {Node} node The root node for the template to revert. In most of the cases, it is the\n\t * same node used by {@link module:ui/template~Template#apply}.\n\t */\n\trevert( node ) {\n\t\tif ( !this._revertData ) {\n\t\t\t/**\n\t\t\t * Attempting to revert a template which has not been applied yet.\n\t\t\t *\n\t\t\t * @error ui-template-revert-not-applied\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-revert-not-applied',\n\t\t\t\t[ this, node ]\n\t\t\t);\n\t\t}\n\n\t\tthis._revertTemplateFromNode( node, this._revertData );\n\t}\n\n\t/**\n\t * Returns an iterator which traverses the template in search of {@link module:ui/view~View}\n\t * instances and returns them one by one.\n\t *\n\t *\t\tconst viewFoo = new View();\n\t *\t\tconst viewBar = new View();\n\t *\t\tconst viewBaz = new View();\n\t *\t\tconst template = new Template( {\n\t *\t\t\ttag: 'div',\n\t *\t\t\tchildren: [\n\t *\t\t\t\tviewFoo,\n\t *\t\t\t\t{\n\t *\t\t\t\t\ttag: 'div',\n\t *\t\t\t\t\tchildren: [\n\t *\t\t\t\t\t\tviewBar\n\t *\t\t\t\t\t]\n\t *\t\t\t\t},\n\t *\t\t\t\tviewBaz\n\t *\t\t\t]\n\t *\t\t} );\n\t *\n\t *\t\t// Logs: viewFoo, viewBar, viewBaz\n\t *\t\tfor ( const view of template.getViews() ) {\n\t *\t\t\tconsole.log( view );\n\t *\t\t}\n\t *\n\t * @returns {Iterable.<module:ui/view~View>}\n\t */\n\t* getViews() {\n\t\tfunction* search( def ) {\n\t\t\tif ( def.children ) {\n\t\t\t\tfor ( const child of def.children ) {\n\t\t\t\t\tif ( isView( child ) ) {\n\t\t\t\t\t\tyield child;\n\t\t\t\t\t} else if ( isTemplate( child ) ) {\n\t\t\t\t\t\tyield* search( child );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tyield* search( this );\n\t}\n\n\t/**\n\t * An entry point to the interface which binds DOM nodes to\n\t * {@link module:utils/observablemixin~Observable observables}.\n\t * There are two types of bindings:\n\t *\n\t * * HTML element attributes or text `textContent` synchronized with attributes of an\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}\n\t * and {@link module:ui/template~BindChain#if}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\tattributes: {\n\t *\t\t\t\t// Binds the element \"class\" attribute to observable#classAttribute.\n\t *\t\t\t\tclass: bind.to( 'classAttribute' )\n\t *\t\t\t}\n\t *\t\t} ).render();\n\t *\n\t * * DOM events fired on HTML element propagated through\n\t * {@link module:utils/observablemixin~Observable}. Learn more about {@link module:ui/template~BindChain#to}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tnew Template( {\n\t *\t\t\ton: {\n\t *\t\t\t\t// Will be fired by the observable.\n\t *\t\t\t\tclick: bind( 'elementClicked' )\n\t *\t\t\t}\n\t *\t\t} ).render();\n\t *\n\t * Also see {@link module:ui/view~View#bindTemplate}.\n\t *\n\t * @param {module:utils/observablemixin~Observable} observable An observable which provides boundable attributes.\n\t * @param {module:utils/emittermixin~Emitter} emitter An emitter that listens to observable attribute\n\t * changes or DOM Events (depending on the kind of the binding). Usually, a {@link module:ui/view~View} instance.\n\t * @returns {module:ui/template~BindChain}\n\t */\n\tstatic bind( observable, emitter ) {\n\t\treturn {\n\t\t\tto( eventNameOrFunctionOrAttribute, callback ) {\n\t\t\t\treturn new TemplateToBinding( {\n\t\t\t\t\teventNameOrFunction: eventNameOrFunctionOrAttribute,\n\t\t\t\t\tattribute: eventNameOrFunctionOrAttribute,\n\t\t\t\t\tobservable, emitter, callback\n\t\t\t\t} );\n\t\t\t},\n\n\t\t\tif( attribute, valueIfTrue, callback ) {\n\t\t\t\treturn new TemplateIfBinding( {\n\t\t\t\t\tobservable, emitter, attribute, valueIfTrue, callback\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Extends an existing {@link module:ui/template~Template} instance with some additional content\n\t * from another {@link module:ui/template~TemplateDefinition}.\n\t *\n\t *\t\tconst bind = Template.bind( observable, emitter );\n\t *\n\t *\t\tconst template = new Template( {\n\t *\t\t\ttag: 'p',\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'a',\n\t *\t\t\t\tdata-x: bind.to( 'foo' )\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t{\n\t *\t\t\t\t\ttag: 'span',\n\t *\t\t\t\t\tattributes: {\n\t *\t\t\t\t\t\tclass: 'b'\n\t *\t\t\t\t\t},\n\t *\t\t\t\t\tchildren: [\n\t *\t\t\t\t\t\t'Span'\n\t *\t\t\t\t\t]\n\t *\t\t\t\t}\n\t *\t\t\t]\n\t *\t\t } );\n\t *\n\t *\t\t// Instance-level extension.\n\t *\t\tTemplate.extend( template, {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'b',\n\t *\t\t\t\tdata-x: bind.to( 'bar' )\n\t *\t\t\t},\n\t *\t\t\tchildren: [\n\t *\t\t\t\t{\n\t *\t\t\t\t\tattributes: {\n\t *\t\t\t\t\t\tclass: 'c'\n\t *\t\t\t\t\t}\n\t *\t\t\t\t}\n\t *\t\t\t]\n\t *\t\t} );\n\t *\n\t *\t\t// Child extension.\n\t *\t\tTemplate.extend( template.children[ 0 ], {\n\t *\t\t\tattributes: {\n\t *\t\t\t\tclass: 'd'\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t * the `outerHTML` of `template.render()` is:\n\t *\n\t *\t\t<p class=\"a b\" data-x=\"{ observable.foo } { observable.bar }\">\n\t *\t\t\t<span class=\"b c d\">Span</span>\n\t *\t\t</p>\n\t *\n\t * @param {module:ui/template~Template} template An existing template instance to be extended.\n\t * @param {module:ui/template~TemplateDefinition} def Additional definition to be applied to a template.\n\t */\n\tstatic extend( template, def ) {\n\t\tif ( template._isRendered ) {\n\t\t\t/**\n\t\t\t * Extending a template after rendering may not work as expected. To make sure\n\t\t\t * the {@link module:ui/template~Template.extend extending} works for an element,\n\t\t\t * make sure it happens before {@link #render} is called.\n\t\t\t *\n\t\t\t * @error template-extend-render\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'template-extend-render',\n\t\t\t\t[ this, template ]\n\t\t\t);\n\t\t}\n\n\t\textendTemplate( template, normalize( clone( def ) ) );\n\t}\n\n\t/**\n\t * Renders a DOM Node (either an HTML element or text) out of the template.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderNode( data ) {\n\t\tlet isInvalid;\n\n\t\tif ( data.node ) {\n\t\t\t// When applying, a definition cannot have \"tag\" and \"text\" at the same time.\n\t\t\tisInvalid = this.tag && this.text;\n\t\t} else {\n\t\t\t// When rendering, a definition must have either \"tag\" or \"text\": XOR( this.tag, this.text ).\n\t\t\tisInvalid = this.tag ? this.text : !this.text;\n\t\t}\n\n\t\tif ( isInvalid ) {\n\t\t\t/**\n\t\t\t * Node definition cannot have the \"tag\" and \"text\" properties at the same time.\n\t\t\t * Node definition must have either \"tag\" or \"text\" when rendering a new Node.\n\t\t\t *\n\t\t\t * @error ui-template-wrong-syntax\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-wrong-syntax',\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tif ( this.text ) {\n\t\t\treturn this._renderText( data );\n\t\t} else {\n\t\t\treturn this._renderElement( data );\n\t\t}\n\t}\n\n\t/**\n\t * Renders an HTML element out of the template.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderElement( data ) {\n\t\tlet node = data.node;\n\n\t\tif ( !node ) {\n\t\t\tnode = data.node = document.createElementNS( this.ns || xhtmlNs, this.tag );\n\t\t}\n\n\t\tthis._renderAttributes( data );\n\t\tthis._renderElementChildren( data );\n\t\tthis._setUpListeners( data );\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Renders a text node out of {@link module:ui/template~Template#text}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderText( data ) {\n\t\tlet node = data.node;\n\n\t\t// Save the original textContent to revert it in #revert().\n\t\tif ( node ) {\n\t\t\tdata.revertData.text = node.textContent;\n\t\t} else {\n\t\t\tnode = data.node = document.createTextNode( '' );\n\t\t}\n\n\t\t// Check if this Text Node is bound to Observable. Cases:\n\t\t//\n\t\t//\t\ttext: [ Template.bind( ... ).to( ... ) ]\n\t\t//\n\t\t//\t\ttext: [\n\t\t//\t\t\t'foo',\n\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\n\t\t//\t\t\t...\n\t\t//\t\t]\n\t\t//\n\t\tif ( hasTemplateBinding( this.text ) ) {\n\t\t\tthis._bindToObservable( {\n\t\t\t\tschema: this.text,\n\t\t\t\tupdater: getTextUpdater( node ),\n\t\t\t\tdata\n\t\t\t} );\n\t\t}\n\t\t// Simply set text. Cases:\n\t\t//\n\t\t//\t\ttext: [ 'all', 'are', 'static' ]\n\t\t//\n\t\t//\t\ttext: [ 'foo' ]\n\t\t//\n\t\telse {\n\t\t\tnode.textContent = this.text.join( '' );\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Renders HTML element attributes out of {@link module:ui/template~Template#attributes}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderAttributes( data ) {\n\t\tlet attrName, attrValue, domAttrValue, attrNs;\n\n\t\tif ( !this.attributes ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst node = data.node;\n\t\tconst revertData = data.revertData;\n\n\t\tfor ( attrName in this.attributes ) {\n\t\t\t// Current attribute value in DOM.\n\t\t\tdomAttrValue = node.getAttribute( attrName );\n\n\t\t\t// The value to be set.\n\t\t\tattrValue = this.attributes[ attrName ];\n\n\t\t\t// Save revert data.\n\t\t\tif ( revertData ) {\n\t\t\t\trevertData.attributes[ attrName ] = domAttrValue;\n\t\t\t}\n\n\t\t\t// Detect custom namespace:\n\t\t\t//\n\t\t\t//\t\tclass: {\n\t\t\t//\t\t\tns: 'abc',\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tattrNs = ( isObject( attrValue[ 0 ] ) && attrValue[ 0 ].ns ) ? attrValue[ 0 ].ns : null;\n\n\t\t\t// Activate binding if one is found. Cases:\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... )\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t'bar',\n\t\t\t//\t\t\tTemplate.bind( ... ).to( ... ),\n\t\t\t//\t\t\t'baz'\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\t//\t\tclass: {\n\t\t\t//\t\t\tns: 'abc',\n\t\t\t//\t\t\tvalue: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tif ( hasTemplateBinding( attrValue ) ) {\n\t\t\t\t// Normalize attributes with additional data like namespace:\n\t\t\t\t//\n\t\t\t\t//\t\tclass: {\n\t\t\t\t//\t\t\tns: 'abc',\n\t\t\t\t//\t\t\tvalue: [ ... ]\n\t\t\t\t//\t\t}\n\t\t\t\t//\n\t\t\t\tconst valueToBind = attrNs ? attrValue[ 0 ].value : attrValue;\n\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\n\t\t\t\t// don't override them.\n\t\t\t\tif ( revertData && shouldExtend( attrName ) ) {\n\t\t\t\t\tvalueToBind.unshift( domAttrValue );\n\t\t\t\t}\n\n\t\t\t\tthis._bindToObservable( {\n\t\t\t\t\tschema: valueToBind,\n\t\t\t\t\tupdater: getAttributeUpdater( node, attrName, attrNs ),\n\t\t\t\t\tdata\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Style attribute could be an Object so it needs to be parsed in a specific way.\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\twidth: '100px',\n\t\t\t//\t\t\theight: Template.bind( ... ).to( ... )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\telse if ( attrName == 'style' && typeof attrValue[ 0 ] !== 'string' ) {\n\t\t\t\tthis._renderStyleAttribute( attrValue[ 0 ], data );\n\t\t\t}\n\n\t\t\t// Otherwise simply set the static attribute:\n\t\t\t//\n\t\t\t//\t\tclass: [ 'foo' ]\n\t\t\t//\n\t\t\t//\t\tclass: [ 'all', 'are', 'static' ]\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t{\n\t\t\t//\t\t\t\tns: 'abc',\n\t\t\t//\t\t\t\tvalue: [ 'foo' ]\n\t\t\t//\t\t\t}\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\telse {\n\t\t\t\t// Extend the original value of attributes like \"style\" and \"class\",\n\t\t\t\t// don't override them.\n\t\t\t\tif ( revertData && domAttrValue && shouldExtend( attrName ) ) {\n\t\t\t\t\tattrValue.unshift( domAttrValue );\n\t\t\t\t}\n\n\t\t\t\tattrValue = attrValue\n\t\t\t\t\t// Retrieve \"values\" from:\n\t\t\t\t\t//\n\t\t\t\t\t//\t\tclass: [\n\t\t\t\t\t//\t\t\t{\n\t\t\t\t\t//\t\t\t\tns: 'abc',\n\t\t\t\t\t//\t\t\t\tvalue: [ ... ]\n\t\t\t\t\t//\t\t\t}\n\t\t\t\t\t//\t\t]\n\t\t\t\t\t//\n\t\t\t\t\t.map( val => val ? ( val.value || val ) : val )\n\t\t\t\t\t// Flatten the array.\n\t\t\t\t\t.reduce( ( prev, next ) => prev.concat( next ), [] )\n\t\t\t\t\t// Convert into string.\n\t\t\t\t\t.reduce( arrayValueReducer, '' );\n\n\t\t\t\tif ( !isFalsy( attrValue ) ) {\n\t\t\t\t\tnode.setAttributeNS( attrNs, attrName, attrValue );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Renders the `style` attribute of an HTML element based on\n\t * {@link module:ui/template~Template#attributes}.\n\t *\n\t * A style attribute is an {Object} with static values:\n\t *\n\t *\t\tattributes: {\n\t *\t\t\tstyle: {\n\t *\t\t\t\tcolor: 'red'\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t * or values bound to {@link module:ui/model~Model} properties:\n\t *\n\t *\t\tattributes: {\n\t *\t\t\tstyle: {\n\t *\t\t\t\tcolor: bind.to( ... )\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t * Note: The `style` attribute is rendered without setting the namespace. It does not seem to be\n\t * needed.\n\t *\n\t * @private\n\t * @param {Object} styles Styles located in `attributes.style` of {@link module:ui/template~TemplateDefinition}.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderStyleAttribute( styles, data ) {\n\t\tconst node = data.node;\n\n\t\tfor ( const styleName in styles ) {\n\t\t\tconst styleValue = styles[ styleName ];\n\n\t\t\t// Cases:\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\tcolor: bind.to( 'attribute' )\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\tif ( hasTemplateBinding( styleValue ) ) {\n\t\t\t\tthis._bindToObservable( {\n\t\t\t\t\tschema: [ styleValue ],\n\t\t\t\t\tupdater: getStyleUpdater( node, styleName ),\n\t\t\t\t\tdata\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// Cases:\n\t\t\t//\n\t\t\t//\t\tstyle: {\n\t\t\t//\t\t\tcolor: 'red'\n\t\t\t//\t\t}\n\t\t\t//\n\t\t\telse {\n\t\t\t\tnode.style[ styleName ] = styleValue;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Recursively renders HTML element's children from {@link module:ui/template~Template#children}.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_renderElementChildren( data ) {\n\t\tconst node = data.node;\n\t\tconst container = data.intoFragment ? document.createDocumentFragment() : node;\n\t\tconst isApplying = data.isApplying;\n\t\tlet childIndex = 0;\n\n\t\tfor ( const child of this.children ) {\n\t\t\tif ( isViewCollection( child ) ) {\n\t\t\t\tif ( !isApplying ) {\n\t\t\t\t\tchild.setParent( node );\n\n\t\t\t\t\t// Note: ViewCollection renders its children.\n\t\t\t\t\tfor ( const view of child ) {\n\t\t\t\t\t\tcontainer.appendChild( view.element );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if ( isView( child ) ) {\n\t\t\t\tif ( !isApplying ) {\n\t\t\t\t\tif ( !child.isRendered ) {\n\t\t\t\t\t\tchild.render();\n\t\t\t\t\t}\n\n\t\t\t\t\tcontainer.appendChild( child.element );\n\t\t\t\t}\n\t\t\t} else if ( isNode( child ) ) {\n\t\t\t\tcontainer.appendChild( child );\n\t\t\t} else {\n\t\t\t\tif ( isApplying ) {\n\t\t\t\t\tconst revertData = data.revertData;\n\t\t\t\t\tconst childRevertData = getEmptyRevertData();\n\n\t\t\t\t\trevertData.children.push( childRevertData );\n\n\t\t\t\t\tchild._renderNode( {\n\t\t\t\t\t\tnode: container.childNodes[ childIndex++ ],\n\t\t\t\t\t\tisApplying: true,\n\t\t\t\t\t\trevertData: childRevertData\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.appendChild( child.render() );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( data.intoFragment ) {\n\t\t\tnode.appendChild( container );\n\t\t}\n\t}\n\n\t/**\n\t * Activates `on` event listeners from the {@link module:ui/template~TemplateDefinition}\n\t * on an HTML element.\n\t *\n\t * @protected\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t */\n\t_setUpListeners( data ) {\n\t\tif ( !this.eventListeners ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( const key in this.eventListeners ) {\n\t\t\tconst revertBindings = this.eventListeners[ key ].map( schemaItem => {\n\t\t\t\tconst [ domEvtName, domSelector ] = key.split( '@' );\n\n\t\t\t\treturn schemaItem.activateDomEventListener( domEvtName, domSelector, data );\n\t\t\t} );\n\n\t\t\tif ( data.revertData ) {\n\t\t\t\tdata.revertData.bindings.push( revertBindings );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * For a given {@link module:ui/template~TemplateValueSchema} containing {@link module:ui/template~TemplateBinding}\n\t * activates the binding and sets its initial value.\n\t *\n\t * Note: {@link module:ui/template~TemplateValueSchema} can be for HTML element attributes or\n\t * text node `textContent`.\n\t *\n\t * @protected\n\t * @param {Object} options Binding options.\n\t * @param {module:ui/template~TemplateValueSchema} options.schema\n\t * @param {Function} options.updater A function which updates the DOM (like attribute or text).\n\t * @param {module:ui/template~RenderData} options.data Rendering data.\n\t */\n\t_bindToObservable( { schema, updater, data } ) {\n\t\tconst revertData = data.revertData;\n\n\t\t// Set initial values.\n\t\tsyncValueSchemaValue( schema, updater, data );\n\n\t\tconst revertBindings = schema\n\t\t\t// Filter \"falsy\" (false, undefined, null, '') value schema components out.\n\t\t\t.filter( item => !isFalsy( item ) )\n\t\t\t// Filter inactive bindings from schema, like static strings ('foo'), numbers (42), etc.\n\t\t\t.filter( item => item.observable )\n\t\t\t// Once only the actual binding are left, let the emitter listen to observable change:attribute event.\n\t\t\t// TODO: Reduce the number of listeners attached as many bindings may listen\n\t\t\t// to the same observable attribute.\n\t\t\t.map( templateBinding => templateBinding.activateAttributeListener( schema, updater, data ) );\n\n\t\tif ( revertData ) {\n\t\t\trevertData.bindings.push( revertBindings );\n\t\t}\n\t}\n\n\t/**\n\t * Reverts {@link module:ui/template~RenderData#revertData template data} from a node to\n\t * return it to the original state.\n\t *\n\t * @protected\n\t * @param {HTMLElement|Text} node A node to be reverted.\n\t * @param {Object} revertData An object that stores information about what changes have been made by\n\t * {@link #apply} to the node. See {@link module:ui/template~RenderData#revertData} for more information.\n\t */\n\t_revertTemplateFromNode( node, revertData ) {\n\t\tfor ( const binding of revertData.bindings ) {\n\t\t\t// Each binding may consist of several observable+observable#attribute.\n\t\t\t// like the following has 2:\n\t\t\t//\n\t\t\t//\t\tclass: [\n\t\t\t//\t\t\t'x',\n\t\t\t//\t\t\tbind.to( 'foo' ),\n\t\t\t//\t\t\t'y',\n\t\t\t//\t\t\tbind.to( 'bar' )\n\t\t\t//\t\t]\n\t\t\t//\n\t\t\tfor ( const revertBinding of binding ) {\n\t\t\t\trevertBinding();\n\t\t\t}\n\t\t}\n\n\t\tif ( revertData.text ) {\n\t\t\tnode.textContent = revertData.text;\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( const attrName in revertData.attributes ) {\n\t\t\tconst attrValue = revertData.attributes[ attrName ];\n\n\t\t\t// When the attribute has **not** been set before #apply().\n\t\t\tif ( attrValue === null ) {\n\t\t\t\tnode.removeAttribute( attrName );\n\t\t\t} else {\n\t\t\t\tnode.setAttribute( attrName, attrValue );\n\t\t\t}\n\t\t}\n\n\t\tfor ( let i = 0; i < revertData.children.length; ++i ) {\n\t\t\tthis._revertTemplateFromNode( node.childNodes[ i ], revertData.children[ i ] );\n\t\t}\n\t}\n}\n\nmix( Template, EmitterMixin );\n\n/**\n * Describes a binding created by the {@link module:ui/template~Template.bind} interface.\n *\n * @protected\n */\nexport class TemplateBinding {\n\t/**\n\t * Creates an instance of the {@link module:ui/template~TemplateBinding} class.\n\t *\n\t * @param {module:ui/template~TemplateDefinition} def The definition of the binding.\n\t */\n\tconstructor( def ) {\n\t\tObject.assign( this, def );\n\n\t\t/**\n\t\t * An observable instance of the binding. It either:\n\t\t *\n\t\t * * provides the attribute with the value,\n\t\t * * or passes the event when a corresponding DOM event is fired.\n\t\t *\n\t\t * @member {module:utils/observablemixin~ObservableMixin} module:ui/template~TemplateBinding#observable\n\t\t */\n\n\t\t/**\n\t\t * An {@link module:utils/emittermixin~Emitter} used by the binding to:\n\t\t *\n\t\t * * listen to the attribute change in the {@link module:ui/template~TemplateBinding#observable},\n\t\t * * or listen to the event in the DOM.\n\t\t *\n\t\t * @member {module:utils/emittermixin~EmitterMixin} module:ui/template~TemplateBinding#emitter\n\t\t */\n\n\t\t/**\n\t\t * The name of the {@link module:ui/template~TemplateBinding#observable observed attribute}.\n\t\t *\n\t\t * @member {String} module:ui/template~TemplateBinding#attribute\n\t\t */\n\n\t\t/**\n\t\t * A custom function to process the value of the {@link module:ui/template~TemplateBinding#attribute}.\n\t\t *\n\t\t * @member {Function} [module:ui/template~TemplateBinding#callback]\n\t\t */\n\t}\n\n\t/**\n\t * Returns the value of the binding. It is the value of the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}. The value may be processed by the\n\t * {@link module:ui/template~TemplateBinding#callback}, if such has been passed to the binding.\n\t *\n\t * @param {Node} [node] A native DOM node, passed to the custom {@link module:ui/template~TemplateBinding#callback}.\n\t * @returns {*} The value of {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}.\n\t */\n\tgetValue( node ) {\n\t\tconst value = this.observable[ this.attribute ];\n\n\t\treturn this.callback ? this.callback( value, node ) : value;\n\t}\n\n\t/**\n\t * Activates the listener which waits for changes of the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable}, then updates the DOM with the aggregated\n\t * value of {@link module:ui/template~TemplateValueSchema}.\n\t *\n\t * @param {module:ui/template~TemplateValueSchema} schema A full schema to generate an attribute or text in the DOM.\n\t * @param {Function} updater A DOM updater function used to update the native DOM attribute or text.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t * @returns {Function} A function to sever the listener binding.\n\t */\n\tactivateAttributeListener( schema, updater, data ) {\n\t\tconst callback = () => syncValueSchemaValue( schema, updater, data );\n\n\t\tthis.emitter.listenTo( this.observable, 'change:' + this.attribute, callback );\n\n\t\t// Allows revert of the listener.\n\t\treturn () => {\n\t\t\tthis.emitter.stopListening( this.observable, 'change:' + this.attribute, callback );\n\t\t};\n\t}\n}\n\n/**\n * Describes either:\n *\n * * a binding to an {@link module:utils/observablemixin~Observable},\n * * or a native DOM event binding.\n *\n * It is created by the {@link module:ui/template~BindChain#to} method.\n *\n * @protected\n */\nexport class TemplateToBinding extends TemplateBinding {\n\t/**\n\t * Activates the listener for the native DOM event, which when fired, is propagated by\n\t * the {@link module:ui/template~TemplateBinding#emitter}.\n\t *\n\t * @param {String} domEvtName The name of the native DOM event.\n\t * @param {String} domSelector The selector in the DOM to filter delegated events.\n\t * @param {module:ui/template~RenderData} data Rendering data.\n\t * @returns {Function} A function to sever the listener binding.\n\t */\n\tactivateDomEventListener( domEvtName, domSelector, data ) {\n\t\tconst callback = ( evt, domEvt ) => {\n\t\t\tif ( !domSelector || domEvt.target.matches( domSelector ) ) {\n\t\t\t\tif ( typeof this.eventNameOrFunction == 'function' ) {\n\t\t\t\t\tthis.eventNameOrFunction( domEvt );\n\t\t\t\t} else {\n\t\t\t\t\tthis.observable.fire( this.eventNameOrFunction, domEvt );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.emitter.listenTo( data.node, domEvtName, callback );\n\n\t\t// Allows revert of the listener.\n\t\treturn () => {\n\t\t\tthis.emitter.stopListening( data.node, domEvtName, callback );\n\t\t};\n\t}\n}\n\n/**\n * Describes a binding to {@link module:utils/observablemixin~ObservableMixin} created by the {@link module:ui/template~BindChain#if}\n * method.\n *\n * @protected\n */\nexport class TemplateIfBinding extends TemplateBinding {\n\t/**\n\t * @inheritDoc\n\t */\n\tgetValue( node ) {\n\t\tconst value = super.getValue( node );\n\n\t\treturn isFalsy( value ) ? false : ( this.valueIfTrue || true );\n\t}\n\n\t/**\n\t * The value of the DOM attribute or text to be set if the {@link module:ui/template~TemplateBinding#attribute} in\n\t * {@link module:ui/template~TemplateBinding#observable} is `true`.\n\t *\n\t * @member {String} [module:ui/template~TemplateIfBinding#valueIfTrue]\n\t */\n}\n\n// Checks whether given {@link module:ui/template~TemplateValueSchema} contains a\n// {@link module:ui/template~TemplateBinding}.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @returns {Boolean}\nfunction hasTemplateBinding( schema ) {\n\tif ( !schema ) {\n\t\treturn false;\n\t}\n\n\t// Normalize attributes with additional data like namespace:\n\t//\n\t//\t\tclass: {\n\t//\t\t\tns: 'abc',\n\t//\t\t\tvalue: [ ... ]\n\t//\t\t}\n\t//\n\tif ( schema.value ) {\n\t\tschema = schema.value;\n\t}\n\n\tif ( Array.isArray( schema ) ) {\n\t\treturn schema.some( hasTemplateBinding );\n\t} else if ( schema instanceof TemplateBinding ) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n// Assembles the value using {@link module:ui/template~TemplateValueSchema} and stores it in a form of\n// an Array. Each entry of the Array corresponds to one of {@link module:ui/template~TemplateValueSchema}\n// items.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\n// @returns {Array}\nfunction getValueSchemaValue( schema, node ) {\n\treturn schema.map( schemaItem => {\n\t\t// Process {@link module:ui/template~TemplateBinding} bindings.\n\t\tif ( schemaItem instanceof TemplateBinding ) {\n\t\t\treturn schemaItem.getValue( node );\n\t\t}\n\n\t\t// All static values like strings, numbers, and \"falsy\" values (false, null, undefined, '', etc.) just pass.\n\t\treturn schemaItem;\n\t} );\n}\n\n// A function executed each time the bound Observable attribute changes, which updates the DOM with a value\n// constructed from {@link module:ui/template~TemplateValueSchema}.\n//\n// @param {module:ui/template~TemplateValueSchema} schema\n// @param {Function} updater A function which updates the DOM (like attribute or text).\n// @param {Node} node DOM Node updated when {@link module:utils/observablemixin~ObservableMixin} changes.\nfunction syncValueSchemaValue( schema, updater, { node } ) {\n\tlet value = getValueSchemaValue( schema, node );\n\n\t// Check if schema is a single Template.bind.if, like:\n\t//\n\t//\t\tclass: Template.bind.if( 'foo' )\n\t//\n\tif ( schema.length == 1 && schema[ 0 ] instanceof TemplateIfBinding ) {\n\t\tvalue = value[ 0 ];\n\t} else {\n\t\tvalue = value.reduce( arrayValueReducer, '' );\n\t}\n\n\tif ( isFalsy( value ) ) {\n\t\tupdater.remove();\n\t} else {\n\t\tupdater.set( value );\n\t}\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of DOM Node to set or reset `textContent`.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @returns {Object}\nfunction getTextUpdater( node ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tnode.textContent = value;\n\t\t},\n\n\t\tremove() {\n\t\t\tnode.textContent = '';\n\t\t}\n\t};\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of DOM Node to set or reset an attribute.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @param {String} attrName Name of the attribute to be modified.\n// @param {String} [ns=null] Namespace to use.\n// @returns {Object}\nfunction getAttributeUpdater( el, attrName, ns ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tel.setAttributeNS( ns, attrName, value );\n\t\t},\n\n\t\tremove() {\n\t\t\tel.removeAttributeNS( ns, attrName );\n\t\t}\n\t};\n}\n\n// Returns an object consisting of `set` and `remove` functions, which\n// can be used in the context of CSSStyleDeclaration to set or remove a style.\n// @see module:ui/view~View#_bindToObservable\n//\n// @param {Node} node DOM Node to be modified.\n// @param {String} styleName Name of the style to be modified.\n// @returns {Object}\nfunction getStyleUpdater( el, styleName ) {\n\treturn {\n\t\tset( value ) {\n\t\t\tel.style[ styleName ] = value;\n\t\t},\n\n\t\tremove() {\n\t\t\tel.style[ styleName ] = null;\n\t\t}\n\t};\n}\n\n// Clones definition of the template.\n//\n// @param {module:ui/template~TemplateDefinition} def\n// @returns {module:ui/template~TemplateDefinition}\nfunction clone( def ) {\n\tconst clone = cloneDeepWith( def, value => {\n\t\t// Don't clone the `Template.bind`* bindings because of the references to Observable\n\t\t// and DomEmitterMixin instances inside, which would also be traversed and cloned by greedy\n\t\t// cloneDeepWith algorithm. There's no point in cloning Observable/DomEmitterMixins\n\t\t// along with the definition.\n\t\t//\n\t\t// Don't clone Template instances if provided as a child. They're simply #render()ed\n\t\t// and nothing should interfere.\n\t\t//\n\t\t// Also don't clone View instances if provided as a child of the Template. The template\n\t\t// instance will be extracted from the View during the normalization and there's no need\n\t\t// to clone it.\n\t\tif ( value && ( value instanceof TemplateBinding || isTemplate( value ) || isView( value ) || isViewCollection( value ) ) ) {\n\t\t\treturn value;\n\t\t}\n\t} );\n\n\treturn clone;\n}\n\n// Normalizes given {@link module:ui/template~TemplateDefinition}.\n//\n// See:\n//  * {@link normalizeAttributes}\n//  * {@link normalizeListeners}\n//  * {@link normalizePlainTextDefinition}\n//  * {@link normalizeTextDefinition}\n//\n// @param {module:ui/template~TemplateDefinition} def\n// @returns {module:ui/template~TemplateDefinition} Normalized definition.\nfunction normalize( def ) {\n\tif ( typeof def == 'string' ) {\n\t\tdef = normalizePlainTextDefinition( def );\n\t} else if ( def.text ) {\n\t\tnormalizeTextDefinition( def );\n\t}\n\n\tif ( def.on ) {\n\t\tdef.eventListeners = normalizeListeners( def.on );\n\n\t\t// Template mixes EmitterMixin, so delete #on to avoid collision.\n\t\tdelete def.on;\n\t}\n\n\tif ( !def.text ) {\n\t\tif ( def.attributes ) {\n\t\t\tnormalizeAttributes( def.attributes );\n\t\t}\n\n\t\tconst children = [];\n\n\t\tif ( def.children ) {\n\t\t\tif ( isViewCollection( def.children ) ) {\n\t\t\t\tchildren.push( def.children );\n\t\t\t} else {\n\t\t\t\tfor ( const child of def.children ) {\n\t\t\t\t\tif ( isTemplate( child ) || isView( child ) || isNode( child ) ) {\n\t\t\t\t\t\tchildren.push( child );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildren.push( new Template( child ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdef.children = children;\n\t}\n\n\treturn def;\n}\n\n// Normalizes \"attributes\" section of {@link module:ui/template~TemplateDefinition}.\n//\n//\t\tattributes: {\n//\t\t\ta: 'bar',\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\n//\t\t\tc: {\n//\t\t\t\tvalue: 'bar'\n//\t\t\t}\n//\t\t}\n//\n// becomes\n//\n//\t\tattributes: {\n//\t\t\ta: [ 'bar' ],\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\n//\t\t\tc: {\n//\t\t\t\tvalue: [ 'bar' ]\n//\t\t\t}\n//\t\t}\n//\n// @param {Object} attributes\nfunction normalizeAttributes( attributes ) {\n\tfor ( const a in attributes ) {\n\t\tif ( attributes[ a ].value ) {\n\t\t\tattributes[ a ].value = toArray( attributes[ a ].value );\n\t\t}\n\n\t\tarrayify( attributes, a );\n\t}\n}\n\n// Normalizes \"on\" section of {@link module:ui/template~TemplateDefinition}.\n//\n//\t\ton: {\n//\t\t\ta: 'bar',\n//\t\t\tb: {@link module:ui/template~TemplateBinding},\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\n//\t\t}\n//\n// becomes\n//\n//\t\ton: {\n//\t\t\ta: [ 'bar' ],\n//\t\t\tb: [ {@link module:ui/template~TemplateBinding} ],\n//\t\t\tc: [ {@link module:ui/template~TemplateBinding}, () => { ... } ]\n//\t\t}\n//\n// @param {Object} listeners\n// @returns {Object} Object containing normalized listeners.\nfunction normalizeListeners( listeners ) {\n\tfor ( const l in listeners ) {\n\t\tarrayify( listeners, l );\n\t}\n\n\treturn listeners;\n}\n\n// Normalizes \"string\" {@link module:ui/template~TemplateDefinition}.\n//\n//\t\t\"foo\"\n//\n// becomes\n//\n//\t\t{ text: [ 'foo' ] },\n//\n// @param {String} def\n// @returns {module:ui/template~TemplateDefinition} Normalized template definition.\nfunction normalizePlainTextDefinition( def ) {\n\treturn {\n\t\ttext: [ def ]\n\t};\n}\n\n// Normalizes text {@link module:ui/template~TemplateDefinition}.\n//\n//\t\tchildren: [\n//\t\t\t{ text: 'def' },\n//\t\t\t{ text: {@link module:ui/template~TemplateBinding} }\n//\t\t]\n//\n// becomes\n//\n//\t\tchildren: [\n//\t\t\t{ text: [ 'def' ] },\n//\t\t\t{ text: [ {@link module:ui/template~TemplateBinding} ] }\n//\t\t]\n//\n// @param {module:ui/template~TemplateDefinition} def\nfunction normalizeTextDefinition( def ) {\n\tdef.text = toArray( def.text );\n}\n\n// Wraps an entry in Object in an Array, if not already one.\n//\n//\t\t{\n//\t\t\tx: 'y',\n//\t\t\ta: [ 'b' ]\n//\t\t}\n//\n// becomes\n//\n//\t\t{\n//\t\t\tx: [ 'y' ],\n//\t\t\ta: [ 'b' ]\n//\t\t}\n//\n// @param {Object} obj\n// @param {String} key\nfunction arrayify( obj, key ) {\n\tobj[ key ] = toArray( obj[ key ] );\n}\n\n// A helper which concatenates the value avoiding unwanted\n// leading white spaces.\n//\n// @param {String} prev\n// @param {String} cur\n// @returns {String}\nfunction arrayValueReducer( prev, cur ) {\n\tif ( isFalsy( cur ) ) {\n\t\treturn prev;\n\t} else if ( isFalsy( prev ) ) {\n\t\treturn cur;\n\t} else {\n\t\treturn `${ prev } ${ cur }`;\n\t}\n}\n\n// Extends one object defined in the following format:\n//\n//\t\t{\n//\t\t\tkey1: [Array1],\n//\t\t\tkey2: [Array2],\n//\t\t\t...\n//\t\t\tkeyN: [ArrayN]\n//\t\t}\n//\n// with another object of the same data format.\n//\n// @param {Object} obj Base object.\n// @param {Object} ext Object extending base.\n// @returns {String}\nfunction extendObjectValueArray( obj, ext ) {\n\tfor ( const a in ext ) {\n\t\tif ( obj[ a ] ) {\n\t\t\tobj[ a ].push( ...ext[ a ] );\n\t\t} else {\n\t\t\tobj[ a ] = ext[ a ];\n\t\t}\n\t}\n}\n\n// A helper for {@link module:ui/template~Template#extend}. Recursively extends {@link module:ui/template~Template} instance\n// with content from {@link module:ui/template~TemplateDefinition}. See {@link module:ui/template~Template#extend} to learn more.\n//\n// @param {module:ui/template~Template} def A template instance to be extended.\n// @param {module:ui/template~TemplateDefinition} def A definition which is to extend the template instance.\n// @param {Object} Error context.\nfunction extendTemplate( template, def ) {\n\tif ( def.attributes ) {\n\t\tif ( !template.attributes ) {\n\t\t\ttemplate.attributes = {};\n\t\t}\n\n\t\textendObjectValueArray( template.attributes, def.attributes );\n\t}\n\n\tif ( def.eventListeners ) {\n\t\tif ( !template.eventListeners ) {\n\t\t\ttemplate.eventListeners = {};\n\t\t}\n\n\t\textendObjectValueArray( template.eventListeners, def.eventListeners );\n\t}\n\n\tif ( def.text ) {\n\t\ttemplate.text.push( ...def.text );\n\t}\n\n\tif ( def.children && def.children.length ) {\n\t\tif ( template.children.length != def.children.length ) {\n\t\t\t/**\n\t\t\t * The number of children in extended definition does not match.\n\t\t\t *\n\t\t\t * @error ui-template-extend-children-mismatch\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'ui-template-extend-children-mismatch',\n\t\t\t\ttemplate\n\t\t\t);\n\t\t}\n\n\t\tlet childIndex = 0;\n\n\t\tfor ( const childDef of def.children ) {\n\t\t\textendTemplate( template.children[ childIndex++ ], childDef );\n\t\t}\n\t}\n}\n\n// Checks if value is \"falsy\".\n// Note: 0 (Number) is not \"falsy\" in this context.\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isFalsy( value ) {\n\treturn !value && value !== 0;\n}\n\n// Checks if the item is an instance of {@link module:ui/view~View}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isView( item ) {\n\treturn item instanceof View;\n}\n\n// Checks if the item is an instance of {@link module:ui/template~Template}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isTemplate( item ) {\n\treturn item instanceof Template;\n}\n\n// Checks if the item is an instance of {@link module:ui/viewcollection~ViewCollection}\n//\n// @private\n// @param {*} value Value to be checked.\nfunction isViewCollection( item ) {\n\treturn item instanceof ViewCollection;\n}\n\n// Creates an empty skeleton for {@link module:ui/template~Template#revert}\n// data.\n//\n// @private\nfunction getEmptyRevertData() {\n\treturn {\n\t\tchildren: [],\n\t\tbindings: [],\n\t\tattributes: {}\n\t};\n}\n\n// Checks whether an attribute should be extended when\n// {@link module:ui/template~Template#apply} is called.\n//\n// @private\n// @param {String} attrName Attribute name to check.\nfunction shouldExtend( attrName ) {\n\treturn attrName == 'class' || attrName == 'style';\n}\n\n/**\n * A definition of the {@link module:ui/template~Template}. It describes what kind of\n * node a template will render (HTML element or text), attributes of an element, DOM event\n * listeners and children.\n *\n * Also see:\n * * {@link module:ui/template~TemplateValueSchema} to learn about HTML element attributes,\n * * {@link module:ui/template~TemplateListenerSchema} to learn about DOM event listeners.\n *\n * A sample definition on an HTML element can look like this:\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tchildren: [\n *\t\t\t\t{\n *\t\t\t\t\ttag: 'span',\n *\t\t\t\t\tattributes: { ... },\n *\t\t\t\t\tchildren: [ ... ],\n *\t\t\t\t},\n *\t\t\t\t{\n *\t\t\t\t\ttext: 'static–text'\n *\t\t\t\t},\n *\t\t\t\t'also-static–text',\n *\t\t\t],\n *\t\t\tattributes: {\n *\t\t\t\tclass: {@link module:ui/template~TemplateValueSchema},\n *\t\t\t\tid: {@link module:ui/template~TemplateValueSchema},\n *\t\t\t\tstyle: {@link module:ui/template~TemplateValueSchema}\n *\n *\t\t\t\t// ...\n *\t\t\t},\n *\t\t\ton: {\n *\t\t\t\t'click': {@link module:ui/template~TemplateListenerSchema}\n *\n *\t\t\t\t// Document.querySelector format is also accepted.\n *\t\t\t\t'keyup@a.some-class': {@link module:ui/template~TemplateListenerSchema}\n *\n *\t\t\t\t// ...\n *\t\t\t}\n *\t\t} );\n *\n * A {@link module:ui/view~View}, another {@link module:ui/template~Template} or a native DOM node\n * can also become a child of a template. When a view is passed, its {@link module:ui/view~View#element} is used:\n *\n *\t\tconst view = new SomeView();\n *\t\tconst childTemplate = new Template( { ... } );\n *\t\tconst childNode = document.createElement( 'b' );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\n *\t\t\tchildren: [\n *\t\t\t\t// view#element will be added as a child of this <p>.\n *\t\t\t\tview,\n *\n * \t\t\t\t// The output of childTemplate.render() will be added here.\n *\t\t\t\tchildTemplate,\n *\n *\t\t\t\t// Native DOM nodes are included directly in the rendered output.\n *\t\t\t\tchildNode\n *\t\t\t]\n *\t\t} );\n *\n * An entire {@link module:ui/viewcollection~ViewCollection} can be used as a child in the definition:\n *\n *\t\tconst collection = new ViewCollection();\n *\t\tcollection.add( someView );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\n *\t\t\tchildren: collection\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateDefinition\n * @type Object\n *\n * @property {String} tag See the template {@link module:ui/template~Template#tag} property.\n *\n * @property {Array.<module:ui/template~TemplateDefinition>} [children]\n * See the template {@link module:ui/template~Template#children} property.\n *\n * @property {Object.<String, module:ui/template~TemplateValueSchema>} [attributes]\n * See the template {@link module:ui/template~Template#attributes} property.\n *\n * @property {String|module:ui/template~TemplateValueSchema|Array.<String|module:ui/template~TemplateValueSchema>} [text]\n * See the template {@link module:ui/template~Template#text} property.\n *\n * @property {Object.<String, module:ui/template~TemplateListenerSchema>} [on]\n * See the template {@link module:ui/template~Template#eventListeners} property.\n */\n\n/**\n * Describes a value of an HTML element attribute or `textContent`. It allows combining multiple\n * data sources like static values and {@link module:utils/observablemixin~Observable} attributes.\n *\n * Also see:\n * * {@link module:ui/template~TemplateDefinition} to learn where to use it,\n * * {@link module:ui/template~Template.bind} to learn how to configure\n * {@link module:utils/observablemixin~Observable} attribute bindings,\n * * {@link module:ui/template~Template#render} to learn how to render a template,\n * * {@link module:ui/template~BindChain#to `to()`} and {@link module:ui/template~BindChain#if `if()`}\n * methods to learn more about bindings.\n *\n * Attribute values can be described in many different ways:\n *\n *\t\t// Bind helper will create bindings to attributes of the observable.\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\t// A plain string schema.\n *\t\t\t\t'class': 'static-text',\n *\n *\t\t\t\t// An object schema, binds to the \"foo\" attribute of the\n *\t\t\t\t// observable and follows its value.\n *\t\t\t\t'class': bind.to( 'foo' ),\n *\n *\t\t\t\t// An array schema, combines the above.\n *\t\t\t\t'class': [\n *\t\t\t\t\t'static-text',\n *\t\t\t\t\tbind.to( 'bar', () => { ... } ),\n *\n * \t\t\t\t\t// Bindings can also be conditional.\n *\t\t\t\t\tbind.if( 'baz', 'class-when-baz-is-true' )\n *\t\t\t\t],\n *\n *\t\t\t\t// An array schema, with a custom namespace, e.g. useful for creating SVGs.\n *\t\t\t\t'class': {\n *\t\t\t\t\tns: 'http://ns.url',\n *\t\t\t\t\tvalue: [\n *\t\t\t\t\t\tbind.if( 'baz', 'value-when-true' ),\n *\t\t\t\t\t\t'static-text'\n *\t\t\t\t\t]\n *\t\t\t\t},\n *\n *\t\t\t\t// An object schema, specific for styles.\n *\t\t\t\tstyle: {\n *\t\t\t\t\tcolor: 'red',\n *\t\t\t\t\tbackgroundColor: bind.to( 'qux', () => { ... } )\n *\t\t\t\t}\n *\t\t\t}\n *\t\t} );\n *\n * Text nodes can also have complex values:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\t// Will render a \"foo\" text node.\n *\t\tnew Template( {\n *\t\t\ttext: 'foo'\n *\t\t} );\n *\n *\t\t// Will render a \"static text: {observable.foo}\" text node.\n *\t\t// The text of the node will be updated as the \"foo\" attribute changes.\n *\t\tnew Template( {\n *\t\t\ttext: [\n *\t\t\t\t'static text: ',\n *\t\t\t\tbind.to( 'foo', () => { ... } )\n *\t\t\t]\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateValueSchema\n * @type {Object|String|Array}\n */\n\n/**\n * Describes an event listener attached to an HTML element. Such listener can propagate DOM events\n * through an {@link module:utils/observablemixin~Observable} instance, execute custom callbacks\n * or both, if necessary.\n *\n * Also see:\n * * {@link module:ui/template~TemplateDefinition} to learn more about template definitions,\n * * {@link module:ui/template~BindChain#to `to()`} method to learn more about bindings.\n *\n * Check out different ways of attaching event listeners below:\n *\n *\t\t// Bind helper will propagate events through the observable.\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\ton: {\n *\t\t\t\t// An object schema. The observable will fire the \"clicked\" event upon DOM \"click\".\n *\t\t\t\tclick: bind.to( 'clicked' )\n *\n *\t\t\t\t// An object schema. It will work for \"click\" event on \"a.foo\" children only.\n *\t\t\t\t'click@a.foo': bind.to( 'clicked' )\n *\n *\t\t\t\t// An array schema, makes the observable propagate multiple events.\n *\t\t\t\tclick: [\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\t\t\t\t\tbind.to( 'executed' )\n *\t\t\t\t],\n *\n *\t\t\t\t// An array schema with a custom callback.\n *\t\t\t\t'click@a.foo': {\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\t\t\t\t\tbind.to( evt => {\n *\t\t\t\t\t\tconsole.log( `${ evt.target } has been clicked!` );\n *\t\t\t\t\t} }\n *\t\t\t\t}\n *\t\t\t}\n *\t\t} );\n *\n * @typedef module:ui/template~TemplateListenerSchema\n * @type {Object|String|Array}\n */\n\n/**\n * The return value of {@link ~Template.bind `Template.bind()`}. It provides `to()` and `if()`\n * methods to create the {@link module:utils/observablemixin~Observable observable} attribute and event bindings.\n *\n * @interface module:ui/template~BindChain\n */\n\n/**\n * Binds an {@link module:utils/observablemixin~Observable observable} to either:\n *\n * * an HTML element attribute or a text node `textContent`, so it remains in sync with the observable\n * attribute as it changes,\n * * or an HTML element DOM event, so the DOM events are propagated through an observable.\n *\n * Some common use cases of `to()` bindings are presented below:\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'p',\n *\t\t\tattributes: {\n *\t\t\t\t// class=\"...\" attribute gets bound to `observable#a`\n *\t\t\t\tclass: bind.to( 'a' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t// <p>...</p> gets bound to observable#b; always `toUpperCase()`.\n *\t\t\t\t{\n *\t\t\t\t\ttext: bind.to( 'b', ( value, node ) => value.toUpperCase() )\n *\t\t\t\t}\n *\t\t\t],\n *\t\t\ton: {\n *\t\t\t\tclick: [\n *\t\t\t\t\t// An observable will fire \"clicked\" upon \"click\" in the DOM.\n *\t\t\t\t\tbind.to( 'clicked' ),\n *\n *\t\t\t\t\t// A custom callback will be executed upon \"click\" in the DOM.\n *\t\t\t\t\tbind.to( () => {\n *\t\t\t\t\t\t...\n *\t\t\t\t\t} )\n *\t\t\t\t]\n *\t\t\t}\n *\t\t} ).render();\n *\n * Learn more about using `to()` in the {@link module:ui/template~TemplateValueSchema} and\n * {@link module:ui/template~TemplateListenerSchema}.\n *\n * @method #to\n * @param {String|Function} eventNameOrFunctionOrAttribute An attribute name of\n * {@link module:utils/observablemixin~Observable} or a DOM event name or an event callback.\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\n * @returns {module:ui/template~TemplateBinding}\n */\n\n/**\n * Binds an {@link module:utils/observablemixin~Observable observable} to an HTML element attribute or a text\n * node `textContent` so it remains in sync with the observable attribute as it changes.\n *\n * Unlike {@link module:ui/template~BindChain#to}, it controls the presence of the attribute or `textContent`\n * depending on the \"falseness\" of an {@link module:utils/observablemixin~Observable} attribute.\n *\n *\t\tconst bind = Template.bind( observable, emitter );\n *\n *\t\tnew Template( {\n *\t\t\ttag: 'input',\n *\t\t\tattributes: {\n *\t\t\t\t// <input checked> when `observable#a` is not undefined/null/false/''\n *\t\t\t\t// <input> when `observable#a` is undefined/null/false\n *\t\t\t\tchecked: bind.if( 'a' )\n *\t\t\t},\n *\t\t\tchildren: [\n *\t\t\t\t{\n *\t\t\t\t\t// <input>\"b-is-not-set\"</input> when `observable#b` is undefined/null/false/''\n *\t\t\t\t\t// <input></input> when `observable#b` is not \"falsy\"\n *\t\t\t\t\ttext: bind.if( 'b', 'b-is-not-set', ( value, node ) => !value )\n *\t\t\t\t}\n *\t\t\t]\n *\t\t} ).render();\n *\n * Learn more about using `if()` in the {@link module:ui/template~TemplateValueSchema}.\n *\n * @method #if\n * @param {String} attribute An attribute name of {@link module:utils/observablemixin~Observable} used in the binding.\n * @param {String} [valueIfTrue] Value set when the {@link module:utils/observablemixin~Observable} attribute is not\n * undefined/null/false/'' (empty string).\n * @param {Function} [callback] Allows for processing of the value. Accepts `Node` and `value` as arguments.\n * @returns {module:ui/template~TemplateBinding}\n */\n\n/**\n * The {@link module:ui/template~Template#_renderNode} configuration.\n *\n * @private\n * @interface module:ui/template~RenderData\n */\n\n/**\n * Tells {@link module:ui/template~Template#_renderNode} to render\n * children into `DocumentFragment` first and then append the fragment\n * to the parent element. It is a speed optimization.\n *\n * @member {Boolean} #intoFragment\n */\n\n/**\n * A node which is being rendered.\n *\n * @member {HTMLElement|Text} #node\n */\n\n/**\n * Indicates whether the {@module:ui/template~RenderNodeOptions#node} has\n * been provided by {@module:ui/template~Template#apply}.\n *\n * @member {Boolean} #isApplying\n */\n\n/**\n * An object storing the data that helps {@module:ui/template~Template#revert}\n * bringing back an element to its initial state, i.e. before\n * {@module:ui/template~Template#apply} was called.\n *\n * @member {Object} #revertData\n */\n"]}]}