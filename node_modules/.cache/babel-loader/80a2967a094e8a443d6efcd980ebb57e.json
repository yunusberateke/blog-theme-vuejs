{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-utils/src/collection.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-utils/src/collection.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciBmcm9tICIvaG9tZS9la2ViZXJhdC9ZYW5kZXguRGlzay9Qcm9qZWxlcmltL0JlbmltUHJvamVsZXJpbS93ZWJzaXRlbS93ZWJzaXRlbS13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLndlYWstbWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuZGVzY3JpcHRpb24uanMiOwoKLyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDIxLCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIHV0aWxzL2NvbGxlY3Rpb24KICovCmltcG9ydCBFbWl0dGVyTWl4aW4gZnJvbSAnLi9lbWl0dGVybWl4aW4nOwppbXBvcnQgQ0tFZGl0b3JFcnJvciBmcm9tICcuL2NrZWRpdG9yZXJyb3InOwppbXBvcnQgdWlkIGZyb20gJy4vdWlkJzsKaW1wb3J0IGlzSXRlcmFibGUgZnJvbSAnLi9pc2l0ZXJhYmxlJzsKaW1wb3J0IG1peCBmcm9tICcuL21peCc7Ci8qKgogKiBDb2xsZWN0aW9ucyBhcmUgb3JkZXJlZCBzZXRzIG9mIG9iamVjdHMuIEl0ZW1zIGluIHRoZSBjb2xsZWN0aW9uIGNhbiBiZSByZXRyaWV2ZWQgYnkgdGhlaXIgaW5kZXhlcwogKiBpbiB0aGUgY29sbGVjdGlvbiAobGlrZSBpbiBhbiBhcnJheSkgb3IgYnkgdGhlaXIgaWRzLgogKgogKiBJZiBhbiBvYmplY3Qgd2l0aG91dCBhbiBgaWRgIHByb3BlcnR5IGlzIGJlaW5nIGFkZGVkIHRvIHRoZSBjb2xsZWN0aW9uLCB0aGUgYGlkYCBwcm9wZXJ0eSB3aWxsIGJlIGdlbmVyYXRlZAogKiBhdXRvbWF0aWNhbGx5LiBOb3RlIHRoYXQgdGhlIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGlkIGlzIHVuaXF1ZSBvbmx5IHdpdGhpbiB0aGlzIHNpbmdsZSBjb2xsZWN0aW9uIGluc3RhbmNlLgogKgogKiBCeSBkZWZhdWx0IGFuIGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb24gaXMgaWRlbnRpZmllZCBieSBpdHMgYGlkYCBwcm9wZXJ0eS4gVGhlIG5hbWUgb2YgdGhlIGlkZW50aWZpZXIgY2FuIGJlCiAqIGNvbmZpZ3VyZWQgdGhyb3VnaCB0aGUgY29uc3RydWN0b3Igb2YgdGhlIGNvbGxlY3Rpb24uCiAqCiAqIEBtaXhlcyBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJNaXhpbgogKi8KCnZhciBDb2xsZWN0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAvKioKICAgKiBDcmVhdGVzIGEgbmV3IENvbGxlY3Rpb24gaW5zdGFuY2UuCiAgICoKICAgKiBZb3UgY2FuIHByb3ZpZGUgYW4gaXRlcmFibGUgb2YgaW5pdGlhbCBpdGVtcyB0aGUgY29sbGVjdGlvbiB3aWxsIGJlIGNyZWF0ZWQgd2l0aDoKICAgKgogICAqCQljb25zdCBjb2xsZWN0aW9uID0gbmV3IENvbGxlY3Rpb24oIFsgeyBpZDogJ0pvaG4nIH0sIHsgaWQ6ICdNaWtlJyB9IF0gKTsKICAgKgogICAqCQljb25zb2xlLmxvZyggY29sbGVjdGlvbi5nZXQoIDAgKSApOyAvLyAtPiB7IGlkOiAnSm9obicgfQogICAqCQljb25zb2xlLmxvZyggY29sbGVjdGlvbi5nZXQoIDEgKSApOyAvLyAtPiB7IGlkOiAnTWlrZScgfQogICAqCQljb25zb2xlLmxvZyggY29sbGVjdGlvbi5nZXQoICdNaWtlJyApICk7IC8vIC0+IHsgaWQ6ICdNaWtlJyB9CiAgICoKICAgKiBPciB5b3UgY2FuIGZpcnN0IGNyZWF0ZSBhIGNvbGxlY3Rpb24gYW5kIHRoZW4gYWRkIG5ldyBpdGVtcyB1c2luZyB0aGUge0BsaW5rICNhZGR9IG1ldGhvZDoKICAgKgogICAqCQljb25zdCBjb2xsZWN0aW9uID0gbmV3IENvbGxlY3Rpb24oKTsKICAgKgogICAqCQljb2xsZWN0aW9uLmFkZCggeyBpZDogJ0pvaG4nIH0gKTsKICAgKgkJY29uc29sZS5sb2coIGNvbGxlY3Rpb24uZ2V0KCAwICkgKTsgLy8gLT4geyBpZDogJ0pvaG4nIH0KICAgKgogICAqIFdoYXRldmVyIG9wdGlvbiB5b3UgY2hvb3NlLCB5b3UgY2FuIGFsd2F5cyBwYXNzIGEgY29uZmlndXJhdGlvbiBvYmplY3QgYXMgdGhlIGxhc3QgYXJndW1lbnQKICAgKiBvZiB0aGUgY29uc3RydWN0b3I6CiAgICoKICAgKgkJY29uc3QgZW1wdHlDb2xsZWN0aW9uID0gbmV3IENvbGxlY3Rpb24oIHsgaWRQcm9wZXJ0eTogJ25hbWUnIH0gKTsKICAgKgkJZW1wdHlDb2xsZWN0aW9uLmFkZCggeyBuYW1lOiAnSm9obicgfSApOwogICAqCQljb25zb2xlLmxvZyggY29sbGVjdGlvbi5nZXQoICdKb2huJyApICk7IC8vIC0+IHsgbmFtZTogJ0pvaG4nIH0KICAgKgogICAqCQljb25zdCBub25FbXB0eUNvbGxlY3Rpb24gPSBuZXcgQ29sbGVjdGlvbiggWyB7IG5hbWU6ICdKb2huJyB9IF0sIHsgaWRQcm9wZXJ0eTogJ25hbWUnIH0gKTsKICAgKgkJbm9uRW1wdHlDb2xsZWN0aW9uLmFkZCggeyBuYW1lOiAnR2VvcmdlJyB9ICk7CiAgICoJCWNvbnNvbGUubG9nKCBjb2xsZWN0aW9uLmdldCggJ0dlb3JnZScgKSApOyAvLyAtPiB7IG5hbWU6ICdHZW9yZ2UnIH0KICAgKgkJY29uc29sZS5sb2coIGNvbGxlY3Rpb24uZ2V0KCAnSm9obicgKSApOyAvLyAtPiB7IG5hbWU6ICdKb2huJyB9CiAgICoKICAgKiBAcGFyYW0ge0l0ZXJhYmxlLjxPYmplY3Q+fE9iamVjdH0gaW5pdGlhbEl0ZW1zT3JPcHRpb25zIFRoZSBpbml0aWFsIGl0ZW1zIG9mIHRoZSBjb2xsZWN0aW9uIG9yCiAgICogdGhlIG9wdGlvbnMgb2JqZWN0LgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gVGhlIG9wdGlvbnMgb2JqZWN0LCB3aGVuIHRoZSBmaXJzdCBhcmd1bWVudCBpcyBhbiBhcnJheSBvZiBpbml0aWFsIGl0ZW1zLgogICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5pZFByb3BlcnR5PSdpZCddIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB3aGljaCBpcyB1c2VkIHRvIGlkZW50aWZ5IGFuIGl0ZW0uCiAgICogSXRlbXMgdGhhdCBkbyBub3QgaGF2ZSBzdWNoIGEgcHJvcGVydHkgd2lsbCBiZSBhc3NpZ25lZCBvbmUgd2hlbiBhZGRlZCB0byB0aGUgY29sbGVjdGlvbi4KICAgKi8KICBmdW5jdGlvbiBDb2xsZWN0aW9uKCkgewogICAgdmFyIGluaXRpYWxJdGVtc09yT3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbGxlY3Rpb24pOwoKICAgIHZhciBoYXNJbml0aWFsSXRlbXMgPSBpc0l0ZXJhYmxlKGluaXRpYWxJdGVtc09yT3B0aW9ucyk7CgogICAgaWYgKCFoYXNJbml0aWFsSXRlbXMpIHsKICAgICAgb3B0aW9ucyA9IGluaXRpYWxJdGVtc09yT3B0aW9uczsKICAgIH0KICAgIC8qKgogICAgICogVGhlIGludGVybmFsIGxpc3Qgb2YgaXRlbXMgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge09iamVjdFtdfQogICAgICovCgoKICAgIHRoaXMuX2l0ZW1zID0gW107CiAgICAvKioKICAgICAqIFRoZSBpbnRlcm5hbCBtYXAgb2YgaXRlbXMgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge01hcH0KICAgICAqLwoKICAgIHRoaXMuX2l0ZW1NYXAgPSBuZXcgTWFwKCk7CiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB3aGljaCBpcyBjb25zaWRlcmVkIHRvIGlkZW50aWZ5IGFuIGl0ZW0uCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge1N0cmluZ30KICAgICAqLwoKICAgIHRoaXMuX2lkUHJvcGVydHkgPSBvcHRpb25zLmlkUHJvcGVydHkgfHwgJ2lkJzsKICAgIC8qKgogICAgICogQSBoZWxwZXIgbWFwcGluZyBleHRlcm5hbCBpdGVtcyBvZiBhIGJvdW5kIGNvbGxlY3Rpb24gKHtAbGluayAjYmluZFRvfSkKICAgICAqIGFuZCBhY3R1YWwgaXRlbXMgb2YgdGhpcyBjb2xsZWN0aW9uLiBJdCBwcm92aWRlcyBpbmZvcm1hdGlvbgogICAgICogbmVjZXNzYXJ5IHRvIHByb3Blcmx5IHJlbW92ZSBpdGVtcyBib3VuZCB0byBhbm90aGVyIGNvbGxlY3Rpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayAjX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcH0uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7V2Vha01hcH0KICAgICAqLwoKICAgIHRoaXMuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcCA9IG5ldyBXZWFrTWFwKCk7CiAgICAvKioKICAgICAqIEEgaGVscGVyIG1hcHBpbmcgaXRlbXMgb2YgdGhpcyBjb2xsZWN0aW9uIHRvIGV4dGVybmFsIGl0ZW1zIG9mIGEgYm91bmQgY29sbGVjdGlvbgogICAgICogKHtAbGluayAjYmluZFRvfSkuIEl0IHByb3ZpZGVzIGluZm9ybWF0aW9uIG5lY2Vzc2FyeSB0byBtYW5hZ2UgdGhlIGJpbmRpbmdzLCBlLmcuCiAgICAgKiB0byBhdm9pZCBsb29wcyBpbiB0d2/igJN3YXkgYmluZGluZ3MuCiAgICAgKgogICAgICogU2VlIHtAbGluayAjX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcH0uCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQG1lbWJlciB7V2Vha01hcH0KICAgICAqLwoKICAgIHRoaXMuX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcCA9IG5ldyBXZWFrTWFwKCk7CiAgICAvKioKICAgICAqIFN0b3JlcyBpbmRleGVzIG9mIHNraXBwZWQgaXRlbXMgZnJvbSBib3VuZCBleHRlcm5hbCBjb2xsZWN0aW9uLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtBcnJheX0KICAgICAqLwoKICAgIHRoaXMuX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsID0gW107IC8vIFNldCB0aGUgaW5pdGlhbCBjb250ZW50IG9mIHRoZSBjb2xsZWN0aW9uIChpZiBwcm92aWRlZCBpbiB0aGUgY29uc3RydWN0b3IpLgoKICAgIGlmIChoYXNJbml0aWFsSXRlbXMpIHsKICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGluaXRpYWxJdGVtc09yT3B0aW9ucyksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBpdGVtID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgdGhpcy5faXRlbXMucHVzaChpdGVtKTsKCiAgICAgICAgICB0aGlzLl9pdGVtTWFwLnNldCh0aGlzLl9nZXRJdGVtSWRCZWZvcmVBZGRpbmcoaXRlbSksIGl0ZW0pOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEEgY29sbGVjdGlvbiBpbnN0YW5jZSB0aGlzIGNvbGxlY3Rpb24gaXMgYm91bmQgdG8gYXMgYSByZXN1bHQKICAgICAqIG9mIGNhbGxpbmcge0BsaW5rICNiaW5kVG99IG1ldGhvZC4KICAgICAqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9ufSAjX2JpbmRUb0NvbGxlY3Rpb24KICAgICAqLwoKICB9CiAgLyoqCiAgICogVGhlIG51bWJlciBvZiBpdGVtcyBhdmFpbGFibGUgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICoKICAgKiBAbWVtYmVyIHtOdW1iZXJ9ICNsZW5ndGgKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhDb2xsZWN0aW9uLCBbewogICAga2V5OiAibGVuZ3RoIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5faXRlbXMubGVuZ3RoOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBmaXJzdCBpdGVtIGZyb20gdGhlIGNvbGxlY3Rpb24gb3IgbnVsbCB3aGVuIGNvbGxlY3Rpb24gaXMgZW1wdHkuCiAgICAgKgogICAgICogQHJldHVybnMge09iamVjdHxudWxsfSBUaGUgZmlyc3QgaXRlbSBvciBgbnVsbGAgaWYgY29sbGVjdGlvbiBpcyBlbXB0eS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaXJzdCIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zWzBdIHx8IG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGxhc3QgaXRlbSBmcm9tIHRoZSBjb2xsZWN0aW9uIG9yIG51bGwgd2hlbiBjb2xsZWN0aW9uIGlzIGVtcHR5LgogICAgICoKICAgICAqIEByZXR1cm5zIHtPYmplY3R8bnVsbH0gVGhlIGxhc3QgaXRlbSBvciBgbnVsbGAgaWYgY29sbGVjdGlvbiBpcyBlbXB0eS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJsYXN0IiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5faXRlbXNbdGhpcy5sZW5ndGggLSAxXSB8fCBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIGFuIGl0ZW0gaW50byB0aGUgY29sbGVjdGlvbi4KICAgICAqCiAgICAgKiBJZiB0aGUgaXRlbSBkb2VzIG5vdCBoYXZlIGFuIGlkLCB0aGVuIGl0IHdpbGwgYmUgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgYW5kIHNldCBvbiB0aGUgaXRlbS4KICAgICAqCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbQogICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpbmRleF0gVGhlIHBvc2l0aW9uIG9mIHRoZSBpdGVtIGluIHRoZSBjb2xsZWN0aW9uLiBUaGUgaXRlbQogICAgICogaXMgcHVzaGVkIHRvIHRoZSBjb2xsZWN0aW9uIHdoZW4gYGluZGV4YCBub3Qgc3BlY2lmaWVkLgogICAgICogQGZpcmVzIGFkZAogICAgICogQGZpcmVzIGNoYW5nZQogICAgICovCgogIH0sIHsKICAgIGtleTogImFkZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkKGl0ZW0sIGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLmFkZE1hbnkoW2l0ZW1dLCBpbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgbXVsdGlwbGUgaXRlbXMgaW50byB0aGUgY29sbGVjdGlvbi4KICAgICAqCiAgICAgKiBBbnkgaXRlbSBub3QgY29udGFpbmluZyBhbiBpZCB3aWxsIGdldCBhbiBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBvbmUuCiAgICAgKgogICAgICogQGNoYWluYWJsZQogICAgICogQHBhcmFtIHtJdGVyYWJsZS48T2JqZWN0Pn0gaXRlbQogICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpbmRleF0gVGhlIHBvc2l0aW9uIG9mIHRoZSBpbnNlcnRpb24uIEl0ZW1zIHdpbGwgYmUgYXBwZW5kZWQgaWYgbm8gYGluZGV4YCBpcyBzcGVjaWZpZWQuCiAgICAgKiBAZmlyZXMgYWRkCiAgICAgKiBAZmlyZXMgY2hhbmdlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYWRkTWFueSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkTWFueShpdGVtcywgaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBpbmRleCA9IHRoaXMuX2l0ZW1zLmxlbmd0aDsKICAgICAgfSBlbHNlIGlmIChpbmRleCA+IHRoaXMuX2l0ZW1zLmxlbmd0aCB8fCBpbmRleCA8IDApIHsKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgYGluZGV4YCBwYXNzZWQgdG8ge0BsaW5rIG1vZHVsZTp1dGlscy9jb2xsZWN0aW9ufkNvbGxlY3Rpb24jYWRkTWFueSBgQ29sbGVjdGlvbiNhZGRNYW55KClgfQogICAgICAgICAqIGlzIGludmFsaWQuIEl0IG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCB0aGUgY29sbGVjdGlvbidzIGxlbmd0aC4KICAgICAgICAgKgogICAgICAgICAqIEBlcnJvciBjb2xsZWN0aW9uLWFkZC1pdGVtLWludmFsaWQtaW5kZXgKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29sbGVjdGlvbi1hZGQtaXRlbS1pbnZhbGlkLWluZGV4JywgdGhpcyk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIG9mZnNldCA9IDA7IG9mZnNldCA8IGl0ZW1zLmxlbmd0aDsgb2Zmc2V0KyspIHsKICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW29mZnNldF07CgogICAgICAgIHZhciBpdGVtSWQgPSB0aGlzLl9nZXRJdGVtSWRCZWZvcmVBZGRpbmcoaXRlbSk7CgogICAgICAgIHZhciBjdXJyZW50SXRlbUluZGV4ID0gaW5kZXggKyBvZmZzZXQ7CgogICAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShjdXJyZW50SXRlbUluZGV4LCAwLCBpdGVtKTsKCiAgICAgICAgdGhpcy5faXRlbU1hcC5zZXQoaXRlbUlkLCBpdGVtKTsKCiAgICAgICAgdGhpcy5maXJlKCdhZGQnLCBpdGVtLCBjdXJyZW50SXRlbUluZGV4KTsKICAgICAgfQoKICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnLCB7CiAgICAgICAgYWRkZWQ6IGl0ZW1zLAogICAgICAgIHJlbW92ZWQ6IFtdLAogICAgICAgIGluZGV4OiBpbmRleAogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgYW4gaXRlbSBieSBpdHMgSUQgb3IgaW5kZXguCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd8TnVtYmVyfSBpZE9ySW5kZXggVGhlIGl0ZW0gSUQgb3IgaW5kZXggaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fG51bGx9IFRoZSByZXF1ZXN0ZWQgaXRlbSBvciBgbnVsbGAgaWYgc3VjaCBpdGVtIGRvZXMgbm90IGV4aXN0LgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0KGlkT3JJbmRleCkgewogICAgICB2YXIgaXRlbTsKCiAgICAgIGlmICh0eXBlb2YgaWRPckluZGV4ID09ICdzdHJpbmcnKSB7CiAgICAgICAgaXRlbSA9IHRoaXMuX2l0ZW1NYXAuZ2V0KGlkT3JJbmRleCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlkT3JJbmRleCA9PSAnbnVtYmVyJykgewogICAgICAgIGl0ZW0gPSB0aGlzLl9pdGVtc1tpZE9ySW5kZXhdOwogICAgICB9IGVsc2UgewogICAgICAgIC8qKgogICAgICAgICAqIEFuIGluZGV4IG9yIElEIG11c3QgYmUgZ2l2ZW4uCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3IgY29sbGVjdGlvbi1nZXQtaW52YWxpZC1hcmcKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29sbGVjdGlvbi1nZXQtaW52YWxpZC1hcmcnLCB0aGlzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZW0gfHwgbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhIEJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBjb2xsZWN0aW9uIGNvbnRhaW5zIGFuIGl0ZW0uCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBpdGVtT3JJZCBUaGUgaXRlbSBvciBpdHMgSUQgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYHRydWVgIGlmIHRoZSBjb2xsZWN0aW9uIGNvbnRhaW5zIHRoZSBpdGVtLCBgZmFsc2VgIG90aGVyd2lzZS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhcyhpdGVtT3JJZCkgewogICAgICBpZiAodHlwZW9mIGl0ZW1PcklkID09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1NYXAuaGFzKGl0ZW1PcklkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBPYmplY3QKICAgICAgICB2YXIgaWRQcm9wZXJ0eSA9IHRoaXMuX2lkUHJvcGVydHk7CiAgICAgICAgdmFyIGlkID0gaXRlbU9ySWRbaWRQcm9wZXJ0eV07CiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1NYXAuaGFzKGlkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIGFuIGluZGV4IG9mIGFuIGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb24uCiAgICAgKiBXaGVuIGFuIGl0ZW0gaXMgbm90IGRlZmluZWQgaW4gdGhlIGNvbGxlY3Rpb24sIHRoZSBpbmRleCB3aWxsIGVxdWFsIC0xLgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gaXRlbU9ySWQgVGhlIGl0ZW0gb3IgaXRzIElEIGluIHRoZSBjb2xsZWN0aW9uLgogICAgICogQHJldHVybnMge051bWJlcn0gVGhlIGluZGV4IG9mIGEgZ2l2ZW4gaXRlbS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRJbmRleCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5kZXgoaXRlbU9ySWQpIHsKICAgICAgdmFyIGl0ZW07CgogICAgICBpZiAodHlwZW9mIGl0ZW1PcklkID09ICdzdHJpbmcnKSB7CiAgICAgICAgaXRlbSA9IHRoaXMuX2l0ZW1NYXAuZ2V0KGl0ZW1PcklkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVtID0gaXRlbU9ySWQ7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLl9pdGVtcy5pbmRleE9mKGl0ZW0pOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGFuIGl0ZW0gZnJvbSB0aGUgY29sbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdHxOdW1iZXJ8U3RyaW5nfSBzdWJqZWN0IFRoZSBpdGVtIHRvIHJlbW92ZSwgaXRzIElEIG9yIGluZGV4IGluIHRoZSBjb2xsZWN0aW9uLgogICAgICogQHJldHVybnMge09iamVjdH0gVGhlIHJlbW92ZWQgaXRlbS4KICAgICAqIEBmaXJlcyByZW1vdmUKICAgICAqIEBmaXJlcyBjaGFuZ2UKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZShzdWJqZWN0KSB7CiAgICAgIHZhciBfdGhpcyRfcmVtb3ZlID0gdGhpcy5fcmVtb3ZlKHN1YmplY3QpLAogICAgICAgICAgX3RoaXMkX3JlbW92ZTIgPSBfc2xpY2VkVG9BcnJheShfdGhpcyRfcmVtb3ZlLCAyKSwKICAgICAgICAgIGl0ZW0gPSBfdGhpcyRfcmVtb3ZlMlswXSwKICAgICAgICAgIGluZGV4ID0gX3RoaXMkX3JlbW92ZTJbMV07CgogICAgICB0aGlzLmZpcmUoJ2NoYW5nZScsIHsKICAgICAgICBhZGRlZDogW10sCiAgICAgICAgcmVtb3ZlZDogW2l0ZW1dLAogICAgICAgIGluZGV4OiBpbmRleAogICAgICB9KTsKICAgICAgcmV0dXJuIGl0ZW07CiAgICB9CiAgICAvKioKICAgICAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFjayBmb3IgZWFjaCBpdGVtIGluIHRoZSBjb2xsZWN0aW9uIGFuZCBjb21wb3NlcyBhbiBhcnJheSBvciB2YWx1ZXMgcmV0dXJuZWQgYnkgdGhpcyBjYWxsYmFjay4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICogQHBhcmFtIHtPYmplY3R9IGNhbGxiYWNrLml0ZW0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjYWxsYmFjay5pbmRleAogICAgICogQHBhcmFtIHtPYmplY3R9IGN0eCBDb250ZXh0IGluIHdoaWNoIHRoZSBgY2FsbGJhY2tgIHdpbGwgYmUgY2FsbGVkLgogICAgICogQHJldHVybnMge0FycmF5fSBUaGUgcmVzdWx0IG9mIG1hcHBpbmcuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibWFwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtYXAoY2FsbGJhY2ssIGN0eCkgewogICAgICByZXR1cm4gdGhpcy5faXRlbXMubWFwKGNhbGxiYWNrLCBjdHgpOwogICAgfQogICAgLyoqCiAgICAgKiBGaW5kcyB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgY29sbGVjdGlvbiBmb3Igd2hpY2ggdGhlIGBjYWxsYmFja2AgcmV0dXJucyBhIHRydWUgdmFsdWUuCiAgICAgKgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjYWxsYmFjay5pdGVtCiAgICAgKiBAcGFyYW0ge051bWJlcn0gY2FsbGJhY2suaW5kZXgKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjdHggQ29udGV4dCBpbiB3aGljaCB0aGUgYGNhbGxiYWNrYCB3aWxsIGJlIGNhbGxlZC4KICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBpdGVtIGZvciB3aGljaCBgY2FsbGJhY2tgIHJldHVybmVkIGEgdHJ1ZSB2YWx1ZS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kKGNhbGxiYWNrLCBjdHgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmZpbmQoY2FsbGJhY2ssIGN0eCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYW4gYXJyYXkgd2l0aCBpdGVtcyBmb3Igd2hpY2ggdGhlIGBjYWxsYmFja2AgcmV0dXJuZWQgYSB0cnVlIHZhbHVlLgogICAgICoKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY2FsbGJhY2suaXRlbQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGNhbGxiYWNrLmluZGV4CiAgICAgKiBAcGFyYW0ge09iamVjdH0gY3R4IENvbnRleHQgaW4gd2hpY2ggdGhlIGBjYWxsYmFja2Agd2lsbCBiZSBjYWxsZWQuCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0W119IFRoZSBhcnJheSB3aXRoIG1hdGNoaW5nIGl0ZW1zLgogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbHRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsdGVyKGNhbGxiYWNrLCBjdHgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmZpbHRlcihjYWxsYmFjaywgY3R4KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhbGwgaXRlbXMgZnJvbSB0aGUgY29sbGVjdGlvbiBhbmQgZGVzdHJveXMgdGhlIGJpbmRpbmcgY3JlYXRlZCB1c2luZwogICAgICoge0BsaW5rICNiaW5kVG99LgogICAgICoKICAgICAqIEBmaXJlcyByZW1vdmUKICAgICAqIEBmaXJlcyBjaGFuZ2UKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjbGVhciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgIGlmICh0aGlzLl9iaW5kVG9Db2xsZWN0aW9uKSB7CiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKHRoaXMuX2JpbmRUb0NvbGxlY3Rpb24pOwogICAgICAgIHRoaXMuX2JpbmRUb0NvbGxlY3Rpb24gPSBudWxsOwogICAgICB9CgogICAgICB2YXIgcmVtb3ZlZEl0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLl9pdGVtcyk7CgogICAgICB3aGlsZSAodGhpcy5sZW5ndGgpIHsKICAgICAgICB0aGlzLl9yZW1vdmUoMCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZmlyZSgnY2hhbmdlJywgewogICAgICAgIGFkZGVkOiBbXSwKICAgICAgICByZW1vdmVkOiByZW1vdmVkSXRlbXMsCiAgICAgICAgaW5kZXg6IDAKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEJpbmRzIGFuZCBzeW5jaHJvbml6ZXMgdGhlIGNvbGxlY3Rpb24gd2l0aCBhbm90aGVyIG9uZS4KICAgICAqCiAgICAgKiBUaGUgYmluZGluZyBjYW4gYmUgYSBzaW1wbGUgZmFjdG9yeToKICAgICAqCiAgICAgKgkJY2xhc3MgRmFjdG9yeUNsYXNzIHsKICAgICAqCQkJY29uc3RydWN0b3IoIGRhdGEgKSB7CiAgICAgKgkJCQl0aGlzLmxhYmVsID0gZGF0YS5sYWJlbDsKICAgICAqCQkJfQogICAgICoJCX0KICAgICAqCiAgICAgKgkJY29uc3Qgc291cmNlID0gbmV3IENvbGxlY3Rpb24oIHsgaWRQcm9wZXJ0eTogJ2xhYmVsJyB9ICk7CiAgICAgKgkJY29uc3QgdGFyZ2V0ID0gbmV3IENvbGxlY3Rpb24oKTsKICAgICAqCiAgICAgKgkJdGFyZ2V0LmJpbmRUbyggc291cmNlICkuYXMoIEZhY3RvcnlDbGFzcyApOwogICAgICoKICAgICAqCQlzb3VyY2UuYWRkKCB7IGxhYmVsOiAnZm9vJyB9ICk7CiAgICAgKgkJc291cmNlLmFkZCggeyBsYWJlbDogJ2JhcicgfSApOwogICAgICoKICAgICAqCQljb25zb2xlLmxvZyggdGFyZ2V0Lmxlbmd0aCApOyAvLyAyCiAgICAgKgkJY29uc29sZS5sb2coIHRhcmdldC5nZXQoIDEgKS5sYWJlbCApOyAvLyAnYmFyJwogICAgICoKICAgICAqCQlzb3VyY2UucmVtb3ZlKCAwICk7CiAgICAgKgkJY29uc29sZS5sb2coIHRhcmdldC5sZW5ndGggKTsgLy8gMQogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQuZ2V0KCAwICkubGFiZWwgKTsgLy8gJ2JhcicKICAgICAqCiAgICAgKiBvciB0aGUgZmFjdG9yeSBkcml2ZW4gYnkgYSBjdXN0b20gY2FsbGJhY2s6CiAgICAgKgogICAgICoJCWNsYXNzIEZvb0NsYXNzIHsKICAgICAqCQkJY29uc3RydWN0b3IoIGRhdGEgKSB7CiAgICAgKgkJCQl0aGlzLmxhYmVsID0gZGF0YS5sYWJlbDsKICAgICAqCQkJfQogICAgICoJCX0KICAgICAqCiAgICAgKgkJY2xhc3MgQmFyQ2xhc3MgewogICAgICoJCQljb25zdHJ1Y3RvciggZGF0YSApIHsKICAgICAqCQkJCXRoaXMubGFiZWwgPSBkYXRhLmxhYmVsOwogICAgICoJCQl9CiAgICAgKgkJfQogICAgICoKICAgICAqCQljb25zdCBzb3VyY2UgPSBuZXcgQ29sbGVjdGlvbiggeyBpZFByb3BlcnR5OiAnbGFiZWwnIH0gKTsKICAgICAqCQljb25zdCB0YXJnZXQgPSBuZXcgQ29sbGVjdGlvbigpOwogICAgICoKICAgICAqCQl0YXJnZXQuYmluZFRvKCBzb3VyY2UgKS51c2luZyggKCBpdGVtICkgPT4gewogICAgICoJCQlpZiAoIGl0ZW0ubGFiZWwgPT0gJ2ZvbycgKSB7CiAgICAgKgkJCQlyZXR1cm4gbmV3IEZvb0NsYXNzKCBpdGVtICk7CiAgICAgKgkJCX0gZWxzZSB7CiAgICAgKgkJCQlyZXR1cm4gbmV3IEJhckNsYXNzKCBpdGVtICk7CiAgICAgKgkJCX0KICAgICAqCQl9ICk7CiAgICAgKgogICAgICoJCXNvdXJjZS5hZGQoIHsgbGFiZWw6ICdmb28nIH0gKTsKICAgICAqCQlzb3VyY2UuYWRkKCB7IGxhYmVsOiAnYmFyJyB9ICk7CiAgICAgKgogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQubGVuZ3RoICk7IC8vIDIKICAgICAqCQljb25zb2xlLmxvZyggdGFyZ2V0LmdldCggMCApIGluc3RhbmNlb2YgRm9vQ2xhc3MgKTsgLy8gdHJ1ZQogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQuZ2V0KCAxICkgaW5zdGFuY2VvZiBCYXJDbGFzcyApOyAvLyB0cnVlCiAgICAgKgogICAgICogb3IgdGhlIGZhY3Rvcnkgb3V0IG9mIHByb3BlcnR5IG5hbWU6CiAgICAgKgogICAgICoJCWNvbnN0IHNvdXJjZSA9IG5ldyBDb2xsZWN0aW9uKCB7IGlkUHJvcGVydHk6ICdsYWJlbCcgfSApOwogICAgICoJCWNvbnN0IHRhcmdldCA9IG5ldyBDb2xsZWN0aW9uKCk7CiAgICAgKgogICAgICoJCXRhcmdldC5iaW5kVG8oIHNvdXJjZSApLnVzaW5nKCAnbGFiZWwnICk7CiAgICAgKgogICAgICoJCXNvdXJjZS5hZGQoIHsgbGFiZWw6IHsgdmFsdWU6ICdmb28nIH0gfSApOwogICAgICoJCXNvdXJjZS5hZGQoIHsgbGFiZWw6IHsgdmFsdWU6ICdiYXInIH0gfSApOwogICAgICoKICAgICAqCQljb25zb2xlLmxvZyggdGFyZ2V0Lmxlbmd0aCApOyAvLyAyCiAgICAgKgkJY29uc29sZS5sb2coIHRhcmdldC5nZXQoIDAgKS52YWx1ZSApOyAvLyAnZm9vJwogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQuZ2V0KCAxICkudmFsdWUgKTsgLy8gJ2JhcicKICAgICAqCiAgICAgKiBJdCdzIHBvc3NpYmxlIHRvIHNraXAgc3BlY2lmaWVkIGl0ZW1zIGJ5IHJldHVybmluZyBmYWxzeSB2YWx1ZToKICAgICAqCiAgICAgKgkJY29uc3Qgc291cmNlID0gbmV3IENvbGxlY3Rpb24oKTsKICAgICAqCQljb25zdCB0YXJnZXQgPSBuZXcgQ29sbGVjdGlvbigpOwogICAgICoKICAgICAqCQl0YXJnZXQuYmluZFRvKCBzb3VyY2UgKS51c2luZyggaXRlbSA9PiB7CiAgICAgKgkJCWlmICggaXRlbS5oaWRkZW4gKSB7CiAgICAgKgkJCQlyZXR1cm4gbnVsbDsKICAgICAqCQkJfQogICAgICoKICAgICAqCQkJcmV0dXJuIGl0ZW07CiAgICAgKgkJfSApOwogICAgICoKICAgICAqCQlzb3VyY2UuYWRkKCB7IGhpZGRlbjogdHJ1ZSB9ICk7CiAgICAgKgkJc291cmNlLmFkZCggeyBoaWRkZW46IGZhbHNlIH0gKTsKICAgICAqCiAgICAgKgkJY29uc29sZS5sb2coIHNvdXJjZS5sZW5ndGggKTsgLy8gMgogICAgICoJCWNvbnNvbGUubG9nKCB0YXJnZXQubGVuZ3RoICk7IC8vIDEKICAgICAqCiAgICAgKiAqKk5vdGUqKjoge0BsaW5rICNjbGVhcn0gY2FuIGJlIHVzZWQgdG8gYnJlYWsgdGhlIGJpbmRpbmcuCiAgICAgKgogICAgICogQHBhcmFtIHttb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9ufSBleHRlcm5hbENvbGxlY3Rpb24gQSBjb2xsZWN0aW9uIHRvIGJlIGJvdW5kLgogICAgICogQHJldHVybnMge09iamVjdH0KICAgICAqIEByZXR1cm5zIHttb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9uQmluZFRvQ2hhaW59IFRoZSBiaW5kaW5nIGNoYWluIG9iamVjdC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJiaW5kVG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGJpbmRUbyhleHRlcm5hbENvbGxlY3Rpb24pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLl9iaW5kVG9Db2xsZWN0aW9uKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGNvbGxlY3Rpb24gY2Fubm90IGJlIGJvdW5kIG1vcmUgdGhhbiBvbmNlLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIGNvbGxlY3Rpb24tYmluZC10by1yZWJpbmQKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29sbGVjdGlvbi1iaW5kLXRvLXJlYmluZCcsIHRoaXMpOwogICAgICB9CgogICAgICB0aGlzLl9iaW5kVG9Db2xsZWN0aW9uID0gZXh0ZXJuYWxDb2xsZWN0aW9uOwogICAgICByZXR1cm4gewogICAgICAgIGFzOiBmdW5jdGlvbiBhcyhDbGFzcykgewogICAgICAgICAgX3RoaXMuX3NldFVwQmluZFRvQmluZGluZyhmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gbmV3IENsYXNzKGl0ZW0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB1c2luZzogZnVuY3Rpb24gdXNpbmcoY2FsbGJhY2tPclByb3BlcnR5KSB7CiAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrT3JQcm9wZXJ0eSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIF90aGlzLl9zZXRVcEJpbmRUb0JpbmRpbmcoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2tPclByb3BlcnR5KGl0ZW0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzLl9zZXRVcEJpbmRUb0JpbmRpbmcoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbVtjYWxsYmFja09yUHJvcGVydHldOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIEZpbmFsaXplcyBhbmQgYWN0aXZhdGVzIGEgYmluZGluZyBpbml0aWF0ZWQgYnkgeyNiaW5kVG99LgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZhY3RvcnkgQSBmdW5jdGlvbiB3aGljaCBwcm9kdWNlcyBjb2xsZWN0aW9uIGl0ZW1zLgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXRVcEJpbmRUb0JpbmRpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRVcEJpbmRUb0JpbmRpbmcoZmFjdG9yeSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBleHRlcm5hbENvbGxlY3Rpb24gPSB0aGlzLl9iaW5kVG9Db2xsZWN0aW9uOyAvLyBBZGRzIHRoZSBpdGVtIHRvIHRoZSBjb2xsZWN0aW9uIG9uY2UgYSBjaGFuZ2UgaGFzIGJlZW4gZG9uZSB0byB0aGUgZXh0ZXJuYWwgY29sbGVjdGlvbi4KICAgICAgLy8KICAgICAgLy8gQHByaXZhdGUKCiAgICAgIHZhciBhZGRJdGVtID0gZnVuY3Rpb24gYWRkSXRlbShldnQsIGV4dGVybmFsSXRlbSwgaW5kZXgpIHsKICAgICAgICB2YXIgaXNFeHRlcm5hbEJvdW5kVG9UaGlzID0gZXh0ZXJuYWxDb2xsZWN0aW9uLl9iaW5kVG9Db2xsZWN0aW9uID09IF90aGlzMjsKCiAgICAgICAgdmFyIGV4dGVybmFsSXRlbUJvdW5kID0gZXh0ZXJuYWxDb2xsZWN0aW9uLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuZ2V0KGV4dGVybmFsSXRlbSk7IC8vIElmIGFuIGV4dGVybmFsIGNvbGxlY3Rpb24gaXMgYm91bmQgdG8gdGhpcyBjb2xsZWN0aW9uLCB3aGljaCBtYWtlcyBpdCBhIDLigJN3YXkgYmluZGluZywKICAgICAgICAvLyBhbmQgdGhlIHBhcnRpY3VsYXIgZXh0ZXJuYWwgY29sbGVjdGlvbiBpdGVtIGlzIGFscmVhZHkgYm91bmQsIGRvbid0IGFkZCBpdCBoZXJlLgogICAgICAgIC8vIFRoZSBleHRlcm5hbCBpdGVtIGhhcyBiZWVuIGNyZWF0ZWQgKipvdXQgb2YgdGhpcyBjb2xsZWN0aW9uJ3MgaXRlbSoqIGFuZCAocmUpYWRkaW5nIGl0IHdpbGwKICAgICAgICAvLyBjYXVzZSBhIGxvb3AuCgoKICAgICAgICBpZiAoaXNFeHRlcm5hbEJvdW5kVG9UaGlzICYmIGV4dGVybmFsSXRlbUJvdW5kKSB7CiAgICAgICAgICBfdGhpczIuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcC5zZXQoZXh0ZXJuYWxJdGVtLCBleHRlcm5hbEl0ZW1Cb3VuZCk7CgogICAgICAgICAgX3RoaXMyLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuc2V0KGV4dGVybmFsSXRlbUJvdW5kLCBleHRlcm5hbEl0ZW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGZhY3RvcnkoZXh0ZXJuYWxJdGVtKTsgLy8gV2hlbiB0aGVyZSBpcyBubyBpdGVtIHdlIG5lZWQgdG8gcmVtZW1iZXIgc2tpcHBlZCBpbmRleCBmaXJzdCBhbmQgdGhlbiB3ZSBjYW4gc2tpcCB0aGlzIGl0ZW0uCgogICAgICAgICAgaWYgKCFpdGVtKSB7CiAgICAgICAgICAgIF90aGlzMi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWwucHVzaChpbmRleCk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIExldHMgdHJ5IHRvIHB1dCBpdGVtIGF0IHRoZSBzYW1lIGluZGV4IGFzIGluZGV4IGluIGV4dGVybmFsIGNvbGxlY3Rpb24KICAgICAgICAgIC8vIGJ1dCB3aGVuIHRoZXJlIGFyZSBhIHNraXBwZWQgaXRlbXMgaW4gb25lIG9yIGJvdGggY29sbGVjdGlvbnMgd2UgbmVlZCB0byByZWNhbGN1bGF0ZSB0aGlzIGluZGV4LgoKCiAgICAgICAgICB2YXIgZmluYWxJbmRleCA9IGluZGV4OyAvLyBXaGVuIHdlIHRyeSB0byBpbnNlcnQgaXRlbSBhZnRlciBzb21lIHNraXBwZWQgaXRlbXMgZnJvbSBleHRlcm5hbCBjb2xsZWN0aW9uIHdlIG5lZWQKICAgICAgICAgIC8vIHRvIGluY2x1ZGUgdGhpcyBza2lwcGVkIGl0ZW1zIGFuZCBkZWNyZWFzZSBpbmRleC4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBGb3IgdGhlIGZvbGxvd2luZyBleGFtcGxlOgogICAgICAgICAgLy8gZXh0ZXJuYWwgLT4gWyAnQScsICdCIC0gc2tpcHBlZCBmb3IgaW50ZXJuYWwnLCAnQyAtIHNraXBwZWQgZm9yIGludGVybmFsJyBdCiAgICAgICAgICAvLyBpbnRlcm5hbCAtPiBbIEEgXQogICAgICAgICAgLy8KICAgICAgICAgIC8vIEFub3RoZXIgaXRlbSBpcyBiZWVuIGFkZGVkIGF0IHRoZSBlbmQgb2YgZXh0ZXJuYWwgY29sbGVjdGlvbjoKICAgICAgICAgIC8vIGV4dGVybmFsLmFkZCggJ0QnICkKICAgICAgICAgIC8vIGV4dGVybmFsIC0+IFsgJ0EnLCAnQiAtIHNraXBwZWQgZm9yIGludGVybmFsJywgJ0MgLSBza2lwcGVkIGZvciBpbnRlcm5hbCcsICdEJyBdCiAgICAgICAgICAvLwogICAgICAgICAgLy8gV2UgY2FuJ3QganVzdCBhZGQgJ0QnIHRvIGludGVybmFsIGF0IHRoZSBzYW1lIGluZGV4IGFzIGluZGV4IGluIGV4dGVybmFsIGJlY2F1c2UKICAgICAgICAgIC8vIHRoaXMgd2lsbCBwcm9kdWNlIGVtcHR5IGluZGV4ZXMgd2hhdCBpcyBpbnZhbGlkOgogICAgICAgICAgLy8gaW50ZXJuYWwgLT4gWyAnQScsIGVtcHR5LCBlbXB0eSwgJ0QnIF0KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBTbyB3ZSBuZWVkIHRvIGluY2x1ZGUgc2tpcHBlZCBpdGVtcyBhbmQgZGVjcmVhc2UgaW5kZXgKICAgICAgICAgIC8vIGludGVybmFsIC0+IFsgJ0EnLCAnRCcgXQoKICAgICAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoX3RoaXMyLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbCksCiAgICAgICAgICAgICAgX3N0ZXAyOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIHNraXBwZWQgPSBfc3RlcDIudmFsdWU7CgogICAgICAgICAgICAgIGlmIChpbmRleCA+IHNraXBwZWQpIHsKICAgICAgICAgICAgICAgIGZpbmFsSW5kZXgtLTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gV2UgbmVlZCB0byB0YWtlIGludG8gY29uc2lkZXJhdGlvbiB0aGF0IGV4dGVybmFsIGNvbGxlY3Rpb24gY291bGQgc2tpcCBzb21lIGl0ZW1zIGZyb20KICAgICAgICAgICAgLy8gaW50ZXJuYWwgY29sbGVjdGlvbi4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gRm9yIHRoZSBmb2xsb3dpbmcgZXhhbXBsZToKICAgICAgICAgICAgLy8gaW50ZXJuYWwgLT4gWyAnQScsICdCIC0gc2tpcHBlZCBmb3IgZXh0ZXJuYWwnLCAnQyAtIHNraXBwZWQgZm9yIGV4dGVybmFsJyBdCiAgICAgICAgICAgIC8vIGV4dGVybmFsIC0+IFsgQSBdCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIEFub3RoZXIgaXRlbSBpcyBiZWVuIGFkZGVkIGF0IHRoZSBlbmQgb2YgZXh0ZXJuYWwgY29sbGVjdGlvbjoKICAgICAgICAgICAgLy8gZXh0ZXJuYWwuYWRkKCAnRCcgKQogICAgICAgICAgICAvLyBleHRlcm5hbCAtPiBbICdBJywgJ0QnIF0KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBpbmNsdWRlIHNraXBwZWQgaXRlbXMgYW5kIHBsYWNlIG5ldyBpdGVtIGFmdGVyIHRoZW06CiAgICAgICAgICAgIC8vIGludGVybmFsIC0+IFsgJ0EnLCAnQiAtIHNraXBwZWQgZm9yIGV4dGVybmFsJywgJ0MgLSBza2lwcGVkIGZvciBleHRlcm5hbCcsICdEJyBdCgogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihleHRlcm5hbENvbGxlY3Rpb24uX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsKSwKICAgICAgICAgICAgICBfc3RlcDM7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IzLnMoKTsgIShfc3RlcDMgPSBfaXRlcmF0b3IzLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICB2YXIgX3NraXBwZWQgPSBfc3RlcDMudmFsdWU7CgogICAgICAgICAgICAgIGlmIChmaW5hbEluZGV4ID49IF9za2lwcGVkKSB7CiAgICAgICAgICAgICAgICBmaW5hbEluZGV4Kys7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3IzLmYoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczIuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcC5zZXQoZXh0ZXJuYWxJdGVtLCBpdGVtKTsKCiAgICAgICAgICBfdGhpczIuX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcC5zZXQoaXRlbSwgZXh0ZXJuYWxJdGVtKTsKCiAgICAgICAgICBfdGhpczIuYWRkKGl0ZW0sIGZpbmFsSW5kZXgpOyAvLyBBZnRlciBhZGRpbmcgbmV3IGVsZW1lbnQgdG8gaW50ZXJuYWwgY29sbGVjdGlvbiB3ZSBuZWVkIHVwZGF0ZSBpbmRleGVzCiAgICAgICAgICAvLyBvZiBza2lwcGVkIGl0ZW1zIGluIGV4dGVybmFsIGNvbGxlY3Rpb24uCgoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXh0ZXJuYWxDb2xsZWN0aW9uLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZmluYWxJbmRleCA8PSBleHRlcm5hbENvbGxlY3Rpb24uX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsW2ldKSB7CiAgICAgICAgICAgICAgZXh0ZXJuYWxDb2xsZWN0aW9uLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbFtpXSsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OyAvLyBMb2FkIHRoZSBpbml0aWFsIGNvbnRlbnQgb2YgdGhlIGNvbGxlY3Rpb24uCgoKICAgICAgdmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihleHRlcm5hbENvbGxlY3Rpb24pLAogICAgICAgICAgX3N0ZXA0OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgdmFyIGV4dGVybmFsSXRlbSA9IF9zdGVwNC52YWx1ZTsKICAgICAgICAgIGFkZEl0ZW0obnVsbCwgZXh0ZXJuYWxJdGVtLCBleHRlcm5hbENvbGxlY3Rpb24uZ2V0SW5kZXgoZXh0ZXJuYWxJdGVtKSk7CiAgICAgICAgfSAvLyBTeW5jaHJvbml6ZSB0aGUgd2l0aCBjb2xsZWN0aW9uIGFzIG5ldyBpdGVtcyBhcmUgYWRkZWQuCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I0LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I0LmYoKTsKICAgICAgfQoKICAgICAgdGhpcy5saXN0ZW5UbyhleHRlcm5hbENvbGxlY3Rpb24sICdhZGQnLCBhZGRJdGVtKTsgLy8gU3luY2hyb25pemUgdGhlIHdpdGggY29sbGVjdGlvbiBhcyBuZXcgaXRlbXMgYXJlIHJlbW92ZWQuCgogICAgICB0aGlzLmxpc3RlblRvKGV4dGVybmFsQ29sbGVjdGlvbiwgJ3JlbW92ZScsIGZ1bmN0aW9uIChldnQsIGV4dGVybmFsSXRlbSwgaW5kZXgpIHsKICAgICAgICB2YXIgaXRlbSA9IF90aGlzMi5fYmluZFRvRXh0ZXJuYWxUb0ludGVybmFsTWFwLmdldChleHRlcm5hbEl0ZW0pOwoKICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgX3RoaXMyLnJlbW92ZShpdGVtKTsKICAgICAgICB9IC8vIEFmdGVyIHJlbW92aW5nIGVsZW1lbnQgZnJvbSBleHRlcm5hbCBjb2xsZWN0aW9uIHdlIG5lZWQgdXBkYXRlL3JlbW92ZSBpbmRleGVzCiAgICAgICAgLy8gb2Ygc2tpcHBlZCBpdGVtcyBpbiBpbnRlcm5hbCBjb2xsZWN0aW9uLgoKCiAgICAgICAgX3RoaXMyLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbCA9IF90aGlzMi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWwucmVkdWNlKGZ1bmN0aW9uIChyZXN1bHQsIHNraXBwZWQpIHsKICAgICAgICAgIGlmIChpbmRleCA8IHNraXBwZWQpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goc2tpcHBlZCAtIDEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbmRleCA+IHNraXBwZWQpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goc2tpcHBlZCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9LCBbXSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIHVuaXF1ZSBpZCBwcm9wZXJ0eSBmb3IgYSBnaXZlbiBgaXRlbWAuCiAgICAgKgogICAgICogVGhlIG1ldGhvZCB3aWxsIGdlbmVyYXRlIG5ldyBpZCBhbmQgYXNzaWduIGl0IHRvIHRoZSBgaXRlbWAgaWYgaXQgZG9lc24ndCBoYXZlIGFueS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gSXRlbSB0byBiZSBhZGRlZC4KICAgICAqIEByZXR1cm5zIHtTdHJpbmd9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2dldEl0ZW1JZEJlZm9yZUFkZGluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEl0ZW1JZEJlZm9yZUFkZGluZyhpdGVtKSB7CiAgICAgIHZhciBpZFByb3BlcnR5ID0gdGhpcy5faWRQcm9wZXJ0eTsKICAgICAgdmFyIGl0ZW1JZDsKCiAgICAgIGlmIChpZFByb3BlcnR5IGluIGl0ZW0pIHsKICAgICAgICBpdGVtSWQgPSBpdGVtW2lkUHJvcGVydHldOwoKICAgICAgICBpZiAodHlwZW9mIGl0ZW1JZCAhPSAnc3RyaW5nJykgewogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGlzIGl0ZW0ncyBJRCBzaG91bGQgYmUgYSBzdHJpbmcuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGVycm9yIGNvbGxlY3Rpb24tYWRkLWludmFsaWQtaWQKICAgICAgICAgICAqLwogICAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbGxlY3Rpb24tYWRkLWludmFsaWQtaWQnLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmdldChpdGVtSWQpKSB7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgaXRlbSBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgY29sbGVjdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAZXJyb3IgY29sbGVjdGlvbi1hZGQtaXRlbS1hbHJlYWR5LWV4aXN0cwogICAgICAgICAgICovCiAgICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29sbGVjdGlvbi1hZGQtaXRlbS1hbHJlYWR5LWV4aXN0cycsIHRoaXMpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVtW2lkUHJvcGVydHldID0gaXRlbUlkID0gdWlkKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpdGVtSWQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcmUge0BsaW5rICNyZW1vdmV9IG1ldGhvZCBpbXBsZW1lbnRhdGlvbiBzaGFyZWQgaW4gb3RoZXIgZnVuY3Rpb25zLgogICAgICoKICAgICAqIEluIGNvbnRyYXN0IHRoaXMgbWV0aG9kICoqZG9lcyBub3QqKiBmaXJlIHRoZSB7QGxpbmsgI2V2ZW50OmNoYW5nZX0gZXZlbnQuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdWJqZWN0IFRoZSBpdGVtIHRvIHJlbW92ZSwgaXRzIGlkIG9yIGluZGV4IGluIHRoZSBjb2xsZWN0aW9uLgogICAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGFuIGFycmF5IHdpdGggdGhlIHJlbW92ZWQgaXRlbSBhbmQgaXRzIGluZGV4LgogICAgICogQGZpcmVzIHJlbW92ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9yZW1vdmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmUoc3ViamVjdCkgewogICAgICB2YXIgaW5kZXgsIGlkLCBpdGVtOwogICAgICB2YXIgaXRlbURvZXNOb3RFeGlzdCA9IGZhbHNlOwogICAgICB2YXIgaWRQcm9wZXJ0eSA9IHRoaXMuX2lkUHJvcGVydHk7CgogICAgICBpZiAodHlwZW9mIHN1YmplY3QgPT0gJ3N0cmluZycpIHsKICAgICAgICBpZCA9IHN1YmplY3Q7CiAgICAgICAgaXRlbSA9IHRoaXMuX2l0ZW1NYXAuZ2V0KGlkKTsKICAgICAgICBpdGVtRG9lc05vdEV4aXN0ID0gIWl0ZW07CgogICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICBpbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoaXRlbSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBzdWJqZWN0ID09ICdudW1iZXInKSB7CiAgICAgICAgaW5kZXggPSBzdWJqZWN0OwogICAgICAgIGl0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleF07CiAgICAgICAgaXRlbURvZXNOb3RFeGlzdCA9ICFpdGVtOwoKICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgaWQgPSBpdGVtW2lkUHJvcGVydHldOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVtID0gc3ViamVjdDsKICAgICAgICBpZCA9IGl0ZW1baWRQcm9wZXJ0eV07CiAgICAgICAgaW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGl0ZW0pOwogICAgICAgIGl0ZW1Eb2VzTm90RXhpc3QgPSBpbmRleCA9PSAtMSB8fCAhdGhpcy5faXRlbU1hcC5nZXQoaWQpOwogICAgICB9CgogICAgICBpZiAoaXRlbURvZXNOb3RFeGlzdCkgewogICAgICAgIC8qKgogICAgICAgICAqIEl0ZW0gbm90IGZvdW5kLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIGNvbGxlY3Rpb24tcmVtb3ZlLTQwNAogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLXJlbW92ZS00MDQnLCB0aGlzKTsKICAgICAgfQoKICAgICAgdGhpcy5faXRlbXMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgIHRoaXMuX2l0ZW1NYXAuZGVsZXRlKGlkKTsKCiAgICAgIHZhciBleHRlcm5hbEl0ZW0gPSB0aGlzLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuZ2V0KGl0ZW0pOwoKICAgICAgdGhpcy5fYmluZFRvSW50ZXJuYWxUb0V4dGVybmFsTWFwLmRlbGV0ZShpdGVtKTsKCiAgICAgIHRoaXMuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcC5kZWxldGUoZXh0ZXJuYWxJdGVtKTsKCiAgICAgIHRoaXMuZmlyZSgncmVtb3ZlJywgaXRlbSwgaW5kZXgpOwogICAgICByZXR1cm4gW2l0ZW0sIGluZGV4XTsKICAgIH0KICAgIC8qKgogICAgICogSXRlcmFibGUgaW50ZXJmYWNlLgogICAgICoKICAgICAqIEByZXR1cm5zIHtJdGVyYWJsZS48Kj59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiBTeW1ib2wuaXRlcmF0b3IsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgIHJldHVybiB0aGlzLl9pdGVtc1tTeW1ib2wuaXRlcmF0b3JdKCk7CiAgICB9CiAgICAvKioKICAgICAqIEZpcmVkIHdoZW4gYW4gaXRlbSBpcyBhZGRlZCB0byB0aGUgY29sbGVjdGlvbi4KICAgICAqCiAgICAgKiBAZXZlbnQgYWRkCiAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgYWRkZWQgaXRlbS4KICAgICAqLwoKICAgIC8qKgogICAgICogRmlyZWQgd2hlbiB0aGUgY29sbGVjdGlvbiB3YXMgY2hhbmdlZCBkdWUgdG8gYWRkaW5nIG9yIHJlbW92aW5nIGl0ZW1zLgogICAgICoKICAgICAqIEBldmVudCBjaGFuZ2UKICAgICAqIEBwYXJhbSB7SXRlcmFibGUuPE9iamVjdD59IGFkZGVkIEEgbGlzdCBvZiBhZGRlZCBpdGVtcy4KICAgICAqIEBwYXJhbSB7SXRlcmFibGUuPE9iamVjdD59IHJlbW92ZWQgQSBsaXN0IG9mIHJlbW92ZWQgaXRlbXMuCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggQW4gaW5kZXggd2hlcmUgdGhlIGFkZGl0aW9uIG9yIHJlbW92YWwgb2NjdXJyZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEZpcmVkIHdoZW4gYW4gaXRlbSBpcyByZW1vdmVkIGZyb20gdGhlIGNvbGxlY3Rpb24uCiAgICAgKgogICAgICogQGV2ZW50IHJlbW92ZQogICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIHJlbW92ZWQgaXRlbS4KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCBJbmRleCBmcm9tIHdoaWNoIGl0ZW0gd2FzIHJlbW92ZWQuCiAgICAgKi8KCiAgfV0pOwoKICByZXR1cm4gQ29sbGVjdGlvbjsKfSgpOwoKZXhwb3J0IHsgQ29sbGVjdGlvbiBhcyBkZWZhdWx0IH07Cm1peChDb2xsZWN0aW9uLCBFbWl0dGVyTWl4aW4pOwovKioKICogQW4gb2JqZWN0IHJldHVybmVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2NvbGxlY3Rpb25+Q29sbGVjdGlvbiNiaW5kVG8gYGJpbmRUbygpYH0gbWV0aG9kCiAqIHByb3ZpZGluZyBmdW5jdGlvbnMgdGhhdCBzcGVjaWZ5IHRoZSB0eXBlIG9mIHRoZSBiaW5kaW5nLgogKgogKiBTZWUgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9uI2JpbmRUbyBgYmluZFRvKClgfSBkb2N1bWVudGF0aW9uIGZvciBleGFtcGxlcy4KICoKICogQGludGVyZmFjZSBtb2R1bGU6dXRpbHMvY29sbGVjdGlvbn5Db2xsZWN0aW9uQmluZFRvQ2hhaW4KICovCgovKioKICogQ3JlYXRlcyBhIGNhbGxiYWNrIG9yIGEgcHJvcGVydHkgYmluZGluZy4KICoKICogQG1ldGhvZCAjdXNpbmcKICogQHBhcmFtIHtGdW5jdGlvbnxTdHJpbmd9IGNhbGxiYWNrT3JQcm9wZXJ0eSAgV2hlbiB0aGUgZnVuY3Rpb24gaXMgcGFzc2VkLCBpdCBzaG91bGQgcmV0dXJuCiAqIHRoZSBjb2xsZWN0aW9uIGl0ZW1zLiBXaGVuIHRoZSBzdHJpbmcgaXMgcHJvdmlkZWQsIHRoZSBwcm9wZXJ0eSB2YWx1ZSBpcyB1c2VkIHRvIGNyZWF0ZSB0aGUgYm91bmQgY29sbGVjdGlvbiBpdGVtcy4KICovCgovKioKICogQ3JlYXRlcyB0aGUgY2xhc3MgZmFjdG9yeSBiaW5kaW5nIGluIHdoaWNoIGl0ZW1zIG9mIHRoZSBzb3VyY2UgY29sbGVjdGlvbiBhcmUgcGFzc2VkIHRvCiAqIHRoZSBjb25zdHJ1Y3RvciBvZiB0aGUgc3BlY2lmaWVkIGNsYXNzLgogKgogKiBAbWV0aG9kICNhcwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBDbGFzcyBUaGUgY2xhc3MgY29uc3RydWN0b3IgdXNlZCB0byBjcmVhdGUgaW5zdGFuY2VzIGluIHRoZSBmYWN0b3J5LgogKi8="},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-utils/src/collection.js"],"names":["EmitterMixin","CKEditorError","uid","isIterable","mix","Collection","initialItemsOrOptions","options","hasInitialItems","_items","_itemMap","Map","_idProperty","idProperty","_bindToExternalToInternalMap","WeakMap","_bindToInternalToExternalMap","_skippedIndexesFromExternal","item","push","set","_getItemIdBeforeAdding","length","index","addMany","items","undefined","offset","itemId","currentItemIndex","splice","fire","added","removed","idOrIndex","get","itemOrId","has","id","indexOf","subject","_remove","callback","ctx","map","find","filter","_bindToCollection","stopListening","removedItems","Array","from","externalCollection","as","Class","_setUpBindToBinding","using","callbackOrProperty","factory","addItem","evt","externalItem","isExternalBoundToThis","externalItemBound","finalIndex","skipped","add","i","getIndex","listenTo","remove","reduce","result","itemDoesNotExist","delete","Symbol","iterator"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA,OAAOA,YAAP,MAAyB,gBAAzB;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,GAAP,MAAgB,OAAhB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,GAAP,MAAgB,OAAhB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IACqBC,U;AACpB;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACC,wBAAwD;AAAA,QAA3CC,qBAA2C,uEAAnB,EAAmB;AAAA,QAAfC,OAAe,uEAAL,EAAK;;AAAA;;AACvD,QAAMC,eAAe,GAAGL,UAAU,CAAEG,qBAAF,CAAlC;;AAEA,QAAK,CAACE,eAAN,EAAwB;AACvBD,MAAAA,OAAO,GAAGD,qBAAV;AACA;AAED;AACF;AACA;AACA;AACA;AACA;;;AACE,SAAKG,MAAL,GAAc,EAAd;AAEA;AACF;AACA;AACA;AACA;AACA;;AACE,SAAKC,QAAL,GAAgB,IAAIC,GAAJ,EAAhB;AAEA;AACF;AACA;AACA;AACA;AACA;;AACE,SAAKC,WAAL,GAAmBL,OAAO,CAACM,UAAR,IAAsB,IAAzC;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,SAAKC,4BAAL,GAAoC,IAAIC,OAAJ,EAApC;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,SAAKC,4BAAL,GAAoC,IAAID,OAAJ,EAApC;AAEA;AACF;AACA;AACA;AACA;AACA;;AACE,SAAKE,2BAAL,GAAmC,EAAnC,CA7DuD,CA+DvD;;AACA,QAAKT,eAAL,EAAuB;AAAA,iDACFF,qBADE;AAAA;;AAAA;AACtB,4DAA4C;AAAA,cAAhCY,IAAgC;;AAC3C,eAAKT,MAA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C,QAAAA,KAAK,EAAE,EADa;AAEpBC,QAAAA,OAAO,EAAEgB,YAFW;AAGpB1B,QAAAA,KAAK,EAAE;AAHa,OAArB;AAKA;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;WACC,gBAAQ6B,kBAAR,EAA6B;AAAA;;AAC5B,UAAK,KAAKL,iBAAV,EAA8B;AAC7B;AACH;AACA;AACA;AACA;AACG,cAAM,IAAI9C,aAAJ,CAAmB,2BAAnB,EAAgD,IAAhD,CAAN;AACA;;AAED,WAAK8C,iBAAL,GAAyBK,kBAAzB;AAEA,aAAO;AACNC,QAAAA,EAAE,EAAE,YAAAC,KAAK,EAAI;AACZ,UAAA,KAAI,CAACC,mBAAL,CAA0B,UAAArC,IAAI;AAAA,mBAAI,IAAIoC,KAAJ,CAAWpC,IAAX,CAAJ;AAAA,WAA9B;AACA,SAHK;AAKNsC,QAAAA,KAAK,EAAE,eAAAC,kBAAkB,EAAI;AAC5B,cAAK,OAAOA,kBAAP,IAA6B,UAAlC,EAA+C;AAC9C,YAAA,KAAI,CAACF,mBAAL,CAA0B,UAAArC,IAAI;AAAA,qBAAIuC,kBAAkB,CAAEvC,IAAF,CAAtB;AAAA,aAA9B;AACA,WAFD,MAEO;AACN,YAAA,KAAI,CAACqC,mBAAL,CAA0B,UAAArC,IAAI;AAAA,qBAAIA,IAAI,CAAEuC,kBAAF,CAAR;AAAA,aAA9B;AACA;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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module utils/collection\n */\n\nimport EmitterMixin from './emittermixin';\nimport CKEditorError from './ckeditorerror';\nimport uid from './uid';\nimport isIterable from './isiterable';\nimport mix from './mix';\n\n/**\n * Collections are ordered sets of objects. Items in the collection can be retrieved by their indexes\n * in the collection (like in an array) or by their ids.\n *\n * If an object without an `id` property is being added to the collection, the `id` property will be generated\n * automatically. Note that the automatically generated id is unique only within this single collection instance.\n *\n * By default an item in the collection is identified by its `id` property. The name of the identifier can be\n * configured through the constructor of the collection.\n *\n * @mixes module:utils/emittermixin~EmitterMixin\n */\nexport default class Collection {\n\t/**\n\t * Creates a new Collection instance.\n\t *\n\t * You can provide an iterable of initial items the collection will be created with:\n\t *\n\t *\t\tconst collection = new Collection( [ { id: 'John' }, { id: 'Mike' } ] );\n\t *\n\t *\t\tconsole.log( collection.get( 0 ) ); // -> { id: 'John' }\n\t *\t\tconsole.log( collection.get( 1 ) ); // -> { id: 'Mike' }\n\t *\t\tconsole.log( collection.get( 'Mike' ) ); // -> { id: 'Mike' }\n\t *\n\t * Or you can first create a collection and then add new items using the {@link #add} method:\n\t *\n\t *\t\tconst collection = new Collection();\n\t *\n\t *\t\tcollection.add( { id: 'John' } );\n\t *\t\tconsole.log( collection.get( 0 ) ); // -> { id: 'John' }\n\t *\n\t * Whatever option you choose, you can always pass a configuration object as the last argument\n\t * of the constructor:\n\t *\n\t *\t\tconst emptyCollection = new Collection( { idProperty: 'name' } );\n\t *\t\temptyCollection.add( { name: 'John' } );\n\t *\t\tconsole.log( collection.get( 'John' ) ); // -> { name: 'John' }\n\t *\n\t *\t\tconst nonEmptyCollection = new Collection( [ { name: 'John' } ], { idProperty: 'name' } );\n\t *\t\tnonEmptyCollection.add( { name: 'George' } );\n\t *\t\tconsole.log( collection.get( 'George' ) ); // -> { name: 'George' }\n\t *\t\tconsole.log( collection.get( 'John' ) ); // -> { name: 'John' }\n\t *\n\t * @param {Iterable.<Object>|Object} initialItemsOrOptions The initial items of the collection or\n\t * the options object.\n\t * @param {Object} [options={}] The options object, when the first argument is an array of initial items.\n\t * @param {String} [options.idProperty='id'] The name of the property which is used to identify an item.\n\t * Items that do not have such a property will be assigned one when added to the collection.\n\t */\n\tconstructor( initialItemsOrOptions = {}, options = {} ) {\n\t\tconst hasInitialItems = isIterable( initialItemsOrOptions );\n\n\t\tif ( !hasInitialItems ) {\n\t\t\toptions = initialItemsOrOptions;\n\t\t}\n\n\t\t/**\n\t\t * The internal list of items in the collection.\n\t\t *\n\t\t * @private\n\t\t * @member {Object[]}\n\t\t */\n\t\tthis._items = [];\n\n\t\t/**\n\t\t * The internal map of items in the collection.\n\t\t *\n\t\t * @private\n\t\t * @member {Map}\n\t\t */\n\t\tthis._itemMap = new Map();\n\n\t\t/**\n\t\t * The name of the property which is considered to identify an item.\n\t\t *\n\t\t * @private\n\t\t * @member {String}\n\t\t */\n\t\tthis._idProperty = options.idProperty || 'id';\n\n\t\t/**\n\t\t * A helper mapping external items of a bound collection ({@link #bindTo})\n\t\t * and actual items of this collection. It provides information\n\t\t * necessary to properly remove items bound to another collection.\n\t\t *\n\t\t * See {@link #_bindToInternalToExternalMap}.\n\t\t *\n\t\t * @protected\n\t\t * @member {WeakMap}\n\t\t */\n\t\tthis._bindToExternalToInternalMap = new WeakMap();\n\n\t\t/**\n\t\t * A helper mapping items of this collection to external items of a bound collection\n\t\t * ({@link #bindTo}). It provides information necessary to manage the bindings, e.g.\n\t\t * to avoid loops in twoway bindings.\n\t\t *\n\t\t * See {@link #_bindToExternalToInternalMap}.\n\t\t *\n\t\t * @protected\n\t\t * @member {WeakMap}\n\t\t */\n\t\tthis._bindToInternalToExternalMap = new WeakMap();\n\n\t\t/**\n\t\t * Stores indexes of skipped items from bound external collection.\n\t\t *\n\t\t * @private\n\t\t * @member {Array}\n\t\t */\n\t\tthis._skippedIndexesFromExternal = [];\n\n\t\t// Set the initial content of the collection (if provided in the constructor).\n\t\tif ( hasInitialItems ) {\n\t\t\tfor ( const item of initialItemsOrOptions ) {\n\t\t\t\tthis._items.push( item );\n\t\t\t\tthis._itemMap.set( this._getItemIdBeforeAdding( item ), item );\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * A collection instance this collection is bound to as a result\n\t\t * of calling {@link #bindTo} method.\n\t\t *\n\t\t * @protected\n\t\t * @member {module:utils/collection~Collection} #_bindToCollection\n\t\t */\n\t}\n\n\t/**\n\t * The number of items available in the collection.\n\t *\n\t * @member {Number} #length\n\t */\n\tget length() {\n\t\treturn this._items.length;\n\t}\n\n\t/**\n\t * Returns the first item from the collection or null when collection is empty.\n\t *\n\t * @returns {Object|null} The first item or `null` if collection is empty.\n\t */\n\tget first() {\n\t\treturn this._items[ 0 ] || null;\n\t}\n\n\t/**\n\t * Returns the last item from the collection or null when collection is empty.\n\t *\n\t * @returns {Object|null} The last item or `null` if collection is empty.\n\t */\n\tget last() {\n\t\treturn this._items[ this.length - 1 ] || null;\n\t}\n\n\t/**\n\t * Adds an item into the collection.\n\t *\n\t * If the item does not have an id, then it will be automatically generated and set on the item.\n\t *\n\t * @chainable\n\t * @param {Object} item\n\t * @param {Number} [index] The position of the item in the collection. The item\n\t * is pushed to the collection when `index` not specified.\n\t * @fires add\n\t * @fires change\n\t */\n\tadd( item, index ) {\n\t\treturn this.addMany( [ item ], index );\n\t}\n\n\t/**\n\t * Adds multiple items into the collection.\n\t *\n\t * Any item not containing an id will get an automatically generated one.\n\t *\n\t * @chainable\n\t * @param {Iterable.<Object>} item\n\t * @param {Number} [index] The position of the insertion. Items will be appended if no `index` is specified.\n\t * @fires add\n\t * @fires change\n\t */\n\taddMany( items, index ) {\n\t\tif ( index === undefined ) {\n\t\t\tindex = this._items.length;\n\t\t} else if ( index > this._items.length || index < 0 ) {\n\t\t\t/**\n\t\t\t * The `index` passed to {@link module:utils/collection~Collection#addMany `Collection#addMany()`}\n\t\t\t * is invalid. It must be a number between 0 and the collection's length.\n\t\t\t *\n\t\t\t * @error collection-add-item-invalid-index\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-add-item-invalid-index', this );\n\t\t}\n\n\t\tfor ( let offset = 0; offset < items.length; offset++ ) {\n\t\t\tconst item = items[ offset ];\n\t\t\tconst itemId = this._getItemIdBeforeAdding( item );\n\t\t\tconst currentItemIndex = index + offset;\n\n\t\t\tthis._items.splice( currentItemIndex, 0, item );\n\t\t\tthis._itemMap.set( itemId, item );\n\n\t\t\tthis.fire( 'add', item, currentItemIndex );\n\t\t}\n\n\t\tthis.fire( 'change', {\n\t\t\tadded: items,\n\t\t\tremoved: [],\n\t\t\tindex\n\t\t} );\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Gets an item by its ID or index.\n\t *\n\t * @param {String|Number} idOrIndex The item ID or index in the collection.\n\t * @returns {Object|null} The requested item or `null` if such item does not exist.\n\t */\n\tget( idOrIndex ) {\n\t\tlet item;\n\n\t\tif ( typeof idOrIndex == 'string' ) {\n\t\t\titem = this._itemMap.get( idOrIndex );\n\t\t} else if ( typeof idOrIndex == 'number' ) {\n\t\t\titem = this._items[ idOrIndex ];\n\t\t} else {\n\t\t\t/**\n\t\t\t * An index or ID must be given.\n\t\t\t *\n\t\t\t * @error collection-get-invalid-arg\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-get-invalid-arg', this );\n\t\t}\n\n\t\treturn item || null;\n\t}\n\n\t/**\n\t * Returns a Boolean indicating whether the collection contains an item.\n\t *\n\t * @param {Object|String} itemOrId The item or its ID in the collection.\n\t * @returns {Boolean} `true` if the collection contains the item, `false` otherwise.\n\t */\n\thas( itemOrId ) {\n\t\tif ( typeof itemOrId == 'string' ) {\n\t\t\treturn this._itemMap.has( itemOrId );\n\t\t} else { // Object\n\t\t\tconst idProperty = this._idProperty;\n\t\t\tconst id = itemOrId[ idProperty ];\n\n\t\t\treturn this._itemMap.has( id );\n\t\t}\n\t}\n\n\t/**\n\t * Gets an index of an item in the collection.\n\t * When an item is not defined in the collection, the index will equal -1.\n\t *\n\t * @param {Object|String} itemOrId The item or its ID in the collection.\n\t * @returns {Number} The index of a given item.\n\t */\n\tgetIndex( itemOrId ) {\n\t\tlet item;\n\n\t\tif ( typeof itemOrId == 'string' ) {\n\t\t\titem = this._itemMap.get( itemOrId );\n\t\t} else {\n\t\t\titem = itemOrId;\n\t\t}\n\n\t\treturn this._items.indexOf( item );\n\t}\n\n\t/**\n\t * Removes an item from the collection.\n\t *\n\t * @param {Object|Number|String} subject The item to remove, its ID or index in the collection.\n\t * @returns {Object} The removed item.\n\t * @fires remove\n\t * @fires change\n\t */\n\tremove( subject ) {\n\t\tconst [ item, index ] = this._remove( subject );\n\n\t\tthis.fire( 'change', {\n\t\t\tadded: [],\n\t\t\tremoved: [ item ],\n\t\t\tindex\n\t\t} );\n\n\t\treturn item;\n\t}\n\n\t/**\n\t * Executes the callback for each item in the collection and composes an array or values returned by this callback.\n\t *\n\t * @param {Function} callback\n\t * @param {Object} callback.item\n\t * @param {Number} callback.index\n\t * @param {Object} ctx Context in which the `callback` will be called.\n\t * @returns {Array} The result of mapping.\n\t */\n\tmap( callback, ctx ) {\n\t\treturn this._items.map( callback, ctx );\n\t}\n\n\t/**\n\t * Finds the first item in the collection for which the `callback` returns a true value.\n\t *\n\t * @param {Function} callback\n\t * @param {Object} callback.item\n\t * @param {Number} callback.index\n\t * @param {Object} ctx Context in which the `callback` will be called.\n\t * @returns {Object} The item for which `callback` returned a true value.\n\t */\n\tfind( callback, ctx ) {\n\t\treturn this._items.find( callback, ctx );\n\t}\n\n\t/**\n\t * Returns an array with items for which the `callback` returned a true value.\n\t *\n\t * @param {Function} callback\n\t * @param {Object} callback.item\n\t * @param {Number} callback.index\n\t * @param {Object} ctx Context in which the `callback` will be called.\n\t * @returns {Object[]} The array with matching items.\n\t */\n\tfilter( callback, ctx ) {\n\t\treturn this._items.filter( callback, ctx );\n\t}\n\n\t/**\n\t * Removes all items from the collection and destroys the binding created using\n\t * {@link #bindTo}.\n\t *\n\t * @fires remove\n\t * @fires change\n\t */\n\tclear() {\n\t\tif ( this._bindToCollection ) {\n\t\t\tthis.stopListening( this._bindToCollection );\n\t\t\tthis._bindToCollection = null;\n\t\t}\n\n\t\tconst removedItems = Array.from( this._items );\n\n\t\twhile ( this.length ) {\n\t\t\tthis._remove( 0 );\n\t\t}\n\n\t\tthis.fire( 'change', {\n\t\t\tadded: [],\n\t\t\tremoved: removedItems,\n\t\t\tindex: 0\n\t\t} );\n\t}\n\n\t/**\n\t * Binds and synchronizes the collection with another one.\n\t *\n\t * The binding can be a simple factory:\n\t *\n\t *\t\tclass FactoryClass {\n\t *\t\t\tconstructor( data ) {\n\t *\t\t\t\tthis.label = data.label;\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).as( FactoryClass );\n\t *\n\t *\t\tsource.add( { label: 'foo' } );\n\t *\t\tsource.add( { label: 'bar' } );\n\t *\n\t *\t\tconsole.log( target.length ); // 2\n\t *\t\tconsole.log( target.get( 1 ).label ); // 'bar'\n\t *\n\t *\t\tsource.remove( 0 );\n\t *\t\tconsole.log( target.length ); // 1\n\t *\t\tconsole.log( target.get( 0 ).label ); // 'bar'\n\t *\n\t * or the factory driven by a custom callback:\n\t *\n\t *\t\tclass FooClass {\n\t *\t\t\tconstructor( data ) {\n\t *\t\t\t\tthis.label = data.label;\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t *\t\tclass BarClass {\n\t *\t\t\tconstructor( data ) {\n\t *\t\t\t\tthis.label = data.label;\n\t *\t\t\t}\n\t *\t\t}\n\t *\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).using( ( item ) => {\n\t *\t\t\tif ( item.label == 'foo' ) {\n\t *\t\t\t\treturn new FooClass( item );\n\t *\t\t\t} else {\n\t *\t\t\t\treturn new BarClass( item );\n\t *\t\t\t}\n\t *\t\t} );\n\t *\n\t *\t\tsource.add( { label: 'foo' } );\n\t *\t\tsource.add( { label: 'bar' } );\n\t *\n\t *\t\tconsole.log( target.length ); // 2\n\t *\t\tconsole.log( target.get( 0 ) instanceof FooClass ); // true\n\t *\t\tconsole.log( target.get( 1 ) instanceof BarClass ); // true\n\t *\n\t * or the factory out of property name:\n\t *\n\t *\t\tconst source = new Collection( { idProperty: 'label' } );\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).using( 'label' );\n\t *\n\t *\t\tsource.add( { label: { value: 'foo' } } );\n\t *\t\tsource.add( { label: { value: 'bar' } } );\n\t *\n\t *\t\tconsole.log( target.length ); // 2\n\t *\t\tconsole.log( target.get( 0 ).value ); // 'foo'\n\t *\t\tconsole.log( target.get( 1 ).value ); // 'bar'\n\t *\n\t * It's possible to skip specified items by returning falsy value:\n\t *\n\t *\t\tconst source = new Collection();\n\t *\t\tconst target = new Collection();\n\t *\n\t *\t\ttarget.bindTo( source ).using( item => {\n\t *\t\t\tif ( item.hidden ) {\n\t *\t\t\t\treturn null;\n\t *\t\t\t}\n\t *\n\t *\t\t\treturn item;\n\t *\t\t} );\n\t *\n\t *\t\tsource.add( { hidden: true } );\n\t *\t\tsource.add( { hidden: false } );\n\t *\n\t *\t\tconsole.log( source.length ); // 2\n\t *\t\tconsole.log( target.length ); // 1\n\t *\n\t * **Note**: {@link #clear} can be used to break the binding.\n\t *\n\t * @param {module:utils/collection~Collection} externalCollection A collection to be bound.\n\t * @returns {Object}\n\t * @returns {module:utils/collection~CollectionBindToChain} The binding chain object.\n\t */\n\tbindTo( externalCollection ) {\n\t\tif ( this._bindToCollection ) {\n\t\t\t/**\n\t\t\t * The collection cannot be bound more than once.\n\t\t\t *\n\t\t\t * @error collection-bind-to-rebind\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-bind-to-rebind', this );\n\t\t}\n\n\t\tthis._bindToCollection = externalCollection;\n\n\t\treturn {\n\t\t\tas: Class => {\n\t\t\t\tthis._setUpBindToBinding( item => new Class( item ) );\n\t\t\t},\n\n\t\t\tusing: callbackOrProperty => {\n\t\t\t\tif ( typeof callbackOrProperty == 'function' ) {\n\t\t\t\t\tthis._setUpBindToBinding( item => callbackOrProperty( item ) );\n\t\t\t\t} else {\n\t\t\t\t\tthis._setUpBindToBinding( item => item[ callbackOrProperty ] );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Finalizes and activates a binding initiated by {#bindTo}.\n\t *\n\t * @protected\n\t * @param {Function} factory A function which produces collection items.\n\t */\n\t_setUpBindToBinding( factory ) {\n\t\tconst externalCollection = this._bindToCollection;\n\n\t\t// Adds the item to the collection once a change has been done to the external collection.\n\t\t//\n\t\t// @private\n\t\tconst addItem = ( evt, externalItem, index ) => {\n\t\t\tconst isExternalBoundToThis = externalCollection._bindToCollection == this;\n\t\t\tconst externalItemBound = externalCollection._bindToInternalToExternalMap.get( externalItem );\n\n\t\t\t// If an external collection is bound to this collection, which makes it a 2way binding,\n\t\t\t// and the particular external collection item is already bound, don't add it here.\n\t\t\t// The external item has been created **out of this collection's item** and (re)adding it will\n\t\t\t// cause a loop.\n\t\t\tif ( isExternalBoundToThis && externalItemBound ) {\n\t\t\t\tthis._bindToExternalToInternalMap.set( externalItem, externalItemBound );\n\t\t\t\tthis._bindToInternalToExternalMap.set( externalItemBound, externalItem );\n\t\t\t} else {\n\t\t\t\tconst item = factory( externalItem );\n\n\t\t\t\t// When there is no item we need to remember skipped index first and then we can skip this item.\n\t\t\t\tif ( !item ) {\n\t\t\t\t\tthis._skippedIndexesFromExternal.push( index );\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Lets try to put item at the same index as index in external collection\n\t\t\t\t// but when there are a skipped items in one or both collections we need to recalculate this index.\n\t\t\t\tlet finalIndex = index;\n\n\t\t\t\t// When we try to insert item after some skipped items from external collection we need\n\t\t\t\t// to include this skipped items and decrease index.\n\t\t\t\t//\n\t\t\t\t// For the following example:\n\t\t\t\t// external -> [ 'A', 'B - skipped for internal', 'C - skipped for internal' ]\n\t\t\t\t// internal -> [ A ]\n\t\t\t\t//\n\t\t\t\t// Another item is been added at the end of external collection:\n\t\t\t\t// external.add( 'D' )\n\t\t\t\t// external -> [ 'A', 'B - skipped for internal', 'C - skipped for internal', 'D' ]\n\t\t\t\t//\n\t\t\t\t// We can't just add 'D' to internal at the same index as index in external because\n\t\t\t\t// this will produce empty indexes what is invalid:\n\t\t\t\t// internal -> [ 'A', empty, empty, 'D' ]\n\t\t\t\t//\n\t\t\t\t// So we need to include skipped items and decrease index\n\t\t\t\t// internal -> [ 'A', 'D' ]\n\t\t\t\tfor ( const skipped of this._skippedIndexesFromExternal ) {\n\t\t\t\t\tif ( index > skipped ) {\n\t\t\t\t\t\tfinalIndex--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// We need to take into consideration that external collection could skip some items from\n\t\t\t\t// internal collection.\n\t\t\t\t//\n\t\t\t\t// For the following example:\n\t\t\t\t// internal -> [ 'A', 'B - skipped for external', 'C - skipped for external' ]\n\t\t\t\t// external -> [ A ]\n\t\t\t\t//\n\t\t\t\t// Another item is been added at the end of external collection:\n\t\t\t\t// external.add( 'D' )\n\t\t\t\t// external -> [ 'A', 'D' ]\n\t\t\t\t//\n\t\t\t\t// We need to include skipped items and place new item after them:\n\t\t\t\t// internal -> [ 'A', 'B - skipped for external', 'C - skipped for external', 'D' ]\n\t\t\t\tfor ( const skipped of externalCollection._skippedIndexesFromExternal ) {\n\t\t\t\t\tif ( finalIndex >= skipped ) {\n\t\t\t\t\t\tfinalIndex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._bindToExternalToInternalMap.set( externalItem, item );\n\t\t\t\tthis._bindToInternalToExternalMap.set( item, externalItem );\n\t\t\t\tthis.add( item, finalIndex );\n\n\t\t\t\t// After adding new element to internal collection we need update indexes\n\t\t\t\t// of skipped items in external collection.\n\t\t\t\tfor ( let i = 0; i < externalCollection._skippedIndexesFromExternal.length; i++ ) {\n\t\t\t\t\tif ( finalIndex <= externalCollection._skippedIndexesFromExternal[ i ] ) {\n\t\t\t\t\t\texternalCollection._skippedIndexesFromExternal[ i ]++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Load the initial content of the collection.\n\t\tfor ( const externalItem of externalCollection ) {\n\t\t\taddItem( null, externalItem, externalCollection.getIndex( externalItem ) );\n\t\t}\n\n\t\t// Synchronize the with collection as new items are added.\n\t\tthis.listenTo( externalCollection, 'add', addItem );\n\n\t\t// Synchronize the with collection as new items are removed.\n\t\tthis.listenTo( externalCollection, 'remove', ( evt, externalItem, index ) => {\n\t\t\tconst item = this._bindToExternalToInternalMap.get( externalItem );\n\n\t\t\tif ( item ) {\n\t\t\t\tthis.remove( item );\n\t\t\t}\n\n\t\t\t// After removing element from external collection we need update/remove indexes\n\t\t\t// of skipped items in internal collection.\n\t\t\tthis._skippedIndexesFromExternal = this._skippedIndexesFromExternal.reduce( ( result, skipped ) => {\n\t\t\t\tif ( index < skipped ) {\n\t\t\t\t\tresult.push( skipped - 1 );\n\t\t\t\t}\n\n\t\t\t\tif ( index > skipped ) {\n\t\t\t\t\tresult.push( skipped );\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}, [] );\n\t\t} );\n\t}\n\n\t/**\n\t * Returns an unique id property for a given `item`.\n\t *\n\t * The method will generate new id and assign it to the `item` if it doesn't have any.\n\t *\n\t * @private\n\t * @param {Object} item Item to be added.\n\t * @returns {String}\n\t */\n\t_getItemIdBeforeAdding( item ) {\n\t\tconst idProperty = this._idProperty;\n\t\tlet itemId;\n\n\t\tif ( ( idProperty in item ) ) {\n\t\t\titemId = item[ idProperty ];\n\n\t\t\tif ( typeof itemId != 'string' ) {\n\t\t\t\t/**\n\t\t\t\t * This item's ID should be a string.\n\t\t\t\t *\n\t\t\t\t * @error collection-add-invalid-id\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'collection-add-invalid-id', this );\n\t\t\t}\n\n\t\t\tif ( this.get( itemId ) ) {\n\t\t\t\t/**\n\t\t\t\t * This item already exists in the collection.\n\t\t\t\t *\n\t\t\t\t * @error collection-add-item-already-exists\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'collection-add-item-already-exists', this );\n\t\t\t}\n\t\t} else {\n\t\t\titem[ idProperty ] = itemId = uid();\n\t\t}\n\n\t\treturn itemId;\n\t}\n\n\t/**\n\t * Core {@link #remove} method implementation shared in other functions.\n\t *\n\t * In contrast this method **does not** fire the {@link #event:change} event.\n\t *\n\t * @private\n\t * @param {Object} subject The item to remove, its id or index in the collection.\n\t * @returns {Array} Returns an array with the removed item and its index.\n\t * @fires remove\n\t */\n\t_remove( subject ) {\n\t\tlet index, id, item;\n\t\tlet itemDoesNotExist = false;\n\t\tconst idProperty = this._idProperty;\n\n\t\tif ( typeof subject == 'string' ) {\n\t\t\tid = subject;\n\t\t\titem = this._itemMap.get( id );\n\t\t\titemDoesNotExist = !item;\n\n\t\t\tif ( item ) {\n\t\t\t\tindex = this._items.indexOf( item );\n\t\t\t}\n\t\t} else if ( typeof subject == 'number' ) {\n\t\t\tindex = subject;\n\t\t\titem = this._items[ index ];\n\t\t\titemDoesNotExist = !item;\n\n\t\t\tif ( item ) {\n\t\t\t\tid = item[ idProperty ];\n\t\t\t}\n\t\t} else {\n\t\t\titem = subject;\n\t\t\tid = item[ idProperty ];\n\t\t\tindex = this._items.indexOf( item );\n\t\t\titemDoesNotExist = ( index == -1 || !this._itemMap.get( id ) );\n\t\t}\n\n\t\tif ( itemDoesNotExist ) {\n\t\t\t/**\n\t\t\t * Item not found.\n\t\t\t *\n\t\t\t * @error collection-remove-404\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'collection-remove-404', this );\n\t\t}\n\n\t\tthis._items.splice( index, 1 );\n\t\tthis._itemMap.delete( id );\n\n\t\tconst externalItem = this._bindToInternalToExternalMap.get( item );\n\t\tthis._bindToInternalToExternalMap.delete( item );\n\t\tthis._bindToExternalToInternalMap.delete( externalItem );\n\n\t\tthis.fire( 'remove', item, index );\n\n\t\treturn [ item, index ];\n\t}\n\n\t/**\n\t * Iterable interface.\n\t *\n\t * @returns {Iterable.<*>}\n\t */\n\t[ Symbol.iterator ]() {\n\t\treturn this._items[ Symbol.iterator ]();\n\t}\n\n\t/**\n\t * Fired when an item is added to the collection.\n\t *\n\t * @event add\n\t * @param {Object} item The added item.\n\t */\n\n\t/**\n\t * Fired when the collection was changed due to adding or removing items.\n\t *\n\t * @event change\n\t * @param {Iterable.<Object>} added A list of added items.\n\t * @param {Iterable.<Object>} removed A list of removed items.\n\t * @param {Number} index An index where the addition or removal occurred.\n\t */\n\n\t/**\n\t * Fired when an item is removed from the collection.\n\t *\n\t * @event remove\n\t * @param {Object} item The removed item.\n\t * @param {Number} index Index from which item was removed.\n\t */\n}\n\nmix( Collection, EmitterMixin );\n\n/**\n * An object returned by the {@link module:utils/collection~Collection#bindTo `bindTo()`} method\n * providing functions that specify the type of the binding.\n *\n * See the {@link module:utils/collection~Collection#bindTo `bindTo()`} documentation for examples.\n *\n * @interface module:utils/collection~CollectionBindToChain\n */\n\n/**\n * Creates a callback or a property binding.\n *\n * @method #using\n * @param {Function|String} callbackOrProperty  When the function is passed, it should return\n * the collection items. When the string is provided, the property value is used to create the bound collection items.\n */\n\n/**\n * Creates the class factory binding in which items of the source collection are passed to\n * the constructor of the specified class.\n *\n * @method #as\n * @param {Function} Class The class constructor used to create instances in the factory.\n */\n"]}]}