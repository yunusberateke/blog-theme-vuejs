{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-link/src/linkediting.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-link/src/linkediting.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfc2xpY2VkVG9BcnJheSBmcm9tICIvaG9tZS9la2ViZXJhdC9ZYW5kZXguRGlzay9Qcm9qZWxlcmltL0JlbmltUHJvamVsZXJpbS93ZWJzaXRlbS93ZWJzaXRlbS13ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmFuY2hvci5qcyI7CgovKioKICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjEsIENLU291cmNlIC0gRnJlZGVyaWNvIEtuYWJiZW4uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLW9zcy1saWNlbnNlCiAqLwoKLyoqCiAqIEBtb2R1bGUgbGluay9saW5rZWRpdGluZwogKi8KaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSAnY2tlZGl0b3I1L3NyYy9jb3JlJzsKaW1wb3J0IHsgTW91c2VPYnNlcnZlciB9IGZyb20gJ2NrZWRpdG9yNS9zcmMvZW5naW5lJzsKaW1wb3J0IHsgSW5wdXQsIFR3b1N0ZXBDYXJldE1vdmVtZW50LCBpbmxpbmVIaWdobGlnaHQsIGZpbmRBdHRyaWJ1dGVSYW5nZSB9IGZyb20gJ2NrZWRpdG9yNS9zcmMvdHlwaW5nJzsKaW1wb3J0IHsgQ2xpcGJvYXJkUGlwZWxpbmUgfSBmcm9tICdja2VkaXRvcjUvc3JjL2NsaXBib2FyZCc7CmltcG9ydCB7IGtleUNvZGVzIH0gZnJvbSAnY2tlZGl0b3I1L3NyYy91dGlscyc7CmltcG9ydCBMaW5rQ29tbWFuZCBmcm9tICcuL2xpbmtjb21tYW5kJzsKaW1wb3J0IFVubGlua0NvbW1hbmQgZnJvbSAnLi91bmxpbmtjb21tYW5kJzsKaW1wb3J0IE1hbnVhbERlY29yYXRvciBmcm9tICcuL3V0aWxzL21hbnVhbGRlY29yYXRvcic7CmltcG9ydCB7IGNyZWF0ZUxpbmtFbGVtZW50LCBlbnN1cmVTYWZlVXJsLCBnZXRMb2NhbGl6ZWREZWNvcmF0b3JzLCBub3JtYWxpemVEZWNvcmF0b3JzIH0gZnJvbSAnLi91dGlscyc7CmltcG9ydCAnLi4vdGhlbWUvbGluay5jc3MnOwp2YXIgSElHSExJR0hUX0NMQVNTID0gJ2NrLWxpbmtfc2VsZWN0ZWQnOwp2YXIgREVDT1JBVE9SX0FVVE9NQVRJQyA9ICdhdXRvbWF0aWMnOwp2YXIgREVDT1JBVE9SX01BTlVBTCA9ICdtYW51YWwnOwp2YXIgRVhURVJOQUxfTElOS1NfUkVHRVhQID0gL14oaHR0cHM/Oik/XC9cLy87Ci8qKgogKiBUaGUgbGluayBlbmdpbmUgZmVhdHVyZS4KICoKICogSXQgaW50cm9kdWNlcyB0aGUgYGxpbmtIcmVmPSJ1cmwiYCBhdHRyaWJ1dGUgaW4gdGhlIG1vZGVsIHdoaWNoIHJlbmRlcnMgdG8gdGhlIHZpZXcgYXMgYSBgPGEgaHJlZj0idXJsIj5gIGVsZW1lbnQKICogYXMgd2VsbCBhcyBgJ2xpbmsnYCBhbmQgYCd1bmxpbmsnYCBjb21tYW5kcy4KICoKICogQGV4dGVuZHMgbW9kdWxlOmNvcmUvcGx1Z2luflBsdWdpbgogKi8KCnZhciBMaW5rRWRpdGluZyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BsdWdpbikgewogIF9pbmhlcml0cyhMaW5rRWRpdGluZywgX1BsdWdpbik7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoTGlua0VkaXRpbmcpOwoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogIGZ1bmN0aW9uIExpbmtFZGl0aW5nKGVkaXRvcikgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMaW5rRWRpdGluZyk7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBlZGl0b3IpOwogICAgZWRpdG9yLmNvbmZpZy5kZWZpbmUoJ2xpbmsnLCB7CiAgICAgIGFkZFRhcmdldFRvRXh0ZXJuYWxMaW5rczogZmFsc2UKICAgIH0pOwogICAgcmV0dXJuIF90aGlzOwogIH0KICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKExpbmtFZGl0aW5nLCBbewogICAga2V5OiAiaW5pdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yOyAvLyBBbGxvdyBsaW5rIGF0dHJpYnV0ZSBvbiBhbGwgaW5saW5lIG5vZGVzLgoKICAgICAgZWRpdG9yLm1vZGVsLnNjaGVtYS5leHRlbmQoJyR0ZXh0JywgewogICAgICAgIGFsbG93QXR0cmlidXRlczogJ2xpbmtIcmVmJwogICAgICB9KTsKICAgICAgZWRpdG9yLmNvbnZlcnNpb24uZm9yKCdkYXRhRG93bmNhc3QnKS5hdHRyaWJ1dGVUb0VsZW1lbnQoewogICAgICAgIG1vZGVsOiAnbGlua0hyZWYnLAogICAgICAgIHZpZXc6IGNyZWF0ZUxpbmtFbGVtZW50CiAgICAgIH0pOwogICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2VkaXRpbmdEb3duY2FzdCcpLmF0dHJpYnV0ZVRvRWxlbWVudCh7CiAgICAgICAgbW9kZWw6ICdsaW5rSHJlZicsCiAgICAgICAgdmlldzogZnVuY3Rpb24gdmlldyhocmVmLCBjb252ZXJzaW9uQXBpKSB7CiAgICAgICAgICByZXR1cm4gY3JlYXRlTGlua0VsZW1lbnQoZW5zdXJlU2FmZVVybChocmVmKSwgY29udmVyc2lvbkFwaSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgZWRpdG9yLmNvbnZlcnNpb24uZm9yKCd1cGNhc3QnKS5lbGVtZW50VG9BdHRyaWJ1dGUoewogICAgICAgIHZpZXc6IHsKICAgICAgICAgIG5hbWU6ICdhJywKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgaHJlZjogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW9kZWw6IHsKICAgICAgICAgIGtleTogJ2xpbmtIcmVmJywKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh2aWV3RWxlbWVudCkgewogICAgICAgICAgICByZXR1cm4gdmlld0VsZW1lbnQuZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsgLy8gQ3JlYXRlIGxpbmtpbmcgY29tbWFuZHMuCgogICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdsaW5rJywgbmV3IExpbmtDb21tYW5kKGVkaXRvcikpOwogICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCd1bmxpbmsnLCBuZXcgVW5saW5rQ29tbWFuZChlZGl0b3IpKTsKICAgICAgdmFyIGxpbmtEZWNvcmF0b3JzID0gZ2V0TG9jYWxpemVkRGVjb3JhdG9ycyhlZGl0b3IudCwgbm9ybWFsaXplRGVjb3JhdG9ycyhlZGl0b3IuY29uZmlnLmdldCgnbGluay5kZWNvcmF0b3JzJykpKTsKCiAgICAgIHRoaXMuX2VuYWJsZUF1dG9tYXRpY0RlY29yYXRvcnMobGlua0RlY29yYXRvcnMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0ubW9kZSA9PT0gREVDT1JBVE9SX0FVVE9NQVRJQzsKICAgICAgfSkpOwoKICAgICAgdGhpcy5fZW5hYmxlTWFudWFsRGVjb3JhdG9ycyhsaW5rRGVjb3JhdG9ycy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5tb2RlID09PSBERUNPUkFUT1JfTUFOVUFMOwogICAgICB9KSk7IC8vIEVuYWJsZSB0d28tc3RlcCBjYXJldCBtb3ZlbWVudCBmb3IgYGxpbmtIcmVmYCBhdHRyaWJ1dGUuCgoKICAgICAgdmFyIHR3b1N0ZXBDYXJldE1vdmVtZW50UGx1Z2luID0gZWRpdG9yLnBsdWdpbnMuZ2V0KFR3b1N0ZXBDYXJldE1vdmVtZW50KTsKICAgICAgdHdvU3RlcENhcmV0TW92ZW1lbnRQbHVnaW4ucmVnaXN0ZXJBdHRyaWJ1dGUoJ2xpbmtIcmVmJyk7IC8vIFNldHVwIGhpZ2hsaWdodCBvdmVyIHNlbGVjdGVkIGxpbmsuCgogICAgICBpbmxpbmVIaWdobGlnaHQoZWRpdG9yLCAnbGlua0hyZWYnLCAnYScsIEhJR0hMSUdIVF9DTEFTUyk7IC8vIENoYW5nZSB0aGUgYXR0cmlidXRlcyBvZiB0aGUgc2VsZWN0aW9uIGluIGNlcnRhaW4gc2l0dWF0aW9ucyBhZnRlciB0aGUgbGluayB3YXMgaW5zZXJ0ZWQgaW50byB0aGUgZG9jdW1lbnQuCgogICAgICB0aGlzLl9lbmFibGVJbnNlcnRDb250ZW50U2VsZWN0aW9uQXR0cmlidXRlc0ZpeGVyKCk7IC8vIEhhbmRsZSBhIGNsaWNrIGF0IHRoZSBiZWdpbm5pbmcvZW5kIG9mIGEgbGluayBlbGVtZW50LgoKCiAgICAgIHRoaXMuX2VuYWJsZUNsaWNraW5nQWZ0ZXJMaW5rKCk7IC8vIEhhbmRsZSB0eXBpbmcgb3ZlciB0aGUgbGluay4KCgogICAgICB0aGlzLl9lbmFibGVUeXBpbmdPdmVyTGluaygpOyAvLyBIYW5kbGUgcmVtb3ZpbmcgdGhlIGNvbnRlbnQgYWZ0ZXIgdGhlIGxpbmsgZWxlbWVudC4KCgogICAgICB0aGlzLl9oYW5kbGVEZWxldGVDb250ZW50QWZ0ZXJMaW5rKCk7CiAgICB9CiAgICAvKioKICAgICAqIFByb2Nlc3NlcyBhbiBhcnJheSBvZiBjb25maWd1cmVkIHtAbGluayBtb2R1bGU6bGluay9saW5rfkxpbmtEZWNvcmF0b3JBdXRvbWF0aWNEZWZpbml0aW9uIGF1dG9tYXRpYyBkZWNvcmF0b3JzfQogICAgICogYW5kIHJlZ2lzdGVycyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciBkb3duY2FzdCBkaXNwYXRjaGVyfQogICAgICogZm9yIGVhY2ggb25lIG9mIHRoZW0uIERvd25jYXN0IGRpc3BhdGNoZXJzIGFyZSBvYnRhaW5lZCB1c2luZyB0aGUKICAgICAqIHtAbGluayBtb2R1bGU6bGluay91dGlsc35BdXRvbWF0aWNEZWNvcmF0b3JzI2dldERpc3BhdGNoZXJ9IG1ldGhvZC4KICAgICAqCiAgICAgKiAqKk5vdGUqKjogVGhpcyBtZXRob2QgYWxzbyBhY3RpdmF0ZXMgdGhlIGF1dG9tYXRpYyBleHRlcm5hbCBsaW5rIGRlY29yYXRvciBpZiBlbmFibGVkIHdpdGgKICAgICAqIHtAbGluayBtb2R1bGU6bGluay9saW5rfkxpbmtDb25maWcjYWRkVGFyZ2V0VG9FeHRlcm5hbExpbmtzIGBjb25maWcubGluay5hZGRUYXJnZXRUb0V4dGVybmFsTGlua3NgfS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtBcnJheS48bW9kdWxlOmxpbmsvbGlua35MaW5rRGVjb3JhdG9yQXV0b21hdGljRGVmaW5pdGlvbj59IGF1dG9tYXRpY0RlY29yYXRvckRlZmluaXRpb25zCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2VuYWJsZUF1dG9tYXRpY0RlY29yYXRvcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9lbmFibGVBdXRvbWF0aWNEZWNvcmF0b3JzKGF1dG9tYXRpY0RlY29yYXRvckRlZmluaXRpb25zKSB7CiAgICAgIHZhciBlZGl0b3IgPSB0aGlzLmVkaXRvcjsgLy8gU3RvcmUgYXV0b21hdGljIGRlY29yYXRvcnMgaW4gdGhlIGNvbW1hbmQgaW5zdGFuY2UgYXMgd2UgZG8gdGhlIHNhbWUgd2l0aCBtYW51YWwgZGVjb3JhdG9ycy4KICAgICAgLy8gVGhhbmtzIHRvIHRoYXQsIGBMaW5rSW1hZ2VFZGl0aW5nYCBwbHVnaW4gY2FuIHJlLXVzZSB0aGUgc2FtZSBkZWZpbml0aW9ucy4KCiAgICAgIHZhciBjb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldCgnbGluaycpOwogICAgICB2YXIgYXV0b21hdGljRGVjb3JhdG9ycyA9IGNvbW1hbmQuYXV0b21hdGljRGVjb3JhdG9yczsgLy8gQWRkcyBhIGRlZmF1bHQgZGVjb3JhdG9yIGZvciBleHRlcm5hbCBsaW5rcy4KCiAgICAgIGlmIChlZGl0b3IuY29uZmlnLmdldCgnbGluay5hZGRUYXJnZXRUb0V4dGVybmFsTGlua3MnKSkgewogICAgICAgIGF1dG9tYXRpY0RlY29yYXRvcnMuYWRkKHsKICAgICAgICAgIGlkOiAnbGlua0lzRXh0ZXJuYWwnLAogICAgICAgICAgbW9kZTogREVDT1JBVE9SX0FVVE9NQVRJQywKICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiBjYWxsYmFjayh1cmwpIHsKICAgICAgICAgICAgcmV0dXJuIEVYVEVSTkFMX0xJTktTX1JFR0VYUC50ZXN0KHVybCk7CiAgICAgICAgICB9LAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICB0YXJnZXQ6ICdfYmxhbmsnLAogICAgICAgICAgICByZWw6ICdub29wZW5lciBub3JlZmVycmVyJwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBhdXRvbWF0aWNEZWNvcmF0b3JzLmFkZChhdXRvbWF0aWNEZWNvcmF0b3JEZWZpbml0aW9ucyk7CgogICAgICBpZiAoYXV0b21hdGljRGVjb3JhdG9ycy5sZW5ndGgpIHsKICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2Rvd25jYXN0JykuYWRkKGF1dG9tYXRpY0RlY29yYXRvcnMuZ2V0RGlzcGF0Y2hlcigpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBQcm9jZXNzZXMgYW4gYXJyYXkgb2YgY29uZmlndXJlZCB7QGxpbmsgbW9kdWxlOmxpbmsvbGlua35MaW5rRGVjb3JhdG9yTWFudWFsRGVmaW5pdGlvbiBtYW51YWwgZGVjb3JhdG9yc30sCiAgICAgKiB0cmFuc2Zvcm1zIHRoZW0gaW50byB7QGxpbmsgbW9kdWxlOmxpbmsvdXRpbHN+TWFudWFsRGVjb3JhdG9yfSBpbnN0YW5jZXMgYW5kIHN0b3JlcyB0aGVtIGluIHRoZQogICAgICoge0BsaW5rIG1vZHVsZTpsaW5rL2xpbmtjb21tYW5kfkxpbmtDb21tYW5kI21hbnVhbERlY29yYXRvcnN9IGNvbGxlY3Rpb24gKGEgbW9kZWwgZm9yIG1hbnVhbCBkZWNvcmF0b3JzIHN0YXRlKS4KICAgICAqCiAgICAgKiBBbHNvIHJlZ2lzdGVycyBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjYXR0cmlidXRlVG9FbGVtZW50IGF0dHJpYnV0ZS10by1lbGVtZW50fQogICAgICogY29udmVydGVyIGZvciBlYWNoIG1hbnVhbCBkZWNvcmF0b3IgYW5kIGV4dGVuZHMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEgbW9kZWwncyBzY2hlbWF9CiAgICAgKiB3aXRoIGFkZXF1YXRlIG1vZGVsIGF0dHJpYnV0ZXMuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSB7QXJyYXkuPG1vZHVsZTpsaW5rL2xpbmt+TGlua0RlY29yYXRvck1hbnVhbERlZmluaXRpb24+fSBtYW51YWxEZWNvcmF0b3JEZWZpbml0aW9ucwogICAgICovCgogIH0sIHsKICAgIGtleTogIl9lbmFibGVNYW51YWxEZWNvcmF0b3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5hYmxlTWFudWFsRGVjb3JhdG9ycyhtYW51YWxEZWNvcmF0b3JEZWZpbml0aW9ucykgewogICAgICBpZiAoIW1hbnVhbERlY29yYXRvckRlZmluaXRpb25zLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgICB2YXIgY29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpbmsnKTsKICAgICAgdmFyIG1hbnVhbERlY29yYXRvcnMgPSBjb21tYW5kLm1hbnVhbERlY29yYXRvcnM7CiAgICAgIG1hbnVhbERlY29yYXRvckRlZmluaXRpb25zLmZvckVhY2goZnVuY3Rpb24gKGRlY29yYXRvcikgewogICAgICAgIGVkaXRvci5tb2RlbC5zY2hlbWEuZXh0ZW5kKCckdGV4dCcsIHsKICAgICAgICAgIGFsbG93QXR0cmlidXRlczogZGVjb3JhdG9yLmlkCiAgICAgICAgfSk7IC8vIEtlZXBzIHJlZmVyZW5jZSB0byBtYW51YWwgZGVjb3JhdG9yIHRvIGRlY29kZSBpdHMgbmFtZSB0byBhdHRyaWJ1dGVzIGR1cmluZyBkb3duY2FzdC4KCiAgICAgICAgbWFudWFsRGVjb3JhdG9ycy5hZGQobmV3IE1hbnVhbERlY29yYXRvcihkZWNvcmF0b3IpKTsKICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2Rvd25jYXN0JykuYXR0cmlidXRlVG9FbGVtZW50KHsKICAgICAgICAgIG1vZGVsOiBkZWNvcmF0b3IuaWQsCiAgICAgICAgICB2aWV3OiBmdW5jdGlvbiB2aWV3KG1hbnVhbERlY29yYXRvck5hbWUsIF9yZWYpIHsKICAgICAgICAgICAgdmFyIHdyaXRlciA9IF9yZWYud3JpdGVyOwoKICAgICAgICAgICAgaWYgKG1hbnVhbERlY29yYXRvck5hbWUpIHsKICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlcyA9IG1hbnVhbERlY29yYXRvcnMuZ2V0KGRlY29yYXRvci5pZCkuYXR0cmlidXRlczsKICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IHdyaXRlci5jcmVhdGVBdHRyaWJ1dGVFbGVtZW50KCdhJywgYXR0cmlidXRlcywgewogICAgICAgICAgICAgICAgcHJpb3JpdHk6IDUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB3cml0ZXIuc2V0Q3VzdG9tUHJvcGVydHkoJ2xpbmsnLCB0cnVlLCBlbGVtZW50KTsKICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcigndXBjYXN0JykuZWxlbWVudFRvQXR0cmlidXRlKHsKICAgICAgICAgIHZpZXc6IHsKICAgICAgICAgICAgbmFtZTogJ2EnLAogICAgICAgICAgICBhdHRyaWJ1dGVzOiBtYW51YWxEZWNvcmF0b3JzLmdldChkZWNvcmF0b3IuaWQpLmF0dHJpYnV0ZXMKICAgICAgICAgIH0sCiAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICBrZXk6IGRlY29yYXRvci5pZAogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogU3RhcnRzIGxpc3RlbmluZyB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNldmVudDppbnNlcnRDb250ZW50fSBhbmQgY29ycmVjdHMgdGhlIG1vZGVsCiAgICAgKiBzZWxlY3Rpb24gYXR0cmlidXRlcyBpZiB0aGUgc2VsZWN0aW9uIGlzIGF0IHRoZSBlbmQgb2YgYSBsaW5rIGFmdGVyIGluc2VydGluZyB0aGUgY29udGVudC4KICAgICAqCiAgICAgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGFjdGlvbiBpcyB0byBpbXByb3ZlIHRoZSBvdmVyYWxsIFVYIGJlY2F1c2UgdGhlIHVzZXIgaXMgbm8gbG9uZ2VyICJ0cmFwcGVkIiBieSB0aGUKICAgICAqIGBsaW5rSHJlZmAgYXR0cmlidXRlIG9mIHRoZSBzZWxlY3Rpb24gYW5kIHRoZXkgY2FuIHR5cGUgYSAiY2xlYW4iIChgbGlua0hyZWZg4oCTbGVzcykgdGV4dCByaWdodCBhd2F5LgogICAgICoKICAgICAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy82MDUzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2VuYWJsZUluc2VydENvbnRlbnRTZWxlY3Rpb25BdHRyaWJ1dGVzRml4ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9lbmFibGVJbnNlcnRDb250ZW50U2VsZWN0aW9uQXR0cmlidXRlc0ZpeGVyKCkgewogICAgICB2YXIgZWRpdG9yID0gdGhpcy5lZGl0b3I7CiAgICAgIHZhciBtb2RlbCA9IGVkaXRvci5tb2RlbDsKICAgICAgdmFyIHNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjsKICAgICAgdmFyIGxpbmtDb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldCgnbGluaycpOwogICAgICB0aGlzLmxpc3RlblRvKG1vZGVsLCAnaW5zZXJ0Q29udGVudCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbm9kZUJlZm9yZSA9IHNlbGVjdGlvbi5hbmNob3Iubm9kZUJlZm9yZTsKICAgICAgICB2YXIgbm9kZUFmdGVyID0gc2VsZWN0aW9uLmFuY2hvci5ub2RlQWZ0ZXI7IC8vIE5PVEU6IOKGsCBhbmQg4oaxIHJlcHJlc2VudCB0aGUgZ3Jhdml0eSBvZiB0aGUgc2VsZWN0aW9uLgogICAgICAgIC8vIFRoZSBvbmx5IHRydWx5IHZhbGlkIGNhc2UgaXM6CiAgICAgICAgLy8KICAgICAgICAvLwkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4oawCiAgICAgICAgLy8JCS4uLjwkdGV4dCBsaW5rSHJlZj0iZm9vIj5JTlNFUlRFRFtdPC8kdGV4dD4KICAgICAgICAvLwogICAgICAgIC8vIElmIHRoZSBzZWxlY3Rpb24gaXMgbm90ICJ0cmFwcGVkIiBieSB0aGUgYGxpbmtIcmVmYCBhdHRyaWJ1dGUgYWZ0ZXIgaW5zZXJ0aW5nLCB0aGVyZSdzIG5vdGhpbmcKICAgICAgICAvLyB0byBmaXggdGhlcmUuCgogICAgICAgIGlmICghc2VsZWN0aW9uLmhhc0F0dHJpYnV0ZSgnbGlua0hyZWYnKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gRmlsdGVyIG91dCB0aGUgZm9sbG93aW5nIGNhc2Ugd2hlcmUgYSBsaW5rIHdpdGggdGhlIHNhbWUgaHJlZiAoZS5nLiA8YSBocmVmPSJmb28iPklOU0VSVEVEPC9hPikgaXMgaW5zZXJ0ZWQKICAgICAgICAvLyBpbiB0aGUgbWlkZGxlIG9mIGFuIGV4aXN0aW5nIGxpbms6CiAgICAgICAgLy8KICAgICAgICAvLyBCZWZvcmUgaW5zZXJ0aW9uOgogICAgICAgIC8vCQkgICAgICAgICAgICAgICAgICAgICAgIOKGsAogICAgICAgIC8vCQk8JHRleHQgbGlua0hyZWY9ImZvbyI+bFtdaW5rPC8kdGV4dD4KICAgICAgICAvLwogICAgICAgIC8vIEV4cGVjdGVkIGFmdGVyIGluc2VydGlvbjoKICAgICAgICAvLwkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKGsAogICAgICAgIC8vCQk8JHRleHQgbGlua0hyZWY9ImZvbyI+bElOU0VSVEVEW11pbms8LyR0ZXh0PgogICAgICAgIC8vCgoKICAgICAgICBpZiAoIW5vZGVCZWZvcmUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIEZpbHRlciBvdXQgdGhlIGZvbGxvd2luZyBjYXNlIHdoZXJlIHRoZSBzZWxlY3Rpb24gaGFzIHRoZSAibGlua0hyZWYiIGF0dHJpYnV0ZSBiZWNhdXNlIHRoZQogICAgICAgIC8vIGdyYXZpdHkgaXMgb3ZlcnJpZGRlbiBhbmQgc29tZSB0ZXh0IHdpdGggYW5vdGhlciBhdHRyaWJ1dGUgKGUuZy4gPGI+SU5TRVJURUQ8L2I+KSBpcyBpbnNlcnRlZDoKICAgICAgICAvLwogICAgICAgIC8vIEJlZm9yZSBpbnNlcnRpb246CiAgICAgICAgLy8KICAgICAgICAvLwkJICAgICAgICAgICAgICAgICAgICAgICDihrEKICAgICAgICAvLwkJPCR0ZXh0IGxpbmtIcmVmPSJmb28iPltdbGluazwvJHRleHQ+CiAgICAgICAgLy8KICAgICAgICAvLyBFeHBlY3RlZCBhZnRlciBpbnNlcnRpb246CiAgICAgICAgLy8KICAgICAgICAvLwkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKGsQogICAgICAgIC8vCQk8JHRleHQgYm9sZD0idHJ1ZSI+SU5TRVJURUQ8LyR0ZXh0PjwkdGV4dCBsaW5rSHJlZj0iZm9vIj5bXWxpbms8LyR0ZXh0PgogICAgICAgIC8vCgoKICAgICAgICBpZiAoIW5vZGVCZWZvcmUuaGFzQXR0cmlidXRlKCdsaW5rSHJlZicpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBGaWx0ZXIgb3V0IHRoZSBmb2xsb3dpbmcgY2FzZSB3aGVyZSBhIGxpbmsgaXMgYSBpbnNlcnRlZCBpbiB0aGUgbWlkZGxlIChvciBiZWZvcmUpIGFub3RoZXIgbGluawogICAgICAgIC8vIChkaWZmZXJlbnQgVVJMcywgc28gdGhleSB3aWxsIG5vdCBtZXJnZSkuIEluIHRoaXMgKGxldCdzIHNheSB3ZWlyZCkgY2FzZSwgd2UgY2FuIGxlYXZlIHRoZSBzZWxlY3Rpb24KICAgICAgICAvLyBhdHRyaWJ1dGVzIGFzIHRoZXkgYXJlIGJlY2F1c2UgdGhlIHVzZXIgd2lsbCBlbmQgdXAgd3JpdGluZyBpbiBvbmUgbGluayBvciBhbm90aGVyIGFueXdheS4KICAgICAgICAvLwogICAgICAgIC8vIEJlZm9yZSBpbnNlcnRpb246CiAgICAgICAgLy8KICAgICAgICAvLwkJICAgICAgICAgICAgICAgICAgICAgICDihrAKICAgICAgICAvLwkJPCR0ZXh0IGxpbmtIcmVmPSJmb28iPmxbXWluazwvJHRleHQ+CiAgICAgICAgLy8KICAgICAgICAvLyBFeHBlY3RlZCBhZnRlciBpbnNlcnRpb246CiAgICAgICAgLy8KICAgICAgICAvLwkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKGsAogICAgICAgIC8vCQk8JHRleHQgbGlua0hyZWY9ImZvbyI+bDwvJHRleHQ+PCR0ZXh0IGxpbmtIcmVmPSJiYXIiPklOU0VSVEVEW108LyR0ZXh0PjwkdGV4dCBsaW5rSHJlZj0iZm9vIj5pbms8LyR0ZXh0PgogICAgICAgIC8vCgoKICAgICAgICBpZiAobm9kZUFmdGVyICYmIG5vZGVBZnRlci5oYXNBdHRyaWJ1dGUoJ2xpbmtIcmVmJykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1vZGVsLmNoYW5nZShmdW5jdGlvbiAod3JpdGVyKSB7CiAgICAgICAgICByZW1vdmVMaW5rQXR0cmlidXRlc0Zyb21TZWxlY3Rpb24od3JpdGVyLCBsaW5rQ29tbWFuZC5tYW51YWxEZWNvcmF0b3JzKTsKICAgICAgICB9KTsKICAgICAgfSwgewogICAgICAgIHByaW9yaXR5OiAnbG93JwogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogU3RhcnRzIGxpc3RlbmluZyB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50Om1vdXNlZG93bn0gYW5kCiAgICAgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OnNlbGVjdGlvbkNoYW5nZX0gYW5kIHB1dHMgdGhlIHNlbGVjdGlvbiBiZWZvcmUvYWZ0ZXIgYSBsaW5rIG5vZGUKICAgICAqIGlmIGNsaWNrZWQgYXQgdGhlIGJlZ2lubmluZy9lbmRpbmcgb2YgdGhlIGxpbmsuCiAgICAgKgogICAgICogVGhlIHB1cnBvc2Ugb2YgdGhpcyBhY3Rpb24gaXMgdG8gYWxsb3cgdHlwaW5nIGFyb3VuZCB0aGUgbGluayBub2RlIGRpcmVjdGx5IGFmdGVyIGEgY2xpY2suCiAgICAgKgogICAgICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEwMTYuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfZW5hYmxlQ2xpY2tpbmdBZnRlckxpbmsiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9lbmFibGVDbGlja2luZ0FmdGVyTGluaygpIHsKICAgICAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgICB2YXIgbGlua0NvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCdsaW5rJyk7CiAgICAgIGVkaXRvci5lZGl0aW5nLnZpZXcuYWRkT2JzZXJ2ZXIoTW91c2VPYnNlcnZlcik7CiAgICAgIHZhciBjbGlja2VkID0gZmFsc2U7IC8vIERldGVjdCB0aGUgY2xpY2suCgogICAgICB0aGlzLmxpc3RlblRvKGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQsICdtb3VzZWRvd24nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgY2xpY2tlZCA9IHRydWU7CiAgICAgIH0pOyAvLyBXaGVuIHRoZSBzZWxlY3Rpb24gaGFzIGNoYW5nZWQuLi4KCiAgICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudCwgJ3NlbGVjdGlvbkNoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIWNsaWNrZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIC4uLmFuZCBpdCB3YXMgY2F1c2VkIGJ5IHRoZSBjbGljay4uLgoKCiAgICAgICAgY2xpY2tlZCA9IGZhbHNlOwogICAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uOyAvLyAuLi5hbmQgbm8gdGV4dCBpcyBzZWxlY3RlZC4uLgoKICAgICAgICBpZiAoIXNlbGVjdGlvbi5pc0NvbGxhcHNlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gLi4uYW5kIGNsaWNrZWQgdGV4dCBpcyB0aGUgbGluay4uLgoKCiAgICAgICAgaWYgKCFzZWxlY3Rpb24uaGFzQXR0cmlidXRlKCdsaW5rSHJlZicpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgcG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpOwogICAgICAgIHZhciBsaW5rUmFuZ2UgPSBmaW5kQXR0cmlidXRlUmFuZ2UocG9zaXRpb24sICdsaW5rSHJlZicsIHNlbGVjdGlvbi5nZXRBdHRyaWJ1dGUoJ2xpbmtIcmVmJyksIGVkaXRvci5tb2RlbCk7IC8vIC4uLmNoZWNrIHdoZXRoZXIgY2xpY2tlZCBzdGFydC9lbmQgYm91bmRhcnkgb2YgdGhlIGxpbmsuCiAgICAgICAgLy8gSWYgc28sIHJlbW92ZSB0aGUgYGxpbmtIcmVmYCBhdHRyaWJ1dGUuCgogICAgICAgIGlmIChwb3NpdGlvbi5pc1RvdWNoaW5nKGxpbmtSYW5nZS5zdGFydCkgfHwgcG9zaXRpb24uaXNUb3VjaGluZyhsaW5rUmFuZ2UuZW5kKSkgewogICAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZShmdW5jdGlvbiAod3JpdGVyKSB7CiAgICAgICAgICAgIHJlbW92ZUxpbmtBdHRyaWJ1dGVzRnJvbVNlbGVjdGlvbih3cml0ZXIsIGxpbmtDb21tYW5kLm1hbnVhbERlY29yYXRvcnMpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogU3RhcnRzIGxpc3RlbmluZyB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNkZWxldGVDb250ZW50fSBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0Q29udGVudH0KICAgICAqIGFuZCBjaGVja3Mgd2hldGhlciB0eXBpbmcgb3ZlciB0aGUgbGluay4gSWYgc28sIGF0dHJpYnV0ZXMgb2YgcmVtb3ZlZCB0ZXh0IGFyZSBwcmVzZXJ2ZWQgYW5kIGFwcGxpZWQgdG8gdGhlIGluc2VydGVkIHRleHQuCiAgICAgKgogICAgICogVGhlIHB1cnBvc2Ugb2YgdGhpcyBhY3Rpb24gaXMgdG8gYWxsb3cgbW9kaWZ5aW5nIGEgdGV4dCB3aXRob3V0IGxvb3NpbmcgdGhlIGBsaW5rSHJlZmAgYXR0cmlidXRlIChhbmQgb3RoZXIpLgogICAgICoKICAgICAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy80NzYyLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2VuYWJsZVR5cGluZ092ZXJMaW5rIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5hYmxlVHlwaW5nT3ZlckxpbmsoKSB7CiAgICAgIHZhciBlZGl0b3IgPSB0aGlzLmVkaXRvcjsKICAgICAgdmFyIHZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3OyAvLyBTZWxlY3Rpb24gYXR0cmlidXRlcyB3aGVuIHN0YXJ0ZWQgdHlwaW5nIG92ZXIgdGhlIGxpbmsuCgogICAgICB2YXIgc2VsZWN0aW9uQXR0cmlidXRlczsgLy8gV2hldGhlciBwcmVzc2VkIGBCYWNrc3BhY2VgIG9yIGBEZWxldGVgLiBJZiBzbywgYXR0cmlidXRlcyBzaG91bGQgbm90IGJlIHByZXNlcnZlZC4KCiAgICAgIHZhciBkZWxldGVkQ29udGVudDsgLy8gRGV0ZWN0IHByZXNzaW5nIGBCYWNrc3BhY2VgIC8gYERlbGV0ZWAuCgogICAgICB0aGlzLmxpc3RlblRvKHZpZXcuZG9jdW1lbnQsICdkZWxldGUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZGVsZXRlZENvbnRlbnQgPSB0cnVlOwogICAgICB9LCB7CiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJwogICAgICB9KTsgLy8gTGlzdGVuaW5nIHRvIGBtb2RlbCNkZWxldGVDb250ZW50YCBhbGxvd3MgZGV0ZWN0aW5nIHdoZXRoZXIgc2VsZWN0ZWQgY29udGVudCB3YXMgYSBsaW5rLgogICAgICAvLyBJZiBzbywgYmVmb3JlIHJlbW92aW5nIHRoZSBlbGVtZW50LCB3ZSB3aWxsIGNvcHkgaXRzIGF0dHJpYnV0ZXMuCgogICAgICB0aGlzLmxpc3RlblRvKGVkaXRvci5tb2RlbCwgJ2RlbGV0ZUNvbnRlbnQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGVjdGlvbiA9IGVkaXRvci5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247IC8vIENvcHkgYXR0cmlidXRlcyBvbmx5IGlmIGFueXRoaW5nIGlzIHNlbGVjdGVkLgoKICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBXaGVuIHRoZSBjb250ZW50IHdhcyBkZWxldGVkLCBkbyBub3QgcHJlc2VydmUgYXR0cmlidXRlcy4KCgogICAgICAgIGlmIChkZWxldGVkQ29udGVudCkgewogICAgICAgICAgZGVsZXRlZENvbnRlbnQgPSBmYWxzZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIEVuYWJsZWQgb25seSB3aGVuIHR5cGluZy4KCgogICAgICAgIGlmICghaXNUeXBpbmcoZWRpdG9yKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNob3VsZENvcHlBdHRyaWJ1dGVzKGVkaXRvci5tb2RlbCkpIHsKICAgICAgICAgIHNlbGVjdGlvbkF0dHJpYnV0ZXMgPSBzZWxlY3Rpb24uZ2V0QXR0cmlidXRlcygpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIHByaW9yaXR5OiAnaGlnaCcKICAgICAgfSk7IC8vIExpc3RlbmluZyB0byBgbW9kZWwjaW5zZXJ0Q29udGVudGAgYWxsb3dzIGRldGVjdGluZyB0aGUgY29udGVudCBpbnNlcnRpb24uCiAgICAgIC8vIFdlIHdhbnQgdG8gYXBwbHkgYXR0cmlidXRlcyB0aGF0IHdlcmUgcmVtb3ZlZCB3aGlsZSB0eXBpbmcgb3ZlciB0aGUgbGluay4KCiAgICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLm1vZGVsLCAnaW5zZXJ0Q29udGVudCcsIGZ1bmN0aW9uIChldnQsIF9yZWYyKSB7CiAgICAgICAgdmFyIF9yZWYzID0gX3NsaWNlZFRvQXJyYXkoX3JlZjIsIDEpLAogICAgICAgICAgICBlbGVtZW50ID0gX3JlZjNbMF07CgogICAgICAgIGRlbGV0ZWRDb250ZW50ID0gZmFsc2U7IC8vIEVuYWJsZWQgb25seSB3aGVuIHR5cGluZy4KCiAgICAgICAgaWYgKCFpc1R5cGluZyhlZGl0b3IpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNlbGVjdGlvbkF0dHJpYnV0ZXMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGVkaXRvci5tb2RlbC5jaGFuZ2UoZnVuY3Rpb24gKHdyaXRlcikgewogICAgICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHNlbGVjdGlvbkF0dHJpYnV0ZXMpLAogICAgICAgICAgICAgIF9zdGVwOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIF9zdGVwJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAudmFsdWUsIDIpLAogICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBfc3RlcCR2YWx1ZVswXSwKICAgICAgICAgICAgICAgICAgdmFsdWUgPSBfc3RlcCR2YWx1ZVsxXTsKCiAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGUsIHZhbHVlLCBlbGVtZW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHNlbGVjdGlvbkF0dHJpYnV0ZXMgPSBudWxsOwogICAgICB9LCB7CiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJwogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogU3RhcnRzIGxpc3RlbmluZyB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNkZWxldGVDb250ZW50fSBhbmQgY2hlY2tzIHdoZXRoZXIKICAgICAqIHJlbW92aW5nIGEgY29udGVudCByaWdodCBhZnRlciB0aGUgImxpbmtIcmVmIiBhdHRyaWJ1dGUuCiAgICAgKgogICAgICogSWYgc28sIHRoZSBzZWxlY3Rpb24gc2hvdWxkIG5vdCBwcmVzZXJ2ZSB0aGUgYGxpbmtIcmVmYCBhdHRyaWJ1dGUuIEhvd2V2ZXIsIGlmCiAgICAgKiB0aGUge0BsaW5rIG1vZHVsZTp0eXBpbmcvdHdvc3RlcGNhcmV0bW92ZW1lbnR+VHdvU3RlcENhcmV0TW92ZW1lbnR9IHBsdWdpbiBpcyBhY3RpdmUgYW5kCiAgICAgKiB0aGUgc2VsZWN0aW9uIGhhcyB0aGUgImxpbmtIcmVmIiBhdHRyaWJ1dGUgZHVlIHRvIG92ZXJyaWRlbiBncmF2aXR5IChhdCB0aGUgZW5kKSwgdGhlIGBsaW5rSHJlZmAgYXR0cmlidXRlIHNob3VsZCBzdGF5IHVudG91Y2hlZC4KICAgICAqCiAgICAgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGFjdGlvbiBpcyB0byBhbGxvdyByZW1vdmluZyB0aGUgbGluayB0ZXh0IGFuZCBrZWVwIHRoZSBzZWxlY3Rpb24gb3V0c2lkZSB0aGUgbGluay4KICAgICAqCiAgICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvNzUyMS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVEZWxldGVDb250ZW50QWZ0ZXJMaW5rIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlRGVsZXRlQ29udGVudEFmdGVyTGluaygpIHsKICAgICAgdmFyIGVkaXRvciA9IHRoaXMuZWRpdG9yOwogICAgICB2YXIgbW9kZWwgPSBlZGl0b3IubW9kZWw7CiAgICAgIHZhciBzZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247CiAgICAgIHZhciB2aWV3ID0gZWRpdG9yLmVkaXRpbmcudmlldzsKICAgICAgdmFyIGxpbmtDb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldCgnbGluaycpOyAvLyBBIGZsYWcgd2hldGhlciBhdHRyaWJ1dGVzIGBsaW5rSHJlZmAgYXR0cmlidXRlIHNob3VsZCBiZSBwcmVzZXJ2ZWQuCgogICAgICB2YXIgc2hvdWxkUHJlc2VydmVBdHRyaWJ1dGVzID0gZmFsc2U7IC8vIEEgZmxhZyB3aGV0aGVyIHRoZSBgQmFja3NwYWNlYCBrZXkgd2FzIHByZXNzZWQuCgogICAgICB2YXIgaGFzQmFja3NwYWNlUHJlc3NlZCA9IGZhbHNlOyAvLyBEZXRlY3QgcHJlc3NpbmcgYEJhY2tzcGFjZWAuCgogICAgICB0aGlzLmxpc3RlblRvKHZpZXcuZG9jdW1lbnQsICdkZWxldGUnLCBmdW5jdGlvbiAoZXZ0LCBkYXRhKSB7CiAgICAgICAgaGFzQmFja3NwYWNlUHJlc3NlZCA9IGRhdGEuZG9tRXZlbnQua2V5Q29kZSA9PT0ga2V5Q29kZXMuYmFja3NwYWNlOwogICAgICB9LCB7CiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJwogICAgICB9KTsgLy8gQmVmb3JlIHJlbW92aW5nIHRoZSBjb250ZW50LCBjaGVjayB3aGV0aGVyIHRoZSBzZWxlY3Rpb24gaXMgaW5zaWRlIGEgbGluayBvciBhdCB0aGUgZW5kIG9mIGxpbmsgYnV0IHdpdGggMi1TQ00gZW5hYmxlZC4KICAgICAgLy8gSWYgc28sIHdlIHdhbnQgdG8gcHJlc2VydmUgbGluayBhdHRyaWJ1dGVzLgoKICAgICAgdGhpcy5saXN0ZW5Ubyhtb2RlbCwgJ2RlbGV0ZUNvbnRlbnQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gUmVzZXQgdGhlIHN0YXRlLgogICAgICAgIHNob3VsZFByZXNlcnZlQXR0cmlidXRlcyA9IGZhbHNlOwogICAgICAgIHZhciBwb3NpdGlvbiA9IHNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7CiAgICAgICAgdmFyIGxpbmtIcmVmID0gc2VsZWN0aW9uLmdldEF0dHJpYnV0ZSgnbGlua0hyZWYnKTsKCiAgICAgICAgaWYgKCFsaW5rSHJlZikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxpbmtSYW5nZSA9IGZpbmRBdHRyaWJ1dGVSYW5nZShwb3NpdGlvbiwgJ2xpbmtIcmVmJywgbGlua0hyZWYsIG1vZGVsKTsgLy8gUHJlc2VydmUgYGxpbmtIcmVmYCBhdHRyaWJ1dGUgaWYgdGhlIHNlbGVjdGlvbiBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSBsaW5rIG9yCiAgICAgICAgLy8gdGhlIHNlbGVjdGlvbiBpcyBhdCB0aGUgZW5kIG9mIHRoZSBsaW5rIGFuZCAyLVNDTSBpcyBhY3RpdmF0ZWQuCgogICAgICAgIHNob3VsZFByZXNlcnZlQXR0cmlidXRlcyA9IGxpbmtSYW5nZS5jb250YWluc1Bvc2l0aW9uKHBvc2l0aW9uKSB8fCBsaW5rUmFuZ2UuZW5kLmlzRXF1YWwocG9zaXRpb24pOwogICAgICB9LCB7CiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJwogICAgICB9KTsgLy8gQWZ0ZXIgcmVtb3ZpbmcgdGhlIGNvbnRlbnQsIGNoZWNrIHdoZXRoZXIgdGhlIGN1cnJlbnQgc2VsZWN0aW9uIHNob3VsZCBwcmVzZXJ2ZSB0aGUgYGxpbmtIcmVmYCBhdHRyaWJ1dGUuCgogICAgICB0aGlzLmxpc3RlblRvKG1vZGVsLCAnZGVsZXRlQ29udGVudCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBJZiBkaWRuJ3QgcHJlc3MgYEJhY2tzcGFjZWAuCiAgICAgICAgaWYgKCFoYXNCYWNrc3BhY2VQcmVzc2VkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBoYXNCYWNrc3BhY2VQcmVzc2VkID0gZmFsc2U7IC8vIERpc2FibGUgdGhlIG1lY2hhbmlzbSBpZiBpbnNpZGUgYSBsaW5rIChgPCR0ZXh0IHVybD0iZm9vIj5GW11vbzwvJHRleHQ+YCBvciA8JHRleHQgdXJsPSJmb28iPkZvb1tdPC8kdGV4dD5gKS4KCiAgICAgICAgaWYgKHNob3VsZFByZXNlcnZlQXR0cmlidXRlcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gVXNlIGBtb2RlbC5lbnF1ZXVlQ2hhbmdlKClgIGluIG9yZGVyIHRvIGV4ZWN1dGUgdGhlIGNhbGxiYWNrIGF0IHRoZSBlbmQgb2YgdGhlIGNoYW5nZXMgcHJvY2Vzcy4KCgogICAgICAgIGVkaXRvci5tb2RlbC5lbnF1ZXVlQ2hhbmdlKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICAgIHJlbW92ZUxpbmtBdHRyaWJ1dGVzRnJvbVNlbGVjdGlvbih3cml0ZXIsIGxpbmtDb21tYW5kLm1hbnVhbERlY29yYXRvcnMpOwogICAgICAgIH0pOwogICAgICB9LCB7CiAgICAgICAgcHJpb3JpdHk6ICdsb3cnCiAgICAgIH0pOwogICAgfQogIH1dLCBbewogICAga2V5OiAicGx1Z2luTmFtZSIsCiAgICBnZXQ6CiAgICAvKioKICAgICAqIEBpbmhlcml0RG9jCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuICdMaW5rRWRpdGluZyc7CiAgICB9CiAgICAvKioKICAgICAqIEBpbmhlcml0RG9jCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVxdWlyZXMiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIC8vIENsaXBib2FyZCBpcyByZXF1aXJlZCBmb3IgaGFuZGxpbmcgY3V0IGFuZCBwYXN0ZSBldmVudHMgd2hpbGUgdHlwaW5nIG92ZXIgdGhlIGxpbmsuCiAgICAgIHJldHVybiBbVHdvU3RlcENhcmV0TW92ZW1lbnQsIElucHV0LCBDbGlwYm9hcmRQaXBlbGluZV07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTGlua0VkaXRpbmc7Cn0oUGx1Z2luKTsgLy8gTWFrZSB0aGUgc2VsZWN0aW9uIGZyZWUgb2YgbGluay1yZWxhdGVkIG1vZGVsIGF0dHJpYnV0ZXMuCi8vIEFsbCBsaW5rLXJlbGF0ZWQgbW9kZWwgYXR0cmlidXRlcyBzdGFydCB3aXRoICJsaW5rIi4gVGhhdCBpbmNsdWRlcyBub3Qgb25seSAibGlua0hyZWYiCi8vIGJ1dCBhbHNvIGFsbCBkZWNvcmF0b3IgYXR0cmlidXRlcyAodGhleSBoYXZlIGR5bmFtaWMgbmFtZXMpLgovLwovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlcn0gd3JpdGVyCi8vIEBwYXJhbSB7bW9kdWxlOnV0aWxzL2NvbGxlY3Rpb25+Q29sbGVjdGlvbn0gbWFudWFsRGVjb3JhdG9ycwoKCmV4cG9ydCB7IExpbmtFZGl0aW5nIGFzIGRlZmF1bHQgfTsKCmZ1bmN0aW9uIHJlbW92ZUxpbmtBdHRyaWJ1dGVzRnJvbVNlbGVjdGlvbih3cml0ZXIsIG1hbnVhbERlY29yYXRvcnMpIHsKICB3cml0ZXIucmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlKCdsaW5rSHJlZicpOwoKICB2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG1hbnVhbERlY29yYXRvcnMpLAogICAgICBfc3RlcDI7CgogIHRyeSB7CiAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICB2YXIgZGVjb3JhdG9yID0gX3N0ZXAyLnZhbHVlOwogICAgICB3cml0ZXIucmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlKGRlY29yYXRvci5pZCk7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICB9IGZpbmFsbHkgewogICAgX2l0ZXJhdG9yMi5mKCk7CiAgfQp9IC8vIENoZWNrcyB3aGV0aGVyIHNlbGVjdGlvbidzIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIGNvcGllZCB0byB0aGUgbmV3IGluc2VydGVkIHRleHQuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbH0gbW9kZWwKLy8gQHJldHVybnMge0Jvb2xlYW59CgoKZnVuY3Rpb24gc2hvdWxkQ29weUF0dHJpYnV0ZXMobW9kZWwpIHsKICB2YXIgc2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uOwogIHZhciBmaXJzdFBvc2l0aW9uID0gc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKTsKICB2YXIgbGFzdFBvc2l0aW9uID0gc2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpOwogIHZhciBub2RlQXRGaXJzdFBvc2l0aW9uID0gZmlyc3RQb3NpdGlvbi5ub2RlQWZ0ZXI7IC8vIFRoZSB0ZXh0IGxpbmsgbm9kZSBkb2VzIG5vdCBleGlzdC4uLgoKICBpZiAoIW5vZGVBdEZpcnN0UG9zaXRpb24pIHsKICAgIHJldHVybiBmYWxzZTsKICB9IC8vIC4uLm9yIGl0IGlzbid0IHRoZSB0ZXh0IG5vZGUuLi4KCgogIGlmICghbm9kZUF0Rmlyc3RQb3NpdGlvbi5pcygnJHRleHQnKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0gLy8gLi4ub3IgaXNuJ3QgdGhlIGxpbmsuCgoKICBpZiAoIW5vZGVBdEZpcnN0UG9zaXRpb24uaGFzQXR0cmlidXRlKCdsaW5rSHJlZicpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfSAvLyBgdGV4dE5vZGVgID0gdGhlIHBvc2l0aW9uIGlzIGluc2lkZSB0aGUgbGluayBlbGVtZW50LgogIC8vIGBub2RlQmVmb3JlYCA9IHRoZSBwb3NpdGlvbiBpcyBhdCB0aGUgZW5kIG9mIHRoZSBsaW5rIGVsZW1lbnQuCgoKICB2YXIgbm9kZUF0TGFzdFBvc2l0aW9uID0gbGFzdFBvc2l0aW9uLnRleHROb2RlIHx8IGxhc3RQb3NpdGlvbi5ub2RlQmVmb3JlOyAvLyBJZiBib3RoIHJlZmVyZW5jZXMgdGhlIHNhbWUgbm9kZSBzZWxlY3Rpb24gY29udGFpbnMgYSBzaW5nbGUgdGV4dCBub2RlLgoKICBpZiAobm9kZUF0Rmlyc3RQb3NpdGlvbiA9PT0gbm9kZUF0TGFzdFBvc2l0aW9uKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9IC8vIElmIG5vZGVzIGFyZSBub3QgZXF1YWwsIG1heWJlIHRoZSBsaW5rIG5vZGVzIGhhcyBkZWZpbmVkIGFkZGl0aW9uYWwgYXR0cmlidXRlcyBpbnNpZGUuCiAgLy8gRmlyc3QsIHdlIG5lZWQgdG8gZmluZCB0aGUgZW50aXJlIGxpbmsgcmFuZ2UuCgoKICB2YXIgbGlua1JhbmdlID0gZmluZEF0dHJpYnV0ZVJhbmdlKGZpcnN0UG9zaXRpb24sICdsaW5rSHJlZicsIG5vZGVBdEZpcnN0UG9zaXRpb24uZ2V0QXR0cmlidXRlKCdsaW5rSHJlZicpLCBtb2RlbCk7IC8vIFRoZW4gd2UgY2FuIGNoZWNrIHdoZXRoZXIgc2VsZWN0ZWQgcmFuZ2UgaXMgaW5zaWRlIHRoZSBmb3VuZCBsaW5rIHJhbmdlLiBJZiBzbywgYXR0cmlidXRlcyBzaG91bGQgYmUgcHJlc2VydmVkLgoKICByZXR1cm4gbGlua1JhbmdlLmNvbnRhaW5zUmFuZ2UobW9kZWwuY3JlYXRlUmFuZ2UoZmlyc3RQb3NpdGlvbiwgbGFzdFBvc2l0aW9uKSwgdHJ1ZSk7Cn0gLy8gQ2hlY2tzIHdoZXRoZXIgcHJvdmlkZWQgY2hhbmdlcyB3ZXJlIGNhdXNlZCBieSB0eXBpbmcuCi8vCi8vIEBwYXJhbXMge21vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J+RWRpdG9yfSBlZGl0b3IKLy8gQHJldHVybnMge0Jvb2xlYW59CgoKZnVuY3Rpb24gaXNUeXBpbmcoZWRpdG9yKSB7CiAgdmFyIGlucHV0ID0gZWRpdG9yLnBsdWdpbnMuZ2V0KCdJbnB1dCcpOwogIHJldHVybiBpbnB1dC5pc0lucHV0KGVkaXRvci5tb2RlbC5jaGFuZ2UoZnVuY3Rpb24gKHdyaXRlcikgewogICAgcmV0dXJuIHdyaXRlci5iYXRjaDsKICB9KSk7Cn0="},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-link/src/linkediting.js"],"names":["Plugin","MouseObserver","Input","TwoStepCaretMovement","inlineHighlight","findAttributeRange","ClipboardPipeline","keyCodes","LinkCommand","UnlinkCommand","ManualDecorator","createLinkElement","ensureSafeUrl","getLocalizedDecorators","normalizeDecorators","HIGHLIGHT_CLASS","DECORATOR_AUTOMATIC","DECORATOR_MANUAL","EXTERNAL_LINKS_REGEXP","LinkEditing","editor","config","define","addTargetToExternalLinks","model","schema","extend","allowAttributes","conversion","for","attributeToElement","view","href","conversionApi","elementToAttribute","name","attributes","key","value","viewElement","getAttribute","commands","add","linkDecorators","t","get","_enableAutomaticDecorators","filter","item","mode","_enableManualDecorators","twoStepCaretMovementPlugin","plugins","registerAttribute","_enableInsertContentSelectionAttributesFixer","_enableClickingAfterLink","_enableTypingOverLink","_handleDeleteContentAfterLink","automaticDecoratorDefinitions","command","automaticDecorators","id","callback","url","test","target","rel","length","getDispatcher","manualDecoratorDefinitions","manualDecorators","forEach","decorator","manualDecoratorName","writer","element","createAttributeElement","priority","setCustomProperty","selection","document","linkCommand","listenTo","nodeBefore","anchor","nodeAfter","hasAttribute","change","removeLinkAttributesFromSelection","editing","addObserver","clicked","isCollapsed","position","getFirstPosition","linkRange","isTouching","start","end","selectionAttributes","deletedContent","isTyping","shouldCopyAttributes","getAttributes","evt","attribute","setAttribute","shouldPreserveAttributes","hasBackspacePressed","data","domEvent","keyCode","backspace","linkHref","containsPosition","isEqual","enqueueChange","removeSelectionAttribute","firstPosition","lastPosition","getLastPosition","nodeAtFirstPosition","is","nodeAtLastPosition","textNode","containsRange","createRange","input","isInput","batch"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module link/linkediting\n */\n\nimport { Plugin } from 'ckeditor5/src/core';\nimport { MouseObserver } from 'ckeditor5/src/engine';\nimport { Input, TwoStepCaretMovement, inlineHighlight, findAttributeRange } from 'ckeditor5/src/typing';\nimport { ClipboardPipeline } from 'ckeditor5/src/clipboard';\nimport { keyCodes } from 'ckeditor5/src/utils';\n\nimport LinkCommand from './linkcommand';\nimport UnlinkCommand from './unlinkcommand';\nimport ManualDecorator from './utils/manualdecorator';\nimport { createLinkElement, ensureSafeUrl, getLocalizedDecorators, normalizeDecorators } from './utils';\n\nimport '../theme/link.css';\n\nconst HIGHLIGHT_CLASS = 'ck-link_selected';\nconst DECORATOR_AUTOMATIC = 'automatic';\nconst DECORATOR_MANUAL = 'manual';\nconst EXTERNAL_LINKS_REGEXP = /^(https?:)?\\/\\//;\n\n/**\n * The link engine feature.\n *\n * It introduces the `linkHref=\"url\"` attribute in the model which renders to the view as a `<a href=\"url\">` element\n * as well as `'link'` and `'unlink'` commands.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class LinkEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'LinkEditing';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\t// Clipboard is required for handling cut and paste events while typing over the link.\n\t\treturn [ TwoStepCaretMovement, Input, ClipboardPipeline ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor ) {\n\t\tsuper( editor );\n\n\t\teditor.config.define( 'link', {\n\t\t\taddTargetToExternalLinks: false\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\tconst editor = this.editor;\n\n\t\t// Allow link attribute on all inline nodes.\n\t\teditor.model.schema.extend( '$text', { allowAttributes: 'linkHref' } );\n\n\t\teditor.conversion.for( 'dataDowncast' )\n\t\t\t.attributeToElement( { model: 'linkHref', view: createLinkElement } );\n\n\t\teditor.conversion.for( 'editingDowncast' )\n\t\t\t.attributeToElement( { model: 'linkHref', view: ( href, conversionApi ) => {\n\t\t\t\treturn createLinkElement( ensureSafeUrl( href ), conversionApi );\n\t\t\t} } );\n\n\t\teditor.conversion.for( 'upcast' )\n\t\t\t.elementToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: 'a',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\thref: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmodel: {\n\t\t\t\t\tkey: 'linkHref',\n\t\t\t\t\tvalue: viewElement => viewElement.getAttribute( 'href' )\n\t\t\t\t}\n\t\t\t} );\n\n\t\t// Create linking commands.\n\t\teditor.commands.add( 'link', new LinkCommand( editor ) );\n\t\teditor.commands.add( 'unlink', new UnlinkCommand( editor ) );\n\n\t\tconst linkDecorators = getLocalizedDecorators( editor.t, normalizeDecorators( editor.config.get( 'link.decorators' ) ) );\n\n\t\tthis._enableAutomaticDecorators( linkDecorators.filter( item => item.mode === DECORATOR_AUTOMATIC ) );\n\t\tthis._enableManualDecorators( linkDecorators.filter( item => item.mode === DECORATOR_MANUAL ) );\n\n\t\t// Enable two-step caret movement for `linkHref` attribute.\n\t\tconst twoStepCaretMovementPlugin = editor.plugins.get( TwoStepCaretMovement );\n\t\ttwoStepCaretMovementPlugin.registerAttribute( 'linkHref' );\n\n\t\t// Setup highlight over selected link.\n\t\tinlineHighlight( editor, 'linkHref', 'a', HIGHLIGHT_CLASS );\n\n\t\t// Change the attributes of the selection in certain situations after the link was inserted into the document.\n\t\tthis._enableInsertContentSelectionAttributesFixer();\n\n\t\t// Handle a click at the beginning/end of a link element.\n\t\tthis._enableClickingAfterLink();\n\n\t\t// Handle typing over the link.\n\t\tthis._enableTypingOverLink();\n\n\t\t// Handle removing the content after the link element.\n\t\tthis._handleDeleteContentAfterLink();\n\t}\n\n\t/**\n\t * Processes an array of configured {@link module:link/link~LinkDecoratorAutomaticDefinition automatic decorators}\n\t * and registers a {@link module:engine/conversion/downcastdispatcher~DowncastDispatcher downcast dispatcher}\n\t * for each one of them. Downcast dispatchers are obtained using the\n\t * {@link module:link/utils~AutomaticDecorators#getDispatcher} method.\n\t *\n\t * **Note**: This method also activates the automatic external link decorator if enabled with\n\t * {@link module:link/link~LinkConfig#addTargetToExternalLinks `config.link.addTargetToExternalLinks`}.\n\t *\n\t * @private\n\t * @param {Array.<module:link/link~LinkDecoratorAutomaticDefinition>} automaticDecoratorDefinitions\n\t */\n\t_enableAutomaticDecorators( automaticDecoratorDefinitions ) {\n\t\tconst editor = this.editor;\n\t\t// Store automatic decorators in the command instance as we do the same with manual decorators.\n\t\t// Thanks to that, `LinkImageEditing` plugin can re-use the same definitions.\n\t\tconst command = editor.commands.get( 'link' );\n\t\tconst automaticDecorators = command.automaticDecorators;\n\n\t\t// Adds a default decorator for external links.\n\t\tif ( editor.config.get( 'link.addTargetToExternalLinks' ) ) {\n\t\t\tautomaticDecorators.add( {\n\t\t\t\tid: 'linkIsExternal',\n\t\t\t\tmode: DECORATOR_AUTOMATIC,\n\t\t\t\tcallback: url => EXTERNAL_LINKS_REGEXP.test( url ),\n\t\t\t\tattributes: {\n\t\t\t\t\ttarget: '_blank',\n\t\t\t\t\trel: 'noopener noreferrer'\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tautomaticDecorators.add( automaticDecoratorDefinitions );\n\n\t\tif ( automaticDecorators.length ) {\n\t\t\teditor.conversion.for( 'downcast' ).add( automaticDecorators.getDispatcher() );\n\t\t}\n\t}\n\n\t/**\n\t * Processes an array of configured {@link module:link/link~LinkDecoratorManualDefinition manual decorators},\n\t * transforms them into {@link module:link/utils~ManualDecorator} instances and stores them in the\n\t * {@link module:link/linkcommand~LinkCommand#manualDecorators} collection (a model for manual decorators state).\n\t *\n\t * Also registers an {@link module:engine/conversion/downcasthelpers~DowncastHelpers#attributeToElement attribute-to-element}\n\t * converter for each manual decorator and extends the {@link module:engine/model/schema~Schema model's schema}\n\t * with adequate model attributes.\n\t *\n\t * @private\n\t * @param {Array.<module:link/link~LinkDecoratorManualDefinition>} manualDecoratorDefinitions\n\t */\n\t_enableManualDecorators( manualDecoratorDefinitions ) {\n\t\tif ( !manualDecoratorDefinitions.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.editor;\n\t\tconst command = editor.commands.get( 'link' );\n\t\tconst manualDecorators = command.manualDecorators;\n\n\t\tmanualDecoratorDefinitions.forEach( decorator => {\n\t\t\teditor.model.schema.extend( '$text', { allowAttributes: decorator.id } );\n\n\t\t\t// Keeps reference to manual decorator to decode its name to attributes during downcast.\n\t\t\tmanualDecorators.add( new ManualDecorator( decorator ) );\n\n\t\t\teditor.conversion.for( 'downcast' ).attributeToElement( {\n\t\t\t\tmodel: decorator.id,\n\t\t\t\tview: ( manualDecoratorName, { writer } ) => {\n\t\t\t\t\tif ( manualDecoratorName ) {\n\t\t\t\t\t\tconst attributes = manualDecorators.get( decorator.id ).attributes;\n\t\t\t\t\t\tconst element = writer.createAttributeElement( 'a', attributes, { priority: 5 } );\n\t\t\t\t\t\twriter.setCustomProperty( 'link', true, element );\n\n\t\t\t\t\t\treturn element;\n\t\t\t\t\t}\n\t\t\t\t} } );\n\n\t\t\teditor.conversion.for( 'upcast' ).elementToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: 'a',\n\t\t\t\t\tattributes: manualDecorators.get( decorator.id ).attributes\n\t\t\t\t},\n\t\t\t\tmodel: {\n\t\t\t\t\tkey: decorator.id\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t}\n\n\t/**\n\t * Starts listening to {@link module:engine/model/model~Model#event:insertContent} and corrects the model\n\t * selection attributes if the selection is at the end of a link after inserting the content.\n\t *\n\t * The purpose of this action is to improve the overall UX because the user is no longer \"trapped\" by the\n\t * `linkHref` attribute of the selection and they can type a \"clean\" (`linkHref`less) text right away.\n\t *\n\t * See https://github.com/ckeditor/ckeditor5/issues/6053.\n\t *\n\t * @private\n\t */\n\t_enableInsertContentSelectionAttributesFixer() {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst selection = model.document.selection;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\n\t\tthis.listenTo( model, 'insertContent', () => {\n\t\t\tconst nodeBefore = selection.anchor.nodeBefore;\n\t\t\tconst nodeAfter = selection.anchor.nodeAfter;\n\n\t\t\t// NOTE:  and  represent the gravity of the selection.\n\n\t\t\t// The only truly valid case is:\n\t\t\t//\n\t\t\t//\t\t                                 \n\t\t\t//\t\t...<$text linkHref=\"foo\">INSERTED[]</$text>\n\t\t\t//\n\t\t\t// If the selection is not \"trapped\" by the `linkHref` attribute after inserting, there's nothing\n\t\t\t// to fix there.\n\t\t\tif ( !selection.hasAttribute( 'linkHref' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Filter out the following case where a link with the same href (e.g. <a href=\"foo\">INSERTED</a>) is inserted\n\t\t\t// in the middle of an existing link:\n\t\t\t//\n\t\t\t// Before insertion:\n\t\t\t//\t\t                       \n\t\t\t//\t\t<$text linkHref=\"foo\">l[]ink</$text>\n\t\t\t//\n\t\t\t// Expected after insertion:\n\t\t\t//\t\t                               \n\t\t\t//\t\t<$text linkHref=\"foo\">lINSERTED[]ink</$text>\n\t\t\t//\n\t\t\tif ( !nodeBefore ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Filter out the following case where the selection has the \"linkHref\" attribute because the\n\t\t\t// gravity is overridden and some text with another attribute (e.g. <b>INSERTED</b>) is inserted:\n\t\t\t//\n\t\t\t// Before insertion:\n\t\t\t//\n\t\t\t//\t\t                       \n\t\t\t//\t\t<$text linkHref=\"foo\">[]link</$text>\n\t\t\t//\n\t\t\t// Expected after insertion:\n\t\t\t//\n\t\t\t//\t\t                                                          \n\t\t\t//\t\t<$text bold=\"true\">INSERTED</$text><$text linkHref=\"foo\">[]link</$text>\n\t\t\t//\n\t\t\tif ( !nodeBefore.hasAttribute( 'linkHref' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Filter out the following case where a link is a inserted in the middle (or before) another link\n\t\t\t// (different URLs, so they will not merge). In this (let's say weird) case, we can leave the selection\n\t\t\t// attributes as they are because the user will end up writing in one link or another anyway.\n\t\t\t//\n\t\t\t// Before insertion:\n\t\t\t//\n\t\t\t//\t\t                       \n\t\t\t//\t\t<$text linkHref=\"foo\">l[]ink</$text>\n\t\t\t//\n\t\t\t// Expected after insertion:\n\t\t\t//\n\t\t\t//\t\t                                                             \n\t\t\t//\t\t<$text linkHref=\"foo\">l</$text><$text linkHref=\"bar\">INSERTED[]</$text><$text linkHref=\"foo\">ink</$text>\n\t\t\t//\n\t\t\tif ( nodeAfter && nodeAfter.hasAttribute( 'linkHref' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmodel.change( writer => {\n\t\t\t\tremoveLinkAttributesFromSelection( writer, linkCommand.manualDecorators );\n\t\t\t} );\n\t\t}, { priority: 'low' } );\n\t}\n\n\t/**\n\t * Starts listening to {@link module:engine/view/document~Document#event:mousedown} and\n\t * {@link module:engine/view/document~Document#event:selectionChange} and puts the selection before/after a link node\n\t * if clicked at the beginning/ending of the link.\n\t *\n\t * The purpose of this action is to allow typing around the link node directly after a click.\n\t *\n\t * See https://github.com/ckeditor/ckeditor5/issues/1016.\n\t *\n\t * @private\n\t */\n\t_enableClickingAfterLink() {\n\t\tconst editor = this.editor;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\n\t\teditor.editing.view.addObserver( MouseObserver );\n\n\t\tlet clicked = false;\n\n\t\t// Detect the click.\n\t\tthis.listenTo( editor.editing.view.document, 'mousedown', () => {\n\t\t\tclicked = true;\n\t\t} );\n\n\t\t// When the selection has changed...\n\t\tthis.listenTo( editor.editing.view.document, 'selectionChange', () => {\n\t\t\tif ( !clicked ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// ...and it was caused by the click...\n\t\t\tclicked = false;\n\n\t\t\tconst selection = editor.model.document.selection;\n\n\t\t\t// ...and no text is selected...\n\t\t\tif ( !selection.isCollapsed ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// ...and clicked text is the link...\n\t\t\tif ( !selection.hasAttribute( 'linkHref' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst position = selection.getFirstPosition();\n\t\t\tconst linkRange = findAttributeRange( position, 'linkHref', selection.getAttribute( 'linkHref' ), editor.model );\n\n\t\t\t// ...check whether clicked start/end boundary of the link.\n\t\t\t// If so, remove the `linkHref` attribute.\n\t\t\tif ( position.isTouching( linkRange.start ) || position.isTouching( linkRange.end ) ) {\n\t\t\t\teditor.model.change( writer => {\n\t\t\t\t\tremoveLinkAttributesFromSelection( writer, linkCommand.manualDecorators );\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Starts listening to {@link module:engine/model/model~Model#deleteContent} and {@link module:engine/model/model~Model#insertContent}\n\t * and checks whether typing over the link. If so, attributes of removed text are preserved and applied to the inserted text.\n\t *\n\t * The purpose of this action is to allow modifying a text without loosing the `linkHref` attribute (and other).\n\t *\n\t * See https://github.com/ckeditor/ckeditor5/issues/4762.\n\t *\n\t * @private\n\t */\n\t_enableTypingOverLink() {\n\t\tconst editor = this.editor;\n\t\tconst view = editor.editing.view;\n\n\t\t// Selection attributes when started typing over the link.\n\t\tlet selectionAttributes;\n\n\t\t// Whether pressed `Backspace` or `Delete`. If so, attributes should not be preserved.\n\t\tlet deletedContent;\n\n\t\t// Detect pressing `Backspace` / `Delete`.\n\t\tthis.listenTo( view.document, 'delete', () => {\n\t\t\tdeletedContent = true;\n\t\t}, { priority: 'high' } );\n\n\t\t// Listening to `model#deleteContent` allows detecting whether selected content was a link.\n\t\t// If so, before removing the element, we will copy its attributes.\n\t\tthis.listenTo( editor.model, 'deleteContent', () => {\n\t\t\tconst selection = editor.model.document.selection;\n\n\t\t\t// Copy attributes only if anything is selected.\n\t\t\tif ( selection.isCollapsed ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// When the content was deleted, do not preserve attributes.\n\t\t\tif ( deletedContent ) {\n\t\t\t\tdeletedContent = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Enabled only when typing.\n\t\t\tif ( !isTyping( editor ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( shouldCopyAttributes( editor.model ) ) {\n\t\t\t\tselectionAttributes = selection.getAttributes();\n\t\t\t}\n\t\t}, { priority: 'high' } );\n\n\t\t// Listening to `model#insertContent` allows detecting the content insertion.\n\t\t// We want to apply attributes that were removed while typing over the link.\n\t\tthis.listenTo( editor.model, 'insertContent', ( evt, [ element ] ) => {\n\t\t\tdeletedContent = false;\n\n\t\t\t// Enabled only when typing.\n\t\t\tif ( !isTyping( editor ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( !selectionAttributes ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditor.model.change( writer => {\n\t\t\t\tfor ( const [ attribute, value ] of selectionAttributes ) {\n\t\t\t\t\twriter.setAttribute( attribute, value, element );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tselectionAttributes = null;\n\t\t}, { priority: 'high' } );\n\t}\n\n\t/**\n\t * Starts listening to {@link module:engine/model/model~Model#deleteContent} and checks whether\n\t * removing a content right after the \"linkHref\" attribute.\n\t *\n\t * If so, the selection should not preserve the `linkHref` attribute. However, if\n\t * the {@link module:typing/twostepcaretmovement~TwoStepCaretMovement} plugin is active and\n\t * the selection has the \"linkHref\" attribute due to overriden gravity (at the end), the `linkHref` attribute should stay untouched.\n\t *\n\t * The purpose of this action is to allow removing the link text and keep the selection outside the link.\n\t *\n\t * See https://github.com/ckeditor/ckeditor5/issues/7521.\n\t *\n\t * @private\n\t */\n\t_handleDeleteContentAfterLink() {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst selection = model.document.selection;\n\t\tconst view = editor.editing.view;\n\t\tconst linkCommand = editor.commands.get( 'link' );\n\n\t\t// A flag whether attributes `linkHref` attribute should be preserved.\n\t\tlet shouldPreserveAttributes = false;\n\n\t\t// A flag whether the `Backspace` key was pressed.\n\t\tlet hasBackspacePressed = false;\n\n\t\t// Detect pressing `Backspace`.\n\t\tthis.listenTo( view.document, 'delete', ( evt, data ) => {\n\t\t\thasBackspacePressed = data.domEvent.keyCode === keyCodes.backspace;\n\t\t}, { priority: 'high' } );\n\n\t\t// Before removing the content, check whether the selection is inside a link or at the end of link but with 2-SCM enabled.\n\t\t// If so, we want to preserve link attributes.\n\t\tthis.listenTo( model, 'deleteContent', () => {\n\t\t\t// Reset the state.\n\t\t\tshouldPreserveAttributes = false;\n\n\t\t\tconst position = selection.getFirstPosition();\n\t\t\tconst linkHref = selection.getAttribute( 'linkHref' );\n\n\t\t\tif ( !linkHref ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst linkRange = findAttributeRange( position, 'linkHref', linkHref, model );\n\n\t\t\t// Preserve `linkHref` attribute if the selection is in the middle of the link or\n\t\t\t// the selection is at the end of the link and 2-SCM is activated.\n\t\t\tshouldPreserveAttributes = linkRange.containsPosition( position ) || linkRange.end.isEqual( position );\n\t\t}, { priority: 'high' } );\n\n\t\t// After removing the content, check whether the current selection should preserve the `linkHref` attribute.\n\t\tthis.listenTo( model, 'deleteContent', () => {\n\t\t\t// If didn't press `Backspace`.\n\t\t\tif ( !hasBackspacePressed ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thasBackspacePressed = false;\n\n\t\t\t// Disable the mechanism if inside a link (`<$text url=\"foo\">F[]oo</$text>` or <$text url=\"foo\">Foo[]</$text>`).\n\t\t\tif ( shouldPreserveAttributes ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Use `model.enqueueChange()` in order to execute the callback at the end of the changes process.\n\t\t\teditor.model.enqueueChange( writer => {\n\t\t\t\tremoveLinkAttributesFromSelection( writer, linkCommand.manualDecorators );\n\t\t\t} );\n\t\t}, { priority: 'low' } );\n\t}\n}\n\n// Make the selection free of link-related model attributes.\n// All link-related model attributes start with \"link\". That includes not only \"linkHref\"\n// but also all decorator attributes (they have dynamic names).\n//\n// @param {module:engine/model/writer~Writer} writer\n// @param {module:utils/collection~Collection} manualDecorators\nfunction removeLinkAttributesFromSelection( writer, manualDecorators ) {\n\twriter.removeSelectionAttribute( 'linkHref' );\n\n\tfor ( const decorator of manualDecorators ) {\n\t\twriter.removeSelectionAttribute( decorator.id );\n\t}\n}\n\n// Checks whether selection's attributes should be copied to the new inserted text.\n//\n// @param {module:engine/model/model~Model} model\n// @returns {Boolean}\nfunction shouldCopyAttributes( model ) {\n\tconst selection = model.document.selection;\n\tconst firstPosition = selection.getFirstPosition();\n\tconst lastPosition = selection.getLastPosition();\n\tconst nodeAtFirstPosition = firstPosition.nodeAfter;\n\n\t// The text link node does not exist...\n\tif ( !nodeAtFirstPosition ) {\n\t\treturn false;\n\t}\n\n\t// ...or it isn't the text node...\n\tif ( !nodeAtFirstPosition.is( '$text' ) ) {\n\t\treturn false;\n\t}\n\n\t// ...or isn't the link.\n\tif ( !nodeAtFirstPosition.hasAttribute( 'linkHref' ) ) {\n\t\treturn false;\n\t}\n\n\t// `textNode` = the position is inside the link element.\n\t// `nodeBefore` = the position is at the end of the link element.\n\tconst nodeAtLastPosition = lastPosition.textNode || lastPosition.nodeBefore;\n\n\t// If both references the same node selection contains a single text node.\n\tif ( nodeAtFirstPosition === nodeAtLastPosition ) {\n\t\treturn true;\n\t}\n\n\t// If nodes are not equal, maybe the link nodes has defined additional attributes inside.\n\t// First, we need to find the entire link range.\n\tconst linkRange = findAttributeRange( firstPosition, 'linkHref', nodeAtFirstPosition.getAttribute( 'linkHref' ), model );\n\n\t// Then we can check whether selected range is inside the found link range. If so, attributes should be preserved.\n\treturn linkRange.containsRange( model.createRange( firstPosition, lastPosition ), true );\n}\n\n// Checks whether provided changes were caused by typing.\n//\n// @params {module:core/editor/editor~Editor} editor\n// @returns {Boolean}\nfunction isTyping( editor ) {\n\tconst input = editor.plugins.get( 'Input' );\n\n\treturn input.isInput( editor.model.change( writer => writer.batch ) );\n}\n"]}]}