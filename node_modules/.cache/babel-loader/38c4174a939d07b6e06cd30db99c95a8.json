{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CgovKioKICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjEsIENLU291cmNlIC0gRnJlZGVyaWNvIEtuYWJiZW4uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLW9zcy1saWNlbnNlCiAqLwoKLyoqCiAqIEBtb2R1bGUgdHlwaW5nL3V0aWxzL2luamVjdHR5cGluZ211dGF0aW9uc2hhbmRsaW5nCiAqLwppbXBvcnQgZGlmZiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL3NyYy9kaWZmJzsKaW1wb3J0IERvbUNvbnZlcnRlciBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9zcmMvdmlldy9kb21jb252ZXJ0ZXInOwppbXBvcnQgeyBnZXRTaW5nbGVUZXh0Tm9kZUNoYW5nZSwgY29udGFpbmVyQ2hpbGRyZW5NdXRhdGVkIH0gZnJvbSAnLi91dGlscyc7Ci8qKgogKiBIYW5kbGVzIG11dGF0aW9ucyBjYXVzZWQgYnkgbm9ybWFsIHR5cGluZy4KICoKICogQHBhcmFtIHttb2R1bGU6Y29yZS9lZGl0b3IvZWRpdG9yfkVkaXRvcn0gZWRpdG9yIFRoZSBlZGl0b3IgaW5zdGFuY2UuCiAqLwoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gaW5qZWN0VHlwaW5nTXV0YXRpb25zSGFuZGxpbmcoZWRpdG9yKSB7CiAgZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5vbignbXV0YXRpb25zJywgZnVuY3Rpb24gKGV2dCwgbXV0YXRpb25zLCB2aWV3U2VsZWN0aW9uKSB7CiAgICBuZXcgTXV0YXRpb25IYW5kbGVyKGVkaXRvcikuaGFuZGxlKG11dGF0aW9ucywgdmlld1NlbGVjdGlvbik7CiAgfSk7Cn0KLyoqCiAqIEhlbHBlciBjbGFzcyBmb3IgdHJhbnNsYXRpbmcgRE9NIG11dGF0aW9ucyBpbnRvIG1vZGVsIGNoYW5nZXMuCiAqCiAqIEBwcml2YXRlCiAqLwoKdmFyIE11dGF0aW9uSGFuZGxlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgLyoqCiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUgbXV0YXRpb24gaGFuZGxlci4KICAgKgogICAqIEBwYXJhbSB7bW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3J9IGVkaXRvcgogICAqLwogIGZ1bmN0aW9uIE11dGF0aW9uSGFuZGxlcihlZGl0b3IpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNdXRhdGlvbkhhbmRsZXIpOwoKICAgIC8qKgogICAgICogRWRpdG9yIGluc3RhbmNlIGZvciB3aGljaCBtdXRhdGlvbnMgYXJlIGhhbmRsZWQuCiAgICAgKgogICAgICogQHJlYWRvbmx5CiAgICAgKiBAbWVtYmVyIHttb2R1bGU6Y29yZS9lZGl0b3IvZWRpdG9yfkVkaXRvcn0gI2VkaXRvcgogICAgICovCiAgICB0aGlzLmVkaXRvciA9IGVkaXRvcjsKICAgIC8qKgogICAgICogVGhlIGVkaXRpbmcgY29udHJvbGxlci4KICAgICAqCiAgICAgKiBAcmVhZG9ubHkKICAgICAqIEBtZW1iZXIge21vZHVsZTplbmdpbmUvY29udHJvbGxlci9lZGl0aW5nY29udHJvbGxlcn5FZGl0aW5nQ29udHJvbGxlcn0gI2VkaXRpbmcKICAgICAqLwoKICAgIHRoaXMuZWRpdGluZyA9IHRoaXMuZWRpdG9yLmVkaXRpbmc7CiAgfQogIC8qKgogICAqIEhhbmRsZXMgZ2l2ZW4gbXV0YXRpb25zLgogICAqCiAgICogQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZFRleHR8CiAgICogbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZENoaWxkcmVuPn0gbXV0YXRpb25zCiAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbnxudWxsfSB2aWV3U2VsZWN0aW9uCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoTXV0YXRpb25IYW5kbGVyLCBbewogICAga2V5OiAiaGFuZGxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGUobXV0YXRpb25zLCB2aWV3U2VsZWN0aW9uKSB7CiAgICAgIGlmIChjb250YWluZXJDaGlsZHJlbk11dGF0ZWQobXV0YXRpb25zKSkgewogICAgICAgIHRoaXMuX2hhbmRsZUNvbnRhaW5lckNoaWxkcmVuTXV0YXRpb25zKG11dGF0aW9ucywgdmlld1NlbGVjdGlvbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG11dGF0aW9ucyksCiAgICAgICAgICAgIF9zdGVwOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIG11dGF0aW9uID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgICAvLyBGb3J0dW5hdGVseSBpdCB3aWxsIG5ldmVyIGJlIGJvdGguCiAgICAgICAgICAgIHRoaXMuX2hhbmRsZVRleHRNdXRhdGlvbihtdXRhdGlvbiwgdmlld1NlbGVjdGlvbik7CgogICAgICAgICAgICB0aGlzLl9oYW5kbGVUZXh0Tm9kZUluc2VydGlvbihtdXRhdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBIYW5kbGVzIHNpdHVhdGlvbnMgd2hlbiBjb250YWluZXIncyBjaGlsZHJlbiBtdXRhdGVkIGR1cmluZyBpbnB1dC4gVGhpcyBjYW4gaGFwcGVuIHdoZW4KICAgICAqIHRoZSBicm93c2VyIGlzIHRyeWluZyB0byAiZml4IiBET00gaW4gY2VydGFpbiBzaXR1YXRpb25zLiBGb3IgZXhhbXBsZSwgd2hlbiB0aGUgdXNlciBzdGFydHMgdG8gdHlwZQogICAgICogaW4gYDxwPjxhIGhyZWY9IiI+PGk+TGlua3t9PC9pPjwvYT48L3A+YCwgdGhlIGJyb3dzZXIgbWlnaHQgY2hhbmdlIHRoZSBvcmRlciBvZiBlbGVtZW50cwogICAgICogdG8gYDxwPjxpPjxhIGhyZWY9IiI+TGluazwvYT54e308L2k+PC9wPmAuIEEgc2ltaWxhciBzaXR1YXRpb24gaGFwcGVucyB3aGVuIHRoZSBzcGVsbCBjaGVja2VyCiAgICAgKiByZXBsYWNlcyBhIHdvcmQgd3JhcHBlZCB3aXRoIGA8c3Ryb25nPmAgd2l0aCBhIHdvcmQgd3JhcHBlZCB3aXRoIGEgYDxiPmAgZWxlbWVudC4KICAgICAqCiAgICAgKiBUbyBoYW5kbGUgc3VjaCBzaXR1YXRpb25zLCB0aGUgY29tbW9uIERPTSBhbmNlc3RvciBvZiBhbGwgbXV0YXRpb25zIGlzIGNvbnZlcnRlZCB0byB0aGUgbW9kZWwgcmVwcmVzZW50YXRpb24KICAgICAqIGFuZCB0aGVuIGNvbXBhcmVkIHdpdGggdGhlIGN1cnJlbnQgbW9kZWwgdG8gY2FsY3VsYXRlIHRoZSBwcm9wZXIgdGV4dCBjaGFuZ2UuCiAgICAgKgogICAgICogTm90ZTogU2luZ2xlIHRleHQgbm9kZSBpbnNlcnRpb24gaXMgaGFuZGxlZCBpbiB7QGxpbmsgI19oYW5kbGVUZXh0Tm9kZUluc2VydGlvbn0gYW5kIHRleHQgbm9kZSBtdXRhdGlvbiBpcyBoYW5kbGVkCiAgICAgKiBpbiB7QGxpbmsgI19oYW5kbGVUZXh0TXV0YXRpb259KS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZFRleHR8CiAgICAgKiBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkQ2hpbGRyZW4+fSBtdXRhdGlvbnMKICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb258bnVsbH0gdmlld1NlbGVjdGlvbgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVDb250YWluZXJDaGlsZHJlbk11dGF0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUNvbnRhaW5lckNoaWxkcmVuTXV0YXRpb25zKG11dGF0aW9ucywgdmlld1NlbGVjdGlvbikgewogICAgICAvLyBHZXQgY29tbW9uIGFuY2VzdG9yIG9mIGFsbCBtdXRhdGlvbnMuCiAgICAgIHZhciBtdXRhdGlvbnNDb21tb25BbmNlc3RvciA9IGdldE11dGF0aW9uc0NvbnRhaW5lcihtdXRhdGlvbnMpOyAvLyBRdWl0IGlmIHRoZXJlIGlzIG5vIGNvbW1vbiBhbmNlc3Rvci4KCiAgICAgIGlmICghbXV0YXRpb25zQ29tbW9uQW5jZXN0b3IpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkb21Db252ZXJ0ZXIgPSB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXcuZG9tQ29udmVydGVyOyAvLyBHZXQgY29tbW9uIGFuY2VzdG9yIGluIERPTS4KCiAgICAgIHZhciBkb21NdXRhdGlvbkNvbW1vbkFuY2VzdG9yID0gZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbShtdXRhdGlvbnNDb21tb25BbmNlc3Rvcik7IC8vIENyZWF0ZSBmcmVzaCBEb21Db252ZXJ0ZXIgc28gaXQgd2lsbCBub3QgdXNlIGV4aXN0aW5nIG1hcHBpbmcgYW5kIGNvbnZlcnQgY3VycmVudCBET00gdG8gbW9kZWwuCiAgICAgIC8vIFRoaXMgd291bGRuJ3QgYmUgbmVlZGVkIGlmIERvbUNvbnZlcnRlciB3b3VsZCBhbGxvdyB0byBjcmVhdGUgZnJlc2ggdmlldyB3aXRob3V0IGNoZWNraW5nIGFueSBtYXBwaW5ncy4KCiAgICAgIHZhciBmcmVzaERvbUNvbnZlcnRlciA9IG5ldyBEb21Db252ZXJ0ZXIodGhpcy5lZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50KTsKICAgICAgdmFyIG1vZGVsRnJvbUN1cnJlbnREb20gPSB0aGlzLmVkaXRvci5kYXRhLnRvTW9kZWwoZnJlc2hEb21Db252ZXJ0ZXIuZG9tVG9WaWV3KGRvbU11dGF0aW9uQ29tbW9uQW5jZXN0b3IpKS5nZXRDaGlsZCgwKTsgLy8gQ3VycmVudCBtb2RlbC4KCiAgICAgIHZhciBjdXJyZW50TW9kZWwgPSB0aGlzLmVkaXRvci5lZGl0aW5nLm1hcHBlci50b01vZGVsRWxlbWVudChtdXRhdGlvbnNDb21tb25BbmNlc3Rvcik7IC8vIElmIGNvbW1vbiBhbmNlc3RvciBpcyBub3QgbWFwcGVkLCBkbyBub3QgZG8gYW55dGhpbmcuIEl0IHByb2JhYmx5IGlzIGEgcGFyZW50IG9mIGFub3RoZXIgdmlldyBlbGVtZW50LgogICAgICAvLyBUaGF0IG1lYW5zIHRoYXQgd2Ugd291bGQgbmVlZCB0byBkaWZmIG1vZGVsIGVsZW1lbnRzIChzZWUgYGlmYCBiZWxvdykuIEJldHRlciByZXR1cm4gZWFybHkgaW5zdGVhZCBvZgogICAgICAvLyB0cnlpbmcgdG8gZ2V0IGEgcmVhc29uYWJsZSBtb2RlbCBhbmNlc3Rvci4gSXQgd2lsbCBmZWxsIGludG8gdGhlIGBpZmAgYmVsb3cgYW55d2F5LgogICAgICAvLyBUaGlzIHNpdHVhdGlvbiBoYXBwZW5zIGZvciBleGFtcGxlIGZvciBsaXN0cy4gSWYgYDx1bD5gIGlzIGEgY29tbW9uIGFuY2VzdG9yLCBgY3VycmVudE1vZGVsYCBpcyBgdW5kZWZpbmVkYAogICAgICAvLyBiZWNhdXNlIGA8dWw+YCBpcyBub3QgbWFwcGVkIChgPGxpPmBzIGFyZSkuCiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy83MTguCgogICAgICBpZiAoIWN1cnJlbnRNb2RlbCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgY2hpbGRyZW4gZnJvbSBib3RoIGFuY2VzdG9ycy4KCgogICAgICB2YXIgbW9kZWxGcm9tRG9tQ2hpbGRyZW4gPSBBcnJheS5mcm9tKG1vZGVsRnJvbUN1cnJlbnREb20uZ2V0Q2hpbGRyZW4oKSk7CiAgICAgIHZhciBjdXJyZW50TW9kZWxDaGlsZHJlbiA9IEFycmF5LmZyb20oY3VycmVudE1vZGVsLmdldENoaWxkcmVuKCkpOyAvLyBSZW1vdmUgdGhlIGxhc3QgYDxzb2Z0QnJlYWs+YCBmcm9tIHRoZSBlbmQgb2YgYG1vZGVsRnJvbURvbUNoaWxkcmVuYCBpZiB0aGVyZSBpcyBubyBgPHNvZnRCcmVhaz5gIGluIGN1cnJlbnQgbW9kZWwuCiAgICAgIC8vIElmIHRoZSBkZXNjcmliZWQgc2NlbmFyaW8gaGFwcGVuZWQsIGl0IG1lYW5zIHRoYXQgdGhpcyBpcyBhIGJvZ3VzIGA8YnIgLz5gIGFkZGVkIGJ5IGEgYnJvd3Nlci4KCiAgICAgIHZhciBsYXN0RG9tQ2hpbGQgPSBtb2RlbEZyb21Eb21DaGlsZHJlblttb2RlbEZyb21Eb21DaGlsZHJlbi5sZW5ndGggLSAxXTsKICAgICAgdmFyIGxhc3RDdXJyZW50Q2hpbGQgPSBjdXJyZW50TW9kZWxDaGlsZHJlbltjdXJyZW50TW9kZWxDaGlsZHJlbi5sZW5ndGggLSAxXTsKICAgICAgdmFyIGlzTGFzdERvbUNoaWxkU29mdEJyZWFrID0gbGFzdERvbUNoaWxkICYmIGxhc3REb21DaGlsZC5pcygnZWxlbWVudCcsICdzb2Z0QnJlYWsnKTsKICAgICAgdmFyIGlzTGFzdEN1cnJlbnRDaGlsZFNvZnRCcmVhayA9IGxhc3RDdXJyZW50Q2hpbGQgJiYgIWxhc3RDdXJyZW50Q2hpbGQuaXMoJ2VsZW1lbnQnLCAnc29mdEJyZWFrJyk7CgogICAgICBpZiAoaXNMYXN0RG9tQ2hpbGRTb2Z0QnJlYWsgJiYgaXNMYXN0Q3VycmVudENoaWxkU29mdEJyZWFrKSB7CiAgICAgICAgbW9kZWxGcm9tRG9tQ2hpbGRyZW4ucG9wKCk7CiAgICAgIH0KCiAgICAgIHZhciBzY2hlbWEgPSB0aGlzLmVkaXRvci5tb2RlbC5zY2hlbWE7IC8vIFNraXAgc2l0dWF0aW9ucyB3aGVuIGNvbW1vbiBhbmNlc3RvciBoYXMgYW55IGNvbnRhaW5lciBlbGVtZW50cy4KCiAgICAgIGlmICghaXNTYWZlRm9yVGV4dE11dGF0aW9uKG1vZGVsRnJvbURvbUNoaWxkcmVuLCBzY2hlbWEpIHx8ICFpc1NhZmVGb3JUZXh0TXV0YXRpb24oY3VycmVudE1vZGVsQ2hpbGRyZW4sIHNjaGVtYSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gUmVwbGFjZSAmbmJzcDsgaW5zZXJ0ZWQgYnkgdGhlIGJyb3dzZXIgd2l0aCBub3JtYWwgc3BhY2UuIFNlZSBjb21tZW50IGluIGBfaGFuZGxlVGV4dE11dGF0aW9uYC4KICAgICAgLy8gUmVwbGFjZSBub24tdGV4dHMgd2l0aCBhbnkgY2hhcmFjdGVyLiBUaGlzIGlzIHBvdGVudGlhbGx5IGRhbmdlcm91cyBidXQgcGFzc2VzIGluIG1hbnVhbCB0ZXN0cy4gVGhlIHRoaW5nIGlzCiAgICAgIC8vIHRoYXQgd2UgbmVlZCB0byB0YWtlIGNhcmUgb2YgcHJvcGVyIGluZGV4ZXMgc28gd2UgY2Fubm90IHNpbXBseSByZW1vdmUgbm9uLXRleHQgZWxlbWVudHMgZnJvbSB0aGUgY29udGVudC4KICAgICAgLy8gQnkgaW5zZXJ0aW5nIGEgY2hhcmFjdGVyIHdlIGtlZXAgYWxsIHRoZSByZWFsIHRleHRzIG9uIHRoZWlyIGluZGV4ZXMuCgoKICAgICAgdmFyIG5ld1RleHQgPSBtb2RlbEZyb21Eb21DaGlsZHJlbi5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5pcygnJHRleHQnKSA/IGl0ZW0uZGF0YSA6ICdAJzsKICAgICAgfSkuam9pbignJykucmVwbGFjZSgvXHUwMEEwL2csICcgJyk7CiAgICAgIHZhciBvbGRUZXh0ID0gY3VycmVudE1vZGVsQ2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0uaXMoJyR0ZXh0JykgPyBpdGVtLmRhdGEgOiAnQCc7CiAgICAgIH0pLmpvaW4oJycpLnJlcGxhY2UoL1x1MDBBMC9nLCAnICcpOyAvLyBEbyBub3RoaW5nIGlmIG11dGF0aW9ucyBjcmVhdGVkIHNhbWUgdGV4dC4KCiAgICAgIGlmIChvbGRUZXh0ID09PSBuZXdUZXh0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZGlmZlJlc3VsdCA9IGRpZmYob2xkVGV4dCwgbmV3VGV4dCk7CgogICAgICB2YXIgX2NhbGN1bGF0ZUNoYW5nZXMgPSBjYWxjdWxhdGVDaGFuZ2VzKGRpZmZSZXN1bHQpLAogICAgICAgICAgZmlyc3RDaGFuZ2VBdCA9IF9jYWxjdWxhdGVDaGFuZ2VzLmZpcnN0Q2hhbmdlQXQsCiAgICAgICAgICBpbnNlcnRpb25zID0gX2NhbGN1bGF0ZUNoYW5nZXMuaW5zZXJ0aW9ucywKICAgICAgICAgIGRlbGV0aW9ucyA9IF9jYWxjdWxhdGVDaGFuZ2VzLmRlbGV0aW9uczsgLy8gVHJ5IHNldHRpbmcgbmV3IG1vZGVsIHNlbGVjdGlvbiBhY2NvcmRpbmcgdG8gcGFzc2VkIHZpZXcgc2VsZWN0aW9uLgoKCiAgICAgIHZhciBtb2RlbFNlbGVjdGlvblJhbmdlID0gbnVsbDsKCiAgICAgIGlmICh2aWV3U2VsZWN0aW9uKSB7CiAgICAgICAgbW9kZWxTZWxlY3Rpb25SYW5nZSA9IHRoaXMuZWRpdGluZy5tYXBwZXIudG9Nb2RlbFJhbmdlKHZpZXdTZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpKTsKICAgICAgfQoKICAgICAgdmFyIGluc2VydFRleHQgPSBuZXdUZXh0LnN1YnN0cihmaXJzdENoYW5nZUF0LCBpbnNlcnRpb25zKTsKICAgICAgdmFyIHJlbW92ZVJhbmdlID0gdGhpcy5lZGl0b3IubW9kZWwuY3JlYXRlUmFuZ2UodGhpcy5lZGl0b3IubW9kZWwuY3JlYXRlUG9zaXRpb25BdChjdXJyZW50TW9kZWwsIGZpcnN0Q2hhbmdlQXQpLCB0aGlzLmVkaXRvci5tb2RlbC5jcmVhdGVQb3NpdGlvbkF0KGN1cnJlbnRNb2RlbCwgZmlyc3RDaGFuZ2VBdCArIGRlbGV0aW9ucykpOwogICAgICB0aGlzLmVkaXRvci5leGVjdXRlKCdpbnB1dCcsIHsKICAgICAgICB0ZXh0OiBpbnNlcnRUZXh0LAogICAgICAgIHJhbmdlOiByZW1vdmVSYW5nZSwKICAgICAgICByZXN1bHRSYW5nZTogbW9kZWxTZWxlY3Rpb25SYW5nZQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfaGFuZGxlVGV4dE11dGF0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlVGV4dE11dGF0aW9uKG11dGF0aW9uLCB2aWV3U2VsZWN0aW9uKSB7CiAgICAgIGlmIChtdXRhdGlvbi50eXBlICE9ICd0ZXh0JykgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBSZXBsYWNlICZuYnNwOyBpbnNlcnRlZCBieSB0aGUgYnJvd3NlciB3aXRoIG5vcm1hbCBzcGFjZS4KICAgICAgLy8gV2Ugd2FudCBvbmx5IG5vcm1hbCBzcGFjZXMgaW4gdGhlIG1vZGVsIGFuZCBpbiB0aGUgdmlldy4gUmVuZGVyZXIgYW5kIERPTSBDb252ZXJ0ZXIgd2lsbCBiZSB0aGVuIHJlc3BvbnNpYmxlCiAgICAgIC8vIGZvciByZW5kZXJpbmcgY29uc2VjdXRpdmUgc3BhY2VzIHVzaW5nICZuYnNwOywgYnV0IHRoZSBtb2RlbCBhbmQgdGhlIHZpZXcgaGFzIHRvIGJlIGNsZWFyLgogICAgICAvLyBPdGhlciBmZWF0dXJlIG1heSBpbnRyb2R1Y2UgaW5zZXJ0aW5nIG5vbi1icmVha2FibGUgc3BhY2Ugb24gc3BlY2lmaWMga2V5IHN0cm9rZSAoZm9yIGV4YW1wbGUgc2hpZnQgKyBzcGFjZSkuCiAgICAgIC8vIEhvd2V2ZXIgdGhlbiBpdCB3aWxsIGJlIGhhbmRsZWQgb3V0c2lkZSBvZiBtdXRhdGlvbnMsIGxpa2UgZW50ZXIga2V5IGlzLgogICAgICAvLyBUaGUgcmVwbGFjaW5nIGlzIGhlcmUgYmVjYXVzZSBpdCBoYXMgdG8gYmUgZG9uZSBiZWZvcmUgYGRpZmZgIGFuZCBgZGlmZlRvQ2hhbmdlc2AgZnVuY3Rpb25zLCBhcyB0aGV5CiAgICAgIC8vIHRha2UgYG5ld1RleHRgIGFuZCBjb21wYXJlIGl0IHRvIChjbGVhbmVkIHVwKSB2aWV3LgogICAgICAvLyBJdCBjb3VsZCBhbHNvIGJlIGRvbmUgaW4gbXV0YXRpb24gb2JzZXJ2ZXIgdG9vLCBob3dldmVyIGlmIGFueSBvdXRzaWRlIHBsdWdpbiB3b3VsZCBsaWtlIHRvCiAgICAgIC8vIGludHJvZHVjZSBhZGRpdGlvbmFsIGV2ZW50cyBmb3IgbXV0YXRpb25zLCB0aGV5IHdvdWxkIGdldCBhbHJlYWR5IGNsZWFuZWQgdXAgdmVyc2lvbiAodGhpcyBtYXkgYmUgZ29vZCBvciBub3QpLgoKCiAgICAgIHZhciBuZXdUZXh0ID0gbXV0YXRpb24ubmV3VGV4dC5yZXBsYWNlKC9cdTAwQTAvZywgJyAnKTsgLy8gVG8gaGF2ZSBjb3JyZWN0IGBkaWZmUmVzdWx0YCwgd2UgYWxzbyBjb21wYXJlIHZpZXcgbm9kZSB0ZXh0IGRhdGEgd2l0aCAmbmJzcDsgcmVwbGFjZWQgYnkgc3BhY2UuCgogICAgICB2YXIgb2xkVGV4dCA9IG11dGF0aW9uLm9sZFRleHQucmVwbGFjZSgvXHUwMEEwL2csICcgJyk7IC8vIERvIG5vdGhpbmcgaWYgbXV0YXRpb25zIGNyZWF0ZWQgc2FtZSB0ZXh0LgoKICAgICAgaWYgKG9sZFRleHQgPT09IG5ld1RleHQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkaWZmUmVzdWx0ID0gZGlmZihvbGRUZXh0LCBuZXdUZXh0KTsKCiAgICAgIHZhciBfY2FsY3VsYXRlQ2hhbmdlczIgPSBjYWxjdWxhdGVDaGFuZ2VzKGRpZmZSZXN1bHQpLAogICAgICAgICAgZmlyc3RDaGFuZ2VBdCA9IF9jYWxjdWxhdGVDaGFuZ2VzMi5maXJzdENoYW5nZUF0LAogICAgICAgICAgaW5zZXJ0aW9ucyA9IF9jYWxjdWxhdGVDaGFuZ2VzMi5pbnNlcnRpb25zLAogICAgICAgICAgZGVsZXRpb25zID0gX2NhbGN1bGF0ZUNoYW5nZXMyLmRlbGV0aW9uczsgLy8gVHJ5IHNldHRpbmcgbmV3IG1vZGVsIHNlbGVjdGlvbiBhY2NvcmRpbmcgdG8gcGFzc2VkIHZpZXcgc2VsZWN0aW9uLgoKCiAgICAgIHZhciBtb2RlbFNlbGVjdGlvblJhbmdlID0gbnVsbDsKCiAgICAgIGlmICh2aWV3U2VsZWN0aW9uKSB7CiAgICAgICAgbW9kZWxTZWxlY3Rpb25SYW5nZSA9IHRoaXMuZWRpdGluZy5tYXBwZXIudG9Nb2RlbFJhbmdlKHZpZXdTZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpKTsKICAgICAgfSAvLyBHZXQgdGhlIHBvc2l0aW9uIGluIHZpZXcgYW5kIG1vZGVsIHdoZXJlIHRoZSBjaGFuZ2VzIHdpbGwgaGFwcGVuLgoKCiAgICAgIHZhciB2aWV3UG9zID0gdGhpcy5lZGl0aW5nLnZpZXcuY3JlYXRlUG9zaXRpb25BdChtdXRhdGlvbi5ub2RlLCBmaXJzdENoYW5nZUF0KTsKICAgICAgdmFyIG1vZGVsUG9zID0gdGhpcy5lZGl0aW5nLm1hcHBlci50b01vZGVsUG9zaXRpb24odmlld1Bvcyk7CiAgICAgIHZhciByZW1vdmVSYW5nZSA9IHRoaXMuZWRpdG9yLm1vZGVsLmNyZWF0ZVJhbmdlKG1vZGVsUG9zLCBtb2RlbFBvcy5nZXRTaGlmdGVkQnkoZGVsZXRpb25zKSk7CiAgICAgIHZhciBpbnNlcnRUZXh0ID0gbmV3VGV4dC5zdWJzdHIoZmlyc3RDaGFuZ2VBdCwgaW5zZXJ0aW9ucyk7CiAgICAgIHRoaXMuZWRpdG9yLmV4ZWN1dGUoJ2lucHV0JywgewogICAgICAgIHRleHQ6IGluc2VydFRleHQsCiAgICAgICAgcmFuZ2U6IHJlbW92ZVJhbmdlLAogICAgICAgIHJlc3VsdFJhbmdlOiBtb2RlbFNlbGVjdGlvblJhbmdlCiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVUZXh0Tm9kZUluc2VydGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZVRleHROb2RlSW5zZXJ0aW9uKG11dGF0aW9uKSB7CiAgICAgIGlmIChtdXRhdGlvbi50eXBlICE9ICdjaGlsZHJlbicpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBjaGFuZ2UgPSBnZXRTaW5nbGVUZXh0Tm9kZUNoYW5nZShtdXRhdGlvbik7CiAgICAgIHZhciB2aWV3UG9zID0gdGhpcy5lZGl0aW5nLnZpZXcuY3JlYXRlUG9zaXRpb25BdChtdXRhdGlvbi5ub2RlLCBjaGFuZ2UuaW5kZXgpOwogICAgICB2YXIgbW9kZWxQb3MgPSB0aGlzLmVkaXRpbmcubWFwcGVyLnRvTW9kZWxQb3NpdGlvbih2aWV3UG9zKTsKICAgICAgdmFyIGluc2VydGVkVGV4dCA9IGNoYW5nZS52YWx1ZXNbMF0uZGF0YTsKICAgICAgdGhpcy5lZGl0b3IuZXhlY3V0ZSgnaW5wdXQnLCB7CiAgICAgICAgLy8gUmVwbGFjZSAmbmJzcDsgaW5zZXJ0ZWQgYnkgdGhlIGJyb3dzZXIgd2l0aCBub3JtYWwgc3BhY2UuCiAgICAgICAgLy8gU2VlIGNvbW1lbnQgaW4gYF9oYW5kbGVUZXh0TXV0YXRpb25gLgogICAgICAgIC8vIEluIHRoaXMgY2FzZSB3ZSBkb24ndCBuZWVkIHRvIGRvIHRoaXMgYmVmb3JlIGBkaWZmYCBiZWNhdXNlIHdlIGRpZmYgd2hvbGUgbm9kZXMuCiAgICAgICAgLy8gSnVzdCBjaGFuZ2UgJm5ic3A7IGluIGNhc2UgdGhlcmUgYXJlIHNvbWUuCiAgICAgICAgdGV4dDogaW5zZXJ0ZWRUZXh0LnJlcGxhY2UoL1x1MDBBMC9nLCAnICcpLAogICAgICAgIHJhbmdlOiB0aGlzLmVkaXRvci5tb2RlbC5jcmVhdGVSYW5nZShtb2RlbFBvcykKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTXV0YXRpb25IYW5kbGVyOwp9KCk7IC8vIFJldHVybnMgZmlyc3QgY29tbW9uIGFuY2VzdG9yIG9mIGFsbCBtdXRhdGlvbnMgdGhhdCBpcyBlaXRoZXIge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR9Ci8vIG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcm9vdGVsZW1lbnR+Um9vdEVsZW1lbnR9LgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0ge0FycmF5Ljxtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkVGV4dHwKLy8gbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZENoaWxkcmVuPn0gbXV0YXRpb25zCi8vIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50fGVuZ2luZS92aWV3L3Jvb3RlbGVtZW50flJvb3RFbGVtZW50fHVuZGVmaW5lZH0KCgpmdW5jdGlvbiBnZXRNdXRhdGlvbnNDb250YWluZXIobXV0YXRpb25zKSB7CiAgdmFyIGxjYSA9IG11dGF0aW9ucy5tYXAoZnVuY3Rpb24gKG11dGF0aW9uKSB7CiAgICByZXR1cm4gbXV0YXRpb24ubm9kZTsKICB9KS5yZWR1Y2UoZnVuY3Rpb24gKGNvbW1vbkFuY2VzdG9yLCBub2RlKSB7CiAgICByZXR1cm4gY29tbW9uQW5jZXN0b3IuZ2V0Q29tbW9uQW5jZXN0b3Iobm9kZSwgewogICAgICBpbmNsdWRlU2VsZjogdHJ1ZQogICAgfSk7CiAgfSk7CgogIGlmICghbGNhKSB7CiAgICByZXR1cm47CiAgfSAvLyBXZSBuZWVkIHRvIGxvb2sgZm9yIGNvbnRhaW5lciBhbmQgcm9vdCBlbGVtZW50cyBvbmx5LCBzbyBjaGVjayBhbGwgTENBJ3MKICAvLyBhbmNlc3RvcnMgKHN0YXJ0aW5nIGZyb20gaXRzZWxmKS4KCgogIHJldHVybiBsY2EuZ2V0QW5jZXN0b3JzKHsKICAgIGluY2x1ZGVTZWxmOiB0cnVlLAogICAgcGFyZW50Rmlyc3Q6IHRydWUKICB9KS5maW5kKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC5pcygnY29udGFpbmVyRWxlbWVudCcpIHx8IGVsZW1lbnQuaXMoJ3Jvb3RFbGVtZW50Jyk7CiAgfSk7Cn0gLy8gUmV0dXJucyB0cnVlIGlmIHByb3ZpZGVkIGFycmF5IGNvbnRhaW5zIGNvbnRlbnQgdGhhdCB3b24ndCBiZSBwcm9ibGVtYXRpYyBkdXJpbmcgZGlmZmluZyBhbmQgdGV4dCBtdXRhdGlvbiBoYW5kbGluZy4KLy8KLy8gQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGU+fSBjaGlsZHJlbgovLyBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYX0gc2NoZW1hCi8vIEByZXR1cm5zIHtCb29sZWFufQoKCmZ1bmN0aW9uIGlzU2FmZUZvclRleHRNdXRhdGlvbihjaGlsZHJlbiwgc2NoZW1hKSB7CiAgcmV0dXJuIGNoaWxkcmVuLmV2ZXJ5KGZ1bmN0aW9uIChjaGlsZCkgewogICAgcmV0dXJuIHNjaGVtYS5pc0lubGluZShjaGlsZCk7CiAgfSk7Cn0gLy8gQ2FsY3VsYXRlcyBmaXJzdCBjaGFuZ2UgaW5kZXggYW5kIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRoYXQgc2hvdWxkIGJlIGluc2VydGVkIGFuZCBkZWxldGVkIHN0YXJ0aW5nIGZyb20gdGhhdCBpbmRleC4KLy8KLy8gQHByaXZhdGUKLy8gQHBhcmFtIGRpZmZSZXN1bHQKLy8gQHJldHVybnMge3tpbnNlcnRpb25zOiBudW1iZXIsIGRlbGV0aW9uczogbnVtYmVyLCBmaXJzdENoYW5nZUF0OiAqfX0KCgpmdW5jdGlvbiBjYWxjdWxhdGVDaGFuZ2VzKGRpZmZSZXN1bHQpIHsKICAvLyBJbmRleCB3aGVyZSB0aGUgZmlyc3QgY2hhbmdlIGhhcHBlbnMuIFVzZWQgdG8gc2V0IHRoZSBwb3NpdGlvbiBmcm9tIHdoaWNoIG5vZGVzIHdpbGwgYmUgcmVtb3ZlZCBhbmQgd2hlcmUgd2lsbCBiZSBpbnNlcnRlZC4KICB2YXIgZmlyc3RDaGFuZ2VBdCA9IG51bGw7IC8vIEluZGV4IHdoZXJlIHRoZSBsYXN0IGNoYW5nZSBoYXBwZW5zLiBVc2VkIHRvIHByb3Blcmx5IGNvdW50IGhvdyBtYW55IGNoYXJhY3RlcnMgaGF2ZSB0byBiZSByZW1vdmVkIGFuZCBpbnNlcnRlZC4KCiAgdmFyIGxhc3RDaGFuZ2VBdCA9IG51bGw7IC8vIEdldCBgZmlyc3RDaGFuZ2VBdGAgYW5kIGBsYXN0Q2hhbmdlQXRgLgoKICBmb3IgKHZhciBpID0gMDsgaSA8IGRpZmZSZXN1bHQubGVuZ3RoOyBpKyspIHsKICAgIHZhciBjaGFuZ2UgPSBkaWZmUmVzdWx0W2ldOwoKICAgIGlmIChjaGFuZ2UgIT0gJ2VxdWFsJykgewogICAgICBmaXJzdENoYW5nZUF0ID0gZmlyc3RDaGFuZ2VBdCA9PT0gbnVsbCA/IGkgOiBmaXJzdENoYW5nZUF0OwogICAgICBsYXN0Q2hhbmdlQXQgPSBpOwogICAgfQogIH0gLy8gSG93IG1hbnkgY2hhcmFjdGVycywgc3RhcnRpbmcgZnJvbSBgZmlyc3RDaGFuZ2VBdGAsIHNob3VsZCBiZSByZW1vdmVkLgoKCiAgdmFyIGRlbGV0aW9ucyA9IDA7IC8vIEhvdyBtYW55IGNoYXJhY3RlcnMsIHN0YXJ0aW5nIGZyb20gYGZpcnN0Q2hhbmdlQXRgLCBzaG91bGQgYmUgaW5zZXJ0ZWQuCgogIHZhciBpbnNlcnRpb25zID0gMDsKCiAgZm9yICh2YXIgX2kgPSBmaXJzdENoYW5nZUF0OyBfaSA8PSBsYXN0Q2hhbmdlQXQ7IF9pKyspIHsKICAgIC8vIElmIHRoZXJlIGlzIG5vIGNoYW5nZSAoZXF1YWwpIG9yIGRlbGV0ZSwgdGhlIGNoYXJhY3RlciBpcyBleGlzdGluZyBpbiBgb2xkVGV4dGAuIFdlIGNvdW50IGl0IGZvciByZW1vdmluZy4KICAgIGlmIChkaWZmUmVzdWx0W19pXSAhPSAnaW5zZXJ0JykgewogICAgICBkZWxldGlvbnMrKzsKICAgIH0gLy8gSWYgdGhlcmUgaXMgbm8gY2hhbmdlIChlcXVhbCkgb3IgaW5zZXJ0LCB0aGUgY2hhcmFjdGVyIGlzIGV4aXN0aW5nIGluIGBuZXdUZXh0YC4gV2UgY291bnQgaXQgZm9yIGluc2VydGluZy4KCgogICAgaWYgKGRpZmZSZXN1bHRbX2ldICE9ICdkZWxldGUnKSB7CiAgICAgIGluc2VydGlvbnMrKzsKICAgIH0KICB9CgogIHJldHVybiB7CiAgICBpbnNlcnRpb25zOiBpbnNlcnRpb25zLAogICAgZGVsZXRpb25zOiBkZWxldGlvbnMsCiAgICBmaXJzdENoYW5nZUF0OiBmaXJzdENoYW5nZUF0CiAgfTsKfQ=="},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-typing/src/utils/injecttypingmutationshandling.js"],"names":["diff","DomConverter","getSingleTextNodeChange","containerChildrenMutated","injectTypingMutationsHandling","editor","editing","view","document","on","evt","mutations","viewSelection","MutationHandler","handle","_handleContainerChildrenMutations","mutation","_handleTextMutation","_handleTextNodeInsertion","mutationsCommonAncestor","getMutationsContainer","domConverter","domMutationCommonAncestor","mapViewToDom","freshDomConverter","modelFromCurrentDom","data","toModel","domToView","getChild","currentModel","mapper","toModelElement","modelFromDomChildren","Array","from","getChildren","currentModelChildren","lastDomChild","length","lastCurrentChild","isLastDomChildSoftBreak","is","isLastCurrentChildSoftBreak","pop","schema","model","isSafeForTextMutation","newText","map","item","join","replace","oldText","diffResult","calculateChanges","firstChangeAt","insertions","deletions","modelSelectionRange","toModelRange","getFirstRange","insertText","substr","removeRange","createRange","createPositionAt","execute","text","range","resultRange","type","viewPos","node","modelPos","toModelPosition","getShiftedBy","change","index","insertedText","values","lca","reduce","commonAncestor","getCommonAncestor","includeSelf","getAncestors","parentFirst","find","element","children","every","child","isInline","lastChangeAt","i"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module typing/utils/injecttypingmutationshandling\n */\n\nimport diff from '@ckeditor/ckeditor5-utils/src/diff';\nimport DomConverter from '@ckeditor/ckeditor5-engine/src/view/domconverter';\n\nimport { getSingleTextNodeChange, containerChildrenMutated } from './utils';\n\n/**\n * Handles mutations caused by normal typing.\n *\n * @param {module:core/editor/editor~Editor} editor The editor instance.\n */\nexport default function injectTypingMutationsHandling( editor ) {\n\teditor.editing.view.document.on( 'mutations', ( evt, mutations, viewSelection ) => {\n\t\tnew MutationHandler( editor ).handle( mutations, viewSelection );\n\t} );\n}\n\n/**\n * Helper class for translating DOM mutations into model changes.\n *\n * @private\n */\nclass MutationHandler {\n\t/**\n\t * Creates an instance of the mutation handler.\n\t *\n\t * @param {module:core/editor/editor~Editor} editor\n\t */\n\tconstructor( editor ) {\n\t\t/**\n\t\t * Editor instance for which mutations are handled.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:core/editor/editor~Editor} #editor\n\t\t */\n\t\tthis.editor = editor;\n\n\t\t/**\n\t\t * The editing controller.\n\t\t *\n\t\t * @readonly\n\t\t * @member {module:engine/controller/editingcontroller~EditingController} #editing\n\t\t */\n\t\tthis.editing = this.editor.editing;\n\t}\n\n\t/**\n\t * Handles given mutations.\n\t *\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\n\t */\n\thandle( mutations, viewSelection ) {\n\t\tif ( containerChildrenMutated( mutations ) ) {\n\t\t\tthis._handleContainerChildrenMutations( mutations, viewSelection );\n\t\t} else {\n\t\t\tfor ( const mutation of mutations ) {\n\t\t\t\t// Fortunately it will never be both.\n\t\t\t\tthis._handleTextMutation( mutation, viewSelection );\n\t\t\t\tthis._handleTextNodeInsertion( mutation );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles situations when container's children mutated during input. This can happen when\n\t * the browser is trying to \"fix\" DOM in certain situations. For example, when the user starts to type\n\t * in `<p><a href=\"\"><i>Link{}</i></a></p>`, the browser might change the order of elements\n\t * to `<p><i><a href=\"\">Link</a>x{}</i></p>`. A similar situation happens when the spell checker\n\t * replaces a word wrapped with `<strong>` with a word wrapped with a `<b>` element.\n\t *\n\t * To handle such situations, the common DOM ancestor of all mutations is converted to the model representation\n\t * and then compared with the current model to calculate the proper text change.\n\t *\n\t * Note: Single text node insertion is handled in {@link #_handleTextNodeInsertion} and text node mutation is handled\n\t * in {@link #_handleTextMutation}).\n\t *\n\t * @private\n\t * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n\t * module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n\t * @param {module:engine/view/selection~Selection|null} viewSelection\n\t */\n\t_handleContainerChildrenMutations( mutations, viewSelection ) {\n\t\t// Get common ancestor of all mutations.\n\t\tconst mutationsCommonAncestor = getMutationsContainer( mutations );\n\n\t\t// Quit if there is no common ancestor.\n\t\tif ( !mutationsCommonAncestor ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst domConverter = this.editor.editing.view.domConverter;\n\n\t\t// Get common ancestor in DOM.\n\t\tconst domMutationCommonAncestor = domConverter.mapViewToDom( mutationsCommonAncestor );\n\n\t\t// Create fresh DomConverter so it will not use existing mapping and convert current DOM to model.\n\t\t// This wouldn't be needed if DomConverter would allow to create fresh view without checking any mappings.\n\t\tconst freshDomConverter = new DomConverter( this.editor.editing.view.document );\n\t\tconst modelFromCurrentDom = this.editor.data.toModel(\n\t\t\tfreshDomConverter.domToView( domMutationCommonAncestor )\n\t\t).getChild( 0 );\n\n\t\t// Current model.\n\t\tconst currentModel = this.editor.editing.mapper.toModelElement( mutationsCommonAncestor );\n\n\t\t// If common ancestor is not mapped, do not do anything. It probably is a parent of another view element.\n\t\t// That means that we would need to diff model elements (see `if` below). Better return early instead of\n\t\t// trying to get a reasonable model ancestor. It will fell into the `if` below anyway.\n\t\t// This situation happens for example for lists. If `<ul>` is a common ancestor, `currentModel` is `undefined`\n\t\t// because `<ul>` is not mapped (`<li>`s are).\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/718.\n\t\tif ( !currentModel ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get children from both ancestors.\n\t\tconst modelFromDomChildren = Array.from( modelFromCurrentDom.getChildren() );\n\t\tconst currentModelChildren = Array.from( currentModel.getChildren() );\n\n\t\t// Remove the last `<softBreak>` from the end of `modelFromDomChildren` if there is no `<softBreak>` in current model.\n\t\t// If the described scenario happened, it means that this is a bogus `<br />` added by a browser.\n\t\tconst lastDomChild = modelFromDomChildren[ modelFromDomChildren.length - 1 ];\n\t\tconst lastCurrentChild = currentModelChildren[ currentModelChildren.length - 1 ];\n\n\t\tconst isLastDomChildSoftBreak = lastDomChild && lastDomChild.is( 'element', 'softBreak' );\n\t\tconst isLastCurrentChildSoftBreak = lastCurrentChild && !lastCurrentChild.is( 'element', 'softBreak' );\n\n\t\tif ( isLastDomChildSoftBreak && isLastCurrentChildSoftBreak ) {\n\t\t\tmodelFromDomChildren.pop();\n\t\t}\n\n\t\tconst schema = this.editor.model.schema;\n\n\t\t// Skip situations when common ancestor has any container elements.\n\t\tif ( !isSafeForTextMutation( modelFromDomChildren, schema ) || !isSafeForTextMutation( currentModelChildren, schema ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace &nbsp; inserted by the browser with normal space. See comment in `_handleTextMutation`.\n\t\t// Replace non-texts with any character. This is potentially dangerous but passes in manual tests. The thing is\n\t\t// that we need to take care of proper indexes so we cannot simply remove non-text elements from the content.\n\t\t// By inserting a character we keep all the real texts on their indexes.\n\t\tconst newText = modelFromDomChildren.map( item => item.is( '$text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\n\t\tconst oldText = currentModelChildren.map( item => item.is( '$text' ) ? item.data : '@' ).join( '' ).replace( /\\u00A0/g, ' ' );\n\n\t\t// Do nothing if mutations created same text.\n\t\tif ( oldText === newText ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diffResult = diff( oldText, newText );\n\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\n\n\t\t// Try setting new model selection according to passed view selection.\n\t\tlet modelSelectionRange = null;\n\n\t\tif ( viewSelection ) {\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\n\t\t}\n\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\n\t\tconst removeRange = this.editor.model.createRange(\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt ),\n\t\t\tthis.editor.model.createPositionAt( currentModel, firstChangeAt + deletions )\n\t\t);\n\n\t\tthis.editor.execute( 'input', {\n\t\t\ttext: insertText,\n\t\t\trange: removeRange,\n\t\t\tresultRange: modelSelectionRange\n\t\t} );\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_handleTextMutation( mutation, viewSelection ) {\n\t\tif ( mutation.type != 'text' ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Replace &nbsp; inserted by the browser with normal space.\n\t\t// We want only normal spaces in the model and in the view. Renderer and DOM Converter will be then responsible\n\t\t// for rendering consecutive spaces using &nbsp;, but the model and the view has to be clear.\n\t\t// Other feature may introduce inserting non-breakable space on specific key stroke (for example shift + space).\n\t\t// However then it will be handled outside of mutations, like enter key is.\n\t\t// The replacing is here because it has to be done before `diff` and `diffToChanges` functions, as they\n\t\t// take `newText` and compare it to (cleaned up) view.\n\t\t// It could also be done in mutation observer too, however if any outside plugin would like to\n\t\t// introduce additional events for mutations, they would get already cleaned up version (this may be good or not).\n\t\tconst newText = mutation.newText.replace( /\\u00A0/g, ' ' );\n\t\t// To have correct `diffResult`, we also compare view node text data with &nbsp; replaced by space.\n\t\tconst oldText = mutation.oldText.replace( /\\u00A0/g, ' ' );\n\n\t\t// Do nothing if mutations created same text.\n\t\tif ( oldText === newText ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diffResult = diff( oldText, newText );\n\n\t\tconst { firstChangeAt, insertions, deletions } = calculateChanges( diffResult );\n\n\t\t// Try setting new model selection according to passed view selection.\n\t\tlet modelSelectionRange = null;\n\n\t\tif ( viewSelection ) {\n\t\t\tmodelSelectionRange = this.editing.mapper.toModelRange( viewSelection.getFirstRange() );\n\t\t}\n\n\t\t// Get the position in view and model where the changes will happen.\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, firstChangeAt );\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\n\t\tconst removeRange = this.editor.model.createRange( modelPos, modelPos.getShiftedBy( deletions ) );\n\t\tconst insertText = newText.substr( firstChangeAt, insertions );\n\n\t\tthis.editor.execute( 'input', {\n\t\t\ttext: insertText,\n\t\t\trange: removeRange,\n\t\t\tresultRange: modelSelectionRange\n\t\t} );\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_handleTextNodeInsertion( mutation ) {\n\t\tif ( mutation.type != 'children' ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst change = getSingleTextNodeChange( mutation );\n\t\tconst viewPos = this.editing.view.createPositionAt( mutation.node, change.index );\n\t\tconst modelPos = this.editing.mapper.toModelPosition( viewPos );\n\t\tconst insertedText = change.values[ 0 ].data;\n\n\t\tthis.editor.execute( 'input', {\n\t\t\t// Replace &nbsp; inserted by the browser with normal space.\n\t\t\t// See comment in `_handleTextMutation`.\n\t\t\t// In this case we don't need to do this before `diff` because we diff whole nodes.\n\t\t\t// Just change &nbsp; in case there are some.\n\t\t\ttext: insertedText.replace( /\\u00A0/g, ' ' ),\n\t\t\trange: this.editor.model.createRange( modelPos )\n\t\t} );\n\t}\n}\n\n// Returns first common ancestor of all mutations that is either {@link module:engine/view/containerelement~ContainerElement}\n// or {@link module:engine/view/rootelement~RootElement}.\n//\n// @private\n// @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|\n// module:engine/view/observer/mutationobserver~MutatedChildren>} mutations\n// @returns {module:engine/view/containerelement~ContainerElement|engine/view/rootelement~RootElement|undefined}\nfunction getMutationsContainer( mutations ) {\n\tconst lca = mutations\n\t\t.map( mutation => mutation.node )\n\t\t.reduce( ( commonAncestor, node ) => {\n\t\t\treturn commonAncestor.getCommonAncestor( node, { includeSelf: true } );\n\t\t} );\n\n\tif ( !lca ) {\n\t\treturn;\n\t}\n\n\t// We need to look for container and root elements only, so check all LCA's\n\t// ancestors (starting from itself).\n\treturn lca.getAncestors( { includeSelf: true, parentFirst: true } )\n\t\t.find( element => element.is( 'containerElement' ) || element.is( 'rootElement' ) );\n}\n\n// Returns true if provided array contains content that won't be problematic during diffing and text mutation handling.\n//\n// @param {Array.<module:engine/model/node~Node>} children\n// @param {module:engine/model/schema~Schema} schema\n// @returns {Boolean}\nfunction isSafeForTextMutation( children, schema ) {\n\treturn children.every( child => schema.isInline( child ) );\n}\n\n// Calculates first change index and number of characters that should be inserted and deleted starting from that index.\n//\n// @private\n// @param diffResult\n// @returns {{insertions: number, deletions: number, firstChangeAt: *}}\nfunction calculateChanges( diffResult ) {\n\t// Index where the first change happens. Used to set the position from which nodes will be removed and where will be inserted.\n\tlet firstChangeAt = null;\n\t// Index where the last change happens. Used to properly count how many characters have to be removed and inserted.\n\tlet lastChangeAt = null;\n\n\t// Get `firstChangeAt` and `lastChangeAt`.\n\tfor ( let i = 0; i < diffResult.length; i++ ) {\n\t\tconst change = diffResult[ i ];\n\n\t\tif ( change != 'equal' ) {\n\t\t\tfirstChangeAt = firstChangeAt === null ? i : firstChangeAt;\n\t\t\tlastChangeAt = i;\n\t\t}\n\t}\n\n\t// How many characters, starting from `firstChangeAt`, should be removed.\n\tlet deletions = 0;\n\t// How many characters, starting from `firstChangeAt`, should be inserted.\n\tlet insertions = 0;\n\n\tfor ( let i = firstChangeAt; i <= lastChangeAt; i++ ) {\n\t\t// If there is no change (equal) or delete, the character is existing in `oldText`. We count it for removing.\n\t\tif ( diffResult[ i ] != 'insert' ) {\n\t\t\tdeletions++;\n\t\t}\n\n\t\t// If there is no change (equal) or insert, the character is existing in `newText`. We count it for inserting.\n\t\tif ( diffResult[ i ] != 'delete' ) {\n\t\t\tinsertions++;\n\t\t}\n\t}\n\n\treturn { insertions, deletions, firstChangeAt };\n}\n"]}]}