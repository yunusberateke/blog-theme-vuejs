{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-widget/src/widget.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-widget/src/widget.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfY3JlYXRlU3VwZXIgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zZXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmFuY2hvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZnJvbS5qcyI7CgovKioKICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjEsIENLU291cmNlIC0gRnJlZGVyaWNvIEtuYWJiZW4uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLW9zcy1saWNlbnNlCiAqLwoKLyoqCiAqIEBtb2R1bGUgd2lkZ2V0L3dpZGdldAogKi8KaW1wb3J0IFBsdWdpbiBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWNvcmUvc3JjL3BsdWdpbic7CmltcG9ydCBNb3VzZU9ic2VydmVyIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtZW5naW5lL3NyYy92aWV3L29ic2VydmVyL21vdXNlb2JzZXJ2ZXInOwppbXBvcnQgV2lkZ2V0VHlwZUFyb3VuZCBmcm9tICcuL3dpZGdldHR5cGVhcm91bmQvd2lkZ2V0dHlwZWFyb3VuZCc7CmltcG9ydCBEZWxldGUgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS10eXBpbmcvc3JjL2RlbGV0ZSc7CmltcG9ydCB7IGdldExhYmVsLCBpc1dpZGdldCwgV0lER0VUX1NFTEVDVEVEX0NMQVNTX05BTUUgfSBmcm9tICcuL3V0aWxzJzsKaW1wb3J0IHsgaXNGb3J3YXJkQXJyb3dLZXlDb2RlIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9zcmMva2V5Ym9hcmQnOwppbXBvcnQgZW52IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvc3JjL2Vudic7CmltcG9ydCAnLi4vdGhlbWUvd2lkZ2V0LmNzcyc7CmltcG9ydCB2ZXJ0aWNhbE5hdmlnYXRpb25IYW5kbGVyIGZyb20gJy4vdmVydGljYWxuYXZpZ2F0aW9uJzsKLyoqCiAqIFRoZSB3aWRnZXQgcGx1Z2luLiBJdCBlbmFibGVzIGJhc2Ugc3VwcG9ydCBmb3Igd2lkZ2V0cy4KICoKICogU2VlIHtAZ2xpbmsgYXBpL3dpZGdldCBwYWNrYWdlIHBhZ2V9IGZvciBtb3JlIGRldGFpbHMgYW5kIGRvY3VtZW50YXRpb24uCiAqCiAqIFRoaXMgcGx1Z2luIGVuYWJsZXMgbXVsdGlwbGUgYmVoYXZpb3JzIHJlcXVpcmVkIGJ5IHdpZGdldHM6CiAqCiAqICogVGhlIG1vZGVsIHRvIHZpZXcgc2VsZWN0aW9uIGNvbnZlcnRlciBmb3IgdGhlIGVkaXRpbmcgcGlwZWxpbmUgKGl0IGhhbmRsZXMgd2lkZ2V0IGN1c3RvbSBzZWxlY3Rpb24gcmVuZGVyaW5nKS4KICogSWYgYSBjb252ZXJ0ZWQgc2VsZWN0aW9uIHdyYXBzIGFyb3VuZCBhIHdpZGdldCBlbGVtZW50LCB0aGF0IHNlbGVjdGlvbiBpcyBtYXJrZWQgYXMKICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0aW9uI2lzRmFrZSBmYWtlfS4gQWRkaXRpb25hbGx5LCB0aGUgYGNrLXdpZGdldF9zZWxlY3RlZGAgQ1NTIGNsYXNzCiAqIGlzIGFkZGVkIHRvIGluZGljYXRlIHRoYXQgd2lkZ2V0IGhhcyBiZWVuIHNlbGVjdGVkLgogKiAqIFRoZSBtb3VzZSBhbmQga2V5Ym9hcmQgZXZlbnRzIGhhbmRsaW5nIG9uIGFuZCBhcm91bmQgd2lkZ2V0IGVsZW1lbnRzLgogKgogKiBAZXh0ZW5kcyBtb2R1bGU6Y29yZS9wbHVnaW5+UGx1Z2luCiAqLwoKdmFyIFdpZGdldCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BsdWdpbikgewogIF9pbmhlcml0cyhXaWRnZXQsIF9QbHVnaW4pOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKFdpZGdldCk7CgogIGZ1bmN0aW9uIFdpZGdldCgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXaWRnZXQpOwoKICAgIHJldHVybiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIF9jcmVhdGVDbGFzcyhXaWRnZXQsIFt7CiAgICBrZXk6ICJpbml0IiwKICAgIHZhbHVlOgogICAgLyoqCiAgICAgKiBAaW5oZXJpdERvYwogICAgICovCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHZpZXcgPSB0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXc7CiAgICAgIHZhciB2aWV3RG9jdW1lbnQgPSB2aWV3LmRvY3VtZW50OwogICAgICAvKioKICAgICAgICogSG9sZHMgcHJldmlvdXNseSBzZWxlY3RlZCB3aWRnZXRzLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKiBAdHlwZSB7U2V0Ljxtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50Pn0KICAgICAgICovCgogICAgICB0aGlzLl9wcmV2aW91c2x5U2VsZWN0ZWQgPSBuZXcgU2V0KCk7IC8vIE1vZGVsIHRvIHZpZXcgc2VsZWN0aW9uIGNvbnZlcnRlci4KICAgICAgLy8gQ29udmVydHMgc2VsZWN0aW9uIHBsYWNlZCBvdmVyIHdpZGdldCBlbGVtZW50IHRvIGZha2Ugc2VsZWN0aW9uCgogICAgICB0aGlzLmVkaXRvci5lZGl0aW5nLmRvd25jYXN0RGlzcGF0Y2hlci5vbignc2VsZWN0aW9uJywgZnVuY3Rpb24gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSkgewogICAgICAgIC8vIFJlbW92ZSBzZWxlY3RlZCBjbGFzcyBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgd2lkZ2V0cy4KICAgICAgICBfdGhpcy5fY2xlYXJQcmV2aW91c2x5U2VsZWN0ZWRXaWRnZXRzKGNvbnZlcnNpb25BcGkud3JpdGVyKTsKCiAgICAgICAgdmFyIHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjsKICAgICAgICB2YXIgdmlld1NlbGVjdGlvbiA9IHZpZXdXcml0ZXIuZG9jdW1lbnQuc2VsZWN0aW9uOwogICAgICAgIHZhciBzZWxlY3RlZEVsZW1lbnQgPSB2aWV3U2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpOwogICAgICAgIHZhciBsYXN0TWFya2VkID0gbnVsbDsKCiAgICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHZpZXdTZWxlY3Rpb24uZ2V0UmFuZ2VzKCkpLAogICAgICAgICAgICBfc3RlcDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciByYW5nZSA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihyYW5nZSksCiAgICAgICAgICAgICAgICBfc3RlcDI7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHZhbHVlLml0ZW07IC8vIERvIG5vdCBtYXJrIG5lc3RlZCB3aWRnZXRzIGluIHNlbGVjdGVkIG9uZS4gU2VlOiAjNTcuCgogICAgICAgICAgICAgICAgaWYgKGlzV2lkZ2V0KG5vZGUpICYmICFpc0NoaWxkKG5vZGUsIGxhc3RNYXJrZWQpKSB7CiAgICAgICAgICAgICAgICAgIHZpZXdXcml0ZXIuYWRkQ2xhc3MoV0lER0VUX1NFTEVDVEVEX0NMQVNTX05BTUUsIG5vZGUpOwoKICAgICAgICAgICAgICAgICAgX3RoaXMuX3ByZXZpb3VzbHlTZWxlY3RlZC5hZGQobm9kZSk7CgogICAgICAgICAgICAgICAgICBsYXN0TWFya2VkID0gbm9kZTsgLy8gQ2hlY2sgaWYgd2lkZ2V0IGlzIGEgc2luZ2xlIGVsZW1lbnQgc2VsZWN0ZWQuCgogICAgICAgICAgICAgICAgICBpZiAobm9kZSA9PSBzZWxlY3RlZEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICB2aWV3V3JpdGVyLnNldFNlbGVjdGlvbih2aWV3U2VsZWN0aW9uLmdldFJhbmdlcygpLCB7CiAgICAgICAgICAgICAgICAgICAgICBmYWtlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGdldExhYmVsKHNlbGVjdGVkRWxlbWVudCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgcHJpb3JpdHk6ICdsb3cnCiAgICAgIH0pOyAvLyBJZiBtb3VzZSBkb3duIGlzIHByZXNzZWQgb24gd2lkZ2V0IC0gY3JlYXRlIHNlbGVjdGlvbiBvdmVyIHdob2xlIHdpZGdldC4KCiAgICAgIHZpZXcuYWRkT2JzZXJ2ZXIoTW91c2VPYnNlcnZlcik7CiAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAnbW91c2Vkb3duJywgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpcy5fb25Nb3VzZWRvd24uYXBwbHkoX3RoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0pOyAvLyBUaGVyZSBhcmUgdHdvIGtleWRvd24gbGlzdGVuZXJzIHdvcmtpbmcgb24gZGlmZmVyZW50IHByaW9yaXRpZXMuIFRoaXMgYWxsb3dzIG90aGVyCiAgICAgIC8vIGZlYXR1cmVzIHN1Y2ggYXMgV2lkZ2V0VHlwZUFyb3VuZCBvciBUYWJsZUtleWJvYXJkIHRvIGF0dGFjaCB0aGVpciBsaXN0ZW5lcnMgaW4gYmV0d2VlbgogICAgICAvLyBhbmQgY3VzdG9taXplIHRoZSBiZWhhdmlvciBldmVuIGZ1cnRoZXIgaW4gZGlmZmVyZW50IGNvbnRlbnQvc2VsZWN0aW9uIHNjZW5hcmlvcy4KICAgICAgLy8KICAgICAgLy8gKiBUaGUgZmlyc3QgbGlzdGVuZXIgaGFuZGxlcyBjaGFuZ2luZyB0aGUgc2VsZWN0aW9uIG9uIGFycm93IGtleSBwcmVzcwogICAgICAvLyBpZiB0aGUgd2lkZ2V0IGlzIHNlbGVjdGVkIG9yIGlmIHRoZSBzZWxlY3Rpb24gaXMgbmV4dCB0byBhIHdpZGdldCBhbmQgdGhlIHdpZGdldAogICAgICAvLyBzaG91bGQgYmVjb21lIHNlbGVjdGVkIHVwb24gdGhlIGFycm93IGtleSBwcmVzcy4KICAgICAgLy8KICAgICAgLy8gKiBUaGUgc2Vjb25kIChsYXRlKSBsaXN0ZW5lciBtYWtlcyBzdXJlIHRoZSBkZWZhdWx0IGJyb3dzZXIgYWN0aW9uIG9uIGFycm93IGtleSBwcmVzcyBpcwogICAgICAvLyBwcmV2ZW50ZWQgd2hlbiBhIHdpZGdldCBpcyBzZWxlY3RlZC4gVGhpcyBwcmV2ZW50cyB0aGUgc2VsZWN0aW9uIGZyb20gYmVpbmcgbW92ZWQKICAgICAgLy8gZnJvbSBhIGZha2Ugc2VsZWN0aW9uIGNvbnRhaW5lci4KCiAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAnYXJyb3dLZXknLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuX2hhbmRsZVNlbGVjdGlvbkNoYW5nZU9uQXJyb3dLZXlQcmVzcy5hcHBseShfdGhpcywgYXJndW1lbnRzKTsKICAgICAgfSwgewogICAgICAgIGNvbnRleHQ6IFtpc1dpZGdldCwgJyR0ZXh0J10KICAgICAgfSk7CiAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAnYXJyb3dLZXknLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuX3ByZXZlbnREZWZhdWx0T25BcnJvd0tleVByZXNzLmFwcGx5KF90aGlzLCBhcmd1bWVudHMpOwogICAgICB9LCB7CiAgICAgICAgY29udGV4dDogJyRyb290JwogICAgICB9KTsKICAgICAgdGhpcy5saXN0ZW5Ubyh2aWV3RG9jdW1lbnQsICdhcnJvd0tleScsIHZlcnRpY2FsTmF2aWdhdGlvbkhhbmRsZXIodGhpcy5lZGl0b3IuZWRpdGluZyksIHsKICAgICAgICBjb250ZXh0OiAnJHRleHQnCiAgICAgIH0pOyAvLyBIYW5kbGUgY3VzdG9tIGRlbGV0ZSBiZWhhdmlvdXIuCgogICAgICB0aGlzLmxpc3RlblRvKHZpZXdEb2N1bWVudCwgJ2RlbGV0ZScsIGZ1bmN0aW9uIChldnQsIGRhdGEpIHsKICAgICAgICBpZiAoX3RoaXMuX2hhbmRsZURlbGV0ZShkYXRhLmRpcmVjdGlvbiA9PSAnZm9yd2FyZCcpKSB7CiAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBldnQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGNvbnRleHQ6ICckcm9vdCcKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEhhbmRsZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDptb3VzZWRvd24gbW91c2Vkb3dufSBldmVudHMgb24gd2lkZ2V0IGVsZW1lbnRzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9ldmVudGluZm9+RXZlbnRJbmZvfSBldmVudEluZm8KICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2RvbWV2ZW50ZGF0YX5Eb21FdmVudERhdGF9IGRvbUV2ZW50RGF0YQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9vbk1vdXNlZG93biIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uTW91c2Vkb3duKGV2ZW50SW5mbywgZG9tRXZlbnREYXRhKSB7CiAgICAgIHZhciBlZGl0b3IgPSB0aGlzLmVkaXRvcjsKICAgICAgdmFyIHZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3OwogICAgICB2YXIgdmlld0RvY3VtZW50ID0gdmlldy5kb2N1bWVudDsKICAgICAgdmFyIGVsZW1lbnQgPSBkb21FdmVudERhdGEudGFyZ2V0OyAvLyBEbyBub3RoaW5nIGZvciBzaW5nbGUgb3IgZG91YmxlIGNsaWNrIGluc2lkZSBuZXN0ZWQgZWRpdGFibGUuCgogICAgICBpZiAoaXNJbnNpZGVOZXN0ZWRFZGl0YWJsZShlbGVtZW50KSkgewogICAgICAgIC8vIEJ1dCBhdCBsZWFzdCB0cmlwbGUgY2xpY2sgaW5zaWRlIG5lc3RlZCBlZGl0YWJsZSBjYXVzZXMgYnJva2VuIHNlbGVjdGlvbiBpbiBTYWZhcmkuCiAgICAgICAgLy8gRm9yIHN1Y2ggZXZlbnQsIHdlIHNlbGVjdCB0aGUgZW50aXJlIG5lc3RlZCBlZGl0YWJsZSBlbGVtZW50LgogICAgICAgIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTQ2My4KICAgICAgICBpZiAoKGVudi5pc1NhZmFyaSB8fCBlbnYuaXNHZWNrbykgJiYgZG9tRXZlbnREYXRhLmRvbUV2ZW50LmRldGFpbCA+PSAzKSB7CiAgICAgICAgICB2YXIgbWFwcGVyID0gZWRpdG9yLmVkaXRpbmcubWFwcGVyOwogICAgICAgICAgdmFyIHZpZXdFbGVtZW50ID0gZWxlbWVudC5pcygnYXR0cmlidXRlRWxlbWVudCcpID8gZWxlbWVudC5maW5kQW5jZXN0b3IoZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgcmV0dXJuICFlbGVtZW50LmlzKCdhdHRyaWJ1dGVFbGVtZW50Jyk7CiAgICAgICAgICB9KSA6IGVsZW1lbnQ7CgogICAgICAgICAgdmFyIF9tb2RlbEVsZW1lbnQgPSBtYXBwZXIudG9Nb2RlbEVsZW1lbnQodmlld0VsZW1lbnQpOwoKICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgdGhpcy5lZGl0b3IubW9kZWwuY2hhbmdlKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihfbW9kZWxFbGVtZW50LCAnaW4nKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIElmIHRhcmdldCBpcyBub3QgYSB3aWRnZXQgZWxlbWVudCAtIGNoZWNrIGlmIG9uZSBvZiB0aGUgYW5jZXN0b3JzIGlzLgoKCiAgICAgIGlmICghaXNXaWRnZXQoZWxlbWVudCkpIHsKICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5maW5kQW5jZXN0b3IoaXNXaWRnZXQpOwoKICAgICAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gLy8gT24gQW5kcm9pZCBzZWxlY3Rpb24gd291bGQganVtcCB0byB0aGUgZmlyc3QgdGFibGUgY2VsbCwgb24gb3RoZXIgZGV2aWNlcwogICAgICAvLyB3ZSBjYW4ndCBibG9jayBpdCAoYW5kIGRvbid0IG5lZWQgdG8pIGJlY2F1c2Ugb2YgZHJhZyBhbmQgZHJvcCBzdXBwb3J0LgoKCiAgICAgIGlmIChlbnYuaXNBbmRyb2lkKSB7CiAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0gLy8gRm9jdXMgZWRpdG9yIGlmIGlzIG5vdCBmb2N1c2VkIGFscmVhZHkuCgoKICAgICAgaWYgKCF2aWV3RG9jdW1lbnQuaXNGb2N1c2VkKSB7CiAgICAgICAgdmlldy5mb2N1cygpOwogICAgICB9IC8vIENyZWF0ZSBtb2RlbCBzZWxlY3Rpb24gb3ZlciB3aWRnZXQuCgoKICAgICAgdmFyIG1vZGVsRWxlbWVudCA9IGVkaXRvci5lZGl0aW5nLm1hcHBlci50b01vZGVsRWxlbWVudChlbGVtZW50KTsKCiAgICAgIHRoaXMuX3NldFNlbGVjdGlvbk92ZXJFbGVtZW50KG1vZGVsRWxlbWVudCk7CiAgICB9CiAgICAvKioKICAgICAqIEhhbmRsZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDprZXlkb3duIGtleWRvd259IGV2ZW50cyBhbmQgY2hhbmdlcwogICAgICogdGhlIG1vZGVsIHNlbGVjdGlvbiB3aGVuOgogICAgICoKICAgICAqICogYXJyb3cga2V5IGlzIHByZXNzZWQgd2hlbiB0aGUgd2lkZ2V0IGlzIHNlbGVjdGVkLAogICAgICogKiB0aGUgc2VsZWN0aW9uIGlzIG5leHQgdG8gYSB3aWRnZXQgYW5kIHRoZSB3aWRnZXQgc2hvdWxkIGJlY29tZSBzZWxlY3RlZCB1cG9uIHRoZSBhcnJvdyBrZXkgcHJlc3MuCiAgICAgKgogICAgICogU2VlIHtAbGluayAjX3ByZXZlbnREZWZhdWx0T25BcnJvd0tleVByZXNzfS4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHttb2R1bGU6dXRpbHMvZXZlbnRpbmZvfkV2ZW50SW5mb30gZXZlbnRJbmZvCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9kb21ldmVudGRhdGF+RG9tRXZlbnREYXRhfSBkb21FdmVudERhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfaGFuZGxlU2VsZWN0aW9uQ2hhbmdlT25BcnJvd0tleVByZXNzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlU2VsZWN0aW9uQ2hhbmdlT25BcnJvd0tleVByZXNzKGV2ZW50SW5mbywgZG9tRXZlbnREYXRhKSB7CiAgICAgIHZhciBrZXlDb2RlID0gZG9tRXZlbnREYXRhLmtleUNvZGU7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsOwogICAgICB2YXIgc2NoZW1hID0gbW9kZWwuc2NoZW1hOwogICAgICB2YXIgbW9kZWxTZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247CiAgICAgIHZhciBvYmplY3RFbGVtZW50ID0gbW9kZWxTZWxlY3Rpb24uZ2V0U2VsZWN0ZWRFbGVtZW50KCk7CiAgICAgIHZhciBpc0ZvcndhcmQgPSBpc0ZvcndhcmRBcnJvd0tleUNvZGUoa2V5Q29kZSwgdGhpcy5lZGl0b3IubG9jYWxlLmNvbnRlbnRMYW5ndWFnZURpcmVjdGlvbik7IC8vIElmIG9iamVjdCBlbGVtZW50IGlzIHNlbGVjdGVkLgoKICAgICAgaWYgKG9iamVjdEVsZW1lbnQgJiYgc2NoZW1hLmlzT2JqZWN0KG9iamVjdEVsZW1lbnQpKSB7CiAgICAgICAgdmFyIHBvc2l0aW9uID0gaXNGb3J3YXJkID8gbW9kZWxTZWxlY3Rpb24uZ2V0TGFzdFBvc2l0aW9uKCkgOiBtb2RlbFNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7CiAgICAgICAgdmFyIG5ld1JhbmdlID0gc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZShwb3NpdGlvbiwgaXNGb3J3YXJkID8gJ2ZvcndhcmQnIDogJ2JhY2t3YXJkJyk7CgogICAgICAgIGlmIChuZXdSYW5nZSkgewogICAgICAgICAgbW9kZWwuY2hhbmdlKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihuZXdSYW5nZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgZXZlbnRJbmZvLnN0b3AoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBJZiBzZWxlY3Rpb24gaXMgbmV4dCB0byBvYmplY3QgZWxlbWVudC4KICAgICAgLy8gUmV0dXJuIGlmIG5vdCBjb2xsYXBzZWQuCgoKICAgICAgaWYgKCFtb2RlbFNlbGVjdGlvbi5pc0NvbGxhcHNlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIG9iamVjdEVsZW1lbnROZXh0VG9TZWxlY3Rpb24gPSB0aGlzLl9nZXRPYmplY3RFbGVtZW50TmV4dFRvU2VsZWN0aW9uKGlzRm9yd2FyZCk7CgogICAgICBpZiAob2JqZWN0RWxlbWVudE5leHRUb1NlbGVjdGlvbiAmJiBzY2hlbWEuaXNPYmplY3Qob2JqZWN0RWxlbWVudE5leHRUb1NlbGVjdGlvbikpIHsKICAgICAgICB0aGlzLl9zZXRTZWxlY3Rpb25PdmVyRWxlbWVudChvYmplY3RFbGVtZW50TmV4dFRvU2VsZWN0aW9uKTsKCiAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZXZlbnRJbmZvLnN0b3AoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBIYW5kbGVzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6a2V5ZG93biBrZXlkb3dufSBldmVudHMgYW5kIHByZXZlbnRzCiAgICAgKiB0aGUgZGVmYXVsdCBicm93c2VyIGJlaGF2aW9yIHRvIG1ha2Ugc3VyZSB0aGUgZmFrZSBzZWxlY3Rpb24gaXMgbm90IGJlaW5nIG1vdmVkIGZyb20gYSBmYWtlIHNlbGVjdGlvbgogICAgICogY29udGFpbmVyLgogICAgICoKICAgICAqIFNlZSB7QGxpbmsgI19oYW5kbGVTZWxlY3Rpb25DaGFuZ2VPbkFycm93S2V5UHJlc3N9LgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge21vZHVsZTp1dGlscy9ldmVudGluZm9+RXZlbnRJbmZvfSBldmVudEluZm8KICAgICAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2RvbWV2ZW50ZGF0YX5Eb21FdmVudERhdGF9IGRvbUV2ZW50RGF0YQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9wcmV2ZW50RGVmYXVsdE9uQXJyb3dLZXlQcmVzcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3ByZXZlbnREZWZhdWx0T25BcnJvd0tleVByZXNzKGV2ZW50SW5mbywgZG9tRXZlbnREYXRhKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsOwogICAgICB2YXIgc2NoZW1hID0gbW9kZWwuc2NoZW1hOwogICAgICB2YXIgb2JqZWN0RWxlbWVudCA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTsgLy8gSWYgb2JqZWN0IGVsZW1lbnQgaXMgc2VsZWN0ZWQuCgogICAgICBpZiAob2JqZWN0RWxlbWVudCAmJiBzY2hlbWEuaXNPYmplY3Qob2JqZWN0RWxlbWVudCkpIHsKICAgICAgICBkb21FdmVudERhdGEucHJldmVudERlZmF1bHQoKTsKICAgICAgICBldmVudEluZm8uc3RvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEhhbmRsZXMgZGVsZXRlIGtleXM6IGJhY2tzcGFjZSBhbmQgZGVsZXRlLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzRm9yd2FyZCBTZXQgdG8gdHJ1ZSBpZiBkZWxldGUgd2FzIHBlcmZvcm1lZCBpbiBmb3J3YXJkIGRpcmVjdGlvbi4KICAgICAqIEByZXR1cm5zIHtCb29sZWFufHVuZGVmaW5lZH0gUmV0dXJucyBgdHJ1ZWAgaWYga2V5cyB3ZXJlIGhhbmRsZWQgY29ycmVjdGx5LgogICAgICovCgogIH0sIHsKICAgIGtleTogIl9oYW5kbGVEZWxldGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVEZWxldGUoaXNGb3J3YXJkKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgLy8gRG8gbm90aGluZyB3aGVuIHRoZSByZWFkIG9ubHkgbW9kZSBpcyBlbmFibGVkLgogICAgICBpZiAodGhpcy5lZGl0b3IuaXNSZWFkT25seSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIG1vZGVsRG9jdW1lbnQgPSB0aGlzLmVkaXRvci5tb2RlbC5kb2N1bWVudDsKICAgICAgdmFyIG1vZGVsU2VsZWN0aW9uID0gbW9kZWxEb2N1bWVudC5zZWxlY3Rpb247IC8vIERvIG5vdGhpbmcgb24gbm9uLWNvbGxhcHNlZCBzZWxlY3Rpb24uCgogICAgICBpZiAoIW1vZGVsU2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgb2JqZWN0RWxlbWVudCA9IHRoaXMuX2dldE9iamVjdEVsZW1lbnROZXh0VG9TZWxlY3Rpb24oaXNGb3J3YXJkKTsKCiAgICAgIGlmIChvYmplY3RFbGVtZW50KSB7CiAgICAgICAgdGhpcy5lZGl0b3IubW9kZWwuY2hhbmdlKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICAgIHZhciBwcmV2aW91c05vZGUgPSBtb2RlbFNlbGVjdGlvbi5hbmNob3IucGFyZW50OyAvLyBSZW1vdmUgcHJldmlvdXMgZWxlbWVudCBpZiBlbXB0eS4KCiAgICAgICAgICB3aGlsZSAocHJldmlvdXNOb2RlLmlzRW1wdHkpIHsKICAgICAgICAgICAgdmFyIG5vZGVUb1JlbW92ZSA9IHByZXZpb3VzTm9kZTsKICAgICAgICAgICAgcHJldmlvdXNOb2RlID0gbm9kZVRvUmVtb3ZlLnBhcmVudDsKICAgICAgICAgICAgd3JpdGVyLnJlbW92ZShub2RlVG9SZW1vdmUpOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMi5fc2V0U2VsZWN0aW9uT3ZlckVsZW1lbnQob2JqZWN0RWxlbWVudCk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9uIGRvY3VtZW50J3Mgc2VsZWN0aW9ufSBvdmVyIGdpdmVuIGVsZW1lbnQuCiAgICAgKgogICAgICogQHByb3RlY3RlZAogICAgICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH0gZWxlbWVudAogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXRTZWxlY3Rpb25PdmVyRWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldFNlbGVjdGlvbk92ZXJFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgdGhpcy5lZGl0b3IubW9kZWwuY2hhbmdlKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKHdyaXRlci5jcmVhdGVSYW5nZU9uKGVsZW1lbnQpKTsKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrcyBpZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gcGxhY2VkIG5leHQgdG8gdGhlIGN1cnJlbnQKICAgICAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24gbW9kZWwgc2VsZWN0aW9ufSBleGlzdHMgYW5kIGlzIG1hcmtlZCBpbgogICAgICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSBzY2hlbWF9IGFzIGBvYmplY3RgLgogICAgICoKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gZm9yd2FyZCBEaXJlY3Rpb24gb2YgY2hlY2tpbmcuCiAgICAgKiBAcmV0dXJucyB7bW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnR8bnVsbH0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfZ2V0T2JqZWN0RWxlbWVudE5leHRUb1NlbGVjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldE9iamVjdEVsZW1lbnROZXh0VG9TZWxlY3Rpb24oZm9yd2FyZCkgewogICAgICB2YXIgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDsKICAgICAgdmFyIHNjaGVtYSA9IG1vZGVsLnNjaGVtYTsKICAgICAgdmFyIG1vZGVsU2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uOyAvLyBDbG9uZSBjdXJyZW50IHNlbGVjdGlvbiB0byB1c2UgaXQgYXMgYSBwcm9iZS4gV2UgbXVzdCBsZWF2ZSBkZWZhdWx0IHNlbGVjdGlvbiBhcyBpdCBpcyBzbyBpdCBjYW4gcmV0dXJuCiAgICAgIC8vIHRvIGl0cyBjdXJyZW50IHN0YXRlIGFmdGVyIHVuZG8uCgogICAgICB2YXIgcHJvYmUgPSBtb2RlbC5jcmVhdGVTZWxlY3Rpb24obW9kZWxTZWxlY3Rpb24pOwogICAgICBtb2RlbC5tb2RpZnlTZWxlY3Rpb24ocHJvYmUsIHsKICAgICAgICBkaXJlY3Rpb246IGZvcndhcmQgPyAnZm9yd2FyZCcgOiAnYmFja3dhcmQnCiAgICAgIH0pOwogICAgICB2YXIgb2JqZWN0RWxlbWVudCA9IGZvcndhcmQgPyBwcm9iZS5mb2N1cy5ub2RlQmVmb3JlIDogcHJvYmUuZm9jdXMubm9kZUFmdGVyOwoKICAgICAgaWYgKCEhb2JqZWN0RWxlbWVudCAmJiBzY2hlbWEuaXNPYmplY3Qob2JqZWN0RWxlbWVudCkpIHsKICAgICAgICByZXR1cm4gb2JqZWN0RWxlbWVudDsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgQ1NTIGNsYXNzIGZyb20gcHJldmlvdXNseSBzZWxlY3RlZCB3aWRnZXRzLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0gd3JpdGVyCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2NsZWFyUHJldmlvdXNseVNlbGVjdGVkV2lkZ2V0cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NsZWFyUHJldmlvdXNseVNlbGVjdGVkV2lkZ2V0cyh3cml0ZXIpIHsKICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLl9wcmV2aW91c2x5U2VsZWN0ZWQpLAogICAgICAgICAgX3N0ZXAzOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjMucygpOyAhKF9zdGVwMyA9IF9pdGVyYXRvcjMubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHdpZGdldCA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgIHdyaXRlci5yZW1vdmVDbGFzcyhXSURHRVRfU0VMRUNURURfQ0xBU1NfTkFNRSwgd2lkZ2V0KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjMuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjMuZigpOwogICAgICB9CgogICAgICB0aGlzLl9wcmV2aW91c2x5U2VsZWN0ZWQuY2xlYXIoKTsKICAgIH0KICB9XSwgW3sKICAgIGtleTogInBsdWdpbk5hbWUiLAogICAgZ2V0OgogICAgLyoqCiAgICAgKiBAaW5oZXJpdERvYwogICAgICovCiAgICBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiAnV2lkZ2V0JzsKICAgIH0KICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZXF1aXJlcyIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIFtXaWRnZXRUeXBlQXJvdW5kLCBEZWxldGVdOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFdpZGdldDsKfShQbHVnaW4pOyAvLyBSZXR1cm5zIGB0cnVlYCB3aGVuIGVsZW1lbnQgaXMgYSBuZXN0ZWQgZWRpdGFibGUgb3IgaXMgcGxhY2VkIGluc2lkZSBvbmUuCi8vCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudH0KLy8gQHJldHVybnMge0Jvb2xlYW59CgoKZXhwb3J0IHsgV2lkZ2V0IGFzIGRlZmF1bHQgfTsKCmZ1bmN0aW9uIGlzSW5zaWRlTmVzdGVkRWRpdGFibGUoZWxlbWVudCkgewogIHdoaWxlIChlbGVtZW50KSB7CiAgICBpZiAoZWxlbWVudC5pcygnZWRpdGFibGVFbGVtZW50JykgJiYgIWVsZW1lbnQuaXMoJ3Jvb3RFbGVtZW50JykpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IC8vIENsaWNrIG9uIG5lc3RlZCB3aWRnZXQgc2hvdWxkIHNlbGVjdCBpdC4KCgogICAgaWYgKGlzV2lkZ2V0KGVsZW1lbnQpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnQ7CiAgfQoKICByZXR1cm4gZmFsc2U7Cn0gLy8gQ2hlY2tzIHdoZXRoZXIgdGhlIHNwZWNpZmllZCBgZWxlbWVudGAgaXMgYSBjaGlsZCBvZiB0aGUgYHBhcmVudGAgZWxlbWVudC4KLy8KLy8gQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fSBlbGVtZW50IEFuIGVsZW1lbnQgdG8gY2hlY2suCi8vIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudHxudWxsfSBwYXJlbnQgQSBwYXJlbnQgZm9yIHRoZSBlbGVtZW50LgovLyBAcmV0dXJucyB7Qm9vbGVhbn0KCgpmdW5jdGlvbiBpc0NoaWxkKGVsZW1lbnQsIHBhcmVudCkgewogIGlmICghcGFyZW50KSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gQXJyYXkuZnJvbShlbGVtZW50LmdldEFuY2VzdG9ycygpKS5pbmNsdWRlcyhwYXJlbnQpOwp9"},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-widget/src/widget.js"],"names":["Plugin","MouseObserver","WidgetTypeAround","Delete","getLabel","isWidget","WIDGET_SELECTED_CLASS_NAME","isForwardArrowKeyCode","env","verticalNavigationHandler","Widget","view","editor","editing","viewDocument","document","_previouslySelected","Set","downcastDispatcher","on","evt","data","conversionApi","_clearPreviouslySelectedWidgets","writer","viewWriter","viewSelection","selection","selectedElement","getSelectedElement","lastMarked","getRanges","range","value","node","item","isChild","addClass","add","setSelection","fake","label","priority","addObserver","listenTo","_onMousedown","_handleSelectionChangeOnArrowKeyPress","context","_preventDefaultOnArrowKeyPress","_handleDelete","direction","preventDefault","stop","eventInfo","domEventData","element","target","isInsideNestedEditable","isSafari","isGecko","domEvent","detail","mapper","viewElement","is","findAncestor","modelElement","toModelElement","model","change","isAndroid","isFocused","focus","_setSelectionOverElement","keyCode","schema","modelSelection","objectElement","isForward","locale","contentLanguageDirection","isObject","position","getLastPosition","getFirstPosition","newRange","getNearestSelectionRange","isCollapsed","objectElementNextToSelection","_getObjectElementNextToSelection","isReadOnly","modelDocument","previousNode","anchor","parent","isEmpty","nodeToRemove","remove","createRangeOn","forward","probe","createSelection","modifySelection","nodeBefore","nodeAfter","widget","removeClass","clear","Array","from","getAncestors","includes"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module widget/widget\n */\n\nimport Plugin from '@ckeditor/ckeditor5-core/src/plugin';\nimport MouseObserver from '@ckeditor/ckeditor5-engine/src/view/observer/mouseobserver';\nimport WidgetTypeAround from './widgettypearound/widgettypearound';\nimport Delete from '@ckeditor/ckeditor5-typing/src/delete';\nimport { getLabel, isWidget, WIDGET_SELECTED_CLASS_NAME } from './utils';\nimport { isForwardArrowKeyCode } from '@ckeditor/ckeditor5-utils/src/keyboard';\nimport env from '@ckeditor/ckeditor5-utils/src/env';\n\nimport '../theme/widget.css';\nimport verticalNavigationHandler from './verticalnavigation';\n\n/**\n * The widget plugin. It enables base support for widgets.\n *\n * See {@glink api/widget package page} for more details and documentation.\n *\n * This plugin enables multiple behaviors required by widgets:\n *\n * * The model to view selection converter for the editing pipeline (it handles widget custom selection rendering).\n * If a converted selection wraps around a widget element, that selection is marked as\n * {@link module:engine/view/selection~Selection#isFake fake}. Additionally, the `ck-widget_selected` CSS class\n * is added to indicate that widget has been selected.\n * * The mouse and keyboard events handling on and around widget elements.\n *\n * @extends module:core/plugin~Plugin\n */\nexport default class Widget extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get pluginName() {\n\t\treturn 'Widget';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tstatic get requires() {\n\t\treturn [ WidgetTypeAround, Delete ];\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tinit() {\n\t\tconst view = this.editor.editing.view;\n\t\tconst viewDocument = view.document;\n\n\t\t/**\n\t\t * Holds previously selected widgets.\n\t\t *\n\t\t * @private\n\t\t * @type {Set.<module:engine/view/element~Element>}\n\t\t */\n\t\tthis._previouslySelected = new Set();\n\n\t\t// Model to view selection converter.\n\t\t// Converts selection placed over widget element to fake selection\n\t\tthis.editor.editing.downcastDispatcher.on( 'selection', ( evt, data, conversionApi ) => {\n\t\t\t// Remove selected class from previously selected widgets.\n\t\t\tthis._clearPreviouslySelectedWidgets( conversionApi.writer );\n\n\t\t\tconst viewWriter = conversionApi.writer;\n\t\t\tconst viewSelection = viewWriter.document.selection;\n\t\t\tconst selectedElement = viewSelection.getSelectedElement();\n\t\t\tlet lastMarked = null;\n\n\t\t\tfor ( const range of viewSelection.getRanges() ) {\n\t\t\t\tfor ( const value of range ) {\n\t\t\t\t\tconst node = value.item;\n\n\t\t\t\t\t// Do not mark nested widgets in selected one. See: #57.\n\t\t\t\t\tif ( isWidget( node ) && !isChild( node, lastMarked ) ) {\n\t\t\t\t\t\tviewWriter.addClass( WIDGET_SELECTED_CLASS_NAME, node );\n\n\t\t\t\t\t\tthis._previouslySelected.add( node );\n\t\t\t\t\t\tlastMarked = node;\n\n\t\t\t\t\t\t// Check if widget is a single element selected.\n\t\t\t\t\t\tif ( node == selectedElement ) {\n\t\t\t\t\t\t\tviewWriter.setSelection( viewSelection.getRanges(), { fake: true, label: getLabel( selectedElement ) } );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, { priority: 'low' } );\n\n\t\t// If mouse down is pressed on widget - create selection over whole widget.\n\t\tview.addObserver( MouseObserver );\n\t\tthis.listenTo( viewDocument, 'mousedown', ( ...args ) => this._onMousedown( ...args ) );\n\n\t\t// There are two keydown listeners working on different priorities. This allows other\n\t\t// features such as WidgetTypeAround or TableKeyboard to attach their listeners in between\n\t\t// and customize the behavior even further in different content/selection scenarios.\n\t\t//\n\t\t// * The first listener handles changing the selection on arrow key press\n\t\t// if the widget is selected or if the selection is next to a widget and the widget\n\t\t// should become selected upon the arrow key press.\n\t\t//\n\t\t// * The second (late) listener makes sure the default browser action on arrow key press is\n\t\t// prevented when a widget is selected. This prevents the selection from being moved\n\t\t// from a fake selection container.\n\t\tthis.listenTo( viewDocument, 'arrowKey', ( ...args ) => {\n\t\t\tthis._handleSelectionChangeOnArrowKeyPress( ...args );\n\t\t}, { context: [ isWidget, '$text' ] } );\n\n\t\tthis.listenTo( viewDocument, 'arrowKey', ( ...args ) => {\n\t\t\tthis._preventDefaultOnArrowKeyPress( ...args );\n\t\t}, { context: '$root' } );\n\n\t\tthis.listenTo( viewDocument, 'arrowKey', verticalNavigationHandler( this.editor.editing ), { context: '$text' } );\n\n\t\t// Handle custom delete behaviour.\n\t\tthis.listenTo( viewDocument, 'delete', ( evt, data ) => {\n\t\t\tif ( this._handleDelete( data.direction == 'forward' ) ) {\n\t\t\t\tdata.preventDefault();\n\t\t\t\tevt.stop();\n\t\t\t}\n\t\t}, { context: '$root' } );\n\t}\n\n\t/**\n\t * Handles {@link module:engine/view/document~Document#event:mousedown mousedown} events on widget elements.\n\t *\n\t * @private\n\t * @param {module:utils/eventinfo~EventInfo} eventInfo\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} domEventData\n\t */\n\t_onMousedown( eventInfo, domEventData ) {\n\t\tconst editor = this.editor;\n\t\tconst view = editor.editing.view;\n\t\tconst viewDocument = view.document;\n\t\tlet element = domEventData.target;\n\n\t\t// Do nothing for single or double click inside nested editable.\n\t\tif ( isInsideNestedEditable( element ) ) {\n\t\t\t// But at least triple click inside nested editable causes broken selection in Safari.\n\t\t\t// For such event, we select the entire nested editable element.\n\t\t\t// See: https://github.com/ckeditor/ckeditor5/issues/1463.\n\t\t\tif ( ( env.isSafari || env.isGecko ) && domEventData.domEvent.detail >= 3 ) {\n\t\t\t\tconst mapper = editor.editing.mapper;\n\t\t\t\tconst viewElement = element.is( 'attributeElement' ) ?\n\t\t\t\t\telement.findAncestor( element => !element.is( 'attributeElement' ) ) : element;\n\t\t\t\tconst modelElement = mapper.toModelElement( viewElement );\n\n\t\t\t\tdomEventData.preventDefault();\n\n\t\t\t\tthis.editor.model.change( writer => {\n\t\t\t\t\twriter.setSelection( modelElement, 'in' );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// If target is not a widget element - check if one of the ancestors is.\n\t\tif ( !isWidget( element ) ) {\n\t\t\telement = element.findAncestor( isWidget );\n\n\t\t\tif ( !element ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// On Android selection would jump to the first table cell, on other devices\n\t\t// we can't block it (and don't need to) because of drag and drop support.\n\t\tif ( env.isAndroid ) {\n\t\t\tdomEventData.preventDefault();\n\t\t}\n\n\t\t// Focus editor if is not focused already.\n\t\tif ( !viewDocument.isFocused ) {\n\t\t\tview.focus();\n\t\t}\n\n\t\t// Create model selection over widget.\n\t\tconst modelElement = editor.editing.mapper.toModelElement( element );\n\n\t\tthis._setSelectionOverElement( modelElement );\n\t}\n\n\t/**\n\t * Handles {@link module:engine/view/document~Document#event:keydown keydown} events and changes\n\t * the model selection when:\n\t *\n\t * * arrow key is pressed when the widget is selected,\n\t * * the selection is next to a widget and the widget should become selected upon the arrow key press.\n\t *\n\t * See {@link #_preventDefaultOnArrowKeyPress}.\n\t *\n\t * @private\n\t * @param {module:utils/eventinfo~EventInfo} eventInfo\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} domEventData\n\t */\n\t_handleSelectionChangeOnArrowKeyPress( eventInfo, domEventData ) {\n\t\tconst keyCode = domEventData.keyCode;\n\n\t\tconst model = this.editor.model;\n\t\tconst schema = model.schema;\n\t\tconst modelSelection = model.document.selection;\n\t\tconst objectElement = modelSelection.getSelectedElement();\n\t\tconst isForward = isForwardArrowKeyCode( keyCode, this.editor.locale.contentLanguageDirection );\n\n\t\t// If object element is selected.\n\t\tif ( objectElement && schema.isObject( objectElement ) ) {\n\t\t\tconst position = isForward ? modelSelection.getLastPosition() : modelSelection.getFirstPosition();\n\t\t\tconst newRange = schema.getNearestSelectionRange( position, isForward ? 'forward' : 'backward' );\n\n\t\t\tif ( newRange ) {\n\t\t\t\tmodel.change( writer => {\n\t\t\t\t\twriter.setSelection( newRange );\n\t\t\t\t} );\n\n\t\t\t\tdomEventData.preventDefault();\n\t\t\t\teventInfo.stop();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// If selection is next to object element.\n\t\t// Return if not collapsed.\n\t\tif ( !modelSelection.isCollapsed ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst objectElementNextToSelection = this._getObjectElementNextToSelection( isForward );\n\n\t\tif ( objectElementNextToSelection && schema.isObject( objectElementNextToSelection ) ) {\n\t\t\tthis._setSelectionOverElement( objectElementNextToSelection );\n\n\t\t\tdomEventData.preventDefault();\n\t\t\teventInfo.stop();\n\t\t}\n\t}\n\n\t/**\n\t * Handles {@link module:engine/view/document~Document#event:keydown keydown} events and prevents\n\t * the default browser behavior to make sure the fake selection is not being moved from a fake selection\n\t * container.\n\t *\n\t * See {@link #_handleSelectionChangeOnArrowKeyPress}.\n\t *\n\t * @private\n\t * @param {module:utils/eventinfo~EventInfo} eventInfo\n\t * @param {module:engine/view/observer/domeventdata~DomEventData} domEventData\n\t */\n\t_preventDefaultOnArrowKeyPress( eventInfo, domEventData ) {\n\t\tconst model = this.editor.model;\n\t\tconst schema = model.schema;\n\t\tconst objectElement = model.document.selection.getSelectedElement();\n\n\t\t// If object element is selected.\n\t\tif ( objectElement && schema.isObject( objectElement ) ) {\n\t\t\tdomEventData.preventDefault();\n\t\t\teventInfo.stop();\n\t\t}\n\t}\n\n\t/**\n\t * Handles delete keys: backspace and delete.\n\t *\n\t * @private\n\t * @param {Boolean} isForward Set to true if delete was performed in forward direction.\n\t * @returns {Boolean|undefined} Returns `true` if keys were handled correctly.\n\t */\n\t_handleDelete( isForward ) {\n\t\t// Do nothing when the read only mode is enabled.\n\t\tif ( this.editor.isReadOnly ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst modelDocument = this.editor.model.document;\n\t\tconst modelSelection = modelDocument.selection;\n\n\t\t// Do nothing on non-collapsed selection.\n\t\tif ( !modelSelection.isCollapsed ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst objectElement = this._getObjectElementNextToSelection( isForward );\n\n\t\tif ( objectElement ) {\n\t\t\tthis.editor.model.change( writer => {\n\t\t\t\tlet previousNode = modelSelection.anchor.parent;\n\n\t\t\t\t// Remove previous element if empty.\n\t\t\t\twhile ( previousNode.isEmpty ) {\n\t\t\t\t\tconst nodeToRemove = previousNode;\n\t\t\t\t\tpreviousNode = nodeToRemove.parent;\n\n\t\t\t\t\twriter.remove( nodeToRemove );\n\t\t\t\t}\n\n\t\t\t\tthis._setSelectionOverElement( objectElement );\n\t\t\t} );\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/**\n\t * Sets {@link module:engine/model/selection~Selection document's selection} over given element.\n\t *\n\t * @protected\n\t * @param {module:engine/model/element~Element} element\n\t */\n\t_setSelectionOverElement( element ) {\n\t\tthis.editor.model.change( writer => {\n\t\t\twriter.setSelection( writer.createRangeOn( element ) );\n\t\t} );\n\t}\n\n\t/**\n\t * Checks if {@link module:engine/model/element~Element element} placed next to the current\n\t * {@link module:engine/model/selection~Selection model selection} exists and is marked in\n\t * {@link module:engine/model/schema~Schema schema} as `object`.\n\t *\n\t * @protected\n\t * @param {Boolean} forward Direction of checking.\n\t * @returns {module:engine/model/element~Element|null}\n\t */\n\t_getObjectElementNextToSelection( forward ) {\n\t\tconst model = this.editor.model;\n\t\tconst schema = model.schema;\n\t\tconst modelSelection = model.document.selection;\n\n\t\t// Clone current selection to use it as a probe. We must leave default selection as it is so it can return\n\t\t// to its current state after undo.\n\t\tconst probe = model.createSelection( modelSelection );\n\t\tmodel.modifySelection( probe, { direction: forward ? 'forward' : 'backward' } );\n\t\tconst objectElement = forward ? probe.focus.nodeBefore : probe.focus.nodeAfter;\n\n\t\tif ( !!objectElement && schema.isObject( objectElement ) ) {\n\t\t\treturn objectElement;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Removes CSS class from previously selected widgets.\n\t *\n\t * @private\n\t * @param {module:engine/view/downcastwriter~DowncastWriter} writer\n\t */\n\t_clearPreviouslySelectedWidgets( writer ) {\n\t\tfor ( const widget of this._previouslySelected ) {\n\t\t\twriter.removeClass( WIDGET_SELECTED_CLASS_NAME, widget );\n\t\t}\n\n\t\tthis._previouslySelected.clear();\n\t}\n}\n\n// Returns `true` when element is a nested editable or is placed inside one.\n//\n// @param {module:engine/view/element~Element}\n// @returns {Boolean}\nfunction isInsideNestedEditable( element ) {\n\twhile ( element ) {\n\t\tif ( element.is( 'editableElement' ) && !element.is( 'rootElement' ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Click on nested widget should select it.\n\t\tif ( isWidget( element ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\telement = element.parent;\n\t}\n\n\treturn false;\n}\n\n// Checks whether the specified `element` is a child of the `parent` element.\n//\n// @param {module:engine/view/element~Element} element An element to check.\n// @param {module:engine/view/element~Element|null} parent A parent for the element.\n// @returns {Boolean}\nfunction isChild( element, parent ) {\n\tif ( !parent ) {\n\t\treturn false;\n\t}\n\n\treturn Array.from( element.getAncestors() ).includes( parent );\n}\n"]}]}