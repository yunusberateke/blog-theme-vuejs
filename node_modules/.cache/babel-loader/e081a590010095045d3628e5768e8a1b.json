{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-engine/src/view/observer/mutationobserver.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-engine/src/view/observer/mutationobserver.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXNzZXJ0VGhpc0luaXRpYWxpemVkIjsKaW1wb3J0IF9nZXQgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9nZXQiOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20uanMiOwoKLyoqCiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDIxLCBDS1NvdXJjZSAtIEZyZWRlcmljbyBLbmFiYmVuLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1vc3MtbGljZW5zZQogKi8KCi8qKgogKiBAbW9kdWxlIGVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXIKICovCgovKiBnbG9iYWxzIHdpbmRvdyAqLwppbXBvcnQgT2JzZXJ2ZXIgZnJvbSAnLi9vYnNlcnZlcic7CmltcG9ydCBWaWV3U2VsZWN0aW9uIGZyb20gJy4uL3NlbGVjdGlvbic7CmltcG9ydCB7IHN0YXJ0c1dpdGhGaWxsZXIsIGdldERhdGFXaXRob3V0RmlsbGVyIH0gZnJvbSAnLi4vZmlsbGVyJzsKaW1wb3J0IHsgaXNFcXVhbFdpdGggfSBmcm9tICdsb2Rhc2gtZXMnOwovKioKICogTXV0YXRpb24gb2JzZXJ2ZXIgY2xhc3Mgb2JzZXJ2ZXMgY2hhbmdlcyBpbiB0aGUgRE9NLCBmaXJlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50Om11dGF0aW9uc30gZXZlbnQsIG1hcmsgdmlldwogKiBlbGVtZW50cyBhcyBjaGFuZ2VkIGFuZCBjYWxsIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmVuZGVyZXJ+UmVuZGVyZXIjcmVuZGVyfS4KICogQmVjYXVzZSBhbGwgbXV0YXRlZCBub2RlcyBhcmUgbWFya2VkIGFzICJ0byBiZSByZW5kZXJlZCIgYW5kIHRoZQogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JlbmRlcmVyflJlbmRlcmVyI3JlbmRlcn0gaXMgY2FsbGVkLCBhbGwgY2hhbmdlcyB3aWxsIGJlIHJldmVydGVkLCB1bmxlc3MgdGhlIG11dGF0aW9uIHdpbGwgYmUgaGFuZGxlZCBieSB0aGUKICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDptdXRhdGlvbnN9IGV2ZW50IGxpc3RlbmVyLiBJdCBtZWFucyB1c2VyIHdpbGwgc2VlIG9ubHkgaGFuZGxlZCBjaGFuZ2VzLCBhbmQgdGhlIGVkaXRvcgogKiB3aWxsIGJsb2NrIGFsbCBjaGFuZ2VzIHdoaWNoIGFyZSBub3QgaGFuZGxlZC4KICoKICogTXV0YXRpb24gT2JzZXJ2ZXIgYWxzbyB0YWtlIGNhcmUgb2YgcmVkdWNpbmcgbnVtYmVyIG9mIG11dGF0aW9ucyB3aGljaCBhcmUgZmlyZWQuIEl0IHJlbW92ZXMgZHVwbGljYXRlcyBhbmQKICogbXV0YXRpb25zIG9uIGVsZW1lbnRzIHdoaWNoIGRvIG5vdCBoYXZlIGNvcnJlc3BvbmRpbmcgdmlldyBlbGVtZW50cy4gQWxzbwogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZFRleHQgdGV4dCBtdXRhdGlvbn0gaXMgZmlyZWQgb25seSBpZiBwYXJlbnQgZWxlbWVudCBkbyBub3QgY2hhbmdlIGNoaWxkIGxpc3QuCiAqCiAqIE5vdGUgdGhhdCB0aGlzIG9ic2VydmVyIGlzIGF0dGFjaGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30gYW5kIGlzIGF2YWlsYWJsZSBieSBkZWZhdWx0LgogKgogKiBAZXh0ZW5kcyBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXIKICovCgp2YXIgTXV0YXRpb25PYnNlcnZlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX09ic2VydmVyKSB7CiAgX2luaGVyaXRzKE11dGF0aW9uT2JzZXJ2ZXIsIF9PYnNlcnZlcik7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoTXV0YXRpb25PYnNlcnZlcik7CgogIGZ1bmN0aW9uIE11dGF0aW9uT2JzZXJ2ZXIodmlldykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNdXRhdGlvbk9ic2VydmVyKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHZpZXcpOwogICAgLyoqCiAgICAgKiBOYXRpdmUgbXV0YXRpb24gb2JzZXJ2ZXIgY29uZmlnLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtPYmplY3R9CiAgICAgKi8KCiAgICBfdGhpcy5fY29uZmlnID0gewogICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUsCiAgICAgIGNoYXJhY3RlckRhdGFPbGRWYWx1ZTogdHJ1ZSwKICAgICAgc3VidHJlZTogdHJ1ZQogICAgfTsKICAgIC8qKgogICAgICogUmVmZXJlbmNlIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNkb21Db252ZXJ0ZXJ9LgogICAgICoKICAgICAqIEBtZW1iZXIge21vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyfQogICAgICovCgogICAgX3RoaXMuZG9tQ29udmVydGVyID0gdmlldy5kb21Db252ZXJ0ZXI7CiAgICAvKioKICAgICAqIFJlZmVyZW5jZSB0byB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjX3JlbmRlcmVyfS4KICAgICAqCiAgICAgKiBAbWVtYmVyIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmVuZGVyZXJ+UmVuZGVyZXJ9CiAgICAgKi8KCiAgICBfdGhpcy5yZW5kZXJlciA9IHZpZXcuX3JlbmRlcmVyOwogICAgLyoqCiAgICAgKiBPYnNlcnZlZCBET00gZWxlbWVudHMuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZW1iZXIge0FycmF5LjxIVE1MRWxlbWVudD59CiAgICAgKi8KCiAgICBfdGhpcy5fZG9tRWxlbWVudHMgPSBbXTsKICAgIC8qKgogICAgICogTmF0aXZlIG11dGF0aW9uIG9ic2VydmVyLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWVtYmVyIHtNdXRhdGlvbk9ic2VydmVyfQogICAgICovCgogICAgX3RoaXMuX211dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIoX3RoaXMuX29uTXV0YXRpb25zLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpKTsKICAgIHJldHVybiBfdGhpczsKICB9CiAgLyoqCiAgICogU3luY2hyb25vdXNseSBmaXJlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50Om11dGF0aW9uc30gZXZlbnQgd2l0aCBhbGwgbXV0YXRpb25zIGluIHJlY29yZCBxdWV1ZS4KICAgKiBBdCB0aGUgc2FtZSB0aW1lIGVtcHRpZXMgdGhlIHF1ZXVlIHNvIG11dGF0aW9ucyB3aWxsIG5vdCBiZSBmaXJlZCB0d2ljZS4KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhNdXRhdGlvbk9ic2VydmVyLCBbewogICAga2V5OiAiZmx1c2giLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICB0aGlzLl9vbk11dGF0aW9ucyh0aGlzLl9tdXRhdGlvbk9ic2VydmVyLnRha2VSZWNvcmRzKCkpOwogICAgfQogICAgLyoqCiAgICAgKiBAaW5oZXJpdERvYwogICAgICovCgogIH0sIHsKICAgIGtleTogIm9ic2VydmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9ic2VydmUoZG9tRWxlbWVudCkgewogICAgICB0aGlzLl9kb21FbGVtZW50cy5wdXNoKGRvbUVsZW1lbnQpOwoKICAgICAgaWYgKHRoaXMuaXNFbmFibGVkKSB7CiAgICAgICAgdGhpcy5fbXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKGRvbUVsZW1lbnQsIHRoaXMuX2NvbmZpZyk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJlbmFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsKICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoTXV0YXRpb25PYnNlcnZlci5wcm90b3R5cGUpLCAiZW5hYmxlIiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLl9kb21FbGVtZW50cyksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBkb21FbGVtZW50ID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgdGhpcy5fbXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKGRvbUVsZW1lbnQsIHRoaXMuX2NvbmZpZyk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQGluaGVyaXREb2MKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkaXNhYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihNdXRhdGlvbk9ic2VydmVyLnByb3RvdHlwZSksICJkaXNhYmxlIiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgIHRoaXMuX211dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgfQogICAgLyoqCiAgICAgKiBAaW5oZXJpdERvYwogICAgICovCgogIH0sIHsKICAgIGtleTogImRlc3Ryb3kiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKE11dGF0aW9uT2JzZXJ2ZXIucHJvdG90eXBlKSwgImRlc3Ryb3kiLCB0aGlzKS5jYWxsKHRoaXMpOwoKICAgICAgdGhpcy5fbXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7CiAgICB9CiAgICAvKioKICAgICAqIEhhbmRsZXMgbXV0YXRpb25zLiBEZWR1cGxpY2F0ZXMsIG1hcmsgdmlldyBlbGVtZW50cyB0byBzeW5jLCBmaXJlIGV2ZW50IGFuZCBjYWxsIHJlbmRlci4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIHtBcnJheS48T2JqZWN0Pn0gZG9tTXV0YXRpb25zIEFycmF5IG9mIG5hdGl2ZSBtdXRhdGlvbnMuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX29uTXV0YXRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25NdXRhdGlvbnMoZG9tTXV0YXRpb25zKSB7CiAgICAgIC8vIEFzIGEgcmVzdWx0IG9mIHRoaXMuZmx1c2goKSB3ZSBjYW4gaGF2ZSBhbiBlbXB0eSBjb2xsZWN0aW9uLgogICAgICBpZiAoZG9tTXV0YXRpb25zLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGRvbUNvbnZlcnRlciA9IHRoaXMuZG9tQ29udmVydGVyOyAvLyBVc2UgbWFwIGFuZCBzZXQgZm9yIGRlZHVwbGljYXRpb24uCgogICAgICB2YXIgbXV0YXRlZFRleHRzID0gbmV3IE1hcCgpOwogICAgICB2YXIgbXV0YXRlZEVsZW1lbnRzID0gbmV3IFNldCgpOyAvLyBIYW5kbGUgYGNoaWxkTGlzdGAgbXV0YXRpb25zIGZpcnN0LCBzbyB3ZSB3aWxsIGJlIGFibGUgdG8gY2hlY2sgaWYgdGhlIGBjaGFyYWN0ZXJEYXRhYCBtdXRhdGlvbiBpcyBpbiB0aGUKICAgICAgLy8gZWxlbWVudCB3aXRoIGNoYW5nZWQgc3RydWN0dXJlIGFueXdheS4KCiAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZG9tTXV0YXRpb25zKSwKICAgICAgICAgIF9zdGVwMjsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBtdXRhdGlvbiA9IF9zdGVwMi52YWx1ZTsKCiAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2NoaWxkTGlzdCcpIHsKICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb21Db252ZXJ0ZXIubWFwRG9tVG9WaWV3KG11dGF0aW9uLnRhcmdldCk7IC8vIERvIG5vdCBjb2xsZWN0IG11dGF0aW9ucyBmcm9tIFVJRWxlbWVudHMgYW5kIFJhd0VsZW1lbnRzLgoKICAgICAgICAgICAgaWYgKGVsZW1lbnQgJiYgKGVsZW1lbnQuaXMoJ3VpRWxlbWVudCcpIHx8IGVsZW1lbnQuaXMoJ3Jhd0VsZW1lbnQnKSkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVsZW1lbnQgJiYgIXRoaXMuX2lzQm9ndXNCck11dGF0aW9uKG11dGF0aW9uKSkgewogICAgICAgICAgICAgIG11dGF0ZWRFbGVtZW50cy5hZGQoZWxlbWVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IC8vIEhhbmRsZSBgY2hhcmFjdGVyRGF0YWAgbXV0YXRpb25zIGxhdGVyLCB3aGVuIHdlIGhhdmUgdGhlIGZ1bGwgbGlzdCBvZiBub2RlcyB3aGljaCBjaGFuZ2VkIHN0cnVjdHVyZS4KCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICB9CgogICAgICB2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGRvbU11dGF0aW9ucyksCiAgICAgICAgICBfc3RlcDM7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX211dGF0aW9uID0gX3N0ZXAzLnZhbHVlOwoKICAgICAgICAgIHZhciBfZWxlbWVudCA9IGRvbUNvbnZlcnRlci5tYXBEb21Ub1ZpZXcoX211dGF0aW9uLnRhcmdldCk7IC8vIERvIG5vdCBjb2xsZWN0IG11dGF0aW9ucyBmcm9tIFVJRWxlbWVudHMgYW5kIFJhd0VsZW1lbnRzLgoKCiAgICAgICAgICBpZiAoX2VsZW1lbnQgJiYgKF9lbGVtZW50LmlzKCd1aUVsZW1lbnQnKSB8fCBfZWxlbWVudC5pcygncmF3RWxlbWVudCcpKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX211dGF0aW9uLnR5cGUgPT09ICdjaGFyYWN0ZXJEYXRhJykgewogICAgICAgICAgICB2YXIgdGV4dCA9IGRvbUNvbnZlcnRlci5maW5kQ29ycmVzcG9uZGluZ1ZpZXdUZXh0KF9tdXRhdGlvbi50YXJnZXQpOwoKICAgICAgICAgICAgaWYgKHRleHQgJiYgIW11dGF0ZWRFbGVtZW50cy5oYXModGV4dC5wYXJlbnQpKSB7CiAgICAgICAgICAgICAgLy8gVXNlIHRleHQgYXMgYSBrZXksIGZvciBkZWR1cGxpY2F0aW9uLiBJZiB0aGVyZSB3aWxsIGJlIGFub3RoZXIgbXV0YXRpb24gb24gdGhlIHNhbWUgdGV4dCBlbGVtZW50CiAgICAgICAgICAgICAgLy8gd2Ugd2lsbCBoYXZlIG9ubHkgb25lIGluIHRoZSBtYXAuCiAgICAgICAgICAgICAgbXV0YXRlZFRleHRzLnNldCh0ZXh0LCB7CiAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICBvbGRUZXh0OiB0ZXh0LmRhdGEsCiAgICAgICAgICAgICAgICBuZXdUZXh0OiBnZXREYXRhV2l0aG91dEZpbGxlcihfbXV0YXRpb24udGFyZ2V0KSwKICAgICAgICAgICAgICAgIG5vZGU6IHRleHQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyBXaGVuIHdlIGFkZGVkIGZpcnN0IGxldHRlciB0byB0aGUgdGV4dCBub2RlIHdoaWNoIGhhZCBvbmx5IGlubGluZSBmaWxsZXIsIGZvciB0aGUgRE9NIGl0IGlzIG11dGF0aW9uCiAgICAgICAgICAgIC8vIG9uIHRleHQsIGJ1dCBmb3IgdGhlIHZpZXcsIHdoZXJlIGZpbGxlciB0ZXh0IG5vZGUgZGlkIG5vdCBleGlzdGVkLCBuZXcgdGV4dCBub2RlIHdhcyBjcmVhdGVkLCBzbyB3ZQogICAgICAgICAgICAvLyBuZWVkIHRvIGZpcmUgJ2NoaWxkcmVuJyBtdXRhdGlvbiBpbnN0ZWFkIG9mICd0ZXh0Jy4KICAgICAgICAgICAgZWxzZSBpZiAoIXRleHQgJiYgc3RhcnRzV2l0aEZpbGxlcihfbXV0YXRpb24udGFyZ2V0KSkgewogICAgICAgICAgICAgICAgbXV0YXRlZEVsZW1lbnRzLmFkZChkb21Db252ZXJ0ZXIubWFwRG9tVG9WaWV3KF9tdXRhdGlvbi50YXJnZXQucGFyZW50Tm9kZSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IC8vIE5vdyB3ZSBidWlsZCB0aGUgbGlzdCBvZiBtdXRhdGlvbnMgdG8gZmlyZSBhbmQgbWFyayBlbGVtZW50cy4gV2UgZGlkIG5vdCBkbyBpdCBlYXJsaWVyIHRvIGF2b2lkIG1hcmtpbmcgdGhlCiAgICAgICAgLy8gc2FtZSBub2RlIG11bHRpcGxlIHRpbWVzIGluIGNhc2Ugb2YgZHVwbGljYXRpb24uCiAgICAgICAgLy8gTGlzdCBvZiBtdXRhdGlvbnMgd2Ugd2lsbCBmaXJlLgoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgIH0KCiAgICAgIHZhciB2aWV3TXV0YXRpb25zID0gW107CgogICAgICB2YXIgX2l0ZXJhdG9yNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG11dGF0ZWRUZXh0cy52YWx1ZXMoKSksCiAgICAgICAgICBfc3RlcDQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNC5zKCk7ICEoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgbXV0YXRlZFRleHQgPSBfc3RlcDQudmFsdWU7CiAgICAgICAgICB0aGlzLnJlbmRlcmVyLm1hcmtUb1N5bmMoJ3RleHQnLCBtdXRhdGVkVGV4dC5ub2RlKTsKICAgICAgICAgIHZpZXdNdXRhdGlvbnMucHVzaChtdXRhdGVkVGV4dCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I0LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I0LmYoKTsKICAgICAgfQoKICAgICAgdmFyIF9pdGVyYXRvcjUgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihtdXRhdGVkRWxlbWVudHMpLAogICAgICAgICAgX3N0ZXA1OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHZpZXdFbGVtZW50ID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgdmFyIGRvbUVsZW1lbnQgPSBkb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKHZpZXdFbGVtZW50KTsKICAgICAgICAgIHZhciB2aWV3Q2hpbGRyZW4gPSBBcnJheS5mcm9tKHZpZXdFbGVtZW50LmdldENoaWxkcmVuKCkpOwogICAgICAgICAgdmFyIG5ld1ZpZXdDaGlsZHJlbiA9IEFycmF5LmZyb20oZG9tQ29udmVydGVyLmRvbUNoaWxkcmVuVG9WaWV3KGRvbUVsZW1lbnQsIHsKICAgICAgICAgICAgd2l0aENoaWxkcmVuOiBmYWxzZQogICAgICAgICAgfSkpOyAvLyBJdCBtYXkgaGFwcGVuIHRoYXQgYXMgYSByZXN1bHQgb2YgbWFueSBjaGFuZ2VzIChzdGggd2FzIGluc2VydGVkIGFuZCB0aGVuIHJlbW92ZWQpLAogICAgICAgICAgLy8gYm90aCBlbGVtZW50cyBoYXZlbid0IHJlYWxseSBjaGFuZ2VkLiAjMTAzMQoKICAgICAgICAgIGlmICghaXNFcXVhbFdpdGgodmlld0NoaWxkcmVuLCBuZXdWaWV3Q2hpbGRyZW4sIHNhbWVOb2RlcykpIHsKICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5tYXJrVG9TeW5jKCdjaGlsZHJlbicsIHZpZXdFbGVtZW50KTsKICAgICAgICAgICAgdmlld011dGF0aW9ucy5wdXNoKHsKICAgICAgICAgICAgICB0eXBlOiAnY2hpbGRyZW4nLAogICAgICAgICAgICAgIG9sZENoaWxkcmVuOiB2aWV3Q2hpbGRyZW4sCiAgICAgICAgICAgICAgbmV3Q2hpbGRyZW46IG5ld1ZpZXdDaGlsZHJlbiwKICAgICAgICAgICAgICBub2RlOiB2aWV3RWxlbWVudAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIFJldHJpZXZlIGBkb21TZWxlY3Rpb25gIHVzaW5nIGBvd25lckRvY3VtZW50YCBvZiBvbmUgb2YgbXV0YXRlZCBub2Rlcy4KICAgICAgICAvLyBUaGVyZSBzaG91bGQgbm90IGJlIHNpbXVsdGFuZW91cyBtdXRhdGlvbiBpbiBtdWx0aXBsZSBkb2N1bWVudHMsIHNvIGl0J3MgZmluZS4KCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjUuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjUuZigpOwogICAgICB9CgogICAgICB2YXIgZG9tU2VsZWN0aW9uID0gZG9tTXV0YXRpb25zWzBdLnRhcmdldC5vd25lckRvY3VtZW50LmdldFNlbGVjdGlvbigpOwogICAgICB2YXIgdmlld1NlbGVjdGlvbiA9IG51bGw7CgogICAgICBpZiAoZG9tU2VsZWN0aW9uICYmIGRvbVNlbGVjdGlvbi5hbmNob3JOb2RlKSB7CiAgICAgICAgLy8gSWYgYGRvbVNlbGVjdGlvbmAgaXMgaW5zaWRlIGEgZG9tIG5vZGUgdGhhdCBpcyBhbHJlYWR5IGJvdW5kIHRvIGEgdmlldyBub2RlIGZyb20gdmlldyB0cmVlLCBnZXQKICAgICAgICAvLyBjb3JyZXNwb25kaW5nIHNlbGVjdGlvbiBpbiB0aGUgdmlldyBhbmQgcGFzcyBpdCB0b2dldGhlciB3aXRoIGB2aWV3TXV0YXRpb25zYC4gVGhlIGB2aWV3U2VsZWN0aW9uYCBtYXkKICAgICAgICAvLyBiZSB1c2VkIGJ5IGZlYXR1cmVzIGhhbmRsaW5nIG11dGF0aW9ucy4KICAgICAgICAvLyBPbmx5IG9uZSByYW5nZSBpcyBzdXBwb3J0ZWQuCiAgICAgICAgdmFyIHZpZXdTZWxlY3Rpb25BbmNob3IgPSBkb21Db252ZXJ0ZXIuZG9tUG9zaXRpb25Ub1ZpZXcoZG9tU2VsZWN0aW9uLmFuY2hvck5vZGUsIGRvbVNlbGVjdGlvbi5hbmNob3JPZmZzZXQpOwogICAgICAgIHZhciB2aWV3U2VsZWN0aW9uRm9jdXMgPSBkb21Db252ZXJ0ZXIuZG9tUG9zaXRpb25Ub1ZpZXcoZG9tU2VsZWN0aW9uLmZvY3VzTm9kZSwgZG9tU2VsZWN0aW9uLmZvY3VzT2Zmc2V0KTsgLy8gQW5jaG9yIGFuZCBmb2N1cyBoYXMgdG8gYmUgcHJvcGVybHkgbWFwcGVkIHRvIHZpZXcuCgogICAgICAgIGlmICh2aWV3U2VsZWN0aW9uQW5jaG9yICYmIHZpZXdTZWxlY3Rpb25Gb2N1cykgewogICAgICAgICAgdmlld1NlbGVjdGlvbiA9IG5ldyBWaWV3U2VsZWN0aW9uKHZpZXdTZWxlY3Rpb25BbmNob3IpOwogICAgICAgICAgdmlld1NlbGVjdGlvbi5zZXRGb2N1cyh2aWV3U2VsZWN0aW9uRm9jdXMpOwogICAgICAgIH0KICAgICAgfSAvLyBJbiBjYXNlIG9ubHkgbm9uLXJlbGV2YW50IG11dGF0aW9ucyB3ZXJlIHJlY29yZGVkIGl0IHNraXBzIHRoZSBldmVudCBhbmQgZm9yY2UgcmVuZGVyICgjNTYwMCkuCgoKICAgICAgaWYgKHZpZXdNdXRhdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5kb2N1bWVudC5maXJlKCdtdXRhdGlvbnMnLCB2aWV3TXV0YXRpb25zLCB2aWV3U2VsZWN0aW9uKTsgLy8gSWYgbm90aGluZyBjaGFuZ2VzIG9uIGBtdXRhdGlvbnNgIGV2ZW50LCBhdCB0aGlzIHBvaW50IHdlIGhhdmUgImRpcnR5IERPTSIgKGNoYW5nZWQpIGFuZCBkZS1zeW5jaGVkCiAgICAgICAgLy8gdmlldyAod2hpY2ggaGFzIG5vdCBiZWVuIGNoYW5nZWQpLiBJbiBvcmRlciB0byAicmVzZXQgRE9NIiB3ZSByZW5kZXIgdGhlIHZpZXcgYWdhaW4uCgogICAgICAgIHRoaXMudmlldy5mb3JjZVJlbmRlcigpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzYW1lTm9kZXMoY2hpbGQxLCBjaGlsZDIpIHsKICAgICAgICAvLyBGaXJzdCBsZXZlbCBvZiBjb21wYXJpc29uIChhcnJheSBvZiBjaGlsZHJlbiB2cyBhcnJheSBvZiBjaGlsZHJlbikg4oCTIHVzZSB0aGUgTG9kYXNoJ3MgZGVmYXVsdCBiZWhhdmlvci4KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZDEpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBFbGVtZW50cy4KCgogICAgICAgIGlmIChjaGlsZDEgPT09IGNoaWxkMikgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvLyBUZXh0cy4KICAgICAgICBlbHNlIGlmIChjaGlsZDEuaXMoJyR0ZXh0JykgJiYgY2hpbGQyLmlzKCckdGV4dCcpKSB7CiAgICAgICAgICAgIHJldHVybiBjaGlsZDEuZGF0YSA9PT0gY2hpbGQyLmRhdGE7CiAgICAgICAgICB9IC8vIE5vdCBtYXRjaGluZyB0eXBlcy4KCgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVja3MgaWYgbXV0YXRpb24gd2FzIGdlbmVyYXRlZCBieSB0aGUgYnJvd3NlciBpbnNlcnRpbmcgYm9ndXMgYnIgb24gdGhlIGVuZCBvZiB0aGUgYmxvY2sgZWxlbWVudC4KICAgICAqIFN1Y2ggbXV0YXRpb25zIGFyZSBnZW5lcmF0ZWQgd2hpbGUgcHJlc3Npbmcgc3BhY2Ugb3IgcGVyZm9ybWluZyBuYXRpdmUgc3BlbGxjaGVja2VyIGNvcnJlY3Rpb24KICAgICAqIG9uIHRoZSBlbmQgb2YgdGhlIGJsb2NrIGVsZW1lbnQgaW4gRmlyZWZveCBicm93c2VyLgogICAgICoKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0ge09iamVjdH0gbXV0YXRpb24gTmF0aXZlIG11dGF0aW9uIG9iamVjdC4KICAgICAqIEByZXR1cm5zIHtCb29sZWFufQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9pc0JvZ3VzQnJNdXRhdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2lzQm9ndXNCck11dGF0aW9uKG11dGF0aW9uKSB7CiAgICAgIHZhciBhZGRlZE5vZGUgPSBudWxsOyAvLyBDaGVjayBpZiBtdXRhdGlvbiBhZGRlZCBvbmx5IG9uZSBub2RlIG9uIHRoZSBlbmQgb2YgaXRzIHBhcmVudC4KCiAgICAgIGlmIChtdXRhdGlvbi5uZXh0U2libGluZyA9PT0gbnVsbCAmJiBtdXRhdGlvbi5yZW1vdmVkTm9kZXMubGVuZ3RoID09PSAwICYmIG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoID09IDEpIHsKICAgICAgICBhZGRlZE5vZGUgPSB0aGlzLmRvbUNvbnZlcnRlci5kb21Ub1ZpZXcobXV0YXRpb24uYWRkZWROb2Rlc1swXSwgewogICAgICAgICAgd2l0aENoaWxkcmVuOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gYWRkZWROb2RlICYmIGFkZGVkTm9kZS5pcygnZWxlbWVudCcsICdicicpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIE11dGF0aW9uT2JzZXJ2ZXI7Cn0oT2JzZXJ2ZXIpOwovKioKICogRmlyZWQgd2hlbiBtdXRhdGlvbiBvY2N1cnJlZC4gSWYgdHJlZSB2aWV3IGlzIG5vdCBjaGFuZ2VkIG9uIHRoaXMgZXZlbnQsIERPTSB3aWxsIGJlIHJldmVydGVkIHRvIHRoZSBzdGF0ZSBiZWZvcmUKICogbXV0YXRpb24sIHNvIGFsbCBjaGFuZ2VzIHdoaWNoIHNob3VsZCBiZSBhcHBsaWVkLCBzaG91bGQgYmUgaGFuZGxlZCBvbiB0aGlzIGV2ZW50LgogKgogKiBJbnRyb2R1Y2VkIGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGlvbk9ic2VydmVyfS4KICoKICogTm90ZSB0aGF0IGJlY2F1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0aW9uT2JzZXJ2ZXJ9IGlzIGF0dGFjaGVkIGJ5IHRoZQogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30gdGhpcyBldmVudCBpcyBhdmFpbGFibGUgYnkgZGVmYXVsdC4KICoKICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGlvbk9ic2VydmVyCiAqIEBldmVudCBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6bXV0YXRpb25zCiAqIEBwYXJhbSB7QXJyYXkuPG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRUZXh0fG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRDaGlsZHJlbj59CiAqIHZpZXdNdXRhdGlvbnMgQXJyYXkgb2YgbXV0YXRpb25zLgogKiBGb3IgbXV0YXRlZCB0ZXh0cyBpdCB3aWxsIGJlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvbXV0YXRpb25vYnNlcnZlcn5NdXRhdGVkVGV4dH0gYW5kIGZvciBtdXRhdGVkIGVsZW1lbnRzIGl0IHdpbGwgYmUKICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRDaGlsZHJlbn0uIFlvdSBjYW4gcmVjb2duaXplIHRoZSB0eXBlIGJhc2VkIG9uIHRoZSBgdHlwZWAgcHJvcGVydHkuCiAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb258bnVsbH0gdmlld1NlbGVjdGlvbiBWaWV3IHNlbGVjdGlvbiB0aGF0IGlzIGEgcmVzdWx0IG9mIGNvbnZlcnRpbmcgRE9NIHNlbGVjdGlvbiB0byB2aWV3LgogKiBLZWVwIGluCiAqIG1pbmQgdGhhdCB0aGUgRE9NIHNlbGVjdGlvbiBpcyBhbHJlYWR5ICJ1cGRhdGVkIiwgbWVhbmluZyB0aGF0IGl0IGFscmVhZHkgYWNrbm93bGVkZ2VzIGNoYW5nZXMgZG9uZSBpbiBtdXRhdGlvbi4KICovCgovKioKICogTXV0YXRpb24gaXRlbSBmb3IgdGV4dC4KICoKICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6bXV0YXRpb25zCiAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRlZENoaWxkcmVuCiAqCiAqIEB0eXBlZGVmIHtPYmplY3R9IG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRUZXh0CiAqCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB0eXBlIEZvciB0ZXh0IG11dGF0aW9ucyBpdCBpcyBhbHdheXMgJ3RleHQnLgogKiBAcHJvcGVydHkge21vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHR9IG5vZGUgTXV0YXRlZCB0ZXh0IG5vZGUuCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBvbGRUZXh0IE9sZCB0ZXh0LgogKiBAcHJvcGVydHkge1N0cmluZ30gbmV3VGV4dCBOZXcgdGV4dC4KICovCgovKioKICogTXV0YXRpb24gaXRlbSBmb3IgY2hpbGQgbm9kZXMuCiAqCiAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50Om11dGF0aW9ucwogKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRUZXh0CiAqCiAqIEB0eXBlZGVmIHtPYmplY3R9IG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0ZWRDaGlsZHJlbgogKgogKiBAcHJvcGVydHkge1N0cmluZ30gdHlwZSBGb3IgY2hpbGQgbm9kZXMgbXV0YXRpb25zIGl0IGlzIGFsd2F5cyAnY2hpbGRyZW4nLgogKiBAcHJvcGVydHkge21vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR9IG5vZGUgUGFyZW50IG9mIHRoZSBtdXRhdGVkIGNoaWxkcmVuLgogKiBAcHJvcGVydHkge0FycmF5Ljxtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlPn0gb2xkQ2hpbGRyZW4gT2xkIGNoaWxkIG5vZGVzLgogKiBAcHJvcGVydHkge0FycmF5Ljxtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlPn0gbmV3Q2hpbGRyZW4gTmV3IGNoaWxkIG5vZGVzLgogKi8KCgpleHBvcnQgeyBNdXRhdGlvbk9ic2VydmVyIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-engine/src/view/observer/mutationobserver.js"],"names":["Observer","ViewSelection","startsWithFiller","getDataWithoutFiller","isEqualWith","MutationObserver","view","_config","childList","characterData","characterDataOldValue","subtree","domConverter","renderer","_renderer","_domElements","_mutationObserver","window","_onMutations","bind","takeRecords","domElement","push","isEnabled","observe","disconnect","domMutations","length","mutatedTexts","Map","mutatedElements","Set","mutation","type","element","mapDomToView","target","is","_isBogusBrMutation","add","text","findCorrespondingViewText","has","parent","set","oldText","data","newText","node","parentNode","viewMutations","values","mutatedText","markToSync","viewElement","mapViewToDom","viewChildren","Array","from","getChildren","newViewChildren","domChildrenToView","withChildren","sameNodes","oldChildren","newChildren","domSelection","ownerDocument","getSelection","viewSelection","anchorNode","viewSelectionAnchor","domPositionToView","anchorOffset","viewSelectionFocus","focusNode","focusOffset","setFocus","document","fire","forceRender","child1","child2","isArray","addedNode","nextSibling","removedNodes","addedNodes","domToView"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module engine/view/observer/mutationobserver\n */\n\n/* globals window */\n\nimport Observer from './observer';\nimport ViewSelection from '../selection';\nimport { startsWithFiller, getDataWithoutFiller } from '../filler';\nimport { isEqualWith } from 'lodash-es';\n\n/**\n * Mutation observer class observes changes in the DOM, fires {@link module:engine/view/document~Document#event:mutations} event, mark view\n * elements as changed and call {@link module:engine/view/renderer~Renderer#render}.\n * Because all mutated nodes are marked as \"to be rendered\" and the\n * {@link module:engine/view/renderer~Renderer#render} is called, all changes will be reverted, unless the mutation will be handled by the\n * {@link module:engine/view/document~Document#event:mutations} event listener. It means user will see only handled changes, and the editor\n * will block all changes which are not handled.\n *\n * Mutation Observer also take care of reducing number of mutations which are fired. It removes duplicates and\n * mutations on elements which do not have corresponding view elements. Also\n * {@link module:engine/view/observer/mutationobserver~MutatedText text mutation} is fired only if parent element do not change child list.\n *\n * Note that this observer is attached by the {@link module:engine/view/view~View} and is available by default.\n *\n * @extends module:engine/view/observer/observer~Observer\n */\nexport default class MutationObserver extends Observer {\n\tconstructor( view ) {\n\t\tsuper( view );\n\n\t\t/**\n\t\t * Native mutation observer config.\n\t\t *\n\t\t * @private\n\t\t * @member {Object}\n\t\t */\n\t\tthis._config = {\n\t\t\tchildList: true,\n\t\t\tcharacterData: true,\n\t\t\tcharacterDataOldValue: true,\n\t\t\tsubtree: true\n\t\t};\n\n\t\t/**\n\t\t * Reference to the {@link module:engine/view/view~View#domConverter}.\n\t\t *\n\t\t * @member {module:engine/view/domconverter~DomConverter}\n\t\t */\n\t\tthis.domConverter = view.domConverter;\n\n\t\t/**\n\t\t * Reference to the {@link module:engine/view/view~View#_renderer}.\n\t\t *\n\t\t * @member {module:engine/view/renderer~Renderer}\n\t\t */\n\t\tthis.renderer = view._renderer;\n\n\t\t/**\n\t\t * Observed DOM elements.\n\t\t *\n\t\t * @private\n\t\t * @member {Array.<HTMLElement>}\n\t\t */\n\t\tthis._domElements = [];\n\n\t\t/**\n\t\t * Native mutation observer.\n\t\t *\n\t\t * @private\n\t\t * @member {MutationObserver}\n\t\t */\n\t\tthis._mutationObserver = new window.MutationObserver( this._onMutations.bind( this ) );\n\t}\n\n\t/**\n\t * Synchronously fires {@link module:engine/view/document~Document#event:mutations} event with all mutations in record queue.\n\t * At the same time empties the queue so mutations will not be fired twice.\n\t */\n\tflush() {\n\t\tthis._onMutations( this._mutationObserver.takeRecords() );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tobserve( domElement ) {\n\t\tthis._domElements.push( domElement );\n\n\t\tif ( this.isEnabled ) {\n\t\t\tthis._mutationObserver.observe( domElement, this._config );\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tenable() {\n\t\tsuper.enable();\n\n\t\tfor ( const domElement of this._domElements ) {\n\t\t\tthis._mutationObserver.observe( domElement, this._config );\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisable() {\n\t\tsuper.disable();\n\n\t\tthis._mutationObserver.disconnect();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdestroy() {\n\t\tsuper.destroy();\n\n\t\tthis._mutationObserver.disconnect();\n\t}\n\n\t/**\n\t * Handles mutations. Deduplicates, mark view elements to sync, fire event and call render.\n\t *\n\t * @private\n\t * @param {Array.<Object>} domMutations Array of native mutations.\n\t */\n\t_onMutations( domMutations ) {\n\t\t// As a result of this.flush() we can have an empty collection.\n\t\tif ( domMutations.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst domConverter = this.domConverter;\n\n\t\t// Use map and set for deduplication.\n\t\tconst mutatedTexts = new Map();\n\t\tconst mutatedElements = new Set();\n\n\t\t// Handle `childList` mutations first, so we will be able to check if the `characterData` mutation is in the\n\t\t// element with changed structure anyway.\n\t\tfor ( const mutation of domMutations ) {\n\t\t\tif ( mutation.type === 'childList' ) {\n\t\t\t\tconst element = domConverter.mapDomToView( mutation.target );\n\n\t\t\t\t// Do not collect mutations from UIElements and RawElements.\n\t\t\t\tif ( element && ( element.is( 'uiElement' ) || element.is( 'rawElement' ) ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( element && !this._isBogusBrMutation( mutation ) ) {\n\t\t\t\t\tmutatedElements.add( element );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Handle `characterData` mutations later, when we have the full list of nodes which changed structure.\n\t\tfor ( const mutation of domMutations ) {\n\t\t\tconst element = domConverter.mapDomToView( mutation.target );\n\n\t\t\t// Do not collect mutations from UIElements and RawElements.\n\t\t\tif ( element && ( element.is( 'uiElement' ) || element.is( 'rawElement' ) ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( mutation.type === 'characterData' ) {\n\t\t\t\tconst text = domConverter.findCorrespondingViewText( mutation.target );\n\n\t\t\t\tif ( text && !mutatedElements.has( text.parent ) ) {\n\t\t\t\t\t// Use text as a key, for deduplication. If there will be another mutation on the same text element\n\t\t\t\t\t// we will have only one in the map.\n\t\t\t\t\tmutatedTexts.set( text, {\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\toldText: text.data,\n\t\t\t\t\t\tnewText: getDataWithoutFiller( mutation.target ),\n\t\t\t\t\t\tnode: text\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\t// When we added first letter to the text node which had only inline filler, for the DOM it is mutation\n\t\t\t\t// on text, but for the view, where filler text node did not existed, new text node was created, so we\n\t\t\t\t// need to fire 'children' mutation instead of 'text'.\n\t\t\t\telse if ( !text && startsWithFiller( mutation.target ) ) {\n\t\t\t\t\tmutatedElements.add( domConverter.mapDomToView( mutation.target.parentNode ) );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Now we build the list of mutations to fire and mark elements. We did not do it earlier to avoid marking the\n\t\t// same node multiple times in case of duplication.\n\n\t\t// List of mutations we will fire.\n\t\tconst viewMutations = [];\n\n\t\tfor ( const mutatedText of mutatedTexts.values() ) {\n\t\t\tthis.renderer.markToSync( 'text', mutatedText.node );\n\t\t\tviewMutations.push( mutatedText );\n\t\t}\n\n\t\tfor ( const viewElement of mutatedElements ) {\n\t\t\tconst domElement = domConverter.mapViewToDom( viewElement );\n\t\t\tconst viewChildren = Array.from( viewElement.getChildren() );\n\t\t\tconst newViewChildren = Array.from( domConverter.domChildrenToView( domElement, { withChildren: false } ) );\n\n\t\t\t// It may happen that as a result of many changes (sth was inserted and then removed),\n\t\t\t// both elements haven't really changed. #1031\n\t\t\tif ( !isEqualWith( viewChildren, newViewChildren, sameNodes ) ) {\n\t\t\t\tthis.renderer.markToSync( 'children', viewElement );\n\n\t\t\t\tviewMutations.push( {\n\t\t\t\t\ttype: 'children',\n\t\t\t\t\toldChildren: viewChildren,\n\t\t\t\t\tnewChildren: newViewChildren,\n\t\t\t\t\tnode: viewElement\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\n\t\t// Retrieve `domSelection` using `ownerDocument` of one of mutated nodes.\n\t\t// There should not be simultaneous mutation in multiple documents, so it's fine.\n\t\tconst domSelection = domMutations[ 0 ].target.ownerDocument.getSelection();\n\n\t\tlet viewSelection = null;\n\n\t\tif ( domSelection && domSelection.anchorNode ) {\n\t\t\t// If `domSelection` is inside a dom node that is already bound to a view node from view tree, get\n\t\t\t// corresponding selection in the view and pass it together with `viewMutations`. The `viewSelection` may\n\t\t\t// be used by features handling mutations.\n\t\t\t// Only one range is supported.\n\n\t\t\tconst viewSelectionAnchor = domConverter.domPositionToView( domSelection.anchorNode, domSelection.anchorOffset );\n\t\t\tconst viewSelectionFocus = domConverter.domPositionToView( domSelection.focusNode, domSelection.focusOffset );\n\n\t\t\t// Anchor and focus has to be properly mapped to view.\n\t\t\tif ( viewSelectionAnchor && viewSelectionFocus ) {\n\t\t\t\tviewSelection = new ViewSelection( viewSelectionAnchor );\n\t\t\t\tviewSelection.setFocus( viewSelectionFocus );\n\t\t\t}\n\t\t}\n\n\t\t// In case only non-relevant mutations were recorded it skips the event and force render (#5600).\n\t\tif ( viewMutations.length ) {\n\t\t\tthis.document.fire( 'mutations', viewMutations, viewSelection );\n\n\t\t\t// If nothing changes on `mutations` event, at this point we have \"dirty DOM\" (changed) and de-synched\n\t\t\t// view (which has not been changed). In order to \"reset DOM\" we render the view again.\n\t\t\tthis.view.forceRender();\n\t\t}\n\n\t\tfunction sameNodes( child1, child2 ) {\n\t\t\t// First level of comparison (array of children vs array of children) – use the Lodash's default behavior.\n\t\t\tif ( Array.isArray( child1 ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Elements.\n\t\t\tif ( child1 === child2 ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// Texts.\n\t\t\telse if ( child1.is( '$text' ) && child2.is( '$text' ) ) {\n\t\t\t\treturn child1.data === child2.data;\n\t\t\t}\n\n\t\t\t// Not matching types.\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Checks if mutation was generated by the browser inserting bogus br on the end of the block element.\n\t * Such mutations are generated while pressing space or performing native spellchecker correction\n\t * on the end of the block element in Firefox browser.\n\t *\n\t * @private\n\t * @param {Object} mutation Native mutation object.\n\t * @returns {Boolean}\n\t */\n\t_isBogusBrMutation( mutation ) {\n\t\tlet addedNode = null;\n\n\t\t// Check if mutation added only one node on the end of its parent.\n\t\tif ( mutation.nextSibling === null && mutation.removedNodes.length === 0 && mutation.addedNodes.length == 1 ) {\n\t\t\taddedNode = this.domConverter.domToView( mutation.addedNodes[ 0 ], {\n\t\t\t\twithChildren: false\n\t\t\t} );\n\t\t}\n\n\t\treturn addedNode && addedNode.is( 'element', 'br' );\n\t}\n}\n\n/**\n * Fired when mutation occurred. If tree view is not changed on this event, DOM will be reverted to the state before\n * mutation, so all changes which should be applied, should be handled on this event.\n *\n * Introduced by {@link module:engine/view/observer/mutationobserver~MutationObserver}.\n *\n * Note that because {@link module:engine/view/observer/mutationobserver~MutationObserver} is attached by the\n * {@link module:engine/view/view~View} this event is available by default.\n *\n * @see module:engine/view/observer/mutationobserver~MutationObserver\n * @event module:engine/view/document~Document#event:mutations\n * @param {Array.<module:engine/view/observer/mutationobserver~MutatedText|module:engine/view/observer/mutationobserver~MutatedChildren>}\n * viewMutations Array of mutations.\n * For mutated texts it will be {@link module:engine/view/observer/mutationobserver~MutatedText} and for mutated elements it will be\n * {@link module:engine/view/observer/mutationobserver~MutatedChildren}. You can recognize the type based on the `type` property.\n * @param {module:engine/view/selection~Selection|null} viewSelection View selection that is a result of converting DOM selection to view.\n * Keep in\n * mind that the DOM selection is already \"updated\", meaning that it already acknowledges changes done in mutation.\n */\n\n/**\n * Mutation item for text.\n *\n * @see module:engine/view/document~Document#event:mutations\n * @see module:engine/view/observer/mutationobserver~MutatedChildren\n *\n * @typedef {Object} module:engine/view/observer/mutationobserver~MutatedText\n *\n * @property {String} type For text mutations it is always 'text'.\n * @property {module:engine/view/text~Text} node Mutated text node.\n * @property {String} oldText Old text.\n * @property {String} newText New text.\n */\n\n/**\n * Mutation item for child nodes.\n *\n * @see module:engine/view/document~Document#event:mutations\n * @see module:engine/view/observer/mutationobserver~MutatedText\n *\n * @typedef {Object} module:engine/view/observer/mutationobserver~MutatedChildren\n *\n * @property {String} type For child nodes mutations it is always 'children'.\n * @property {module:engine/view/element~Element} node Parent of the mutated children.\n * @property {Array.<module:engine/view/node~Node>} oldChildren Old child nodes.\n * @property {Array.<module:engine/view/node~Node>} newChildren New child nodes.\n */\n"]}]}