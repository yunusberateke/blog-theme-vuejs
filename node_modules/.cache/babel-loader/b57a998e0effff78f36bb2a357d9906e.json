{"remainingRequest":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js?{}!/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-utils/src/observablemixin.js","dependencies":[{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-utils/src/observablemixin.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-dev-webpack-plugin/lib/translatesourceloader.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIi9ob21lL2VrZWJlcmF0L1lhbmRleC5EaXNrL1Byb2plbGVyaW0vQmVuaW1Qcm9qZWxlcmltL3dlYnNpdGVtL3dlYnNpdGVtLXdlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIgZnJvbSAiL2hvbWUvZWtlYmVyYXQvWWFuZGV4LkRpc2svUHJvamVsZXJpbS9CZW5pbVByb2plbGVyaW0vd2Vic2l0ZW0vd2Vic2l0ZW0td2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mcm9tLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKCi8qKgogKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyMSwgQ0tTb3VyY2UgLSBGcmVkZXJpY28gS25hYmJlbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3Itb3NzLWxpY2Vuc2UKICovCgovKioKICogQG1vZHVsZSB1dGlscy9vYnNlcnZhYmxlbWl4aW4KICovCmltcG9ydCBFbWl0dGVyTWl4aW4gZnJvbSAnLi9lbWl0dGVybWl4aW4nOwppbXBvcnQgQ0tFZGl0b3JFcnJvciBmcm9tICcuL2NrZWRpdG9yZXJyb3InOwppbXBvcnQgeyBleHRlbmQsIGlzT2JqZWN0IH0gZnJvbSAnbG9kYXNoLWVzJzsKdmFyIG9ic2VydmFibGVQcm9wZXJ0aWVzU3ltYm9sID0gU3ltYm9sKCdvYnNlcnZhYmxlUHJvcGVydGllcycpOwp2YXIgYm91bmRPYnNlcnZhYmxlc1N5bWJvbCA9IFN5bWJvbCgnYm91bmRPYnNlcnZhYmxlcycpOwp2YXIgYm91bmRQcm9wZXJ0aWVzU3ltYm9sID0gU3ltYm9sKCdib3VuZFByb3BlcnRpZXMnKTsKCnZhciBfZGVjb3JhdGVkTWV0aG9kcyA9IFN5bWJvbCgnZGVjb3JhdGVkTWV0aG9kcycpOwoKdmFyIF9kZWNvcmF0ZWRPcmlnaW5hbCA9IFN5bWJvbCgnZGVjb3JhdGVkT3JpZ2luYWwnKTsKLyoqCiAqIEEgbWl4aW4gdGhhdCBpbmplY3RzIHRoZSAib2JzZXJ2YWJsZSBwcm9wZXJ0aWVzIiBhbmQgZGF0YSBiaW5kaW5nIGZ1bmN0aW9uYWxpdHkgZGVzY3JpYmVkIGluIHRoZQogKiB7QGxpbmsgfk9ic2VydmFibGV9IGludGVyZmFjZS4KICoKICogUmVhZCBtb3JlIGFib3V0IHRoZSBjb25jZXB0IG9mIG9ic2VydmFibGVzIGluIHRoZToKICogKiB7QGdsaW5rIGZyYW1ld29yay9ndWlkZXMvYXJjaGl0ZWN0dXJlL2NvcmUtZWRpdG9yLWFyY2hpdGVjdHVyZSNldmVudC1zeXN0ZW0tYW5kLW9ic2VydmFibGVzICJFdmVudCBzeXN0ZW0gYW5kIG9ic2VydmFibGVzIn0KICogc2VjdGlvbiBvZiB0aGUge0BnbGluayBmcmFtZXdvcmsvZ3VpZGVzL2FyY2hpdGVjdHVyZS9jb3JlLWVkaXRvci1hcmNoaXRlY3R1cmUgIkNvcmUgZWRpdG9yIGFyY2hpdGVjdHVyZSJ9IGd1aWRlLAogKiAqIHtAZ2xpbmsgZnJhbWV3b3JrL2d1aWRlcy9kZWVwLWRpdmUvb2JzZXJ2YWJsZXMgIk9ic2VydmFibGVzIiBkZWVwIGRpdmV9IGd1aWRlLgogKgogKiBAbWl4aW4gT2JzZXJ2YWJsZU1peGluCiAqIEBtaXhlcyBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXJNaXhpbgogKiBAaW1wbGVtZW50cyBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGUKICovCgoKdmFyIE9ic2VydmFibGVNaXhpbiA9IHsKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogIHNldDogZnVuY3Rpb24gc2V0KG5hbWUsIHZhbHVlKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIC8vIElmIHRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYW4gT2JqZWN0LCBpdGVyYXRlIG92ZXIgaXRzIHByb3BlcnRpZXMuCiAgICBpZiAoaXNPYmplY3QobmFtZSkpIHsKICAgICAgT2JqZWN0LmtleXMobmFtZSkuZm9yRWFjaChmdW5jdGlvbiAocHJvcGVydHkpIHsKICAgICAgICBfdGhpcy5zZXQocHJvcGVydHksIG5hbWVbcHJvcGVydHldKTsKICAgICAgfSwgdGhpcyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpbml0T2JzZXJ2YWJsZSh0aGlzKTsKICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpc1tvYnNlcnZhYmxlUHJvcGVydGllc1N5bWJvbF07CgogICAgaWYgKG5hbWUgaW4gdGhpcyAmJiAhcHJvcGVydGllcy5oYXMobmFtZSkpIHsKICAgICAgLyoqCiAgICAgICAqIENhbm5vdCBvdmVycmlkZSBhbiBleGlzdGluZyBwcm9wZXJ0eS4KICAgICAgICoKICAgICAgICogVGhpcyBlcnJvciBpcyB0aHJvd24gd2hlbiB0cnlpbmcgdG8ge0BsaW5rIH5PYnNlcnZhYmxlI3NldCBzZXR9IGEgcHJvcGVydHkgd2l0aAogICAgICAgKiBhIG5hbWUgb2YgYW4gYWxyZWFkeSBleGlzdGluZyBwcm9wZXJ0eS4gRm9yIGV4YW1wbGU6CiAgICAgICAqCiAgICAgICAqCQlsZXQgb2JzZXJ2YWJsZSA9IG5ldyBNb2RlbCgpOwogICAgICAgKgkJb2JzZXJ2YWJsZS5wcm9wZXJ0eSA9IDE7CiAgICAgICAqCQlvYnNlcnZhYmxlLnNldCggJ3Byb3BlcnR5JywgMiApOwkJCS8vIHRocm93cwogICAgICAgKgogICAgICAgKgkJb2JzZXJ2YWJsZS5zZXQoICdwcm9wZXJ0eScsIDEgKTsKICAgICAgICoJCW9ic2VydmFibGUuc2V0KCAncHJvcGVydHknLCAyICk7CQkJLy8gb2ssIGJlY2F1c2UgdGhpcyBpcyBhbiBleGlzdGluZyBwcm9wZXJ0eS4KICAgICAgICoKICAgICAgICogQGVycm9yIG9ic2VydmFibGUtc2V0LWNhbm5vdC1vdmVycmlkZQogICAgICAgKi8KICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29ic2VydmFibGUtc2V0LWNhbm5vdC1vdmVycmlkZScsIHRoaXMpOwogICAgfQoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBuYW1lLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXMuZ2V0KG5hbWUpOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewogICAgICAgIHZhciBvbGRWYWx1ZSA9IHByb3BlcnRpZXMuZ2V0KG5hbWUpOyAvLyBGaXJlIGBzZXRgIGV2ZW50IGJlZm9yZSB0aGUgbmV3IHZhbHVlIHdpbGwgYmUgc2V0IHRvIG1ha2UgaXQgcG9zc2libGUKICAgICAgICAvLyB0byBvdmVycmlkZSBvYnNlcnZhYmxlIHByb3BlcnR5IHdpdGhvdXQgYWZmZWN0aW5nIGBjaGFuZ2VgIGV2ZW50LgogICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL2lzc3Vlcy8xNzEuCgogICAgICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMuZmlyZSgnc2V0OicgKyBuYW1lLCBuYW1lLCB2YWx1ZSwgb2xkVmFsdWUpOwoKICAgICAgICBpZiAobmV3VmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmV3VmFsdWUgPSB2YWx1ZTsKICAgICAgICB9IC8vIEFsbG93IHVuZGVmaW5lZCBhcyBhbiBpbml0aWFsIHZhbHVlIGxpa2UgQS5kZWZpbmUoICd4JywgdW5kZWZpbmVkICkgKCMxMzIpLgogICAgICAgIC8vIE5vdGU6IFdoZW4gcHJvcGVydGllcyBtYXAgaGFzIG5vIHN1Y2ggb3duIHByb3BlcnR5LCB0aGVuIGl0cyB2YWx1ZSBpcyB1bmRlZmluZWQuCgoKICAgICAgICBpZiAob2xkVmFsdWUgIT09IG5ld1ZhbHVlIHx8ICFwcm9wZXJ0aWVzLmhhcyhuYW1lKSkgewogICAgICAgICAgcHJvcGVydGllcy5zZXQobmFtZSwgbmV3VmFsdWUpOwogICAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2U6JyArIG5hbWUsIG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHRoaXNbbmFtZV0gPSB2YWx1ZTsKICB9LAoKICAvKioKICAgKiBAaW5oZXJpdERvYwogICAqLwogIGJpbmQ6IGZ1bmN0aW9uIGJpbmQoKSB7CiAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYmluZFByb3BlcnRpZXMgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGJpbmRQcm9wZXJ0aWVzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgfQoKICAgIGlmICghYmluZFByb3BlcnRpZXMubGVuZ3RoIHx8ICFpc1N0cmluZ0FycmF5KGJpbmRQcm9wZXJ0aWVzKSkgewogICAgICAvKioKICAgICAgICogQWxsIHByb3BlcnRpZXMgbXVzdCBiZSBzdHJpbmdzLgogICAgICAgKgogICAgICAgKiBAZXJyb3Igb2JzZXJ2YWJsZS1iaW5kLXdyb25nLXByb3BlcnRpZXMKICAgICAgICovCiAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtd3JvbmctcHJvcGVydGllcycsIHRoaXMpOwogICAgfQoKICAgIGlmIChuZXcgU2V0KGJpbmRQcm9wZXJ0aWVzKS5zaXplICE9PSBiaW5kUHJvcGVydGllcy5sZW5ndGgpIHsKICAgICAgLyoqCiAgICAgICAqIFByb3BlcnRpZXMgbXVzdCBiZSB1bmlxdWUuCiAgICAgICAqCiAgICAgICAqIEBlcnJvciBvYnNlcnZhYmxlLWJpbmQtZHVwbGljYXRlLXByb3BlcnRpZXMKICAgICAgICovCiAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtZHVwbGljYXRlLXByb3BlcnRpZXMnLCB0aGlzKTsKICAgIH0KCiAgICBpbml0T2JzZXJ2YWJsZSh0aGlzKTsKICAgIHZhciBib3VuZFByb3BlcnRpZXMgPSB0aGlzW2JvdW5kUHJvcGVydGllc1N5bWJvbF07CiAgICBiaW5kUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wZXJ0eU5hbWUpIHsKICAgICAgaWYgKGJvdW5kUHJvcGVydGllcy5oYXMocHJvcGVydHlOYW1lKSkgewogICAgICAgIC8qKgogICAgICAgICAqIENhbm5vdCBiaW5kIHRoZSBzYW1lIHByb3BlcnR5IG1vcmUgdGhhbiBvbmNlLgogICAgICAgICAqCiAgICAgICAgICogQGVycm9yIG9ic2VydmFibGUtYmluZC1yZWJpbmQKICAgICAgICAgKi8KICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignb2JzZXJ2YWJsZS1iaW5kLXJlYmluZCcsIF90aGlzMik7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIGJpbmRpbmdzID0gbmV3IE1hcCgpOyAvLyBAdHlwZWRlZiB7T2JqZWN0fSBCaW5kaW5nCiAgICAvLyBAcHJvcGVydHkge0FycmF5fSBwcm9wZXJ0eSBQcm9wZXJ0eSB3aGljaCBpcyBib3VuZC4KICAgIC8vIEBwcm9wZXJ0eSB7QXJyYXl9IHRvIEFycmF5IG9mIG9ic2VydmFibGXigJNwcm9wZXJ0eSBjb21wb25lbnRzIG9mIHRoZSBiaW5kaW5nIChgeyBvYnNlcnZhYmxlOiAuLi4sIHByb3BlcnR5OiAuLiB9YCkuCiAgICAvLyBAcHJvcGVydHkge0FycmF5fSBjYWxsYmFjayBBIGZ1bmN0aW9uIHdoaWNoIHByb2Nlc3NlcyBgdG9gIGNvbXBvbmVudHMuCgogICAgYmluZFByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAoYSkgewogICAgICB2YXIgYmluZGluZyA9IHsKICAgICAgICBwcm9wZXJ0eTogYSwKICAgICAgICB0bzogW10KICAgICAgfTsKICAgICAgYm91bmRQcm9wZXJ0aWVzLnNldChhLCBiaW5kaW5nKTsKICAgICAgYmluZGluZ3Muc2V0KGEsIGJpbmRpbmcpOwogICAgfSk7IC8vIEB0eXBlZGVmIHtPYmplY3R9IEJpbmRDaGFpbgogICAgLy8gQHByb3BlcnR5IHtGdW5jdGlvbn0gdG8gU2VlIHtAbGluayB+T2JzZXJ2YWJsZU1peGluI19iaW5kVG99LgogICAgLy8gQHByb3BlcnR5IHtGdW5jdGlvbn0gdG9NYW55IFNlZSB7QGxpbmsgfk9ic2VydmFibGVNaXhpbiNfYmluZFRvTWFueX0uCiAgICAvLyBAcHJvcGVydHkge21vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gX29ic2VydmFibGUgVGhlIG9ic2VydmFibGUgd2hpY2ggaW5pdGlhbGl6ZXMgdGhlIGJpbmRpbmcuCiAgICAvLyBAcHJvcGVydHkge0FycmF5fSBfYmluZFByb3BlcnRpZXMgQXJyYXkgb2YgYF9vYnNlcnZhYmxlYCBwcm9wZXJ0aWVzIHRvIGJlIGJvdW5kLgogICAgLy8gQHByb3BlcnR5IHtBcnJheX0gX3RvIEFycmF5IG9mIGB0bygpYCBvYnNlcnZhYmxl4oCTcHJvcGVydGllcyAoYHsgb2JzZXJ2YWJsZTogdG9PYnNlcnZhYmxlLCBwcm9wZXJ0aWVzOiAuLi50b1Byb3BlcnRpZXMgfWApLgogICAgLy8gQHByb3BlcnR5IHtNYXB9IF9iaW5kaW5ncyBTdG9yZXMgYmluZGluZ3MgdG8gYmUga2VwdCBpbgogICAgLy8ge0BsaW5rIH5PYnNlcnZhYmxlTWl4aW4jX2JvdW5kUHJvcGVydGllc30ve0BsaW5rIH5PYnNlcnZhYmxlTWl4aW4jX2JvdW5kT2JzZXJ2YWJsZXN9CiAgICAvLyBpbml0aWF0ZWQgaW4gdGhpcyBiaW5kaW5nIGNoYWluLgoKICAgIHJldHVybiB7CiAgICAgIHRvOiBiaW5kVG8sCiAgICAgIHRvTWFueTogYmluZFRvTWFueSwKICAgICAgX29ic2VydmFibGU6IHRoaXMsCiAgICAgIF9iaW5kUHJvcGVydGllczogYmluZFByb3BlcnRpZXMsCiAgICAgIF90bzogW10sCiAgICAgIF9iaW5kaW5nczogYmluZGluZ3MKICAgIH07CiAgfSwKCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICB1bmJpbmQ6IGZ1bmN0aW9uIHVuYmluZCgpIHsKICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgIC8vIE5vdGhpbmcgdG8gZG8gaGVyZSBpZiBub3QgaW5pdGVkIHlldC4KICAgIGlmICghdGhpc1tvYnNlcnZhYmxlUHJvcGVydGllc1N5bWJvbF0pIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBib3VuZFByb3BlcnRpZXMgPSB0aGlzW2JvdW5kUHJvcGVydGllc1N5bWJvbF07CiAgICB2YXIgYm91bmRPYnNlcnZhYmxlcyA9IHRoaXNbYm91bmRPYnNlcnZhYmxlc1N5bWJvbF07CgogICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCB1bmJpbmRQcm9wZXJ0aWVzID0gbmV3IEFycmF5KF9sZW4yKSwgX2tleTIgPSAwOyBfa2V5MiA8IF9sZW4yOyBfa2V5MisrKSB7CiAgICAgIHVuYmluZFByb3BlcnRpZXNbX2tleTJdID0gYXJndW1lbnRzW19rZXkyXTsKICAgIH0KCiAgICBpZiAodW5iaW5kUHJvcGVydGllcy5sZW5ndGgpIHsKICAgICAgaWYgKCFpc1N0cmluZ0FycmF5KHVuYmluZFByb3BlcnRpZXMpKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogUHJvcGVydGllcyBtdXN0IGJlIHN0cmluZ3MuCiAgICAgICAgICoKICAgICAgICAgKiBAZXJyb3Igb2JzZXJ2YWJsZS11bmJpbmQtd3JvbmctcHJvcGVydGllcwogICAgICAgICAqLwogICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLXVuYmluZC13cm9uZy1wcm9wZXJ0aWVzJywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHVuYmluZFByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcGVydHlOYW1lKSB7CiAgICAgICAgdmFyIGJpbmRpbmcgPSBib3VuZFByb3BlcnRpZXMuZ2V0KHByb3BlcnR5TmFtZSk7IC8vIE5vdGhpbmcgdG8gZG8gaWYgdGhlIGJpbmRpbmcgaXMgbm90IGRlZmluZWQKCiAgICAgICAgaWYgKCFiaW5kaW5nKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgdG9PYnNlcnZhYmxlLCB0b1Byb3BlcnR5LCB0b1Byb3BlcnRpZXMsIHRvUHJvcGVydHlCaW5kaW5nczsKICAgICAgICBiaW5kaW5nLnRvLmZvckVhY2goZnVuY3Rpb24gKHRvKSB7CiAgICAgICAgICAvLyBUT0RPOiBFUzYgZGVzdHJ1Y3R1cmluZy4KICAgICAgICAgIHRvT2JzZXJ2YWJsZSA9IHRvWzBdOwogICAgICAgICAgdG9Qcm9wZXJ0eSA9IHRvWzFdOwogICAgICAgICAgdG9Qcm9wZXJ0aWVzID0gYm91bmRPYnNlcnZhYmxlcy5nZXQodG9PYnNlcnZhYmxlKTsKICAgICAgICAgIHRvUHJvcGVydHlCaW5kaW5ncyA9IHRvUHJvcGVydGllc1t0b1Byb3BlcnR5XTsKICAgICAgICAgIHRvUHJvcGVydHlCaW5kaW5ncy5kZWxldGUoYmluZGluZyk7CgogICAgICAgICAgaWYgKCF0b1Byb3BlcnR5QmluZGluZ3Muc2l6ZSkgewogICAgICAgICAgICBkZWxldGUgdG9Qcm9wZXJ0aWVzW3RvUHJvcGVydHldOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghT2JqZWN0LmtleXModG9Qcm9wZXJ0aWVzKS5sZW5ndGgpIHsKICAgICAgICAgICAgYm91bmRPYnNlcnZhYmxlcy5kZWxldGUodG9PYnNlcnZhYmxlKTsKCiAgICAgICAgICAgIF90aGlzMy5zdG9wTGlzdGVuaW5nKHRvT2JzZXJ2YWJsZSwgJ2NoYW5nZScpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGJvdW5kUHJvcGVydGllcy5kZWxldGUocHJvcGVydHlOYW1lKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBib3VuZE9ic2VydmFibGVzLmZvckVhY2goZnVuY3Rpb24gKGJpbmRpbmdzLCBib3VuZE9ic2VydmFibGUpIHsKICAgICAgICBfdGhpczMuc3RvcExpc3RlbmluZyhib3VuZE9ic2VydmFibGUsICdjaGFuZ2UnKTsKICAgICAgfSk7CiAgICAgIGJvdW5kT2JzZXJ2YWJsZXMuY2xlYXIoKTsKICAgICAgYm91bmRQcm9wZXJ0aWVzLmNsZWFyKCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogQGluaGVyaXREb2MKICAgKi8KICBkZWNvcmF0ZTogZnVuY3Rpb24gZGVjb3JhdGUobWV0aG9kTmFtZSkgewogICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgdmFyIG9yaWdpbmFsTWV0aG9kID0gdGhpc1ttZXRob2ROYW1lXTsKCiAgICBpZiAoIW9yaWdpbmFsTWV0aG9kKSB7CiAgICAgIC8qKgogICAgICAgKiBDYW5ub3QgZGVjb3JhdGUgYW4gdW5kZWZpbmVkIG1ldGhvZC4KICAgICAgICoKICAgICAgICogQGVycm9yIG9ic2VydmFibGVtaXhpbi1jYW5ub3QtZGVjb3JhdGUtdW5kZWZpbmVkCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB3aGljaCBtZXRob2Qgc2hvdWxkIGJlIGRlY29yYXRlZC4KICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZE5hbWUgTmFtZSBvZiB0aGUgbWV0aG9kIHdoaWNoIGRvZXMgbm90IGV4aXN0LgogICAgICAgKi8KICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29ic2VydmFibGVtaXhpbi1jYW5ub3QtZGVjb3JhdGUtdW5kZWZpbmVkJywgdGhpcywgewogICAgICAgIG9iamVjdDogdGhpcywKICAgICAgICBtZXRob2ROYW1lOiBtZXRob2ROYW1lCiAgICAgIH0pOwogICAgfQoKICAgIHRoaXMub24obWV0aG9kTmFtZSwgZnVuY3Rpb24gKGV2dCwgYXJncykgewogICAgICBldnQucmV0dXJuID0gb3JpZ2luYWxNZXRob2QuYXBwbHkoX3RoaXM0LCBhcmdzKTsKICAgIH0pOwoKICAgIHRoaXNbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIF9sZW4zID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMyksIF9rZXkzID0gMDsgX2tleTMgPCBfbGVuMzsgX2tleTMrKykgewogICAgICAgIGFyZ3NbX2tleTNdID0gYXJndW1lbnRzW19rZXkzXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZmlyZShtZXRob2ROYW1lLCBhcmdzKTsKICAgIH07CgogICAgdGhpc1ttZXRob2ROYW1lXVtfZGVjb3JhdGVkT3JpZ2luYWxdID0gb3JpZ2luYWxNZXRob2Q7CgogICAgaWYgKCF0aGlzW19kZWNvcmF0ZWRNZXRob2RzXSkgewogICAgICB0aGlzW19kZWNvcmF0ZWRNZXRob2RzXSA9IFtdOwogICAgfQoKICAgIHRoaXNbX2RlY29yYXRlZE1ldGhvZHNdLnB1c2gobWV0aG9kTmFtZSk7CiAgfQp9OwpleHRlbmQoT2JzZXJ2YWJsZU1peGluLCBFbWl0dGVyTWl4aW4pOyAvLyBPdmVycmlkZSB0aGUgRW1pdHRlck1peGluIHN0b3BMaXN0ZW5pbmcgbWV0aG9kIHRvIGJlIGFibGUgdG8gY2xlYW4gKGFuZCByZXN0b3JlKSBkZWNvcmF0ZWQgbWV0aG9kcy4KLy8gVGhpcyBpcyBuZWVkZWQgaW4gY2FzZSBvZjoKLy8gIDEuIEhhdmUgeC5mb28oKSBkZWNvcmF0ZWQuCi8vICAyLiBDYWxsIHguc3RvcExpc3RlbmluZygpCi8vICAzLiBDYWxsIHguZm9vKCkuIFByb2JsZW06IG5vdGhpbmcgaGFwcGVucyAodGhlIG9yaWdpbmFsIGZvbygpIG1ldGhvZCBpcyBub3QgZXhlY3V0ZWQpCgpPYnNlcnZhYmxlTWl4aW4uc3RvcExpc3RlbmluZyA9IGZ1bmN0aW9uIChlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spIHsKICAvLyBSZW1vdmluZyBhbGwgbGlzdGVuZXJzIHNvIGxldCdzIGNsZWFuIHRoZSBkZWNvcmF0ZWQgbWV0aG9kcyB0byB0aGUgb3JpZ2luYWwgc3RhdGUuCiAgaWYgKCFlbWl0dGVyICYmIHRoaXNbX2RlY29yYXRlZE1ldGhvZHNdKSB7CiAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpc1tfZGVjb3JhdGVkTWV0aG9kc10pLAogICAgICAgIF9zdGVwOwoKICAgIHRyeSB7CiAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgdmFyIG1ldGhvZE5hbWUgPSBfc3RlcC52YWx1ZTsKICAgICAgICB0aGlzW21ldGhvZE5hbWVdID0gdGhpc1ttZXRob2ROYW1lXVtfZGVjb3JhdGVkT3JpZ2luYWxdOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgIH0gZmluYWxseSB7CiAgICAgIF9pdGVyYXRvci5mKCk7CiAgICB9CgogICAgZGVsZXRlIHRoaXNbX2RlY29yYXRlZE1ldGhvZHNdOwogIH0KCiAgRW1pdHRlck1peGluLnN0b3BMaXN0ZW5pbmcuY2FsbCh0aGlzLCBlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spOwp9OwoKZXhwb3J0IGRlZmF1bHQgT2JzZXJ2YWJsZU1peGluOyAvLyBJbml0IHN5bWJvbCBwcm9wZXJ0aWVzIG5lZWRlZCBmb3IgdGhlIG9ic2VydmFibGUgbWVjaGFuaXNtIHRvIHdvcmsuCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7bW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlTWl4aW59IG9ic2VydmFibGUKCmZ1bmN0aW9uIGluaXRPYnNlcnZhYmxlKG9ic2VydmFibGUpIHsKICAvLyBEbyBub3RoaW5nIGlmIGFscmVhZHkgaW5pdGVkLgogIGlmIChvYnNlcnZhYmxlW29ic2VydmFibGVQcm9wZXJ0aWVzU3ltYm9sXSkgewogICAgcmV0dXJuOwogIH0gLy8gVGhlIGludGVybmFsIGhhc2ggY29udGFpbmluZyB0aGUgb2JzZXJ2YWJsZSdzIHN0YXRlLgogIC8vCiAgLy8gQHByaXZhdGUKICAvLyBAdHlwZSB7TWFwfQoKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9ic2VydmFibGUsIG9ic2VydmFibGVQcm9wZXJ0aWVzU3ltYm9sLCB7CiAgICB2YWx1ZTogbmV3IE1hcCgpCiAgfSk7IC8vIE1hcCBjb250YWluaW5nIGJpbmRpbmdzIHRvIGV4dGVybmFsIG9ic2VydmFibGVzLiBJdCBzaGFyZXMgdGhlIGJpbmRpbmcgb2JqZWN0cwogIC8vIChgeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2EnLCB0bzogLi4uIH1gKSB3aXRoIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbiNfYm91bmRQcm9wZXJ0aWVzfSBhbmQKICAvLyBpdCBpcyB1c2VkIHRvIG9ic2VydmUgZXh0ZXJuYWwgb2JzZXJ2YWJsZXMgdG8gdXBkYXRlIG93biBwcm9wZXJ0aWVzIGFjY29yZGluZ2x5LgogIC8vIFNlZSB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlTWl4aW4jYmluZH0uCiAgLy8KICAvLwkJQS5iaW5kKCAnYScsICdiJywgJ2MnICkudG8oIEIsICd4JywgJ3knLCAneCcgKTsKICAvLwkJY29uc29sZS5sb2coIEEuX2JvdW5kT2JzZXJ2YWJsZXMgKTsKICAvLwogIC8vCQkJTWFwKCB7CiAgLy8JCQkJQjogewogIC8vCQkJCQl4OiBTZXQoIFsKICAvLwkJCQkJCXsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IFsgWyBCLCAneCcgXSBdIH0sCiAgLy8JCQkJCQl7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYycsIHRvOiBbIFsgQiwgJ3gnIF0gXSB9CiAgLy8JCQkJCV0gKSwKICAvLwkJCQkJeTogU2V0KCBbCiAgLy8JCQkJCQl7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYicsIHRvOiBbIFsgQiwgJ3knIF0gXSB9LAogIC8vCQkJCQldICkKICAvLwkJCQl9CiAgLy8JCQl9ICkKICAvLwogIC8vCQlBLmJpbmQoICdkJyApLnRvKCBCLCAneicgKS50byggQywgJ3cnICkuYXMoIGNhbGxiYWNrICk7CiAgLy8JCWNvbnNvbGUubG9nKCBBLl9ib3VuZE9ic2VydmFibGVzICk7CiAgLy8KICAvLwkJCU1hcCggewogIC8vCQkJCUI6IHsKICAvLwkJCQkJeDogU2V0KCBbCiAgLy8JCQkJCQl7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYScsIHRvOiBbIFsgQiwgJ3gnIF0gXSB9LAogIC8vCQkJCQkJeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2MnLCB0bzogWyBbIEIsICd4JyBdIF0gfQogIC8vCQkJCQldICksCiAgLy8JCQkJCXk6IFNldCggWwogIC8vCQkJCQkJeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2InLCB0bzogWyBbIEIsICd5JyBdIF0gfSwKICAvLwkJCQkJXSApLAogIC8vCQkJCQl6OiBTZXQoIFsKICAvLwkJCQkJCXsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdkJywgdG86IFsgWyBCLCAneicgXSwgWyBDLCAndycgXSBdLCBjYWxsYmFjazogY2FsbGJhY2sgfQogIC8vCQkJCQldICkKICAvLwkJCQl9LAogIC8vCQkJCUM6IHsKICAvLwkJCQkJdzogU2V0KCBbCiAgLy8JCQkJCQl7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnZCcsIHRvOiBbIFsgQiwgJ3onIF0sIFsgQywgJ3cnIF0gXSwgY2FsbGJhY2s6IGNhbGxiYWNrIH0KICAvLwkJCQkJXSApCiAgLy8JCQkJfQogIC8vCQkJfSApCiAgLy8KICAvLyBAcHJpdmF0ZQogIC8vIEB0eXBlIHtNYXB9CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYnNlcnZhYmxlLCBib3VuZE9ic2VydmFibGVzU3ltYm9sLCB7CiAgICB2YWx1ZTogbmV3IE1hcCgpCiAgfSk7IC8vIE9iamVjdCB0aGF0IHN0b3JlcyB3aGljaCBwcm9wZXJ0aWVzIG9mIHRoaXMgb2JzZXJ2YWJsZSBhcmUgYm91bmQgYW5kIGhvdy4gSXQgc2hhcmVzCiAgLy8gdGhlIGJpbmRpbmcgb2JqZWN0cyAoYHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IC4uLiB9YCkgd2l0aAogIC8vIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGVNaXhpbiNfYm91bmRPYnNlcnZhYmxlc30uIFRoaXMgZGF0YSBzdHJ1Y3R1cmUgaXMKICAvLyBhIHJldmVyc2Ugb2Yge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZU1peGluI19ib3VuZE9ic2VydmFibGVzfSBhbmQgaXQgaXMgaGVscGZ1bCBmb3IKICAvLyB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlTWl4aW4jdW5iaW5kfS4KICAvLwogIC8vIFNlZSB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlTWl4aW4jYmluZH0uCiAgLy8KICAvLwkJQS5iaW5kKCAnYScsICdiJywgJ2MnICkudG8oIEIsICd4JywgJ3knLCAneCcgKTsKICAvLwkJY29uc29sZS5sb2coIEEuX2JvdW5kUHJvcGVydGllcyApOwogIC8vCiAgLy8JCQlNYXAoIHsKICAvLwkJCQlhOiB7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYScsIHRvOiBbIFsgQiwgJ3gnIF0gXSB9LAogIC8vCQkJCWI6IHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdiJywgdG86IFsgWyBCLCAneScgXSBdIH0sCiAgLy8JCQkJYzogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2MnLCB0bzogWyBbIEIsICd4JyBdIF0gfQogIC8vCQkJfSApCiAgLy8KICAvLwkJQS5iaW5kKCAnZCcgKS50byggQiwgJ3onICkudG8oIEMsICd3JyApLmFzKCBjYWxsYmFjayApOwogIC8vCQljb25zb2xlLmxvZyggQS5fYm91bmRQcm9wZXJ0aWVzICk7CiAgLy8KICAvLwkJCU1hcCggewogIC8vCQkJCWE6IHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IFsgWyBCLCAneCcgXSBdIH0sCiAgLy8JCQkJYjogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2InLCB0bzogWyBbIEIsICd5JyBdIF0gfSwKICAvLwkJCQljOiB7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYycsIHRvOiBbIFsgQiwgJ3gnIF0gXSB9LAogIC8vCQkJCWQ6IHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdkJywgdG86IFsgWyBCLCAneicgXSwgWyBDLCAndycgXSBdLCBjYWxsYmFjazogY2FsbGJhY2sgfQogIC8vCQkJfSApCiAgLy8KICAvLyBAcHJpdmF0ZQogIC8vIEB0eXBlIHtNYXB9CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYnNlcnZhYmxlLCBib3VuZFByb3BlcnRpZXNTeW1ib2wsIHsKICAgIHZhbHVlOiBuZXcgTWFwKCkKICB9KTsKfSAvLyBBIGNoYWluaW5nIGZvciB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlTWl4aW4jYmluZH0gcHJvdmlkaW5nIGAudG8oKWAgaW50ZXJmYWNlLgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0gey4uLltPYnNlcnZhYmxlfFN0cmluZ3xGdW5jdGlvbl19IGFyZ3MgQXJndW1lbnRzIG9mIHRoZSBgLnRvKCBhcmdzIClgIGJpbmRpbmcuCgoKZnVuY3Rpb24gYmluZFRvKCkgewogIHZhciBfdGhpczUgPSB0aGlzOwoKICB2YXIgcGFyc2VkQXJncyA9IHBhcnNlQmluZFRvQXJncy5hcHBseSh2b2lkIDAsIGFyZ3VtZW50cyk7CiAgdmFyIGJpbmRpbmdzS2V5cyA9IEFycmF5LmZyb20odGhpcy5fYmluZGluZ3Mua2V5cygpKTsKICB2YXIgbnVtYmVyT2ZCaW5kaW5ncyA9IGJpbmRpbmdzS2V5cy5sZW5ndGg7IC8vIEVsaW1pbmF0ZSBBLmJpbmQoICd4JyApLnRvKCBCLCBDICkKCiAgaWYgKCFwYXJzZWRBcmdzLmNhbGxiYWNrICYmIHBhcnNlZEFyZ3MudG8ubGVuZ3RoID4gMSkgewogICAgLyoqCiAgICAgKiBCaW5kaW5nIG11bHRpcGxlIG9ic2VydmFibGVzIG9ubHkgcG9zc2libGUgd2l0aCBjYWxsYmFjay4KICAgICAqCiAgICAgKiBAZXJyb3Igb2JzZXJ2YWJsZS1iaW5kLXRvLW5vLWNhbGxiYWNrCiAgICAgKi8KICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtdG8tbm8tY2FsbGJhY2snLCB0aGlzKTsKICB9IC8vIEVsaW1pbmF0ZSBBLmJpbmQoICd4JywgJ3knICkudG8oIEIsIGNhbGxiYWNrICkKCgogIGlmIChudW1iZXJPZkJpbmRpbmdzID4gMSAmJiBwYXJzZWRBcmdzLmNhbGxiYWNrKSB7CiAgICAvKioKICAgICAqIENhbm5vdCBiaW5kIG11bHRpcGxlIHByb3BlcnRpZXMgYW5kIHVzZSBhIGNhbGxiYWNrIGluIG9uZSBiaW5kaW5nLgogICAgICoKICAgICAqIEBlcnJvciBvYnNlcnZhYmxlLWJpbmQtdG8tZXh0cmEtY2FsbGJhY2sKICAgICAqLwogICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29ic2VydmFibGUtYmluZC10by1leHRyYS1jYWxsYmFjaycsIHRoaXMpOwogIH0KCiAgcGFyc2VkQXJncy50by5mb3JFYWNoKGZ1bmN0aW9uICh0bykgewogICAgLy8gRWxpbWluYXRlIEEuYmluZCggJ3gnLCAneScgKS50byggQiwgJ2EnICkKICAgIGlmICh0by5wcm9wZXJ0aWVzLmxlbmd0aCAmJiB0by5wcm9wZXJ0aWVzLmxlbmd0aCAhPT0gbnVtYmVyT2ZCaW5kaW5ncykgewogICAgICAvKioKICAgICAgICogVGhlIG51bWJlciBvZiBwcm9wZXJ0aWVzIG11c3QgbWF0Y2guCiAgICAgICAqCiAgICAgICAqIEBlcnJvciBvYnNlcnZhYmxlLWJpbmQtdG8tcHJvcGVydGllcy1sZW5ndGgKICAgICAgICovCiAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtdG8tcHJvcGVydGllcy1sZW5ndGgnLCBfdGhpczUpOwogICAgfSAvLyBXaGVuIG5vIHRvLnByb3BlcnRpZXMgc3BlY2lmaWVkLCBvYnNlcnZpbmcgc291cmNlIHByb3BlcnRpZXMgaW5zdGVhZCBpLmUuCiAgICAvLyBBLmJpbmQoICd4JywgJ3knICkudG8oIEIgKSAtPiBPYnNlcnZlIEIueCBhbmQgQi55CgoKICAgIGlmICghdG8ucHJvcGVydGllcy5sZW5ndGgpIHsKICAgICAgdG8ucHJvcGVydGllcyA9IF90aGlzNS5fYmluZFByb3BlcnRpZXM7CiAgICB9CiAgfSk7CiAgdGhpcy5fdG8gPSBwYXJzZWRBcmdzLnRvOyAvLyBGaWxsIHtAbGluayBCaW5kQ2hhaW4jX2JpbmRpbmdzfSB3aXRoIGNhbGxiYWNrLiBXaGVuIHRoZSBjYWxsYmFjayBpcyBzZXQgdGhlcmUncyBvbmx5IG9uZSBiaW5kaW5nLgoKICBpZiAocGFyc2VkQXJncy5jYWxsYmFjaykgewogICAgdGhpcy5fYmluZGluZ3MuZ2V0KGJpbmRpbmdzS2V5c1swXSkuY2FsbGJhY2sgPSBwYXJzZWRBcmdzLmNhbGxiYWNrOwogIH0KCiAgYXR0YWNoQmluZFRvTGlzdGVuZXJzKHRoaXMuX29ic2VydmFibGUsIHRoaXMuX3RvKTsgLy8gVXBkYXRlIG9ic2VydmFibGUuX2JvdW5kUHJvcGVydGllcyBhbmQgb2JzZXJ2YWJsZS5fYm91bmRPYnNlcnZhYmxlcy4KCiAgdXBkYXRlQmluZFRvQm91bmQodGhpcyk7IC8vIFNldCBpbml0aWFsIHZhbHVlcyBvZiBib3VuZCBwcm9wZXJ0aWVzLgoKICB0aGlzLl9iaW5kUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wZXJ0eU5hbWUpIHsKICAgIHVwZGF0ZUJvdW5kT2JzZXJ2YWJsZVByb3BlcnR5KF90aGlzNS5fb2JzZXJ2YWJsZSwgcHJvcGVydHlOYW1lKTsKICB9KTsKfSAvLyBCaW5kcyB0byBhbiBhdHRyaWJ1dGUgaW4gYSBzZXQgb2YgaXRlcmFibGUgb2JzZXJ2YWJsZXMuCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7QXJyYXkuPE9ic2VydmFibGU+fSBvYnNlcnZhYmxlcwovLyBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlCi8vIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCgoKZnVuY3Rpb24gYmluZFRvTWFueShvYnNlcnZhYmxlcywgYXR0cmlidXRlLCBjYWxsYmFjaykgewogIGlmICh0aGlzLl9iaW5kaW5ncy5zaXplID4gMSkgewogICAgLyoqCiAgICAgKiBCaW5kaW5nIG9uZSBhdHRyaWJ1dGUgdG8gbWFueSBvYnNlcnZhYmxlcyBvbmx5IHBvc3NpYmxlIHdpdGggb25lIGF0dHJpYnV0ZS4KICAgICAqCiAgICAgKiBAZXJyb3Igb2JzZXJ2YWJsZS1iaW5kLXRvLW1hbnktbm90LW9uZS1iaW5kaW5nCiAgICAgKi8KICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtdG8tbWFueS1ub3Qtb25lLWJpbmRpbmcnLCB0aGlzKTsKICB9CgogIHRoaXMudG8uYXBwbHkodGhpcywgX3RvQ29uc3VtYWJsZUFycmF5KGdldEJpbmRpbmdUYXJnZXRzKG9ic2VydmFibGVzLCBhdHRyaWJ1dGUpKS5jb25jYXQoWy8vIC4uLnVzaW5nIGdpdmVuIGNhbGxiYWNrIHRvIHBhcnNlIGF0dHJpYnV0ZSB2YWx1ZXMuCiAgY2FsbGJhY2tdKSk7Cn0gLy8gUmV0dXJucyBhbiBhcnJheSBvZiBiaW5kaW5nIGNvbXBvbmVudHMgZm9yCi8vIHtAbGluayBPYnNlcnZhYmxlI2JpbmR9IGZyb20gYSBzZXQgb2YgaXRlcmFibGUgb2JzZXJ2YWJsZXMuCi8vCi8vIEBwYXJhbSB7QXJyYXkuPE9ic2VydmFibGU+fSBvYnNlcnZhYmxlcwovLyBAcGFyYW0ge1N0cmluZ30gYXR0cmlidXRlCi8vIEByZXR1cm5zIHtBcnJheS48U3RyaW5nfE9ic2VydmFibGU+fQoKCmZ1bmN0aW9uIGdldEJpbmRpbmdUYXJnZXRzKG9ic2VydmFibGVzLCBhdHRyaWJ1dGUpIHsKICB2YXIgb2JzZXJ2YWJsZUFuZEF0dHJpYnV0ZVBhaXJzID0gb2JzZXJ2YWJsZXMubWFwKGZ1bmN0aW9uIChvYnNlcnZhYmxlKSB7CiAgICByZXR1cm4gW29ic2VydmFibGUsIGF0dHJpYnV0ZV07CiAgfSk7IC8vIE1lcmdlIHBhaXJzIHRvIG9uZS1kaW1lbnNpb24gYXJyYXkgb2Ygb2JzZXJ2YWJsZXMgYW5kIGF0dHJpYnV0ZXMuCgogIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBvYnNlcnZhYmxlQW5kQXR0cmlidXRlUGFpcnMpOwp9IC8vIENoZWNrIGlmIGFsbCBlbnRyaWVzIG9mIHRoZSBhcnJheSBhcmUgb2YgYFN0cmluZ2AgdHlwZS4KLy8KLy8gQHByaXZhdGUKLy8gQHBhcmFtIHtBcnJheX0gYXJyIEFuIGFycmF5IHRvIGJlIGNoZWNrZWQuCi8vIEByZXR1cm5zIHtCb29sZWFufQoKCmZ1bmN0aW9uIGlzU3RyaW5nQXJyYXkoYXJyKSB7CiAgcmV0dXJuIGFyci5ldmVyeShmdW5jdGlvbiAoYSkgewogICAgcmV0dXJuIHR5cGVvZiBhID09ICdzdHJpbmcnOwogIH0pOwp9IC8vIFBhcnNlcyBhbmQgdmFsaWRhdGVzIHtAbGluayBPYnNlcnZhYmxlI2JpbmR9YC50byggYXJncyApYCBhcmd1bWVudHMgYW5kIHJldHVybnMKLy8gYW4gb2JqZWN0IHdpdGggYSBwYXJzZWQgc3RydWN0dXJlLiBGb3IgZXhhbXBsZQovLwovLwkJQS5iaW5kKCAneCcgKS50byggQiwgJ2EnLCBDLCAnYicsIGNhbGwgKTsKLy8KLy8gYmVjb21lcwovLwovLwkJewovLwkJCXRvOiBbCi8vCQkJCXsgb2JzZXJ2YWJsZTogQiwgcHJvcGVydGllczogWyAnYScgXSB9LAovLwkJCQl7IG9ic2VydmFibGU6IEMsIHByb3BlcnRpZXM6IFsgJ2InIF0gfSwKLy8JCQldLAovLwkJCWNhbGxiYWNrOiBjYWxsCi8vIAkJfQovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0gey4uLip9IGFyZ3MgQXJndW1lbnRzIG9mIHtAbGluayBPYnNlcnZhYmxlI2JpbmR9YC50byggYXJncyApYC4KLy8gQHJldHVybnMge09iamVjdH0KCgpmdW5jdGlvbiBwYXJzZUJpbmRUb0FyZ3MoKSB7CiAgZm9yICh2YXIgX2xlbjQgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW40KSwgX2tleTQgPSAwOyBfa2V5NCA8IF9sZW40OyBfa2V5NCsrKSB7CiAgICBhcmdzW19rZXk0XSA9IGFyZ3VtZW50c1tfa2V5NF07CiAgfQoKICAvLyBFbGltaW5hdGUgQS5iaW5kKCAneCcgKS50bygpCiAgaWYgKCFhcmdzLmxlbmd0aCkgewogICAgLyoqCiAgICAgKiBJbnZhbGlkIGFyZ3VtZW50IHN5bnRheCBpbiBgdG8oKWAuCiAgICAgKgogICAgICogQGVycm9yIG9ic2VydmFibGUtYmluZC10by1wYXJzZS1lcnJvcgogICAgICovCiAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignb2JzZXJ2YWJsZS1iaW5kLXRvLXBhcnNlLWVycm9yJywgbnVsbCk7CiAgfQoKICB2YXIgcGFyc2VkID0gewogICAgdG86IFtdCiAgfTsKICB2YXIgbGFzdE9ic2VydmFibGU7CgogIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09ICdmdW5jdGlvbicpIHsKICAgIHBhcnNlZC5jYWxsYmFjayA9IGFyZ3MucG9wKCk7CiAgfQoKICBhcmdzLmZvckVhY2goZnVuY3Rpb24gKGEpIHsKICAgIGlmICh0eXBlb2YgYSA9PSAnc3RyaW5nJykgewogICAgICBsYXN0T2JzZXJ2YWJsZS5wcm9wZXJ0aWVzLnB1c2goYSk7CiAgICB9IGVsc2UgaWYgKF90eXBlb2YoYSkgPT0gJ29iamVjdCcpIHsKICAgICAgbGFzdE9ic2VydmFibGUgPSB7CiAgICAgICAgb2JzZXJ2YWJsZTogYSwKICAgICAgICBwcm9wZXJ0aWVzOiBbXQogICAgICB9OwogICAgICBwYXJzZWQudG8ucHVzaChsYXN0T2JzZXJ2YWJsZSk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignb2JzZXJ2YWJsZS1iaW5kLXRvLXBhcnNlLWVycm9yJywgbnVsbCk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHBhcnNlZDsKfSAvLyBTeW5jaHJvbml6ZXMge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW4jX2JvdW5kT2JzZXJ2YWJsZXN9IHdpdGgge0BsaW5rIEJpbmRpbmd9LgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0ge0JpbmRpbmd9IGJpbmRpbmcgQSBiaW5kaW5nIHRvIHN0b3JlIGluIHtAbGluayBPYnNlcnZhYmxlI19ib3VuZE9ic2VydmFibGVzfS4KLy8gQHBhcmFtIHtPYnNlcnZhYmxlfSB0b09ic2VydmFibGUgQSBvYnNlcnZhYmxlLCB3aGljaCBpcyBhIG5ldyBjb21wb25lbnQgb2YgYGJpbmRpbmdgLgovLyBAcGFyYW0ge1N0cmluZ30gdG9Qcm9wZXJ0eU5hbWUgQSBuYW1lIG9mIGB0b09ic2VydmFibGVgJ3MgcHJvcGVydHksIGEgbmV3IGNvbXBvbmVudCBvZiB0aGUgYGJpbmRpbmdgLgoKCmZ1bmN0aW9uIHVwZGF0ZUJvdW5kT2JzZXJ2YWJsZXMob2JzZXJ2YWJsZSwgYmluZGluZywgdG9PYnNlcnZhYmxlLCB0b1Byb3BlcnR5TmFtZSkgewogIHZhciBib3VuZE9ic2VydmFibGVzID0gb2JzZXJ2YWJsZVtib3VuZE9ic2VydmFibGVzU3ltYm9sXTsKICB2YXIgYmluZGluZ3NUb09ic2VydmFibGUgPSBib3VuZE9ic2VydmFibGVzLmdldCh0b09ic2VydmFibGUpOwogIHZhciBiaW5kaW5ncyA9IGJpbmRpbmdzVG9PYnNlcnZhYmxlIHx8IHt9OwoKICBpZiAoIWJpbmRpbmdzW3RvUHJvcGVydHlOYW1lXSkgewogICAgYmluZGluZ3NbdG9Qcm9wZXJ0eU5hbWVdID0gbmV3IFNldCgpOwogIH0gLy8gUGFzcyB0aGUgYmluZGluZyB0byBhIGNvcnJlc3BvbmRpbmcgU2V0IGluIGBvYnNlcnZhYmxlLl9ib3VuZE9ic2VydmFibGVzYC4KCgogIGJpbmRpbmdzW3RvUHJvcGVydHlOYW1lXS5hZGQoYmluZGluZyk7CgogIGlmICghYmluZGluZ3NUb09ic2VydmFibGUpIHsKICAgIGJvdW5kT2JzZXJ2YWJsZXMuc2V0KHRvT2JzZXJ2YWJsZSwgYmluZGluZ3MpOwogIH0KfSAvLyBTeW5jaHJvbml6ZXMge0BsaW5rIE9ic2VydmFibGUjX2JvdW5kUHJvcGVydGllc30gYW5kIHtAbGluayBPYnNlcnZhYmxlI19ib3VuZE9ic2VydmFibGVzfQovLyB3aXRoIHtAbGluayBCaW5kQ2hhaW59LgovLwovLyBBc3N1bWluZyB0aGUgZm9sbG93aW5nIGJpbmRpbmcgYmVpbmcgY3JlYXRlZAovLwovLyAJCUEuYmluZCggJ2EnLCAnYicgKS50byggQiwgJ3gnLCAneScgKTsKLy8KLy8gdGhlIGZvbGxvd2luZyBiaW5kaW5ncyB3ZXJlIGluaXRpYWxpemVkIGJ5IHtAbGluayBPYnNlcnZhYmxlI2JpbmR9IGluIHtAbGluayBCaW5kQ2hhaW4jX2JpbmRpbmdzfToKLy8KLy8gCQl7Ci8vIAkJCWE6IHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IFtdIH0sCi8vIAkJCWI6IHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdiJywgdG86IFtdIH0sCi8vIAkJfQovLwovLyBJdGVyYXRlIG92ZXIgYWxsIGJpbmRpbmdzIGluIHRoaXMgY2hhaW4gYW5kIGZpbGwgdGhlaXIgYHRvYCBwcm9wZXJ0aWVzIHdpdGgKLy8gY29ycmVzcG9uZGluZyB0byggLi4uICkgYXJndW1lbnRzIChjb21wb25lbnRzIG9mIHRoZSBiaW5kaW5nKSwgc28KLy8KLy8gCQl7Ci8vIAkJCWE6IHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IFsgQiwgJ3gnIF0gfSwKLy8gCQkJYjogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2InLCB0bzogWyBCLCAneScgXSB9LAovLyAJCX0KLy8KLy8gVGhlbiB1cGRhdGUgdGhlIHN0cnVjdHVyZSBvZiB7QGxpbmsgT2JzZXJ2YWJsZSNfYm91bmRPYnNlcnZhYmxlc30gd2l0aCB1cGRhdGVkCi8vIGJpbmRpbmcsIHNvIGl0IGJlY29tZXM6Ci8vCi8vIAkJTWFwKCB7Ci8vIAkJCUI6IHsKLy8gCQkJCXg6IFNldCggWwovLyAJCQkJCXsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IFsgWyBCLCAneCcgXSBdIH0KLy8gCQkJCV0gKSwKLy8gCQkJCXk6IFNldCggWwovLyAJCQkJCXsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdiJywgdG86IFsgWyBCLCAneScgXSBdIH0sCi8vIAkJCQldICkKLy8JCQl9Ci8vIAkJfSApCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7QmluZENoYWlufSBjaGFpbiBUaGUgYmluZGluZyBpbml0aWFsaXplZCBieSB7QGxpbmsgT2JzZXJ2YWJsZSNiaW5kfS4KCgpmdW5jdGlvbiB1cGRhdGVCaW5kVG9Cb3VuZChjaGFpbikgewogIHZhciB0b1Byb3BlcnR5OwoKICBjaGFpbi5fYmluZGluZ3MuZm9yRWFjaChmdW5jdGlvbiAoYmluZGluZywgcHJvcGVydHlOYW1lKSB7CiAgICAvLyBOb3RlOiBGb3IgYSBiaW5kaW5nIHdpdGhvdXQgYSBjYWxsYmFjaywgdGhpcyB3aWxsIHJ1biBvbmx5IG9uY2UKICAgIC8vIGxpa2UgaW4gQS5iaW5kKCAneCcsICd5JyApLnRvKCBCLCAnYScsICdiJyApCiAgICAvLyBUT0RPOiBFUzYgZGVzdHJ1Y3R1cmluZy4KICAgIGNoYWluLl90by5mb3JFYWNoKGZ1bmN0aW9uICh0bykgewogICAgICB0b1Byb3BlcnR5ID0gdG8ucHJvcGVydGllc1tiaW5kaW5nLmNhbGxiYWNrID8gMCA6IGNoYWluLl9iaW5kUHJvcGVydGllcy5pbmRleE9mKHByb3BlcnR5TmFtZSldOwogICAgICBiaW5kaW5nLnRvLnB1c2goW3RvLm9ic2VydmFibGUsIHRvUHJvcGVydHldKTsKICAgICAgdXBkYXRlQm91bmRPYnNlcnZhYmxlcyhjaGFpbi5fb2JzZXJ2YWJsZSwgYmluZGluZywgdG8ub2JzZXJ2YWJsZSwgdG9Qcm9wZXJ0eSk7CiAgICB9KTsKICB9KTsKfSAvLyBVcGRhdGVzIGFuIHByb3BlcnR5IG9mIGEge0BsaW5rIE9ic2VydmFibGV9IHdpdGggYSB2YWx1ZQovLyBkZXRlcm1pbmVkIGJ5IGFuIGVudHJ5IGluIHtAbGluayBPYnNlcnZhYmxlI19ib3VuZFByb3BlcnRpZXN9LgovLwovLyBAcHJpdmF0ZQovLyBAcGFyYW0ge09ic2VydmFibGV9IG9ic2VydmFibGUgQSBvYnNlcnZhYmxlIHdoaWNoIHByb3BlcnR5IGlzIHRvIGJlIHVwZGF0ZWQuCi8vIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eU5hbWUgQW4gcHJvcGVydHkgdG8gYmUgdXBkYXRlZC4KCgpmdW5jdGlvbiB1cGRhdGVCb3VuZE9ic2VydmFibGVQcm9wZXJ0eShvYnNlcnZhYmxlLCBwcm9wZXJ0eU5hbWUpIHsKICB2YXIgYm91bmRQcm9wZXJ0aWVzID0gb2JzZXJ2YWJsZVtib3VuZFByb3BlcnRpZXNTeW1ib2xdOwogIHZhciBiaW5kaW5nID0gYm91bmRQcm9wZXJ0aWVzLmdldChwcm9wZXJ0eU5hbWUpOwogIHZhciBwcm9wZXJ0eVZhbHVlOyAvLyBXaGVuIGEgYmluZGluZyB3aXRoIGNhbGxiYWNrIGlzIGNyZWF0ZWQgbGlrZQogIC8vCiAgLy8gCQlBLmJpbmQoICdhJyApLnRvKCBCLCAnYicsIEMsICdjJywgY2FsbGJhY2sgKTsKICAvLwogIC8vIGNvbGxlY3QgQi5iIGFuZCBDLmMsIHRoZW4gcGFzcyB0aGVtIHRvIGNhbGxiYWNrIHRvIHNldCBBLmEuCgogIGlmIChiaW5kaW5nLmNhbGxiYWNrKSB7CiAgICBwcm9wZXJ0eVZhbHVlID0gYmluZGluZy5jYWxsYmFjay5hcHBseShvYnNlcnZhYmxlLCBiaW5kaW5nLnRvLm1hcChmdW5jdGlvbiAodG8pIHsKICAgICAgcmV0dXJuIHRvWzBdW3RvWzFdXTsKICAgIH0pKTsKICB9IGVsc2UgewogICAgcHJvcGVydHlWYWx1ZSA9IGJpbmRpbmcudG9bMF07CiAgICBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZVswXVtwcm9wZXJ0eVZhbHVlWzFdXTsKICB9CgogIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JzZXJ2YWJsZSwgcHJvcGVydHlOYW1lKSkgewogICAgb2JzZXJ2YWJsZVtwcm9wZXJ0eU5hbWVdID0gcHJvcGVydHlWYWx1ZTsKICB9IGVsc2UgewogICAgb2JzZXJ2YWJsZS5zZXQocHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlKTsKICB9Cn0gLy8gU3RhcnRzIGxpc3RlbmluZyB0byBjaGFuZ2VzIGluIHtAbGluayBCaW5kQ2hhaW4uX3RvfSBvYnNlcnZhYmxlcyB0byB1cGRhdGUKLy8ge0BsaW5rIEJpbmRDaGFpbi5fb2JzZXJ2YWJsZX0ge0BsaW5rIEJpbmRDaGFpbi5fYmluZFByb3BlcnRpZXN9LiBBbHNvIHNldHMgdGhlCi8vIGluaXRpYWwgc3RhdGUgb2Yge0BsaW5rIEJpbmRDaGFpbi5fb2JzZXJ2YWJsZX0uCi8vCi8vIEBwcml2YXRlCi8vIEBwYXJhbSB7QmluZENoYWlufSBjaGFpbiBUaGUgY2hhaW4gaW5pdGlhbGl6ZWQgYnkge0BsaW5rIE9ic2VydmFibGUjYmluZH0uCgoKZnVuY3Rpb24gYXR0YWNoQmluZFRvTGlzdGVuZXJzKG9ic2VydmFibGUsIHRvQmluZGluZ3MpIHsKICB0b0JpbmRpbmdzLmZvckVhY2goZnVuY3Rpb24gKHRvKSB7CiAgICB2YXIgYm91bmRPYnNlcnZhYmxlcyA9IG9ic2VydmFibGVbYm91bmRPYnNlcnZhYmxlc1N5bWJvbF07CiAgICB2YXIgYmluZGluZ3M7IC8vIElmIHRoZXJlJ3MgYWxyZWFkeSBhIGNoYWluIGJldHdlZW4gdGhlIG9ic2VydmFibGVzIChgb2JzZXJ2YWJsZWAgbGlzdGVucyB0bwogICAgLy8gYHRvLm9ic2VydmFibGVgKSwgdGhlcmUncyBubyBuZWVkIHRvIGNyZWF0ZSBhbm90aGVyIGBjaGFuZ2VgIGV2ZW50IGxpc3RlbmVyLgoKICAgIGlmICghYm91bmRPYnNlcnZhYmxlcy5nZXQodG8ub2JzZXJ2YWJsZSkpIHsKICAgICAgb2JzZXJ2YWJsZS5saXN0ZW5Ubyh0by5vYnNlcnZhYmxlLCAnY2hhbmdlJywgZnVuY3Rpb24gKGV2dCwgcHJvcGVydHlOYW1lKSB7CiAgICAgICAgYmluZGluZ3MgPSBib3VuZE9ic2VydmFibGVzLmdldCh0by5vYnNlcnZhYmxlKVtwcm9wZXJ0eU5hbWVdOyAvLyBOb3RlOiB0by5vYnNlcnZhYmxlIHdpbGwgZmlyZSBmb3IgYW55IHByb3BlcnR5IGNoYW5nZSwgcmVhY3QKICAgICAgICAvLyB0byBjaGFuZ2VzIG9mIHByb3BlcnRpZXMgd2hpY2ggYXJlIGJvdW5kIG9ubHkuCgogICAgICAgIGlmIChiaW5kaW5ncykgewogICAgICAgICAgYmluZGluZ3MuZm9yRWFjaChmdW5jdGlvbiAoYmluZGluZykgewogICAgICAgICAgICB1cGRhdGVCb3VuZE9ic2VydmFibGVQcm9wZXJ0eShvYnNlcnZhYmxlLCBiaW5kaW5nLnByb3BlcnR5KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7Cn0KLyoqCiAqIEFuIGludGVyZmFjZSB3aGljaCBhZGRzICJvYnNlcnZhYmxlIHByb3BlcnRpZXMiIGFuZCBkYXRhIGJpbmRpbmcgZnVuY3Rpb25hbGl0eS4KICoKICogQ2FuIGJlIGVhc2lseSBpbXBsZW1lbnRlZCBieSBhIGNsYXNzIGJ5IG1peGluZyB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZU1peGlufSBtaXhpbi4KICoKICogUmVhZCBtb3JlIGFib3V0IHRoZSB1c2FnZSBvZiB0aGlzIGludGVyZmFjZSBpbiB0aGU6CiAqICoge0BnbGluayBmcmFtZXdvcmsvZ3VpZGVzL2FyY2hpdGVjdHVyZS9jb3JlLWVkaXRvci1hcmNoaXRlY3R1cmUjZXZlbnQtc3lzdGVtLWFuZC1vYnNlcnZhYmxlcyAiRXZlbnQgc3lzdGVtIGFuZCBvYnNlcnZhYmxlcyJ9CiAqIHNlY3Rpb24gb2YgdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2d1aWRlcy9hcmNoaXRlY3R1cmUvY29yZS1lZGl0b3ItYXJjaGl0ZWN0dXJlICJDb3JlIGVkaXRvciBhcmNoaXRlY3R1cmUifSBndWlkZSwKICogKiB7QGdsaW5rIGZyYW1ld29yay9ndWlkZXMvZGVlcC1kaXZlL29ic2VydmFibGVzICJPYnNlcnZhYmxlcyIgZGVlcCBkaXZlfSBndWlkZS4KICoKICogQGludGVyZmFjZSBPYnNlcnZhYmxlCiAqIEBleHRlbmRzIG1vZHVsZTp1dGlscy9lbWl0dGVybWl4aW5+RW1pdHRlcgogKi8KCi8qKgogKiBGaXJlZCB3aGVuIGEgcHJvcGVydHkgY2hhbmdlZCB2YWx1ZS4KICoKICoJCW9ic2VydmFibGUuc2V0KCAncHJvcCcsIDEgKTsKICoKICoJCW9ic2VydmFibGUub24oICdjaGFuZ2U6cHJvcCcsICggZXZ0LCBwcm9wZXJ0eU5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSApID0+IHsKICoJCQljb25zb2xlLmxvZyggYCR7IHByb3BlcnR5TmFtZSB9IGhhcyBjaGFuZ2VkIGZyb20gJHsgb2xkVmFsdWUgfSB0byAkeyBuZXdWYWx1ZSB9YCApOwogKgkJfSApOwogKgogKgkJb2JzZXJ2YWJsZS5wcm9wID0gMjsgLy8gLT4gJ3Byb3AgaGFzIGNoYW5nZWQgZnJvbSAxIHRvIDInCiAqCiAqIEBldmVudCBjaGFuZ2U6e3Byb3BlcnR5fQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgcHJvcGVydHkgbmFtZS4KICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgbmV3IHByb3BlcnR5IHZhbHVlLgogKiBAcGFyYW0geyp9IG9sZFZhbHVlIFRoZSBwcmV2aW91cyBwcm9wZXJ0eSB2YWx1ZS4KICovCgovKioKICogRmlyZWQgd2hlbiBhIHByb3BlcnR5IHZhbHVlIGlzIGdvaW5nIHRvIGJlIHNldCBidXQgaXMgbm90IHNldCB5ZXQgKGJlZm9yZSB0aGUgYGNoYW5nZWAgZXZlbnQgaXMgZmlyZWQpLgogKgogKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGZpbmFsIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSBieSB1c2luZwogKiB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9ldmVudGluZm9+RXZlbnRJbmZvI3JldHVybiBldmVudCdzIGByZXR1cm5gIHByb3BlcnR5fS4KICoKICoJCW9ic2VydmFibGUuc2V0KCAncHJvcCcsIDEgKTsKICoKICoJCW9ic2VydmFibGUub24oICdzZXQ6cHJvcCcsICggZXZ0LCBwcm9wZXJ0eU5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSApID0+IHsKICoJCQljb25zb2xlLmxvZyggYFZhbHVlIGlzIGdvaW5nIHRvIGJlIGNoYW5nZWQgZnJvbSAkeyBvbGRWYWx1ZSB9IHRvICR7IG5ld1ZhbHVlIH1gICk7CiAqCQkJY29uc29sZS5sb2coIGBDdXJyZW50IHByb3BlcnR5IHZhbHVlIGlzICR7IG9ic2VydmFibGVbIHByb3BlcnR5TmFtZSBdIH1gICk7CiAqCiAqCQkJLy8gTGV0J3Mgb3ZlcnJpZGUgdGhlIHZhbHVlLgogKgkJCWV2dC5yZXR1cm4gPSAzOwogKgkJfSApOwogKgogKgkJb2JzZXJ2YWJsZS5vbiggJ2NoYW5nZTpwcm9wJywgKCBldnQsIHByb3BlcnR5TmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlICkgPT4gewogKgkJCWNvbnNvbGUubG9nKCBgVmFsdWUgaGFzIGNoYW5nZWQgZnJvbSAkeyBvbGRWYWx1ZSB9IHRvICR7IG5ld1ZhbHVlIH1gICk7CiAqCQl9ICk7CiAqCiAqCQlvYnNlcnZhYmxlLnByb3AgPSAyOyAvLyAtPiAnVmFsdWUgaXMgZ29pbmcgdG8gYmUgY2hhbmdlZCBmcm9tIDEgdG8gMicKICoJCSAgICAgICAgICAgICAgICAgICAgIC8vIC0+ICdDdXJyZW50IHByb3BlcnR5IHZhbHVlIGlzIDEnCiAqCQkgICAgICAgICAgICAgICAgICAgICAvLyAtPiAnVmFsdWUgaGFzIGNoYW5nZWQgZnJvbSAxIHRvIDMnCiAqCiAqICoqTm90ZToqKiBUaGUgZXZlbnQgaXMgZmlyZWQgZXZlbiB3aGVuIHRoZSBuZXcgdmFsdWUgaXMgdGhlIHNhbWUgYXMgdGhlIG9sZCB2YWx1ZS4KICoKICogQGV2ZW50IHNldDp7cHJvcGVydHl9CiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBwcm9wZXJ0eSBuYW1lLgogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSBuZXcgcHJvcGVydHkgdmFsdWUuCiAqIEBwYXJhbSB7Kn0gb2xkVmFsdWUgVGhlIHByZXZpb3VzIHByb3BlcnR5IHZhbHVlLgogKi8KCi8qKgogKiBDcmVhdGVzIGFuZCBzZXRzIHRoZSB2YWx1ZSBvZiBhbiBvYnNlcnZhYmxlIHByb3BlcnR5IG9mIHRoaXMgb2JqZWN0LiBTdWNoIGEgcHJvcGVydHkgYmVjb21lcyBhIHBhcnQKICogb2YgdGhlIHN0YXRlIGFuZCBpcyBvYnNlcnZhYmxlLgogKgogKiBJdCBhY2NlcHRzIGFsc28gYSBzaW5nbGUgb2JqZWN0IGxpdGVyYWwgY29udGFpbmluZyBrZXkvdmFsdWUgcGFpcnMgd2l0aCBwcm9wZXJ0aWVzIHRvIGJlIHNldC4KICoKICogVGhpcyBtZXRob2QgdGhyb3dzIHRoZSBgb2JzZXJ2YWJsZS1zZXQtY2Fubm90LW92ZXJyaWRlYCBlcnJvciBpZiB0aGUgb2JzZXJ2YWJsZSBpbnN0YW5jZSBhbHJlYWR5CiAqIGhhcyBhIHByb3BlcnR5IHdpdGggdGhlIGdpdmVuIHByb3BlcnR5IG5hbWUuIFRoaXMgcHJldmVudHMgZnJvbSBtaXN0YWtlbmx5IG92ZXJyaWRpbmcgZXhpc3RpbmcKICogcHJvcGVydGllcyBhbmQgbWV0aG9kcywgYnV0IG1lYW5zIHRoYXQgYGZvby5zZXQoICdiYXInLCAxIClgIG1heSBiZSBzbGlnaHRseSBzbG93ZXIgdGhhbiBgZm9vLmJhciA9IDFgLgogKgogKiBAbWV0aG9kICNzZXQKICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fSBuYW1lIFRoZSBwcm9wZXJ0eSdzIG5hbWUgb3Igb2JqZWN0IHdpdGggYG5hbWU9PnZhbHVlYCBwYWlycy4KICogQHBhcmFtIHsqfSBbdmFsdWVdIFRoZSBwcm9wZXJ0eSdzIHZhbHVlIChpZiBgbmFtZWAgd2FzIHBhc3NlZCBpbiB0aGUgZmlyc3QgcGFyYW1ldGVyKS4KICovCgovKioKICogQmluZHMge0BsaW5rICNzZXQgb2JzZXJ2YWJsZSBwcm9wZXJ0aWVzfSB0byBvdGhlciBvYmplY3RzIGltcGxlbWVudGluZyB0aGUKICoge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZX0gaW50ZXJmYWNlLgogKgogKiBSZWFkIG1vcmUgaW4gdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2d1aWRlcy9kZWVwLWRpdmUvb2JzZXJ2YWJsZXMjcHJvcGVydHktYmluZGluZ3MgZGVkaWNhdGVkIGd1aWRlfQogKiBjb3ZlcmluZyB0aGUgdG9waWMgb2YgcHJvcGVydHkgYmluZGluZ3Mgd2l0aCBzb21lIGFkZGl0aW9uYWwgZXhhbXBsZXMuCiAqCiAqIENvbnNpZGVyIHR3byBvYmplY3RzOiBhIGBidXR0b25gIGFuZCBhbiBhc3NvY2lhdGVkIGBjb21tYW5kYCAoYm90aCBgT2JzZXJ2YWJsZWApLgogKgogKiBBIHNpbXBsZSBwcm9wZXJ0eSBiaW5kaW5nIGNvdWxkIGJlIGFzIGZvbGxvd3M6CiAqCiAqCQlidXR0b24uYmluZCggJ2lzRW5hYmxlZCcgKS50byggY29tbWFuZCwgJ2lzRW5hYmxlZCcgKTsKICoKICogb3IgZXZlbiBzaG9ydGVyOgogKgogKgkJYnV0dG9uLmJpbmQoICdpc0VuYWJsZWQnICkudG8oIGNvbW1hbmQgKTsKICoKICogd2hpY2ggd29ya3MgaW4gdGhlIGZvbGxvd2luZyB3YXk6CiAqCiAqICogYGJ1dHRvbi5pc0VuYWJsZWRgICoqaW5zdGFudGx5IGVxdWFscyoqIGBjb21tYW5kLmlzRW5hYmxlZGAsCiAqICogd2hlbmV2ZXIgYGNvbW1hbmQuaXNFbmFibGVkYCBjaGFuZ2VzLCBgYnV0dG9uLmlzRW5hYmxlZGAgd2lsbCBpbW1lZGlhdGVseSByZWZsZWN0IGl0cyB2YWx1ZS4KICoKICogKipOb3RlKio6IFRvIHJlbGVhc2UgdGhlIGJpbmRpbmcsIHVzZSB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlI3VuYmluZH0uCiAqCiAqIFlvdSBjYW4gYWxzbyAicmVuYW1lIiB0aGUgcHJvcGVydHkgaW4gdGhlIGJpbmRpbmcgYnkgc3BlY2lmeWluZyB0aGUgbmV3IG5hbWUgaW4gdGhlIGB0bygpYCBjaGFpbjoKICoKICoJCWJ1dHRvbi5iaW5kKCAnaXNFbmFibGVkJyApLnRvKCBjb21tYW5kLCAnaXNXb3JraW5nJyApOwogKgogKiBJdCBpcyBwb3NzaWJsZSB0byBiaW5kIG1vcmUgdGhhbiBvbmUgcHJvcGVydHkgYXQgYSB0aW1lIHRvIHNob3J0ZW4gdGhlIGNvZGU6CiAqCiAqCQlidXR0b24uYmluZCggJ2lzRW5hYmxlZCcsICd2YWx1ZScgKS50byggY29tbWFuZCApOwogKgogKiB3aGljaCBjb3JyZXNwb25kcyB0bzoKICoKICoJCWJ1dHRvbi5iaW5kKCAnaXNFbmFibGVkJyApLnRvKCBjb21tYW5kICk7CiAqCQlidXR0b24uYmluZCggJ3ZhbHVlJyApLnRvKCBjb21tYW5kICk7CiAqCiAqIFRoZSBiaW5kaW5nIGNhbiBpbmNsdWRlIG1vcmUgdGhhbiBvbmUgb2JzZXJ2YWJsZSwgY29tYmluaW5nIG11bHRpcGxlIGRhdGEgc291cmNlcyBpbiBhIGN1c3RvbSBjYWxsYmFjazoKICoKICoJCWJ1dHRvbi5iaW5kKCAnaXNFbmFibGVkJyApLnRvKCBjb21tYW5kLCAnaXNFbmFibGVkJywgdWksICdpc1Zpc2libGUnLAogKgkJCSggaXNDb21tYW5kRW5hYmxlZCwgaXNVSVZpc2libGUgKSA9PiBpc0NvbW1hbmRFbmFibGVkICYmIGlzVUlWaXNpYmxlICk7CiAqCiAqIFVzaW5nIGEgY3VzdG9tIGNhbGxiYWNrIGFsbG93cyBwcm9jZXNzaW5nIHRoZSB2YWx1ZSBiZWZvcmUgcGFzc2luZyBpdCB0byB0aGUgdGFyZ2V0IHByb3BlcnR5OgogKgogKgkJYnV0dG9uLmJpbmQoICdpc0VuYWJsZWQnICkudG8oIGNvbW1hbmQsICd2YWx1ZScsIHZhbHVlID0+IHZhbHVlID09PSAnaGVhZGluZzEnICk7CiAqCiAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gYmluZCB0byB0aGUgc2FtZSBwcm9wZXJ0eSBpbiBhbiBhcnJheSBvZiBvYnNlcnZhYmxlcy4KICogVG8gYmluZCBhIGBidXR0b25gIHRvIG11bHRpcGxlIGNvbW1hbmRzIChhbHNvIGBPYnNlcnZhYmxlc2ApIHNvIHRoYXQgZWFjaCBhbmQgZXZlcnkgb25lIG9mIHRoZW0KICogbXVzdCBiZSBlbmFibGVkIGZvciB0aGUgYnV0dG9uIHRvIGJlY29tZSBlbmFibGVkLCB1c2UgdGhlIGZvbGxvd2luZyBjb2RlOgogKgogKgkJYnV0dG9uLmJpbmQoICdpc0VuYWJsZWQnICkudG9NYW55KCBbIGNvbW1hbmRBLCBjb21tYW5kQiwgY29tbWFuZEMgXSwgJ2lzRW5hYmxlZCcsCiAqCQkJKCBpc0FFbmFibGVkLCBpc0JFbmFibGVkLCBpc0NFbmFibGVkICkgPT4gaXNBRW5hYmxlZCAmJiBpc0JFbmFibGVkICYmIGlzQ0VuYWJsZWQgKTsKICoKICogQG1ldGhvZCAjYmluZAogKiBAcGFyYW0gey4uLlN0cmluZ30gYmluZFByb3BlcnRpZXMgT2JzZXJ2YWJsZSBwcm9wZXJ0aWVzIHRoYXQgd2lsbCBiZSBib3VuZCB0byBvdGhlciBvYnNlcnZhYmxlKHMpLgogKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgYmluZCBjaGFpbiB3aXRoIHRoZSBgdG8oKWAgYW5kIGB0b01hbnkoKWAgbWV0aG9kcy4KICovCgovKioKICogUmVtb3ZlcyB0aGUgYmluZGluZyBjcmVhdGVkIHdpdGgge0BsaW5rICNiaW5kfS4KICoKICoJCS8vIFJlbW92ZXMgdGhlIGJpbmRpbmcgZm9yIHRoZSAnYScgcHJvcGVydHkuCiAqCQlBLnVuYmluZCggJ2EnICk7CiAqCiAqCQkvLyBSZW1vdmVzIGJpbmRpbmdzIGZvciBhbGwgcHJvcGVydGllcy4KICoJCUEudW5iaW5kKCk7CiAqCiAqIEBtZXRob2QgI3VuYmluZAogKiBAcGFyYW0gey4uLlN0cmluZ30gW3VuYmluZFByb3BlcnRpZXNdIE9ic2VydmFibGUgcHJvcGVydGllcyB0byBiZSB1bmJvdW5kLiBBbGwgdGhlIGJpbmRpbmdzIHdpbGwKICogYmUgcmVsZWFzZWQgaWYgbm8gcHJvcGVydGllcyBhcmUgcHJvdmlkZWQuCiAqLwoKLyoqCiAqIFR1cm5zIHRoZSBnaXZlbiBtZXRob2RzIG9mIHRoaXMgb2JqZWN0IGludG8gZXZlbnQtYmFzZWQgb25lcy4gVGhpcyBtZWFucyB0aGF0IHRoZSBuZXcgbWV0aG9kIHdpbGwgZmlyZSBhbiBldmVudAogKiAobmFtZWQgYWZ0ZXIgdGhlIG1ldGhvZCkgYW5kIHRoZSBvcmlnaW5hbCBhY3Rpb24gd2lsbCBiZSBwbHVnZ2VkIGFzIGEgbGlzdGVuZXIgdG8gdGhhdCBldmVudC4KICoKICogUmVhZCBtb3JlIGluIHRoZSB7QGdsaW5rIGZyYW1ld29yay9ndWlkZXMvZGVlcC1kaXZlL29ic2VydmFibGVzI2RlY29yYXRpbmctb2JqZWN0LW1ldGhvZHMgZGVkaWNhdGVkIGd1aWRlfQogKiBjb3ZlcmluZyB0aGUgdG9waWMgb2YgZGVjb3JhdGluZyBtZXRob2RzIHdpdGggc29tZSBhZGRpdGlvbmFsIGV4YW1wbGVzLgogKgogKiBEZWNvcmF0aW5nIHRoZSBtZXRob2QgZG9lcyBub3QgY2hhbmdlIGl0cyBiZWhhdmlvciAoaXQgb25seSBhZGRzIGFuIGV2ZW50KSwKICogYnV0IGl0IGFsbG93cyB0byBtb2RpZnkgaXQgbGF0ZXIgb24gYnkgbGlzdGVuaW5nIHRvIHRoZSBtZXRob2QncyBldmVudC4KICoKICogRm9yIGV4YW1wbGUsIHRvIGNhbmNlbCB0aGUgbWV0aG9kIGV4ZWN1dGlvbiB0aGUgZXZlbnQgY2FuIGJlIHtAbGluayBtb2R1bGU6dXRpbHMvZXZlbnRpbmZvfkV2ZW50SW5mbyNzdG9wIHN0b3BwZWR9OgogKgogKgkJY2xhc3MgRm9vIHsKICoJCQljb25zdHJ1Y3RvcigpIHsKICoJCQkJdGhpcy5kZWNvcmF0ZSggJ21ldGhvZCcgKTsKICoJCQl9CiAqCiAqCQkJbWV0aG9kKCkgewogKgkJCQljb25zb2xlLmxvZyggJ2NhbGxlZCEnICk7CiAqCQkJfQogKgkJfQogKgogKgkJY29uc3QgZm9vID0gbmV3IEZvbygpOwogKgkJZm9vLm9uKCAnbWV0aG9kJywgKCBldnQgKSA9PiB7CiAqCQkJZXZ0LnN0b3AoKTsKICoJCX0sIHsgcHJpb3JpdHk6ICdoaWdoJyB9ICk7CiAqCiAqCQlmb28ubWV0aG9kKCk7IC8vIE5vdGhpbmcgaXMgbG9nZ2VkLgogKgogKgogKiAqKk5vdGUqKjogVGhlIGhpZ2gge0BsaW5rIG1vZHVsZTp1dGlscy9wcmlvcml0aWVzflByaW9yaXR5U3RyaW5nIHByaW9yaXR5fSBsaXN0ZW5lcgogKiBoYXMgYmVlbiB1c2VkIHRvIGV4ZWN1dGUgdGhpcyBwYXJ0aWN1bGFyIGNhbGxiYWNrIGJlZm9yZSB0aGUgb25lIHdoaWNoIGNhbGxzIHRoZSBvcmlnaW5hbCBtZXRob2QKICogKHdoaWNoIHVzZXMgdGhlICJub3JtYWwiIHByaW9yaXR5KS4KICoKICogSXQgaXMgYWxzbyBwb3NzaWJsZSB0byBjaGFuZ2UgdGhlIHJldHVybmVkIHZhbHVlOgogKgogKgkJZm9vLm9uKCAnbWV0aG9kJywgKCBldnQgKSA9PiB7CiAqCQkJZXZ0LnJldHVybiA9ICdGb28hJzsKICoJCX0gKTsKICoKICoJCWZvby5tZXRob2QoKTsgLy8gLT4gJ0ZvbycKICoKICogRmluYWxseSwgaXQgaXMgcG9zc2libGUgdG8gYWNjZXNzIGFuZCBtb2RpZnkgdGhlIGFyZ3VtZW50cyB0aGUgbWV0aG9kIGlzIGNhbGxlZCB3aXRoOgogKgogKgkJbWV0aG9kKCBhLCBiICkgewogKgkJCWNvbnNvbGUubG9nKCBgJHsgYSB9LCAkeyBiIH1gICApOwogKgkJfQogKgogKgkJLy8gLi4uCiAqCiAqCQlmb28ub24oICdtZXRob2QnLCAoIGV2dCwgYXJncyApID0+IHsKICoJCQlhcmdzWyAwIF0gPSAzOwogKgogKgkJCWNvbnNvbGUubG9nKCBhcmdzWyAxIF0gKTsgLy8gLT4gMgogKgkJfSwgeyBwcmlvcml0eTogJ2hpZ2gnIH0gKTsKICoKICoJCWZvby5tZXRob2QoIDEsIDIgKTsgLy8gLT4gJzMsIDInCiAqCiAqIEBtZXRob2QgI2RlY29yYXRlCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2ROYW1lIE5hbWUgb2YgdGhlIG1ldGhvZCB0byBkZWNvcmF0ZS4KICov"},{"version":3,"sources":["/home/ekeberat/Yandex.Disk/Projelerim/BenimProjelerim/websitem/websitem-web/node_modules/@ckeditor/ckeditor5-utils/src/observablemixin.js"],"names":["EmitterMixin","CKEditorError","extend","isObject","observablePropertiesSymbol","Symbol","boundObservablesSymbol","boundPropertiesSymbol","_decoratedMethods","_decoratedOriginal","ObservableMixin","set","name","value","Object","keys","forEach","property","initObservable","properties","has","defineProperty","enumerable","configurable","get","oldValue","newValue","fire","undefined","bind","bindProperties","length","isStringArray","Set","size","boundProperties","propertyName","bindings","Map","a","binding","to","bindTo","toMany","bindToMany","_observable","_bindProperties","_to","_bindings","unbind","boundObservables","unbindProperties","toObservable","toProperty","toProperties","toPropertyBindings","delete","stopListening","boundObservable","clear","decorate","methodName","originalMethod","object","on","evt","args","return","apply","push","emitter","event","callback","call","observable","parsedArgs","parseBindToArgs","bindingsKeys","Array","from","numberOfBindings","attachBindToListeners","updateBindToBound","updateBoundObservableProperty","observables","attribute","getBindingTargets","observableAndAttributePairs","map","prototype","concat","arr","every","parsed","lastObservable","pop","updateBoundObservables","toPropertyName","bindingsToObservable","add","chain","indexOf","propertyValue","hasOwnProperty","toBindings","listenTo"],"mappings":"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A8BkE,aAA9B;AACA;AACD,C,CAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASrB,qBAAT,CAAgCP,UAAhC,EAA4C8B,UAA5C,EAAyD;AACxDA,EAAAA,UAAU,CAACxF,OAAX,CAAoB,UAAAyB,EAAE,EAAI;AACzB,QAAMS,gBAAgB,GAAGwB,UAAU,CAAEpE,sBAAF,CAAnC;AACA,QAAI+B,QAAJ,CAFyB,CAIzB;AACA;;AACA,QAAK,CAACa,gBAAgB,CAAC1B,GAAjB,CAAsBiB,EAAE,CAACiC,UAAzB,CAAN,EAA8C;AAC7CA,MAAAA,UAAU,CAAC+B,QAAX,CAAqBhE,EAAE,CAACiC,UAAxB,EAAoC,QAApC,EAA8C,UAAET,GAAF,EAAO7B,YAAP,EAAyB;AACtEC,QAAAA,QAAQ,GAAGa,gBAAgB,CAAC1B,GAAjB,CAAsBiB,EAAE,CAACiC,UAAzB,EAAuCtC,YAAvC,CAAX,CADsE,CAGtE;AACA;;AACA,YAAKC,QAAL,EAAgB;AACfA,UAAAA,QAAQ,CAACrB,OAAT,CAAkB,UAAAwB,OAAO,EAAI;AAC5B2C,YAAAA,6BAA6B,CAAET,UAAF,EAAclC,OAAO,CAACvB,QAAtB,CAA7B;AACA,WAFD;AAGA;AACD,OAVD;AAWA;AACD,GAnBD;AAoBA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module utils/observablemixin\n */\n\nimport EmitterMixin from './emittermixin';\nimport CKEditorError from './ckeditorerror';\nimport { extend, isObject } from 'lodash-es';\n\nconst observablePropertiesSymbol = Symbol( 'observableProperties' );\nconst boundObservablesSymbol = Symbol( 'boundObservables' );\nconst boundPropertiesSymbol = Symbol( 'boundProperties' );\n\nconst _decoratedMethods = Symbol( 'decoratedMethods' );\nconst _decoratedOriginal = Symbol( 'decoratedOriginal' );\n\n/**\n * A mixin that injects the \"observable properties\" and data binding functionality described in the\n * {@link ~Observable} interface.\n *\n * Read more about the concept of observables in the:\n * * {@glink framework/guides/architecture/core-editor-architecture#event-system-and-observables \"Event system and observables\"}\n * section of the {@glink framework/guides/architecture/core-editor-architecture \"Core editor architecture\"} guide,\n * * {@glink framework/guides/deep-dive/observables \"Observables\" deep dive} guide.\n *\n * @mixin ObservableMixin\n * @mixes module:utils/emittermixin~EmitterMixin\n * @implements module:utils/observablemixin~Observable\n */\nconst ObservableMixin = {\n\t/**\n\t * @inheritDoc\n\t */\n\tset( name, value ) {\n\t\t// If the first parameter is an Object, iterate over its properties.\n\t\tif ( isObject( name ) ) {\n\t\t\tObject.keys( name ).forEach( property => {\n\t\t\t\tthis.set( property, name[ property ] );\n\t\t\t}, this );\n\n\t\t\treturn;\n\t\t}\n\n\t\tinitObservable( this );\n\n\t\tconst properties = this[ observablePropertiesSymbol ];\n\n\t\tif ( ( name in this ) && !properties.has( name ) ) {\n\t\t\t/**\n\t\t\t * Cannot override an existing property.\n\t\t\t *\n\t\t\t * This error is thrown when trying to {@link ~Observable#set set} a property with\n\t\t\t * a name of an already existing property. For example:\n\t\t\t *\n\t\t\t *\t\tlet observable = new Model();\n\t\t\t *\t\tobservable.property = 1;\n\t\t\t *\t\tobservable.set( 'property', 2 );\t\t\t// throws\n\t\t\t *\n\t\t\t *\t\tobservable.set( 'property', 1 );\n\t\t\t *\t\tobservable.set( 'property', 2 );\t\t\t// ok, because this is an existing property.\n\t\t\t *\n\t\t\t * @error observable-set-cannot-override\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'observable-set-cannot-override', this );\n\t\t}\n\n\t\tObject.defineProperty( this, name, {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\n\t\t\tget() {\n\t\t\t\treturn properties.get( name );\n\t\t\t},\n\n\t\t\tset( value ) {\n\t\t\t\tconst oldValue = properties.get( name );\n\n\t\t\t\t// Fire `set` event before the new value will be set to make it possible\n\t\t\t\t// to override observable property without affecting `change` event.\n\t\t\t\t// See https://github.com/ckeditor/ckeditor5-utils/issues/171.\n\t\t\t\tlet newValue = this.fire( 'set:' + name, name, value, oldValue );\n\n\t\t\t\tif ( newValue === undefined ) {\n\t\t\t\t\tnewValue = value;\n\t\t\t\t}\n\n\t\t\t\t// Allow undefined as an initial value like A.define( 'x', undefined ) (#132).\n\t\t\t\t// Note: When properties map has no such own property, then its value is undefined.\n\t\t\t\tif ( oldValue !== newValue || !properties.has( name ) ) {\n\t\t\t\t\tproperties.set( name, newValue );\n\t\t\t\t\tthis.fire( 'change:' + name, name, newValue, oldValue );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\tthis[ name ] = value;\n\t},\n\n\t/**\n\t * @inheritDoc\n\t */\n\tbind( ...bindProperties ) {\n\t\tif ( !bindProperties.length || !isStringArray( bindProperties ) ) {\n\t\t\t/**\n\t\t\t * All properties must be strings.\n\t\t\t *\n\t\t\t * @error observable-bind-wrong-properties\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'observable-bind-wrong-properties', this );\n\t\t}\n\n\t\tif ( ( new Set( bindProperties ) ).size !== bindProperties.length ) {\n\t\t\t/**\n\t\t\t * Properties must be unique.\n\t\t\t *\n\t\t\t * @error observable-bind-duplicate-properties\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'observable-bind-duplicate-properties', this );\n\t\t}\n\n\t\tinitObservable( this );\n\n\t\tconst boundProperties = this[ boundPropertiesSymbol ];\n\n\t\tbindProperties.forEach( propertyName => {\n\t\t\tif ( boundProperties.has( propertyName ) ) {\n\t\t\t\t/**\n\t\t\t\t * Cannot bind the same property more than once.\n\t\t\t\t *\n\t\t\t\t * @error observable-bind-rebind\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'observable-bind-rebind', this );\n\t\t\t}\n\t\t} );\n\n\t\tconst bindings = new Map();\n\n\t\t// @typedef {Object} Binding\n\t\t// @property {Array} property Property which is bound.\n\t\t// @property {Array} to Array of observableproperty components of the binding (`{ observable: ..., property: .. }`).\n\t\t// @property {Array} callback A function which processes `to` components.\n\t\tbindProperties.forEach( a => {\n\t\t\tconst binding = { property: a, to: [] };\n\n\t\t\tboundProperties.set( a, binding );\n\t\t\tbindings.set( a, binding );\n\t\t} );\n\n\t\t// @typedef {Object} BindChain\n\t\t// @property {Function} to See {@link ~ObservableMixin#_bindTo}.\n\t\t// @property {Function} toMany See {@link ~ObservableMixin#_bindToMany}.\n\t\t// @property {module:utils/observablemixin~Observable} _observable The observable which initializes the binding.\n\t\t// @property {Array} _bindProperties Array of `_observable` properties to be bound.\n\t\t// @property {Array} _to Array of `to()` observableproperties (`{ observable: toObservable, properties: ...toProperties }`).\n\t\t// @property {Map} _bindings Stores bindings to be kept in\n\t\t// {@link ~ObservableMixin#_boundProperties}/{@link ~ObservableMixin#_boundObservables}\n\t\t// initiated in this binding chain.\n\t\treturn {\n\t\t\tto: bindTo,\n\t\t\ttoMany: bindToMany,\n\n\t\t\t_observable: this,\n\t\t\t_bindProperties: bindProperties,\n\t\t\t_to: [],\n\t\t\t_bindings: bindings\n\t\t};\n\t},\n\n\t/**\n\t * @inheritDoc\n\t */\n\tunbind( ...unbindProperties ) {\n\t\t// Nothing to do here if not inited yet.\n\t\tif ( !( this[ observablePropertiesSymbol ] ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst boundProperties = this[ boundPropertiesSymbol ];\n\t\tconst boundObservables = this[ boundObservablesSymbol ];\n\n\t\tif ( unbindProperties.length ) {\n\t\t\tif ( !isStringArray( unbindProperties ) ) {\n\t\t\t\t/**\n\t\t\t\t * Properties must be strings.\n\t\t\t\t *\n\t\t\t\t * @error observable-unbind-wrong-properties\n\t\t\t\t */\n\t\t\t\tthrow new CKEditorError( 'observable-unbind-wrong-properties', this );\n\t\t\t}\n\n\t\t\tunbindProperties.forEach( propertyName => {\n\t\t\t\tconst binding = boundProperties.get( propertyName );\n\n\t\t\t\t// Nothing to do if the binding is not defined\n\t\t\t\tif ( !binding ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet toObservable, toProperty, toProperties, toPropertyBindings;\n\n\t\t\t\tbinding.to.forEach( to => {\n\t\t\t\t\t// TODO: ES6 destructuring.\n\t\t\t\t\ttoObservable = to[ 0 ];\n\t\t\t\t\ttoProperty = to[ 1 ];\n\t\t\t\t\ttoProperties = boundObservables.get( toObservable );\n\t\t\t\t\ttoPropertyBindings = toProperties[ toProperty ];\n\n\t\t\t\t\ttoPropertyBindings.delete( binding );\n\n\t\t\t\t\tif ( !toPropertyBindings.size ) {\n\t\t\t\t\t\tdelete toProperties[ toProperty ];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !Object.keys( toProperties ).length ) {\n\t\t\t\t\t\tboundObservables.delete( toObservable );\n\t\t\t\t\t\tthis.stopListening( toObservable, 'change' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tboundProperties.delete( propertyName );\n\t\t\t} );\n\t\t} else {\n\t\t\tboundObservables.forEach( ( bindings, boundObservable ) => {\n\t\t\t\tthis.stopListening( boundObservable, 'change' );\n\t\t\t} );\n\n\t\t\tboundObservables.clear();\n\t\t\tboundProperties.clear();\n\t\t}\n\t},\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdecorate( methodName ) {\n\t\tconst originalMethod = this[ methodName ];\n\n\t\tif ( !originalMethod ) {\n\t\t\t/**\n\t\t\t * Cannot decorate an undefined method.\n\t\t\t *\n\t\t\t * @error observablemixin-cannot-decorate-undefined\n\t\t\t * @param {Object} object The object which method should be decorated.\n\t\t\t * @param {String} methodName Name of the method which does not exist.\n\t\t\t */\n\t\t\tthrow new CKEditorError(\n\t\t\t\t'observablemixin-cannot-decorate-undefined',\n\t\t\t\tthis,\n\t\t\t\t{ object: this, methodName }\n\t\t\t);\n\t\t}\n\n\t\tthis.on( methodName, ( evt, args ) => {\n\t\t\tevt.return = originalMethod.apply( this, args );\n\t\t} );\n\n\t\tthis[ methodName ] = function( ...args ) {\n\t\t\treturn this.fire( methodName, args );\n\t\t};\n\n\t\tthis[ methodName ][ _decoratedOriginal ] = originalMethod;\n\n\t\tif ( !this[ _decoratedMethods ] ) {\n\t\t\tthis[ _decoratedMethods ] = [];\n\t\t}\n\n\t\tthis[ _decoratedMethods ].push( methodName );\n\t}\n};\n\nextend( ObservableMixin, EmitterMixin );\n\n// Override the EmitterMixin stopListening method to be able to clean (and restore) decorated methods.\n// This is needed in case of:\n//  1. Have x.foo() decorated.\n//  2. Call x.stopListening()\n//  3. Call x.foo(). Problem: nothing happens (the original foo() method is not executed)\nObservableMixin.stopListening = function( emitter, event, callback ) {\n\t// Removing all listeners so let's clean the decorated methods to the original state.\n\tif ( !emitter && this[ _decoratedMethods ] ) {\n\t\tfor ( const methodName of this[ _decoratedMethods ] ) {\n\t\t\tthis[ methodName ] = this[ methodName ][ _decoratedOriginal ];\n\t\t}\n\n\t\tdelete this[ _decoratedMethods ];\n\t}\n\n\tEmitterMixin.stopListening.call( this, emitter, event, callback );\n};\n\nexport default ObservableMixin;\n\n// Init symbol properties needed for the observable mechanism to work.\n//\n// @private\n// @param {module:utils/observablemixin~ObservableMixin} observable\nfunction initObservable( observable ) {\n\t// Do nothing if already inited.\n\tif ( observable[ observablePropertiesSymbol ] ) {\n\t\treturn;\n\t}\n\n\t// The internal hash containing the observable's state.\n\t//\n\t// @private\n\t// @type {Map}\n\tObject.defineProperty( observable, observablePropertiesSymbol, {\n\t\tvalue: new Map()\n\t} );\n\n\t// Map containing bindings to external observables. It shares the binding objects\n\t// (`{ observable: A, property: 'a', to: ... }`) with {@link module:utils/observablemixin~ObservableMixin#_boundProperties} and\n\t// it is used to observe external observables to update own properties accordingly.\n\t// See {@link module:utils/observablemixin~ObservableMixin#bind}.\n\t//\n\t//\t\tA.bind( 'a', 'b', 'c' ).to( B, 'x', 'y', 'x' );\n\t//\t\tconsole.log( A._boundObservables );\n\t//\n\t//\t\t\tMap( {\n\t//\t\t\t\tB: {\n\t//\t\t\t\t\tx: Set( [\n\t//\t\t\t\t\t\t{ observable: A, property: 'a', to: [ [ B, 'x' ] ] },\n\t//\t\t\t\t\t\t{ observable: A, property: 'c', to: [ [ B, 'x' ] ] }\n\t//\t\t\t\t\t] ),\n\t//\t\t\t\t\ty: Set( [\n\t//\t\t\t\t\t\t{ observable: A, property: 'b', to: [ [ B, 'y' ] ] },\n\t//\t\t\t\t\t] )\n\t//\t\t\t\t}\n\t//\t\t\t} )\n\t//\n\t//\t\tA.bind( 'd' ).to( B, 'z' ).to( C, 'w' ).as( callback );\n\t//\t\tconsole.log( A._boundObservables );\n\t//\n\t//\t\t\tMap( {\n\t//\t\t\t\tB: {\n\t//\t\t\t\t\tx: Set( [\n\t//\t\t\t\t\t\t{ observable: A, property: 'a', to: [ [ B, 'x' ] ] },\n\t//\t\t\t\t\t\t{ observable: A, property: 'c', to: [ [ B, 'x' ] ] }\n\t//\t\t\t\t\t] ),\n\t//\t\t\t\t\ty: Set( [\n\t//\t\t\t\t\t\t{ observable: A, property: 'b', to: [ [ B, 'y' ] ] },\n\t//\t\t\t\t\t] ),\n\t//\t\t\t\t\tz: Set( [\n\t//\t\t\t\t\t\t{ observable: A, property: 'd', to: [ [ B, 'z' ], [ C, 'w' ] ], callback: callback }\n\t//\t\t\t\t\t] )\n\t//\t\t\t\t},\n\t//\t\t\t\tC: {\n\t//\t\t\t\t\tw: Set( [\n\t//\t\t\t\t\t\t{ observable: A, property: 'd', to: [ [ B, 'z' ], [ C, 'w' ] ], callback: callback }\n\t//\t\t\t\t\t] )\n\t//\t\t\t\t}\n\t//\t\t\t} )\n\t//\n\t// @private\n\t// @type {Map}\n\tObject.defineProperty( observable, boundObservablesSymbol, {\n\t\tvalue: new Map()\n\t} );\n\n\t// Object that stores which properties of this observable are bound and how. It shares\n\t// the binding objects (`{ observable: A, property: 'a', to: ... }`) with\n\t// {@link module:utils/observablemixin~ObservableMixin#_boundObservables}. This data structure is\n\t// a reverse of {@link module:utils/observablemixin~ObservableMixin#_boundObservables} and it is helpful for\n\t// {@link module:utils/observablemixin~ObservableMixin#unbind}.\n\t//\n\t// See {@link module:utils/observablemixin~ObservableMixin#bind}.\n\t//\n\t//\t\tA.bind( 'a', 'b', 'c' ).to( B, 'x', 'y', 'x' );\n\t//\t\tconsole.log( A._boundProperties );\n\t//\n\t//\t\t\tMap( {\n\t//\t\t\t\ta: { observable: A, property: 'a', to: [ [ B, 'x' ] ] },\n\t//\t\t\t\tb: { observable: A, property: 'b', to: [ [ B, 'y' ] ] },\n\t//\t\t\t\tc: { observable: A, property: 'c', to: [ [ B, 'x' ] ] }\n\t//\t\t\t} )\n\t//\n\t//\t\tA.bind( 'd' ).to( B, 'z' ).to( C, 'w' ).as( callback );\n\t//\t\tconsole.log( A._boundProperties );\n\t//\n\t//\t\t\tMap( {\n\t//\t\t\t\ta: { observable: A, property: 'a', to: [ [ B, 'x' ] ] },\n\t//\t\t\t\tb: { observable: A, property: 'b', to: [ [ B, 'y' ] ] },\n\t//\t\t\t\tc: { observable: A, property: 'c', to: [ [ B, 'x' ] ] },\n\t//\t\t\t\td: { observable: A, property: 'd', to: [ [ B, 'z' ], [ C, 'w' ] ], callback: callback }\n\t//\t\t\t} )\n\t//\n\t// @private\n\t// @type {Map}\n\tObject.defineProperty( observable, boundPropertiesSymbol, {\n\t\tvalue: new Map()\n\t} );\n}\n\n// A chaining for {@link module:utils/observablemixin~ObservableMixin#bind} providing `.to()` interface.\n//\n// @private\n// @param {...[Observable|String|Function]} args Arguments of the `.to( args )` binding.\nfunction bindTo( ...args ) {\n\tconst parsedArgs = parseBindToArgs( ...args );\n\tconst bindingsKeys = Array.from( this._bindings.keys() );\n\tconst numberOfBindings = bindingsKeys.length;\n\n\t// Eliminate A.bind( 'x' ).to( B, C )\n\tif ( !parsedArgs.callback && parsedArgs.to.length > 1 ) {\n\t\t/**\n\t\t * Binding multiple observables only possible with callback.\n\t\t *\n\t\t * @error observable-bind-to-no-callback\n\t\t */\n\t\tthrow new CKEditorError( 'observable-bind-to-no-callback', this );\n\t}\n\n\t// Eliminate A.bind( 'x', 'y' ).to( B, callback )\n\tif ( numberOfBindings > 1 && parsedArgs.callback ) {\n\t\t/**\n\t\t * Cannot bind multiple properties and use a callback in one binding.\n\t\t *\n\t\t * @error observable-bind-to-extra-callback\n\t\t */\n\t\tthrow new CKEditorError(\n\t\t\t'observable-bind-to-extra-callback',\n\t\t\tthis\n\t\t);\n\t}\n\n\tparsedArgs.to.forEach( to => {\n\t\t// Eliminate A.bind( 'x', 'y' ).to( B, 'a' )\n\t\tif ( to.properties.length && to.properties.length !== numberOfBindings ) {\n\t\t\t/**\n\t\t\t * The number of properties must match.\n\t\t\t *\n\t\t\t * @error observable-bind-to-properties-length\n\t\t\t */\n\t\t\tthrow new CKEditorError( 'observable-bind-to-properties-length', this );\n\t\t}\n\n\t\t// When no to.properties specified, observing source properties instead i.e.\n\t\t// A.bind( 'x', 'y' ).to( B ) -> Observe B.x and B.y\n\t\tif ( !to.properties.length ) {\n\t\t\tto.properties = this._bindProperties;\n\t\t}\n\t} );\n\n\tthis._to = parsedArgs.to;\n\n\t// Fill {@link BindChain#_bindings} with callback. When the callback is set there's only one binding.\n\tif ( parsedArgs.callback ) {\n\t\tthis._bindings.get( bindingsKeys[ 0 ] ).callback = parsedArgs.callback;\n\t}\n\n\tattachBindToListeners( this._observable, this._to );\n\n\t// Update observable._boundProperties and observable._boundObservables.\n\tupdateBindToBound( this );\n\n\t// Set initial values of bound properties.\n\tthis._bindProperties.forEach( propertyName => {\n\t\tupdateBoundObservableProperty( this._observable, propertyName );\n\t} );\n}\n\n// Binds to an attribute in a set of iterable observables.\n//\n// @private\n// @param {Array.<Observable>} observables\n// @param {String} attribute\n// @param {Function} callback\nfunction bindToMany( observables, attribute, callback ) {\n\tif ( this._bindings.size > 1 ) {\n\t\t/**\n\t\t * Binding one attribute to many observables only possible with one attribute.\n\t\t *\n\t\t * @error observable-bind-to-many-not-one-binding\n\t\t */\n\t\tthrow new CKEditorError( 'observable-bind-to-many-not-one-binding', this );\n\t}\n\n\tthis.to(\n\t\t// Bind to #attribute of each observable...\n\t\t...getBindingTargets( observables, attribute ),\n\t\t// ...using given callback to parse attribute values.\n\t\tcallback\n\t);\n}\n\n// Returns an array of binding components for\n// {@link Observable#bind} from a set of iterable observables.\n//\n// @param {Array.<Observable>} observables\n// @param {String} attribute\n// @returns {Array.<String|Observable>}\nfunction getBindingTargets( observables, attribute ) {\n\tconst observableAndAttributePairs = observables.map( observable => [ observable, attribute ] );\n\n\t// Merge pairs to one-dimension array of observables and attributes.\n\treturn Array.prototype.concat.apply( [], observableAndAttributePairs );\n}\n\n// Check if all entries of the array are of `String` type.\n//\n// @private\n// @param {Array} arr An array to be checked.\n// @returns {Boolean}\nfunction isStringArray( arr ) {\n\treturn arr.every( a => typeof a == 'string' );\n}\n\n// Parses and validates {@link Observable#bind}`.to( args )` arguments and returns\n// an object with a parsed structure. For example\n//\n//\t\tA.bind( 'x' ).to( B, 'a', C, 'b', call );\n//\n// becomes\n//\n//\t\t{\n//\t\t\tto: [\n//\t\t\t\t{ observable: B, properties: [ 'a' ] },\n//\t\t\t\t{ observable: C, properties: [ 'b' ] },\n//\t\t\t],\n//\t\t\tcallback: call\n// \t\t}\n//\n// @private\n// @param {...*} args Arguments of {@link Observable#bind}`.to( args )`.\n// @returns {Object}\nfunction parseBindToArgs( ...args ) {\n\t// Eliminate A.bind( 'x' ).to()\n\tif ( !args.length ) {\n\t\t/**\n\t\t * Invalid argument syntax in `to()`.\n\t\t *\n\t\t * @error observable-bind-to-parse-error\n\t\t */\n\t\tthrow new CKEditorError( 'observable-bind-to-parse-error', null );\n\t}\n\n\tconst parsed = { to: [] };\n\tlet lastObservable;\n\n\tif ( typeof args[ args.length - 1 ] == 'function' ) {\n\t\tparsed.callback = args.pop();\n\t}\n\n\targs.forEach( a => {\n\t\tif ( typeof a == 'string' ) {\n\t\t\tlastObservable.properties.push( a );\n\t\t} else if ( typeof a == 'object' ) {\n\t\t\tlastObservable = { observable: a, properties: [] };\n\t\t\tparsed.to.push( lastObservable );\n\t\t} else {\n\t\t\tthrow new CKEditorError( 'observable-bind-to-parse-error', null );\n\t\t}\n\t} );\n\n\treturn parsed;\n}\n\n// Synchronizes {@link module:utils/observablemixin#_boundObservables} with {@link Binding}.\n//\n// @private\n// @param {Binding} binding A binding to store in {@link Observable#_boundObservables}.\n// @param {Observable} toObservable A observable, which is a new component of `binding`.\n// @param {String} toPropertyName A name of `toObservable`'s property, a new component of the `binding`.\nfunction updateBoundObservables( observable, binding, toObservable, toPropertyName ) {\n\tconst boundObservables = observable[ boundObservablesSymbol ];\n\tconst bindingsToObservable = boundObservables.get( toObservable );\n\tconst bindings = bindingsToObservable || {};\n\n\tif ( !bindings[ toPropertyName ] ) {\n\t\tbindings[ toPropertyName ] = new Set();\n\t}\n\n\t// Pass the binding to a corresponding Set in `observable._boundObservables`.\n\tbindings[ toPropertyName ].add( binding );\n\n\tif ( !bindingsToObservable ) {\n\t\tboundObservables.set( toObservable, bindings );\n\t}\n}\n\n// Synchronizes {@link Observable#_boundProperties} and {@link Observable#_boundObservables}\n// with {@link BindChain}.\n//\n// Assuming the following binding being created\n//\n// \t\tA.bind( 'a', 'b' ).to( B, 'x', 'y' );\n//\n// the following bindings were initialized by {@link Observable#bind} in {@link BindChain#_bindings}:\n//\n// \t\t{\n// \t\t\ta: { observable: A, property: 'a', to: [] },\n// \t\t\tb: { observable: A, property: 'b', to: [] },\n// \t\t}\n//\n// Iterate over all bindings in this chain and fill their `to` properties with\n// corresponding to( ... ) arguments (components of the binding), so\n//\n// \t\t{\n// \t\t\ta: { observable: A, property: 'a', to: [ B, 'x' ] },\n// \t\t\tb: { observable: A, property: 'b', to: [ B, 'y' ] },\n// \t\t}\n//\n// Then update the structure of {@link Observable#_boundObservables} with updated\n// binding, so it becomes:\n//\n// \t\tMap( {\n// \t\t\tB: {\n// \t\t\t\tx: Set( [\n// \t\t\t\t\t{ observable: A, property: 'a', to: [ [ B, 'x' ] ] }\n// \t\t\t\t] ),\n// \t\t\t\ty: Set( [\n// \t\t\t\t\t{ observable: A, property: 'b', to: [ [ B, 'y' ] ] },\n// \t\t\t\t] )\n//\t\t\t}\n// \t\t} )\n//\n// @private\n// @param {BindChain} chain The binding initialized by {@link Observable#bind}.\nfunction updateBindToBound( chain ) {\n\tlet toProperty;\n\n\tchain._bindings.forEach( ( binding, propertyName ) => {\n\t\t// Note: For a binding without a callback, this will run only once\n\t\t// like in A.bind( 'x', 'y' ).to( B, 'a', 'b' )\n\t\t// TODO: ES6 destructuring.\n\t\tchain._to.forEach( to => {\n\t\t\ttoProperty = to.properties[ binding.callback ? 0 : chain._bindProperties.indexOf( propertyName ) ];\n\n\t\t\tbinding.to.push( [ to.observable, toProperty ] );\n\t\t\tupdateBoundObservables( chain._observable, binding, to.observable, toProperty );\n\t\t} );\n\t} );\n}\n\n// Updates an property of a {@link Observable} with a value\n// determined by an entry in {@link Observable#_boundProperties}.\n//\n// @private\n// @param {Observable} observable A observable which property is to be updated.\n// @param {String} propertyName An property to be updated.\nfunction updateBoundObservableProperty( observable, propertyName ) {\n\tconst boundProperties = observable[ boundPropertiesSymbol ];\n\tconst binding = boundProperties.get( propertyName );\n\tlet propertyValue;\n\n\t// When a binding with callback is created like\n\t//\n\t// \t\tA.bind( 'a' ).to( B, 'b', C, 'c', callback );\n\t//\n\t// collect B.b and C.c, then pass them to callback to set A.a.\n\tif ( binding.callback ) {\n\t\tpropertyValue = binding.callback.apply( observable, binding.to.map( to => to[ 0 ][ to[ 1 ] ] ) );\n\t} else {\n\t\tpropertyValue = binding.to[ 0 ];\n\t\tpropertyValue = propertyValue[ 0 ][ propertyValue[ 1 ] ];\n\t}\n\n\tif ( Object.prototype.hasOwnProperty.call( observable, propertyName ) ) {\n\t\tobservable[ propertyName ] = propertyValue;\n\t} else {\n\t\tobservable.set( propertyName, propertyValue );\n\t}\n}\n\n// Starts listening to changes in {@link BindChain._to} observables to update\n// {@link BindChain._observable} {@link BindChain._bindProperties}. Also sets the\n// initial state of {@link BindChain._observable}.\n//\n// @private\n// @param {BindChain} chain The chain initialized by {@link Observable#bind}.\nfunction attachBindToListeners( observable, toBindings ) {\n\ttoBindings.forEach( to => {\n\t\tconst boundObservables = observable[ boundObservablesSymbol ];\n\t\tlet bindings;\n\n\t\t// If there's already a chain between the observables (`observable` listens to\n\t\t// `to.observable`), there's no need to create another `change` event listener.\n\t\tif ( !boundObservables.get( to.observable ) ) {\n\t\t\tobservable.listenTo( to.observable, 'change', ( evt, propertyName ) => {\n\t\t\t\tbindings = boundObservables.get( to.observable )[ propertyName ];\n\n\t\t\t\t// Note: to.observable will fire for any property change, react\n\t\t\t\t// to changes of properties which are bound only.\n\t\t\t\tif ( bindings ) {\n\t\t\t\t\tbindings.forEach( binding => {\n\t\t\t\t\t\tupdateBoundObservableProperty( observable, binding.property );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t} );\n}\n\n/**\n * An interface which adds \"observable properties\" and data binding functionality.\n *\n * Can be easily implemented by a class by mixing the {@link module:utils/observablemixin~ObservableMixin} mixin.\n *\n * Read more about the usage of this interface in the:\n * * {@glink framework/guides/architecture/core-editor-architecture#event-system-and-observables \"Event system and observables\"}\n * section of the {@glink framework/guides/architecture/core-editor-architecture \"Core editor architecture\"} guide,\n * * {@glink framework/guides/deep-dive/observables \"Observables\" deep dive} guide.\n *\n * @interface Observable\n * @extends module:utils/emittermixin~Emitter\n */\n\n/**\n * Fired when a property changed value.\n *\n *\t\tobservable.set( 'prop', 1 );\n *\n *\t\tobservable.on( 'change:prop', ( evt, propertyName, newValue, oldValue ) => {\n *\t\t\tconsole.log( `${ propertyName } has changed from ${ oldValue } to ${ newValue }` );\n *\t\t} );\n *\n *\t\tobservable.prop = 2; // -> 'prop has changed from 1 to 2'\n *\n * @event change:{property}\n * @param {String} name The property name.\n * @param {*} value The new property value.\n * @param {*} oldValue The previous property value.\n */\n\n/**\n * Fired when a property value is going to be set but is not set yet (before the `change` event is fired).\n *\n * You can control the final value of the property by using\n * the {@link module:utils/eventinfo~EventInfo#return event's `return` property}.\n *\n *\t\tobservable.set( 'prop', 1 );\n *\n *\t\tobservable.on( 'set:prop', ( evt, propertyName, newValue, oldValue ) => {\n *\t\t\tconsole.log( `Value is going to be changed from ${ oldValue } to ${ newValue }` );\n *\t\t\tconsole.log( `Current property value is ${ observable[ propertyName ] }` );\n *\n *\t\t\t// Let's override the value.\n *\t\t\tevt.return = 3;\n *\t\t} );\n *\n *\t\tobservable.on( 'change:prop', ( evt, propertyName, newValue, oldValue ) => {\n *\t\t\tconsole.log( `Value has changed from ${ oldValue } to ${ newValue }` );\n *\t\t} );\n *\n *\t\tobservable.prop = 2; // -> 'Value is going to be changed from 1 to 2'\n *\t\t                     // -> 'Current property value is 1'\n *\t\t                     // -> 'Value has changed from 1 to 3'\n *\n * **Note:** The event is fired even when the new value is the same as the old value.\n *\n * @event set:{property}\n * @param {String} name The property name.\n * @param {*} value The new property value.\n * @param {*} oldValue The previous property value.\n */\n\n/**\n * Creates and sets the value of an observable property of this object. Such a property becomes a part\n * of the state and is observable.\n *\n * It accepts also a single object literal containing key/value pairs with properties to be set.\n *\n * This method throws the `observable-set-cannot-override` error if the observable instance already\n * has a property with the given property name. This prevents from mistakenly overriding existing\n * properties and methods, but means that `foo.set( 'bar', 1 )` may be slightly slower than `foo.bar = 1`.\n *\n * @method #set\n * @param {String|Object} name The property's name or object with `name=>value` pairs.\n * @param {*} [value] The property's value (if `name` was passed in the first parameter).\n */\n\n/**\n * Binds {@link #set observable properties} to other objects implementing the\n * {@link module:utils/observablemixin~Observable} interface.\n *\n * Read more in the {@glink framework/guides/deep-dive/observables#property-bindings dedicated guide}\n * covering the topic of property bindings with some additional examples.\n *\n * Consider two objects: a `button` and an associated `command` (both `Observable`).\n *\n * A simple property binding could be as follows:\n *\n *\t\tbutton.bind( 'isEnabled' ).to( command, 'isEnabled' );\n *\n * or even shorter:\n *\n *\t\tbutton.bind( 'isEnabled' ).to( command );\n *\n * which works in the following way:\n *\n * * `button.isEnabled` **instantly equals** `command.isEnabled`,\n * * whenever `command.isEnabled` changes, `button.isEnabled` will immediately reflect its value.\n *\n * **Note**: To release the binding, use {@link module:utils/observablemixin~Observable#unbind}.\n *\n * You can also \"rename\" the property in the binding by specifying the new name in the `to()` chain:\n *\n *\t\tbutton.bind( 'isEnabled' ).to( command, 'isWorking' );\n *\n * It is possible to bind more than one property at a time to shorten the code:\n *\n *\t\tbutton.bind( 'isEnabled', 'value' ).to( command );\n *\n * which corresponds to:\n *\n *\t\tbutton.bind( 'isEnabled' ).to( command );\n *\t\tbutton.bind( 'value' ).to( command );\n *\n * The binding can include more than one observable, combining multiple data sources in a custom callback:\n *\n *\t\tbutton.bind( 'isEnabled' ).to( command, 'isEnabled', ui, 'isVisible',\n *\t\t\t( isCommandEnabled, isUIVisible ) => isCommandEnabled && isUIVisible );\n *\n * Using a custom callback allows processing the value before passing it to the target property:\n *\n *\t\tbutton.bind( 'isEnabled' ).to( command, 'value', value => value === 'heading1' );\n *\n * It is also possible to bind to the same property in an array of observables.\n * To bind a `button` to multiple commands (also `Observables`) so that each and every one of them\n * must be enabled for the button to become enabled, use the following code:\n *\n *\t\tbutton.bind( 'isEnabled' ).toMany( [ commandA, commandB, commandC ], 'isEnabled',\n *\t\t\t( isAEnabled, isBEnabled, isCEnabled ) => isAEnabled && isBEnabled && isCEnabled );\n *\n * @method #bind\n * @param {...String} bindProperties Observable properties that will be bound to other observable(s).\n * @returns {Object} The bind chain with the `to()` and `toMany()` methods.\n */\n\n/**\n * Removes the binding created with {@link #bind}.\n *\n *\t\t// Removes the binding for the 'a' property.\n *\t\tA.unbind( 'a' );\n *\n *\t\t// Removes bindings for all properties.\n *\t\tA.unbind();\n *\n * @method #unbind\n * @param {...String} [unbindProperties] Observable properties to be unbound. All the bindings will\n * be released if no properties are provided.\n */\n\n/**\n * Turns the given methods of this object into event-based ones. This means that the new method will fire an event\n * (named after the method) and the original action will be plugged as a listener to that event.\n *\n * Read more in the {@glink framework/guides/deep-dive/observables#decorating-object-methods dedicated guide}\n * covering the topic of decorating methods with some additional examples.\n *\n * Decorating the method does not change its behavior (it only adds an event),\n * but it allows to modify it later on by listening to the method's event.\n *\n * For example, to cancel the method execution the event can be {@link module:utils/eventinfo~EventInfo#stop stopped}:\n *\n *\t\tclass Foo {\n *\t\t\tconstructor() {\n *\t\t\t\tthis.decorate( 'method' );\n *\t\t\t}\n *\n *\t\t\tmethod() {\n *\t\t\t\tconsole.log( 'called!' );\n *\t\t\t}\n *\t\t}\n *\n *\t\tconst foo = new Foo();\n *\t\tfoo.on( 'method', ( evt ) => {\n *\t\t\tevt.stop();\n *\t\t}, { priority: 'high' } );\n *\n *\t\tfoo.method(); // Nothing is logged.\n *\n *\n * **Note**: The high {@link module:utils/priorities~PriorityString priority} listener\n * has been used to execute this particular callback before the one which calls the original method\n * (which uses the \"normal\" priority).\n *\n * It is also possible to change the returned value:\n *\n *\t\tfoo.on( 'method', ( evt ) => {\n *\t\t\tevt.return = 'Foo!';\n *\t\t} );\n *\n *\t\tfoo.method(); // -> 'Foo'\n *\n * Finally, it is possible to access and modify the arguments the method is called with:\n *\n *\t\tmethod( a, b ) {\n *\t\t\tconsole.log( `${ a }, ${ b }`  );\n *\t\t}\n *\n *\t\t// ...\n *\n *\t\tfoo.on( 'method', ( evt, args ) => {\n *\t\t\targs[ 0 ] = 3;\n *\n *\t\t\tconsole.log( args[ 1 ] ); // -> 2\n *\t\t}, { priority: 'high' } );\n *\n *\t\tfoo.method( 1, 2 ); // -> '3, 2'\n *\n * @method #decorate\n * @param {String} methodName Name of the method to decorate.\n */\n"]}]}